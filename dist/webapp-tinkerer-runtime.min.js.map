{"version":3,"file":"webapp-tinkerer-runtime.min.js","sources":["../node_modules/tslib/tslib.es6.js","../node_modules/localforage/dist/localforage.js","../node_modules/javascript-interface-library/dist/javascript-interface-library.esm.js","../src/webapp-tinkerer-runtime.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/*!\n    localForage -- Offline Storage, Improved\n    Version 1.9.0\n    https://localforage.github.io/localForage\n    (c) 2013-2017 Mozilla, Apache License 2.0\n*/\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.localforage = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw (f.code=\"MODULE_NOT_FOUND\", f)}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(_dereq_,module,exports){\n'use strict';\nvar immediate = _dereq_(1);\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n\n},{\"1\":1}],3:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nif (typeof global.Promise !== 'function') {\n  global.Promise = _dereq_(2);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"2\":2}],4:[function(_dereq_,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getIDB() {\n    /* global indexedDB,webkitIndexedDB,mozIndexedDB,OIndexedDB,msIndexedDB */\n    try {\n        if (typeof indexedDB !== 'undefined') {\n            return indexedDB;\n        }\n        if (typeof webkitIndexedDB !== 'undefined') {\n            return webkitIndexedDB;\n        }\n        if (typeof mozIndexedDB !== 'undefined') {\n            return mozIndexedDB;\n        }\n        if (typeof OIndexedDB !== 'undefined') {\n            return OIndexedDB;\n        }\n        if (typeof msIndexedDB !== 'undefined') {\n            return msIndexedDB;\n        }\n    } catch (e) {\n        return;\n    }\n}\n\nvar idb = getIDB();\n\nfunction isIndexedDBValid() {\n    try {\n        // Initialize IndexedDB; fall back to vendor-prefixed versions\n        // if needed.\n        if (!idb || !idb.open) {\n            return false;\n        }\n        // We mimic PouchDB here;\n        //\n        // We test for openDatabase because IE Mobile identifies itself\n        // as Safari. Oh the lulz...\n        var isSafari = typeof openDatabase !== 'undefined' && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform);\n\n        var hasFetch = typeof fetch === 'function' && fetch.toString().indexOf('[native code') !== -1;\n\n        // Safari <10.1 does not meet our requirements for IDB support\n        // (see: https://github.com/pouchdb/pouchdb/issues/5572).\n        // Safari 10.1 shipped with fetch, we can use that to detect it.\n        // Note: this creates issues with `window.fetch` polyfills and\n        // overrides; see:\n        // https://github.com/localForage/localForage/issues/856\n        return (!isSafari || hasFetch) && typeof indexedDB !== 'undefined' &&\n        // some outdated implementations of IDB that appear on Samsung\n        // and HTC Android devices <4.4 are missing IDBKeyRange\n        // See: https://github.com/mozilla/localForage/issues/128\n        // See: https://github.com/mozilla/localForage/issues/272\n        typeof IDBKeyRange !== 'undefined';\n    } catch (e) {\n        return false;\n    }\n}\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\nfunction createBlob(parts, properties) {\n    /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n    parts = parts || [];\n    properties = properties || {};\n    try {\n        return new Blob(parts, properties);\n    } catch (e) {\n        if (e.name !== 'TypeError') {\n            throw e;\n        }\n        var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder : typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder : typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : WebKitBlobBuilder;\n        var builder = new Builder();\n        for (var i = 0; i < parts.length; i += 1) {\n            builder.append(parts[i]);\n        }\n        return builder.getBlob(properties.type);\n    }\n}\n\n// This is CommonJS because lie is an external dependency, so Rollup\n// can just ignore it.\nif (typeof Promise === 'undefined') {\n    // In the \"nopromises\" build this will just throw if you don't have\n    // a global promise object, but it would throw anyway later.\n    _dereq_(3);\n}\nvar Promise$1 = Promise;\n\nfunction executeCallback(promise, callback) {\n    if (callback) {\n        promise.then(function (result) {\n            callback(null, result);\n        }, function (error) {\n            callback(error);\n        });\n    }\n}\n\nfunction executeTwoCallbacks(promise, callback, errorCallback) {\n    if (typeof callback === 'function') {\n        promise.then(callback);\n    }\n\n    if (typeof errorCallback === 'function') {\n        promise[\"catch\"](errorCallback);\n    }\n}\n\nfunction normalizeKey(key) {\n    // Cast the key to a string, as that's all we can set as a key.\n    if (typeof key !== 'string') {\n        console.warn(key + ' used as a key, but it is not a string.');\n        key = String(key);\n    }\n\n    return key;\n}\n\nfunction getCallback() {\n    if (arguments.length && typeof arguments[arguments.length - 1] === 'function') {\n        return arguments[arguments.length - 1];\n    }\n}\n\n// Some code originally from async_storage.js in\n// [Gaia](https://github.com/mozilla-b2g/gaia).\n\nvar DETECT_BLOB_SUPPORT_STORE = 'local-forage-detect-blob-support';\nvar supportsBlobs = void 0;\nvar dbContexts = {};\nvar toString = Object.prototype.toString;\n\n// Transaction Modes\nvar READ_ONLY = 'readonly';\nvar READ_WRITE = 'readwrite';\n\n// Transform a binary string to an array buffer, because otherwise\n// weird stuff happens when you try to work with the binary string directly.\n// It is known.\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction _binStringToArrayBuffer(bin) {\n    var length = bin.length;\n    var buf = new ArrayBuffer(length);\n    var arr = new Uint8Array(buf);\n    for (var i = 0; i < length; i++) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return buf;\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\n// Code borrowed from PouchDB. See:\n// https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-adapter-idb/src/blobSupport.js\n//\nfunction _checkBlobSupportWithoutCaching(idb) {\n    return new Promise$1(function (resolve) {\n        var txn = idb.transaction(DETECT_BLOB_SUPPORT_STORE, READ_WRITE);\n        var blob = createBlob(['']);\n        txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob, 'key');\n\n        txn.onabort = function (e) {\n            // If the transaction aborts now its due to not being able to\n            // write to the database, likely due to the disk being full\n            e.preventDefault();\n            e.stopPropagation();\n            resolve(false);\n        };\n\n        txn.oncomplete = function () {\n            var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n            var matchedEdge = navigator.userAgent.match(/Edge\\//);\n            // MS Edge pretends to be Chrome 42:\n            // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n            resolve(matchedEdge || !matchedChrome || parseInt(matchedChrome[1], 10) >= 43);\n        };\n    })[\"catch\"](function () {\n        return false; // error, so assume unsupported\n    });\n}\n\nfunction _checkBlobSupport(idb) {\n    if (typeof supportsBlobs === 'boolean') {\n        return Promise$1.resolve(supportsBlobs);\n    }\n    return _checkBlobSupportWithoutCaching(idb).then(function (value) {\n        supportsBlobs = value;\n        return supportsBlobs;\n    });\n}\n\nfunction _deferReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Create a deferred object representing the current database operation.\n    var deferredOperation = {};\n\n    deferredOperation.promise = new Promise$1(function (resolve, reject) {\n        deferredOperation.resolve = resolve;\n        deferredOperation.reject = reject;\n    });\n\n    // Enqueue the deferred operation.\n    dbContext.deferredOperations.push(deferredOperation);\n\n    // Chain its promise to the database readiness.\n    if (!dbContext.dbReady) {\n        dbContext.dbReady = deferredOperation.promise;\n    } else {\n        dbContext.dbReady = dbContext.dbReady.then(function () {\n            return deferredOperation.promise;\n        });\n    }\n}\n\nfunction _advanceReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Resolve its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.resolve();\n        return deferredOperation.promise;\n    }\n}\n\nfunction _rejectReadiness(dbInfo, err) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Reject its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.reject(err);\n        return deferredOperation.promise;\n    }\n}\n\nfunction _getConnection(dbInfo, upgradeNeeded) {\n    return new Promise$1(function (resolve, reject) {\n        dbContexts[dbInfo.name] = dbContexts[dbInfo.name] || createDbContext();\n\n        if (dbInfo.db) {\n            if (upgradeNeeded) {\n                _deferReadiness(dbInfo);\n                dbInfo.db.close();\n            } else {\n                return resolve(dbInfo.db);\n            }\n        }\n\n        var dbArgs = [dbInfo.name];\n\n        if (upgradeNeeded) {\n            dbArgs.push(dbInfo.version);\n        }\n\n        var openreq = idb.open.apply(idb, dbArgs);\n\n        if (upgradeNeeded) {\n            openreq.onupgradeneeded = function (e) {\n                var db = openreq.result;\n                try {\n                    db.createObjectStore(dbInfo.storeName);\n                    if (e.oldVersion <= 1) {\n                        // Added when support for blob shims was added\n                        db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n                    }\n                } catch (ex) {\n                    if (ex.name === 'ConstraintError') {\n                        console.warn('The database \"' + dbInfo.name + '\"' + ' has been upgraded from version ' + e.oldVersion + ' to version ' + e.newVersion + ', but the storage \"' + dbInfo.storeName + '\" already exists.');\n                    } else {\n                        throw ex;\n                    }\n                }\n            };\n        }\n\n        openreq.onerror = function (e) {\n            e.preventDefault();\n            reject(openreq.error);\n        };\n\n        openreq.onsuccess = function () {\n            resolve(openreq.result);\n            _advanceReadiness(dbInfo);\n        };\n    });\n}\n\nfunction _getOriginalConnection(dbInfo) {\n    return _getConnection(dbInfo, false);\n}\n\nfunction _getUpgradedConnection(dbInfo) {\n    return _getConnection(dbInfo, true);\n}\n\nfunction _isUpgradeNeeded(dbInfo, defaultVersion) {\n    if (!dbInfo.db) {\n        return true;\n    }\n\n    var isNewStore = !dbInfo.db.objectStoreNames.contains(dbInfo.storeName);\n    var isDowngrade = dbInfo.version < dbInfo.db.version;\n    var isUpgrade = dbInfo.version > dbInfo.db.version;\n\n    if (isDowngrade) {\n        // If the version is not the default one\n        // then warn for impossible downgrade.\n        if (dbInfo.version !== defaultVersion) {\n            console.warn('The database \"' + dbInfo.name + '\"' + \" can't be downgraded from version \" + dbInfo.db.version + ' to version ' + dbInfo.version + '.');\n        }\n        // Align the versions to prevent errors.\n        dbInfo.version = dbInfo.db.version;\n    }\n\n    if (isUpgrade || isNewStore) {\n        // If the store is new then increment the version (if needed).\n        // This will trigger an \"upgradeneeded\" event which is required\n        // for creating a store.\n        if (isNewStore) {\n            var incVersion = dbInfo.db.version + 1;\n            if (incVersion > dbInfo.version) {\n                dbInfo.version = incVersion;\n            }\n        }\n\n        return true;\n    }\n\n    return false;\n}\n\n// encode a blob for indexeddb engines that don't support blobs\nfunction _encodeBlob(blob) {\n    return new Promise$1(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = function (e) {\n            var base64 = btoa(e.target.result || '');\n            resolve({\n                __local_forage_encoded_blob: true,\n                data: base64,\n                type: blob.type\n            });\n        };\n        reader.readAsBinaryString(blob);\n    });\n}\n\n// decode an encoded blob\nfunction _decodeBlob(encodedBlob) {\n    var arrayBuff = _binStringToArrayBuffer(atob(encodedBlob.data));\n    return createBlob([arrayBuff], { type: encodedBlob.type });\n}\n\n// is this one of our fancy encoded blobs?\nfunction _isEncodedBlob(value) {\n    return value && value.__local_forage_encoded_blob;\n}\n\n// Specialize the default `ready()` function by making it dependent\n// on the current database operations. Thus, the driver will be actually\n// ready when it's been initialized (default) *and* there are no pending\n// operations on the database (initiated by some other instances).\nfunction _fullyReady(callback) {\n    var self = this;\n\n    var promise = self._initReady().then(function () {\n        var dbContext = dbContexts[self._dbInfo.name];\n\n        if (dbContext && dbContext.dbReady) {\n            return dbContext.dbReady;\n        }\n    });\n\n    executeTwoCallbacks(promise, callback, callback);\n    return promise;\n}\n\n// Try to establish a new db connection to replace the\n// current one which is broken (i.e. experiencing\n// InvalidStateError while creating a transaction).\nfunction _tryReconnect(dbInfo) {\n    _deferReadiness(dbInfo);\n\n    var dbContext = dbContexts[dbInfo.name];\n    var forages = dbContext.forages;\n\n    for (var i = 0; i < forages.length; i++) {\n        var forage = forages[i];\n        if (forage._dbInfo.db) {\n            forage._dbInfo.db.close();\n            forage._dbInfo.db = null;\n        }\n    }\n    dbInfo.db = null;\n\n    return _getOriginalConnection(dbInfo).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        // store the latest db reference\n        // in case the db was upgraded\n        dbInfo.db = dbContext.db = db;\n        for (var i = 0; i < forages.length; i++) {\n            forages[i]._dbInfo.db = db;\n        }\n    })[\"catch\"](function (err) {\n        _rejectReadiness(dbInfo, err);\n        throw err;\n    });\n}\n\n// FF doesn't like Promises (micro-tasks) and IDDB store operations,\n// so we have to do it with callbacks\nfunction createTransaction(dbInfo, mode, callback, retries) {\n    if (retries === undefined) {\n        retries = 1;\n    }\n\n    try {\n        var tx = dbInfo.db.transaction(dbInfo.storeName, mode);\n        callback(null, tx);\n    } catch (err) {\n        if (retries > 0 && (!dbInfo.db || err.name === 'InvalidStateError' || err.name === 'NotFoundError')) {\n            return Promise$1.resolve().then(function () {\n                if (!dbInfo.db || err.name === 'NotFoundError' && !dbInfo.db.objectStoreNames.contains(dbInfo.storeName) && dbInfo.version <= dbInfo.db.version) {\n                    // increase the db version, to create the new ObjectStore\n                    if (dbInfo.db) {\n                        dbInfo.version = dbInfo.db.version + 1;\n                    }\n                    // Reopen the database for upgrading.\n                    return _getUpgradedConnection(dbInfo);\n                }\n            }).then(function () {\n                return _tryReconnect(dbInfo).then(function () {\n                    createTransaction(dbInfo, mode, callback, retries - 1);\n                });\n            })[\"catch\"](callback);\n        }\n\n        callback(err);\n    }\n}\n\nfunction createDbContext() {\n    return {\n        // Running localForages sharing a database.\n        forages: [],\n        // Shared database.\n        db: null,\n        // Database readiness (promise).\n        dbReady: null,\n        // Deferred operations on the database.\n        deferredOperations: []\n    };\n}\n\n// Open the IndexedDB database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    // Get the current context of the database;\n    var dbContext = dbContexts[dbInfo.name];\n\n    // ...or create a new context.\n    if (!dbContext) {\n        dbContext = createDbContext();\n        // Register the new context in the global container.\n        dbContexts[dbInfo.name] = dbContext;\n    }\n\n    // Register itself as a running localForage in the current context.\n    dbContext.forages.push(self);\n\n    // Replace the default `ready()` function with the specialized one.\n    if (!self._initReady) {\n        self._initReady = self.ready;\n        self.ready = _fullyReady;\n    }\n\n    // Create an array of initialization states of the related localForages.\n    var initPromises = [];\n\n    function ignoreErrors() {\n        // Don't handle errors here,\n        // just makes sure related localForages aren't pending.\n        return Promise$1.resolve();\n    }\n\n    for (var j = 0; j < dbContext.forages.length; j++) {\n        var forage = dbContext.forages[j];\n        if (forage !== self) {\n            // Don't wait for itself...\n            initPromises.push(forage._initReady()[\"catch\"](ignoreErrors));\n        }\n    }\n\n    // Take a snapshot of the related localForages.\n    var forages = dbContext.forages.slice(0);\n\n    // Initialize the connection process only when\n    // all the related localForages aren't pending.\n    return Promise$1.all(initPromises).then(function () {\n        dbInfo.db = dbContext.db;\n        // Get the connection or open a new one without upgrade.\n        return _getOriginalConnection(dbInfo);\n    }).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo, self._defaultConfig.version)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        dbInfo.db = dbContext.db = db;\n        self._dbInfo = dbInfo;\n        // Share the final connection amongst related localForages.\n        for (var k = 0; k < forages.length; k++) {\n            var forage = forages[k];\n            if (forage !== self) {\n                // Self is already up-to-date.\n                forage._dbInfo.db = dbInfo.db;\n                forage._dbInfo.version = dbInfo.version;\n            }\n        }\n    });\n}\n\nfunction getItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.get(key);\n\n                    req.onsuccess = function () {\n                        var value = req.result;\n                        if (value === undefined) {\n                            value = null;\n                        }\n                        if (_isEncodedBlob(value)) {\n                            value = _decodeBlob(value);\n                        }\n                        resolve(value);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items stored in database.\nfunction iterate(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openCursor();\n                    var iterationNumber = 1;\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (cursor) {\n                            var value = cursor.value;\n                            if (_isEncodedBlob(value)) {\n                                value = _decodeBlob(value);\n                            }\n                            var result = iterator(value, cursor.key, iterationNumber++);\n\n                            // when the iterator callback returns any\n                            // (non-`undefined`) value, then we stop\n                            // the iteration immediately\n                            if (result !== void 0) {\n                                resolve(result);\n                            } else {\n                                cursor[\"continue\"]();\n                            }\n                        } else {\n                            resolve();\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n\n    return promise;\n}\n\nfunction setItem(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        var dbInfo;\n        self.ready().then(function () {\n            dbInfo = self._dbInfo;\n            if (toString.call(value) === '[object Blob]') {\n                return _checkBlobSupport(dbInfo.db).then(function (blobSupport) {\n                    if (blobSupport) {\n                        return value;\n                    }\n                    return _encodeBlob(value);\n                });\n            }\n            return value;\n        }).then(function (value) {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n\n                    // The reason we don't _save_ null is because IE 10 does\n                    // not support saving the `null` type in IndexedDB. How\n                    // ironic, given the bug below!\n                    // See: https://github.com/mozilla/localForage/issues/161\n                    if (value === null) {\n                        value = undefined;\n                    }\n\n                    var req = store.put(value, key);\n\n                    transaction.oncomplete = function () {\n                        // Cast to undefined so the value passed to\n                        // callback/promise is the same as what one would get out\n                        // of `getItem()` later. This leads to some weirdness\n                        // (setItem('foo', undefined) will return `null`), but\n                        // it's not my fault localStorage is our baseline and that\n                        // it's weird.\n                        if (value === undefined) {\n                            value = null;\n                        }\n\n                        resolve(value);\n                    };\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction removeItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    // We use a Grunt task to make this safe for IE and some\n                    // versions of Android (including those used by Cordova).\n                    // Normally IE won't like `.delete()` and will insist on\n                    // using `['delete']()`, but we have a build step that\n                    // fixes this for us now.\n                    var req = store[\"delete\"](key);\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onerror = function () {\n                        reject(req.error);\n                    };\n\n                    // The request will be also be aborted if we've exceeded our storage\n                    // space.\n                    transaction.onabort = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction clear(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.clear();\n\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction length(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.count();\n\n                    req.onsuccess = function () {\n                        resolve(req.result);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction key(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        if (n < 0) {\n            resolve(null);\n\n            return;\n        }\n\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var advanced = false;\n                    var req = store.openKeyCursor();\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            // this means there weren't enough keys\n                            resolve(null);\n\n                            return;\n                        }\n\n                        if (n === 0) {\n                            // We have the first key, return it if that's what they\n                            // wanted.\n                            resolve(cursor.key);\n                        } else {\n                            if (!advanced) {\n                                // Otherwise, ask the cursor to skip ahead n\n                                // records.\n                                advanced = true;\n                                cursor.advance(n);\n                            } else {\n                                // When we get here, we've got the nth key.\n                                resolve(cursor.key);\n                            }\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openKeyCursor();\n                    var keys = [];\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (!cursor) {\n                            resolve(keys);\n                            return;\n                        }\n\n                        keys.push(cursor.key);\n                        cursor[\"continue\"]();\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        var isCurrentDb = options.name === currentConfig.name && self._dbInfo.db;\n\n        var dbPromise = isCurrentDb ? Promise$1.resolve(self._dbInfo.db) : _getOriginalConnection(options).then(function (db) {\n            var dbContext = dbContexts[options.name];\n            var forages = dbContext.forages;\n            dbContext.db = db;\n            for (var i = 0; i < forages.length; i++) {\n                forages[i]._dbInfo.db = db;\n            }\n            return db;\n        });\n\n        if (!options.storeName) {\n            promise = dbPromise.then(function (db) {\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                }\n\n                var dropDBPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.deleteDatabase(options.name);\n\n                    req.onerror = req.onblocked = function (err) {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        reject(err);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        resolve(db);\n                    };\n                });\n\n                return dropDBPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var i = 0; i < forages.length; i++) {\n                        var _forage = forages[i];\n                        _advanceReadiness(_forage._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        } else {\n            promise = dbPromise.then(function (db) {\n                if (!db.objectStoreNames.contains(options.storeName)) {\n                    return;\n                }\n\n                var newVersion = db.version + 1;\n\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                    forage._dbInfo.version = newVersion;\n                }\n\n                var dropObjectPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.open(options.name, newVersion);\n\n                    req.onerror = function (err) {\n                        var db = req.result;\n                        db.close();\n                        reject(err);\n                    };\n\n                    req.onupgradeneeded = function () {\n                        var db = req.result;\n                        db.deleteObjectStore(options.storeName);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        db.close();\n                        resolve(db);\n                    };\n                });\n\n                return dropObjectPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var j = 0; j < forages.length; j++) {\n                        var _forage2 = forages[j];\n                        _forage2._dbInfo.db = db;\n                        _advanceReadiness(_forage2._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        }\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar asyncStorage = {\n    _driver: 'asyncStorage',\n    _initStorage: _initStorage,\n    _support: isIndexedDBValid(),\n    iterate: iterate,\n    getItem: getItem,\n    setItem: setItem,\n    removeItem: removeItem,\n    clear: clear,\n    length: length,\n    key: key,\n    keys: keys,\n    dropInstance: dropInstance\n};\n\nfunction isWebSQLValid() {\n    return typeof openDatabase === 'function';\n}\n\n// Sadly, the best way to save binary data in WebSQL/localStorage is serializing\n// it to Base64, so this is how we store it to prevent very strange errors with less\n// verbose ways of binary <-> string data storage.\nvar BASE_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nvar BLOB_TYPE_PREFIX = '~~local_forage_type~';\nvar BLOB_TYPE_PREFIX_REGEX = /^~~local_forage_type~([^~]+)~/;\n\nvar SERIALIZED_MARKER = '__lfsc__:';\nvar SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER.length;\n\n// OMG the serializations!\nvar TYPE_ARRAYBUFFER = 'arbf';\nvar TYPE_BLOB = 'blob';\nvar TYPE_INT8ARRAY = 'si08';\nvar TYPE_UINT8ARRAY = 'ui08';\nvar TYPE_UINT8CLAMPEDARRAY = 'uic8';\nvar TYPE_INT16ARRAY = 'si16';\nvar TYPE_INT32ARRAY = 'si32';\nvar TYPE_UINT16ARRAY = 'ur16';\nvar TYPE_UINT32ARRAY = 'ui32';\nvar TYPE_FLOAT32ARRAY = 'fl32';\nvar TYPE_FLOAT64ARRAY = 'fl64';\nvar TYPE_SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER_LENGTH + TYPE_ARRAYBUFFER.length;\n\nvar toString$1 = Object.prototype.toString;\n\nfunction stringToBuffer(serializedString) {\n    // Fill the string into a ArrayBuffer.\n    var bufferLength = serializedString.length * 0.75;\n    var len = serializedString.length;\n    var i;\n    var p = 0;\n    var encoded1, encoded2, encoded3, encoded4;\n\n    if (serializedString[serializedString.length - 1] === '=') {\n        bufferLength--;\n        if (serializedString[serializedString.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n\n    var buffer = new ArrayBuffer(bufferLength);\n    var bytes = new Uint8Array(buffer);\n\n    for (i = 0; i < len; i += 4) {\n        encoded1 = BASE_CHARS.indexOf(serializedString[i]);\n        encoded2 = BASE_CHARS.indexOf(serializedString[i + 1]);\n        encoded3 = BASE_CHARS.indexOf(serializedString[i + 2]);\n        encoded4 = BASE_CHARS.indexOf(serializedString[i + 3]);\n\n        /*jslint bitwise: true */\n        bytes[p++] = encoded1 << 2 | encoded2 >> 4;\n        bytes[p++] = (encoded2 & 15) << 4 | encoded3 >> 2;\n        bytes[p++] = (encoded3 & 3) << 6 | encoded4 & 63;\n    }\n    return buffer;\n}\n\n// Converts a buffer to a string to store, serialized, in the backend\n// storage library.\nfunction bufferToString(buffer) {\n    // base64-arraybuffer\n    var bytes = new Uint8Array(buffer);\n    var base64String = '';\n    var i;\n\n    for (i = 0; i < bytes.length; i += 3) {\n        /*jslint bitwise: true */\n        base64String += BASE_CHARS[bytes[i] >> 2];\n        base64String += BASE_CHARS[(bytes[i] & 3) << 4 | bytes[i + 1] >> 4];\n        base64String += BASE_CHARS[(bytes[i + 1] & 15) << 2 | bytes[i + 2] >> 6];\n        base64String += BASE_CHARS[bytes[i + 2] & 63];\n    }\n\n    if (bytes.length % 3 === 2) {\n        base64String = base64String.substring(0, base64String.length - 1) + '=';\n    } else if (bytes.length % 3 === 1) {\n        base64String = base64String.substring(0, base64String.length - 2) + '==';\n    }\n\n    return base64String;\n}\n\n// Serialize a value, afterwards executing a callback (which usually\n// instructs the `setItem()` callback/promise to be executed). This is how\n// we store binary data with localStorage.\nfunction serialize(value, callback) {\n    var valueType = '';\n    if (value) {\n        valueType = toString$1.call(value);\n    }\n\n    // Cannot use `value instanceof ArrayBuffer` or such here, as these\n    // checks fail when running the tests using casper.js...\n    //\n    // TODO: See why those tests fail and use a better solution.\n    if (value && (valueType === '[object ArrayBuffer]' || value.buffer && toString$1.call(value.buffer) === '[object ArrayBuffer]')) {\n        // Convert binary arrays to a string and prefix the string with\n        // a special marker.\n        var buffer;\n        var marker = SERIALIZED_MARKER;\n\n        if (value instanceof ArrayBuffer) {\n            buffer = value;\n            marker += TYPE_ARRAYBUFFER;\n        } else {\n            buffer = value.buffer;\n\n            if (valueType === '[object Int8Array]') {\n                marker += TYPE_INT8ARRAY;\n            } else if (valueType === '[object Uint8Array]') {\n                marker += TYPE_UINT8ARRAY;\n            } else if (valueType === '[object Uint8ClampedArray]') {\n                marker += TYPE_UINT8CLAMPEDARRAY;\n            } else if (valueType === '[object Int16Array]') {\n                marker += TYPE_INT16ARRAY;\n            } else if (valueType === '[object Uint16Array]') {\n                marker += TYPE_UINT16ARRAY;\n            } else if (valueType === '[object Int32Array]') {\n                marker += TYPE_INT32ARRAY;\n            } else if (valueType === '[object Uint32Array]') {\n                marker += TYPE_UINT32ARRAY;\n            } else if (valueType === '[object Float32Array]') {\n                marker += TYPE_FLOAT32ARRAY;\n            } else if (valueType === '[object Float64Array]') {\n                marker += TYPE_FLOAT64ARRAY;\n            } else {\n                callback(new Error('Failed to get type for BinaryArray'));\n            }\n        }\n\n        callback(marker + bufferToString(buffer));\n    } else if (valueType === '[object Blob]') {\n        // Conver the blob to a binaryArray and then to a string.\n        var fileReader = new FileReader();\n\n        fileReader.onload = function () {\n            // Backwards-compatible prefix for the blob type.\n            var str = BLOB_TYPE_PREFIX + value.type + '~' + bufferToString(this.result);\n\n            callback(SERIALIZED_MARKER + TYPE_BLOB + str);\n        };\n\n        fileReader.readAsArrayBuffer(value);\n    } else {\n        try {\n            callback(JSON.stringify(value));\n        } catch (e) {\n            console.error(\"Couldn't convert value into a JSON string: \", value);\n\n            callback(null, e);\n        }\n    }\n}\n\n// Deserialize data we've inserted into a value column/field. We place\n// special markers into our strings to mark them as encoded; this isn't\n// as nice as a meta field, but it's the only sane thing we can do whilst\n// keeping localStorage support intact.\n//\n// Oftentimes this will just deserialize JSON content, but if we have a\n// special marker (SERIALIZED_MARKER, defined above), we will extract\n// some kind of arraybuffer/binary data/typed array out of the string.\nfunction deserialize(value) {\n    // If we haven't marked this string as being specially serialized (i.e.\n    // something other than serialized JSON), we can just return it and be\n    // done with it.\n    if (value.substring(0, SERIALIZED_MARKER_LENGTH) !== SERIALIZED_MARKER) {\n        return JSON.parse(value);\n    }\n\n    // The following code deals with deserializing some kind of Blob or\n    // TypedArray. First we separate out the type of data we're dealing\n    // with from the data itself.\n    var serializedString = value.substring(TYPE_SERIALIZED_MARKER_LENGTH);\n    var type = value.substring(SERIALIZED_MARKER_LENGTH, TYPE_SERIALIZED_MARKER_LENGTH);\n\n    var blobType;\n    // Backwards-compatible blob type serialization strategy.\n    // DBs created with older versions of localForage will simply not have the blob type.\n    if (type === TYPE_BLOB && BLOB_TYPE_PREFIX_REGEX.test(serializedString)) {\n        var matcher = serializedString.match(BLOB_TYPE_PREFIX_REGEX);\n        blobType = matcher[1];\n        serializedString = serializedString.substring(matcher[0].length);\n    }\n    var buffer = stringToBuffer(serializedString);\n\n    // Return the right type based on the code/type set during\n    // serialization.\n    switch (type) {\n        case TYPE_ARRAYBUFFER:\n            return buffer;\n        case TYPE_BLOB:\n            return createBlob([buffer], { type: blobType });\n        case TYPE_INT8ARRAY:\n            return new Int8Array(buffer);\n        case TYPE_UINT8ARRAY:\n            return new Uint8Array(buffer);\n        case TYPE_UINT8CLAMPEDARRAY:\n            return new Uint8ClampedArray(buffer);\n        case TYPE_INT16ARRAY:\n            return new Int16Array(buffer);\n        case TYPE_UINT16ARRAY:\n            return new Uint16Array(buffer);\n        case TYPE_INT32ARRAY:\n            return new Int32Array(buffer);\n        case TYPE_UINT32ARRAY:\n            return new Uint32Array(buffer);\n        case TYPE_FLOAT32ARRAY:\n            return new Float32Array(buffer);\n        case TYPE_FLOAT64ARRAY:\n            return new Float64Array(buffer);\n        default:\n            throw new Error('Unkown type: ' + type);\n    }\n}\n\nvar localforageSerializer = {\n    serialize: serialize,\n    deserialize: deserialize,\n    stringToBuffer: stringToBuffer,\n    bufferToString: bufferToString\n};\n\n/*\n * Includes code from:\n *\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nfunction createDbTable(t, dbInfo, callback, errorCallback) {\n    t.executeSql('CREATE TABLE IF NOT EXISTS ' + dbInfo.storeName + ' ' + '(id INTEGER PRIMARY KEY, key unique, value)', [], callback, errorCallback);\n}\n\n// Open the WebSQL database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage$1(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = typeof options[i] !== 'string' ? options[i].toString() : options[i];\n        }\n    }\n\n    var dbInfoPromise = new Promise$1(function (resolve, reject) {\n        // Open the database; the openDatabase API will automatically\n        // create it for us if it doesn't exist.\n        try {\n            dbInfo.db = openDatabase(dbInfo.name, String(dbInfo.version), dbInfo.description, dbInfo.size);\n        } catch (e) {\n            return reject(e);\n        }\n\n        // Create our key/value table if it doesn't exist.\n        dbInfo.db.transaction(function (t) {\n            createDbTable(t, dbInfo, function () {\n                self._dbInfo = dbInfo;\n                resolve();\n            }, function (t, error) {\n                reject(error);\n            });\n        }, reject);\n    });\n\n    dbInfo.serializer = localforageSerializer;\n    return dbInfoPromise;\n}\n\nfunction tryExecuteSql(t, dbInfo, sqlStatement, args, callback, errorCallback) {\n    t.executeSql(sqlStatement, args, callback, function (t, error) {\n        if (error.code === error.SYNTAX_ERR) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name = ?\", [dbInfo.storeName], function (t, results) {\n                if (!results.rows.length) {\n                    // if the table is missing (was deleted)\n                    // re-create it table and retry\n                    createDbTable(t, dbInfo, function () {\n                        t.executeSql(sqlStatement, args, callback, errorCallback);\n                    }, errorCallback);\n                } else {\n                    errorCallback(t, error);\n                }\n            }, errorCallback);\n        } else {\n            errorCallback(t, error);\n        }\n    }, errorCallback);\n}\n\nfunction getItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName + ' WHERE key = ? LIMIT 1', [key], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).value : null;\n\n                    // Check to see if this is serialized content we need to\n                    // unpack.\n                    if (result) {\n                        result = dbInfo.serializer.deserialize(result);\n                    }\n\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction iterate$1(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var rows = results.rows;\n                    var length = rows.length;\n\n                    for (var i = 0; i < length; i++) {\n                        var item = rows.item(i);\n                        var result = item.value;\n\n                        // Check to see if this is serialized content\n                        // we need to unpack.\n                        if (result) {\n                            result = dbInfo.serializer.deserialize(result);\n                        }\n\n                        result = iterator(result, item.key, i + 1);\n\n                        // void(0) prevents problems with redefinition\n                        // of `undefined`.\n                        if (result !== void 0) {\n                            resolve(result);\n                            return;\n                        }\n                    }\n\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction _setItem(key, value, callback, retriesLeft) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            // The localStorage API doesn't return undefined values in an\n            // \"expected\" way, so undefined is always cast to null in all\n            // drivers. See: https://github.com/mozilla/localForage/pull/42\n            if (value === undefined) {\n                value = null;\n            }\n\n            // Save the original value to pass to the callback.\n            var originalValue = value;\n\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    dbInfo.db.transaction(function (t) {\n                        tryExecuteSql(t, dbInfo, 'INSERT OR REPLACE INTO ' + dbInfo.storeName + ' ' + '(key, value) VALUES (?, ?)', [key, value], function () {\n                            resolve(originalValue);\n                        }, function (t, error) {\n                            reject(error);\n                        });\n                    }, function (sqlError) {\n                        // The transaction failed; check\n                        // to see if it's a quota error.\n                        if (sqlError.code === sqlError.QUOTA_ERR) {\n                            // We reject the callback outright for now, but\n                            // it's worth trying to re-run the transaction.\n                            // Even if the user accepts the prompt to use\n                            // more storage on Safari, this error will\n                            // be called.\n                            //\n                            // Try to re-run the transaction.\n                            if (retriesLeft > 0) {\n                                resolve(_setItem.apply(self, [key, originalValue, callback, retriesLeft - 1]));\n                                return;\n                            }\n                            reject(sqlError);\n                        }\n                    });\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction setItem$1(key, value, callback) {\n    return _setItem.apply(this, [key, value, callback, 1]);\n}\n\nfunction removeItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName + ' WHERE key = ?', [key], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Deletes every item in the table.\n// TODO: Find out if this resets the AUTO_INCREMENT number.\nfunction clear$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName, [], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Does a simple `COUNT(key)` to get the number of items stored in\n// localForage.\nfunction length$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                // Ahhh, SQL makes this one soooooo easy.\n                tryExecuteSql(t, dbInfo, 'SELECT COUNT(key) as c FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var result = results.rows.item(0).c;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Return the key located at key index X; essentially gets the key from a\n// `WHERE id = ?`. This is the most efficient way I can think to implement\n// this rarely-used (in my experience) part of the API, but it can seem\n// inconsistent, because we do `INSERT OR REPLACE INTO` on `setItem()`, so\n// the ID of each key will change every time it's updated. Perhaps a stored\n// procedure for the `setItem()` SQL would solve this problem?\n// TODO: Don't change ID on `setItem()`.\nfunction key$1(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName + ' WHERE id = ? LIMIT 1', [n + 1], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).key : null;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var keys = [];\n\n                    for (var i = 0; i < results.rows.length; i++) {\n                        keys.push(results.rows.item(i).key);\n                    }\n\n                    resolve(keys);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// https://www.w3.org/TR/webdatabase/#databases\n// > There is no way to enumerate or delete the databases available for an origin from this API.\nfunction getAllStoreNames(db) {\n    return new Promise$1(function (resolve, reject) {\n        db.transaction(function (t) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'\", [], function (t, results) {\n                var storeNames = [];\n\n                for (var i = 0; i < results.rows.length; i++) {\n                    storeNames.push(results.rows.item(i).name);\n                }\n\n                resolve({\n                    db: db,\n                    storeNames: storeNames\n                });\n            }, function (t, error) {\n                reject(error);\n            });\n        }, function (sqlError) {\n            reject(sqlError);\n        });\n    });\n}\n\nfunction dropInstance$1(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            var db;\n            if (options.name === currentConfig.name) {\n                // use the db reference of the current instance\n                db = self._dbInfo.db;\n            } else {\n                db = openDatabase(options.name, '', '', 0);\n            }\n\n            if (!options.storeName) {\n                // drop all database tables\n                resolve(getAllStoreNames(db));\n            } else {\n                resolve({\n                    db: db,\n                    storeNames: [options.storeName]\n                });\n            }\n        }).then(function (operationInfo) {\n            return new Promise$1(function (resolve, reject) {\n                operationInfo.db.transaction(function (t) {\n                    function dropTable(storeName) {\n                        return new Promise$1(function (resolve, reject) {\n                            t.executeSql('DROP TABLE IF EXISTS ' + storeName, [], function () {\n                                resolve();\n                            }, function (t, error) {\n                                reject(error);\n                            });\n                        });\n                    }\n\n                    var operations = [];\n                    for (var i = 0, len = operationInfo.storeNames.length; i < len; i++) {\n                        operations.push(dropTable(operationInfo.storeNames[i]));\n                    }\n\n                    Promise$1.all(operations).then(function () {\n                        resolve();\n                    })[\"catch\"](function (e) {\n                        reject(e);\n                    });\n                }, function (sqlError) {\n                    reject(sqlError);\n                });\n            });\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar webSQLStorage = {\n    _driver: 'webSQLStorage',\n    _initStorage: _initStorage$1,\n    _support: isWebSQLValid(),\n    iterate: iterate$1,\n    getItem: getItem$1,\n    setItem: setItem$1,\n    removeItem: removeItem$1,\n    clear: clear$1,\n    length: length$1,\n    key: key$1,\n    keys: keys$1,\n    dropInstance: dropInstance$1\n};\n\nfunction isLocalStorageValid() {\n    try {\n        return typeof localStorage !== 'undefined' && 'setItem' in localStorage &&\n        // in IE8 typeof localStorage.setItem === 'object'\n        !!localStorage.setItem;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction _getKeyPrefix(options, defaultConfig) {\n    var keyPrefix = options.name + '/';\n\n    if (options.storeName !== defaultConfig.storeName) {\n        keyPrefix += options.storeName + '/';\n    }\n    return keyPrefix;\n}\n\n// Check if localStorage throws when saving an item\nfunction checkIfLocalStorageThrows() {\n    var localStorageTestKey = '_localforage_support_test';\n\n    try {\n        localStorage.setItem(localStorageTestKey, true);\n        localStorage.removeItem(localStorageTestKey);\n\n        return false;\n    } catch (e) {\n        return true;\n    }\n}\n\n// Check if localStorage is usable and allows to save an item\n// This method checks if localStorage is usable in Safari Private Browsing\n// mode, or in any other case where the available quota for localStorage\n// is 0 and there wasn't any saved items yet.\nfunction _isLocalStorageUsable() {\n    return !checkIfLocalStorageThrows() || localStorage.length > 0;\n}\n\n// Config the localStorage backend, using options set in the config.\nfunction _initStorage$2(options) {\n    var self = this;\n    var dbInfo = {};\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    dbInfo.keyPrefix = _getKeyPrefix(options, self._defaultConfig);\n\n    if (!_isLocalStorageUsable()) {\n        return Promise$1.reject();\n    }\n\n    self._dbInfo = dbInfo;\n    dbInfo.serializer = localforageSerializer;\n\n    return Promise$1.resolve();\n}\n\n// Remove all keys from the datastore, effectively destroying all data in\n// the app's key/value store!\nfunction clear$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var keyPrefix = self._dbInfo.keyPrefix;\n\n        for (var i = localStorage.length - 1; i >= 0; i--) {\n            var key = localStorage.key(i);\n\n            if (key.indexOf(keyPrefix) === 0) {\n                localStorage.removeItem(key);\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Retrieve an item from the store. Unlike the original async_storage\n// library in Gaia, we don't modify return values at all. If a key's value\n// is `undefined`, we pass that value to the callback function.\nfunction getItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result = localStorage.getItem(dbInfo.keyPrefix + key);\n\n        // If a result was found, parse it from the serialized\n        // string into a JS object. If result isn't truthy, the key\n        // is likely undefined and we'll pass it straight to the\n        // callback.\n        if (result) {\n            result = dbInfo.serializer.deserialize(result);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items in the store.\nfunction iterate$2(iterator, callback) {\n    var self = this;\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var keyPrefix = dbInfo.keyPrefix;\n        var keyPrefixLength = keyPrefix.length;\n        var length = localStorage.length;\n\n        // We use a dedicated iterator instead of the `i` variable below\n        // so other keys we fetch in localStorage aren't counted in\n        // the `iterationNumber` argument passed to the `iterate()`\n        // callback.\n        //\n        // See: github.com/mozilla/localForage/pull/435#discussion_r38061530\n        var iterationNumber = 1;\n\n        for (var i = 0; i < length; i++) {\n            var key = localStorage.key(i);\n            if (key.indexOf(keyPrefix) !== 0) {\n                continue;\n            }\n            var value = localStorage.getItem(key);\n\n            // If a result was found, parse it from the serialized\n            // string into a JS object. If result isn't truthy, the\n            // key is likely undefined and we'll pass it straight\n            // to the iterator.\n            if (value) {\n                value = dbInfo.serializer.deserialize(value);\n            }\n\n            value = iterator(value, key.substring(keyPrefixLength), iterationNumber++);\n\n            if (value !== void 0) {\n                return value;\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Same as localStorage's key() method, except takes a callback.\nfunction key$2(n, callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result;\n        try {\n            result = localStorage.key(n);\n        } catch (error) {\n            result = null;\n        }\n\n        // Remove the prefix from the key, if a key is found.\n        if (result) {\n            result = result.substring(dbInfo.keyPrefix.length);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var length = localStorage.length;\n        var keys = [];\n\n        for (var i = 0; i < length; i++) {\n            var itemKey = localStorage.key(i);\n            if (itemKey.indexOf(dbInfo.keyPrefix) === 0) {\n                keys.push(itemKey.substring(dbInfo.keyPrefix.length));\n            }\n        }\n\n        return keys;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Supply the number of keys in the datastore to the callback function.\nfunction length$2(callback) {\n    var self = this;\n    var promise = self.keys().then(function (keys) {\n        return keys.length;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Remove an item from the store, nice and simple.\nfunction removeItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        localStorage.removeItem(dbInfo.keyPrefix + key);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Set a key's value and run an optional callback once the value is set.\n// Unlike Gaia's implementation, the callback function is passed the value,\n// in case you want to operate on that value only after you're sure it\n// saved, or something like that.\nfunction setItem$2(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        // Convert undefined values to null.\n        // https://github.com/mozilla/localForage/pull/42\n        if (value === undefined) {\n            value = null;\n        }\n\n        // Save the original value to pass to the callback.\n        var originalValue = value;\n\n        return new Promise$1(function (resolve, reject) {\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    try {\n                        localStorage.setItem(dbInfo.keyPrefix + key, value);\n                        resolve(originalValue);\n                    } catch (e) {\n                        // localStorage capacity exceeded.\n                        // TODO: Make this a specific error/event.\n                        if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n                            reject(e);\n                        }\n                        reject(e);\n                    }\n                }\n            });\n        });\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance$2(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        var currentConfig = this.config();\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            if (!options.storeName) {\n                resolve(options.name + '/');\n            } else {\n                resolve(_getKeyPrefix(options, self._defaultConfig));\n            }\n        }).then(function (keyPrefix) {\n            for (var i = localStorage.length - 1; i >= 0; i--) {\n                var key = localStorage.key(i);\n\n                if (key.indexOf(keyPrefix) === 0) {\n                    localStorage.removeItem(key);\n                }\n            }\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar localStorageWrapper = {\n    _driver: 'localStorageWrapper',\n    _initStorage: _initStorage$2,\n    _support: isLocalStorageValid(),\n    iterate: iterate$2,\n    getItem: getItem$2,\n    setItem: setItem$2,\n    removeItem: removeItem$2,\n    clear: clear$2,\n    length: length$2,\n    key: key$2,\n    keys: keys$2,\n    dropInstance: dropInstance$2\n};\n\nvar sameValue = function sameValue(x, y) {\n    return x === y || typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y);\n};\n\nvar includes = function includes(array, searchElement) {\n    var len = array.length;\n    var i = 0;\n    while (i < len) {\n        if (sameValue(array[i], searchElement)) {\n            return true;\n        }\n        i++;\n    }\n\n    return false;\n};\n\nvar isArray = Array.isArray || function (arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n};\n\n// Drivers are stored here when `defineDriver()` is called.\n// They are shared across all instances of localForage.\nvar DefinedDrivers = {};\n\nvar DriverSupport = {};\n\nvar DefaultDrivers = {\n    INDEXEDDB: asyncStorage,\n    WEBSQL: webSQLStorage,\n    LOCALSTORAGE: localStorageWrapper\n};\n\nvar DefaultDriverOrder = [DefaultDrivers.INDEXEDDB._driver, DefaultDrivers.WEBSQL._driver, DefaultDrivers.LOCALSTORAGE._driver];\n\nvar OptionalDriverMethods = ['dropInstance'];\n\nvar LibraryMethods = ['clear', 'getItem', 'iterate', 'key', 'keys', 'length', 'removeItem', 'setItem'].concat(OptionalDriverMethods);\n\nvar DefaultConfig = {\n    description: '',\n    driver: DefaultDriverOrder.slice(),\n    name: 'localforage',\n    // Default DB size is _JUST UNDER_ 5MB, as it's the highest size\n    // we can use without a prompt.\n    size: 4980736,\n    storeName: 'keyvaluepairs',\n    version: 1.0\n};\n\nfunction callWhenReady(localForageInstance, libraryMethod) {\n    localForageInstance[libraryMethod] = function () {\n        var _args = arguments;\n        return localForageInstance.ready().then(function () {\n            return localForageInstance[libraryMethod].apply(localForageInstance, _args);\n        });\n    };\n}\n\nfunction extend() {\n    for (var i = 1; i < arguments.length; i++) {\n        var arg = arguments[i];\n\n        if (arg) {\n            for (var _key in arg) {\n                if (arg.hasOwnProperty(_key)) {\n                    if (isArray(arg[_key])) {\n                        arguments[0][_key] = arg[_key].slice();\n                    } else {\n                        arguments[0][_key] = arg[_key];\n                    }\n                }\n            }\n        }\n    }\n\n    return arguments[0];\n}\n\nvar LocalForage = function () {\n    function LocalForage(options) {\n        _classCallCheck(this, LocalForage);\n\n        for (var driverTypeKey in DefaultDrivers) {\n            if (DefaultDrivers.hasOwnProperty(driverTypeKey)) {\n                var driver = DefaultDrivers[driverTypeKey];\n                var driverName = driver._driver;\n                this[driverTypeKey] = driverName;\n\n                if (!DefinedDrivers[driverName]) {\n                    // we don't need to wait for the promise,\n                    // since the default drivers can be defined\n                    // in a blocking manner\n                    this.defineDriver(driver);\n                }\n            }\n        }\n\n        this._defaultConfig = extend({}, DefaultConfig);\n        this._config = extend({}, this._defaultConfig, options);\n        this._driverSet = null;\n        this._initDriver = null;\n        this._ready = false;\n        this._dbInfo = null;\n\n        this._wrapLibraryMethodsWithReady();\n        this.setDriver(this._config.driver)[\"catch\"](function () {});\n    }\n\n    // Set any config values for localForage; can be called anytime before\n    // the first API call (e.g. `getItem`, `setItem`).\n    // We loop through options so we don't overwrite existing config\n    // values.\n\n\n    LocalForage.prototype.config = function config(options) {\n        // If the options argument is an object, we use it to set values.\n        // Otherwise, we return either a specified config value or all\n        // config values.\n        if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) === 'object') {\n            // If localforage is ready and fully initialized, we can't set\n            // any new configuration values. Instead, we return an error.\n            if (this._ready) {\n                return new Error(\"Can't call config() after localforage \" + 'has been used.');\n            }\n\n            for (var i in options) {\n                if (i === 'storeName') {\n                    options[i] = options[i].replace(/\\W/g, '_');\n                }\n\n                if (i === 'version' && typeof options[i] !== 'number') {\n                    return new Error('Database version must be a number.');\n                }\n\n                this._config[i] = options[i];\n            }\n\n            // after all config options are set and\n            // the driver option is used, try setting it\n            if ('driver' in options && options.driver) {\n                return this.setDriver(this._config.driver);\n            }\n\n            return true;\n        } else if (typeof options === 'string') {\n            return this._config[options];\n        } else {\n            return this._config;\n        }\n    };\n\n    // Used to define a custom driver, shared across all instances of\n    // localForage.\n\n\n    LocalForage.prototype.defineDriver = function defineDriver(driverObject, callback, errorCallback) {\n        var promise = new Promise$1(function (resolve, reject) {\n            try {\n                var driverName = driverObject._driver;\n                var complianceError = new Error('Custom driver not compliant; see ' + 'https://mozilla.github.io/localForage/#definedriver');\n\n                // A driver name should be defined and not overlap with the\n                // library-defined, default drivers.\n                if (!driverObject._driver) {\n                    reject(complianceError);\n                    return;\n                }\n\n                var driverMethods = LibraryMethods.concat('_initStorage');\n                for (var i = 0, len = driverMethods.length; i < len; i++) {\n                    var driverMethodName = driverMethods[i];\n\n                    // when the property is there,\n                    // it should be a method even when optional\n                    var isRequired = !includes(OptionalDriverMethods, driverMethodName);\n                    if ((isRequired || driverObject[driverMethodName]) && typeof driverObject[driverMethodName] !== 'function') {\n                        reject(complianceError);\n                        return;\n                    }\n                }\n\n                var configureMissingMethods = function configureMissingMethods() {\n                    var methodNotImplementedFactory = function methodNotImplementedFactory(methodName) {\n                        return function () {\n                            var error = new Error('Method ' + methodName + ' is not implemented by the current driver');\n                            var promise = Promise$1.reject(error);\n                            executeCallback(promise, arguments[arguments.length - 1]);\n                            return promise;\n                        };\n                    };\n\n                    for (var _i = 0, _len = OptionalDriverMethods.length; _i < _len; _i++) {\n                        var optionalDriverMethod = OptionalDriverMethods[_i];\n                        if (!driverObject[optionalDriverMethod]) {\n                            driverObject[optionalDriverMethod] = methodNotImplementedFactory(optionalDriverMethod);\n                        }\n                    }\n                };\n\n                configureMissingMethods();\n\n                var setDriverSupport = function setDriverSupport(support) {\n                    if (DefinedDrivers[driverName]) {\n                        console.info('Redefining LocalForage driver: ' + driverName);\n                    }\n                    DefinedDrivers[driverName] = driverObject;\n                    DriverSupport[driverName] = support;\n                    // don't use a then, so that we can define\n                    // drivers that have simple _support methods\n                    // in a blocking manner\n                    resolve();\n                };\n\n                if ('_support' in driverObject) {\n                    if (driverObject._support && typeof driverObject._support === 'function') {\n                        driverObject._support().then(setDriverSupport, reject);\n                    } else {\n                        setDriverSupport(!!driverObject._support);\n                    }\n                } else {\n                    setDriverSupport(true);\n                }\n            } catch (e) {\n                reject(e);\n            }\n        });\n\n        executeTwoCallbacks(promise, callback, errorCallback);\n        return promise;\n    };\n\n    LocalForage.prototype.driver = function driver() {\n        return this._driver || null;\n    };\n\n    LocalForage.prototype.getDriver = function getDriver(driverName, callback, errorCallback) {\n        var getDriverPromise = DefinedDrivers[driverName] ? Promise$1.resolve(DefinedDrivers[driverName]) : Promise$1.reject(new Error('Driver not found.'));\n\n        executeTwoCallbacks(getDriverPromise, callback, errorCallback);\n        return getDriverPromise;\n    };\n\n    LocalForage.prototype.getSerializer = function getSerializer(callback) {\n        var serializerPromise = Promise$1.resolve(localforageSerializer);\n        executeTwoCallbacks(serializerPromise, callback);\n        return serializerPromise;\n    };\n\n    LocalForage.prototype.ready = function ready(callback) {\n        var self = this;\n\n        var promise = self._driverSet.then(function () {\n            if (self._ready === null) {\n                self._ready = self._initDriver();\n            }\n\n            return self._ready;\n        });\n\n        executeTwoCallbacks(promise, callback, callback);\n        return promise;\n    };\n\n    LocalForage.prototype.setDriver = function setDriver(drivers, callback, errorCallback) {\n        var self = this;\n\n        if (!isArray(drivers)) {\n            drivers = [drivers];\n        }\n\n        var supportedDrivers = this._getSupportedDrivers(drivers);\n\n        function setDriverToConfig() {\n            self._config.driver = self.driver();\n        }\n\n        function extendSelfWithDriver(driver) {\n            self._extend(driver);\n            setDriverToConfig();\n\n            self._ready = self._initStorage(self._config);\n            return self._ready;\n        }\n\n        function initDriver(supportedDrivers) {\n            return function () {\n                var currentDriverIndex = 0;\n\n                function driverPromiseLoop() {\n                    while (currentDriverIndex < supportedDrivers.length) {\n                        var driverName = supportedDrivers[currentDriverIndex];\n                        currentDriverIndex++;\n\n                        self._dbInfo = null;\n                        self._ready = null;\n\n                        return self.getDriver(driverName).then(extendSelfWithDriver)[\"catch\"](driverPromiseLoop);\n                    }\n\n                    setDriverToConfig();\n                    var error = new Error('No available storage method found.');\n                    self._driverSet = Promise$1.reject(error);\n                    return self._driverSet;\n                }\n\n                return driverPromiseLoop();\n            };\n        }\n\n        // There might be a driver initialization in progress\n        // so wait for it to finish in order to avoid a possible\n        // race condition to set _dbInfo\n        var oldDriverSetDone = this._driverSet !== null ? this._driverSet[\"catch\"](function () {\n            return Promise$1.resolve();\n        }) : Promise$1.resolve();\n\n        this._driverSet = oldDriverSetDone.then(function () {\n            var driverName = supportedDrivers[0];\n            self._dbInfo = null;\n            self._ready = null;\n\n            return self.getDriver(driverName).then(function (driver) {\n                self._driver = driver._driver;\n                setDriverToConfig();\n                self._wrapLibraryMethodsWithReady();\n                self._initDriver = initDriver(supportedDrivers);\n            });\n        })[\"catch\"](function () {\n            setDriverToConfig();\n            var error = new Error('No available storage method found.');\n            self._driverSet = Promise$1.reject(error);\n            return self._driverSet;\n        });\n\n        executeTwoCallbacks(this._driverSet, callback, errorCallback);\n        return this._driverSet;\n    };\n\n    LocalForage.prototype.supports = function supports(driverName) {\n        return !!DriverSupport[driverName];\n    };\n\n    LocalForage.prototype._extend = function _extend(libraryMethodsAndProperties) {\n        extend(this, libraryMethodsAndProperties);\n    };\n\n    LocalForage.prototype._getSupportedDrivers = function _getSupportedDrivers(drivers) {\n        var supportedDrivers = [];\n        for (var i = 0, len = drivers.length; i < len; i++) {\n            var driverName = drivers[i];\n            if (this.supports(driverName)) {\n                supportedDrivers.push(driverName);\n            }\n        }\n        return supportedDrivers;\n    };\n\n    LocalForage.prototype._wrapLibraryMethodsWithReady = function _wrapLibraryMethodsWithReady() {\n        // Add a stub for each driver API method that delays the call to the\n        // corresponding driver method until localForage is ready. These stubs\n        // will be replaced by the driver methods as soon as the driver is\n        // loaded, so there is no performance impact.\n        for (var i = 0, len = LibraryMethods.length; i < len; i++) {\n            callWhenReady(this, LibraryMethods[i]);\n        }\n    };\n\n    LocalForage.prototype.createInstance = function createInstance(options) {\n        return new LocalForage(options);\n    };\n\n    return LocalForage;\n}();\n\n// The actual localForage object that we expose as a module or via a\n// global. It's extended by pulling in one of our other libraries.\n\n\nvar localforage_js = new LocalForage();\n\nmodule.exports = localforage_js;\n\n},{\"3\":3}]},{},[4])(4)\n});\n","//----------------------------------------------------------------------------//\n//                        JavaScript Interface Library                        //\n//----------------------------------------------------------------------------//\n/**** get a reference to the \"global\" object ****/\nvar global = /*#__PURE__*/ Function('return this')();\n// see https://stackoverflow.com/questions/3277182/how-to-get-the-global-object-in-javascript\n//------------------------------------------------------------------------------\n//--                             Object Functions                             --\n//------------------------------------------------------------------------------\n// allow methods from Object.prototype to be applied to \"vanilla\" objects\n/**** Object_hasOwnProperty ****/\nfunction Object_hasOwnProperty(Value, PropertyName) {\n    return ((Value == null) || // let this method crash like its original\n        ('hasOwnProperty' in Value) && (typeof Value.hasOwnProperty === 'function')\n        ? Value.hasOwnProperty(PropertyName)\n        : Object.prototype.hasOwnProperty.call(Value, PropertyName));\n}\n/**** Object_isPrototypeOf ****/\nfunction Object_isPrototypeOf(Value, Candidate) {\n    return ((Value == null) || // let this method crash like its original\n        ('isPrototypeOf' in Value) && (typeof Value.isPrototypeOf === 'function')\n        ? Value.isPrototypeOf(Candidate)\n        : Object.prototype.isPrototypeOf.call(Value, Candidate));\n}\n/**** Object_propertyIsEnumerable ****/\nfunction Object_propertyIsEnumerable(Value, PropertyName) {\n    return ((Value == null) || // let this method crash like its original\n        ('propertyIsEnumerable' in Value) && (typeof Value.propertyIsEnumerable === 'function')\n        ? Value.propertyIsEnumerable(PropertyName)\n        : Object.prototype.propertyIsEnumerable.call(Value, PropertyName));\n}\n/**** Object_toString ****/\nfunction Object_toString(Value) {\n    return ((Value == null) || // let this method crash like its original\n        ('toString' in Value) && (typeof Value.toString === 'function')\n        ? Value.toString()\n        : Object.prototype.toString.call(Value));\n}\n/**** Object_toLocaleString ****/\nfunction Object_toLocaleString(Value) {\n    return ((Value == null) || // let this method crash like its original\n        ('toLocaleString' in Value) && (typeof Value.toLocaleString === 'function')\n        ? Value.toLocaleString()\n        : Object.prototype.toString.call(Value)); // a missing \"toLocaleString\" method will crash Object.prototype.toLocaleString\n}\n/**** Object_valueOf ****/\nfunction Object_valueOf(Value) {\n    return ((Value == null) || // let this method crash like its original\n        ('valueOf' in Value) && (typeof Value.valueOf === 'function')\n        ? Value.valueOf()\n        : Object.prototype.valueOf.call(Value));\n}\n/**** ObjectMergedWith ****/\nfunction ObjectMergedWith(TargetObject) {\n    var otherObjectList = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        otherObjectList[_i - 1] = arguments[_i];\n    }\n    for (var i = 0, l = otherObjectList.length; i < l; i++) {\n        var otherObject = otherObjectList[i];\n        if (otherObject == null) {\n            continue;\n        }\n        if (typeof otherObject === 'object') {\n            for (var Key in otherObject) {\n                var Descriptor = Object.getOwnPropertyDescriptor(otherObject, Key);\n                if (Descriptor != null) {\n                    Object.defineProperty(TargetObject, Key, Descriptor);\n                }\n            }\n        }\n        else {\n            throwError('InvalidArgument: argument #' + (i + 1) + ' is not an object');\n        }\n    }\n    return TargetObject;\n}\n/**** throwError - simplifies construction of named errors ****/\nfunction throwError(Message) {\n    var Match = /^([$a-zA-Z][$a-zA-Z0-9]*):\\s*(\\S.+)\\s*$/.exec(Message);\n    if (Match == null) {\n        throw new Error(Message);\n    }\n    else {\n        var namedError = new Error(Match[2]);\n        namedError.name = Match[1];\n        throw namedError;\n    }\n}\n//------------------------------------------------------------------------------\n//--                      Value Classification Functions                      --\n//------------------------------------------------------------------------------\n/**** ValueExists ****/\nfunction ValueExists(Value) {\n    return (Value != null);\n}\n/**** ValueIsMissing ****/\nfunction ValueIsMissing(Value) {\n    return (Value == null);\n}\n/**** ValueIsBoolean ****/\nfunction ValueIsBoolean(Value) {\n    return (typeof Value === 'boolean') || (Value instanceof Boolean);\n}\n/**** ValueIsNumber ****/\nfunction ValueIsNumber(Value) {\n    return (typeof Value === 'number') || (Value instanceof Number);\n}\n/**** ValueIsFiniteNumber (pure \"isFinite\" breaks on objects) ****/\nfunction ValueIsFiniteNumber(Value) {\n    return ((typeof Value === 'number') || (Value instanceof Number)) && isFinite(Value.valueOf());\n}\n/**** ValueIsNaN (numeric, but NaN - this differs from pure \"isNaN\") ****/\nfunction ValueIsNaN(Value) {\n    return ((typeof Value === 'number') || (Value instanceof Number)) && isNaN(Value.valueOf());\n}\n/**** ValueIsNumberInRange ****/\nfunction ValueIsNumberInRange(Value, minValue, maxValue, withMin, withMax) {\n    if (withMin === void 0) { withMin = true; }\n    if (withMax === void 0) { withMax = true; }\n    if (!ValueIsNumber(Value) || isNaN(Value)) {\n        return false;\n    }\n    if (ValueIsFiniteNumber(minValue)) { // more robust than \"isFinite\" alone\n        if (ValueIsFiniteNumber(maxValue)) { // more robust than \"isFinite\" alone\n            if ((Value < minValue) || (!withMin && (Value === minValue)) ||\n                (Value > maxValue) || (!withMax && (Value === maxValue))) {\n                return false;\n            }\n        }\n        else {\n            if ((Value < minValue) || (!withMin && (Value === minValue))) {\n                return false;\n            }\n        }\n    }\n    else {\n        if (ValueIsFiniteNumber(maxValue)) { // more robust than \"isFinite\" alone\n            if ((Value > maxValue) || (!withMax && (Value === maxValue))) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n/**** ValueIsInteger ****/\nfunction ValueIsInteger(Value) {\n    if ((typeof Value !== 'number') && !(Value instanceof Number)) {\n        return false;\n    }\n    Value = Value.valueOf();\n    return isFinite(Value) && (Math.round(Value) === Value);\n}\n/**** ValueIsIntegerInRange ****/\nfunction ValueIsIntegerInRange(Value, minValue, maxValue) {\n    if (!ValueIsInteger(Value) || isNaN(Value)) {\n        return false;\n    }\n    if (ValueIsFiniteNumber(minValue)) { // more robust than \"isFinite\" alone\n        if (ValueIsFiniteNumber(maxValue)) { // more robust than \"isFinite\" alone\n            if ((Value < minValue) || (Value > maxValue)) {\n                return false;\n            }\n        }\n        else {\n            if (Value < minValue) {\n                return false;\n            }\n        }\n    }\n    else {\n        if (ValueIsFiniteNumber(maxValue)) { // more robust than \"isFinite\" alone\n            if (Value > maxValue) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n/**** ValueIsOrdinal ****/\nfunction ValueIsOrdinal(Value) {\n    if ((typeof Value !== 'number') && !(Value instanceof Number)) {\n        return false;\n    }\n    Value = Value.valueOf();\n    return isFinite(Value) && (Math.round(Value) === Value) && (Value >= 0);\n}\n/**** ValueIsCardinal ****/\nfunction ValueIsCardinal(Value) {\n    if ((typeof Value !== 'number') && !(Value instanceof Number)) {\n        return false;\n    }\n    Value = Value.valueOf();\n    return isFinite(Value) && (Math.round(Value) === Value) && (Value >= 1);\n}\n/**** ValueIsString ****/\nfunction ValueIsString(Value) {\n    return (typeof Value === 'string') || (Value instanceof String);\n}\n/**** ValueIs[Non]EmptyString ****/\nvar emptyStringPattern = /^\\s*$/;\nfunction ValueIsEmptyString(Value) {\n    return ((typeof Value === 'string') || (Value instanceof String)) && emptyStringPattern.test(Value.valueOf());\n}\nfunction ValueIsNonEmptyString(Value) {\n    return ((typeof Value === 'string') || (Value instanceof String)) && !emptyStringPattern.test(Value.valueOf());\n}\n/**** ValueIsStringMatching ****/\nfunction ValueIsStringMatching(Value, Pattern) {\n    return ((typeof Value === 'string') || (Value instanceof String)) && Pattern.test(Value.valueOf());\n}\n/**** ValueIsText ****/\nvar noCtrlCharsButCRLFPattern = /^[^\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F-\\x9F\\u2028\\u2029\\uFFF9-\\uFFFB]*$/;\nfunction ValueIsText(Value) {\n    return ValueIsStringMatching(Value, noCtrlCharsButCRLFPattern);\n}\n/**** ValueIsTextline ****/\nvar noCtrlCharsPattern = /^[^\\x00-\\x1F\\x7F-\\x9F\\u2028\\u2029\\uFFF9-\\uFFFB]*$/;\nfunction ValueIsTextline(Value) {\n    return ValueIsStringMatching(Value, noCtrlCharsPattern);\n}\n/**** ValueIsFunction ****/\nfunction ValueIsFunction(Value) {\n    return (typeof Value === 'function');\n}\n/**** ValueIsAnonymousFunction ****/\nfunction ValueIsAnonymousFunction(Value) {\n    return ((typeof Value === 'function') &&\n        ((Value.name == null) || (Value.name === '')));\n}\n/**** ValueIsNamedFunction ****/\nfunction ValueIsNamedFunction(Value) {\n    return ((typeof Value === 'function') &&\n        (Value.name != null) && (Value.name !== ''));\n}\n/**** ValueIsNativeFunction ****/\nfunction ValueIsNativeFunction(Value) {\n    return ((typeof Value === 'function') &&\n        /^function\\s*[^(]*\\(\\)\\s*\\{\\s*\\[native code\\]\\s*\\}\\s*$/.test(Value.toString()));\n}\n/**** ValueIsScriptedFunction ****/\nfunction ValueIsScriptedFunction(Value) {\n    return ((typeof Value === 'function') &&\n        !/^function\\s*[^(]*\\(\\)\\s*\\{\\s*\\[native code\\]\\s*\\}\\s*$/.test(Value.toString()));\n}\n/**** ValueIsObject ****/\nfunction ValueIsObject(Value) {\n    return (Value != null) && (typeof Value === 'object');\n}\n/**** ValueIsPlainObject ****/\nfunction ValueIsPlainObject(Value) {\n    return ((Value != null) && (typeof Value === 'object') &&\n        (Object.getPrototypeOf(Value) === Object.prototype));\n}\n/**** ValueIsVanillaObject ****/\nfunction ValueIsVanillaObject(Value) {\n    return ((Value != null) && (typeof Value === 'object') &&\n        !(Value instanceof Object));\n}\n/**** ValueIsArray ****/\nvar ValueIsArray = Array.isArray;\n/**** ValueIsList (\"dense\" array) ****/\nfunction ValueIsList(Value, minLength, maxLength) {\n    if (ValueIsArray(Value)) {\n        for (var i = 0, l = Value.length; i < l; i++) {\n            if (Value[i] === undefined) {\n                return false;\n            }\n        }\n        if (minLength != null) {\n            if (Value.length < minLength) {\n                return false;\n            }\n        }\n        if (maxLength != null) {\n            if (Value.length > maxLength) {\n                return false;\n            }\n        }\n        return true;\n    }\n    return false;\n}\n/**** ValueIsListSatisfying ****/\nfunction ValueIsListSatisfying(Value, Validator, minLength, maxLength) {\n    if (ValueIsArray(Value)) {\n        try {\n            for (var i = 0, l = Value.length; i < l; i++) {\n                if (Validator(Value[i]) == false) {\n                    return false;\n                }\n            }\n            if (minLength != null) {\n                if (Value.length < minLength) {\n                    return false;\n                }\n            }\n            if (maxLength != null) {\n                if (Value.length > maxLength) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        catch (Signal) { /* nop */ }\n    }\n    return false;\n}\n/**** ValueIsInstanceOf ****/\nfunction ValueIsInstanceOf(Value, Constructor) {\n    return (Value instanceof Constructor);\n}\n/**** ValueInheritsFrom ****/\nfunction ValueInheritsFrom(Value, Prototype) {\n    return Object_isPrototypeOf(Prototype, Value);\n}\n/**** ValueIsDate ****/\nfunction ValueIsDate(Value) {\n    return (Value instanceof Date);\n}\n/**** ValueIsError ****/\nfunction ValueIsError(Value) {\n    return (Value instanceof Error);\n}\n/**** ValueIsPromise ****/\nfunction ValueIsPromise(Value) {\n    return (Value != null) && (typeof Value.then === 'function');\n}\n// see https://stackoverflow.com/questions/27746304/how-do-i-tell-if-an-object-is-a-promise\n/**** ValueIsRegExp ****/\nfunction ValueIsRegExp(Value) {\n    return (Value instanceof RegExp);\n}\n/**** ValueIsOneOf ****/\nfunction ValueIsOneOf(Value, ValueList) {\n    return (ValueList.indexOf(Value) >= 0);\n} // no automatic unboxing of boxed values and vice-versa!\n/**** ValueIsColor ****/\nfunction ValueIsColor(Value) {\n    return ValueIsString(Value) && (ColorSet.hasOwnProperty(Value) ||\n        /^#[a-fA-F0-9]{6}$/.test(Value) ||\n        /^#[a-fA-F0-9]{8}$/.test(Value) ||\n        /^rgb\\([0-9]+,\\s*[0-9]+,\\s*[0-9]+\\)$/.test(Value) || // not perfect\n        /^rgba\\([0-9]+,\\s*[0-9]+,\\s*[0-9]+,([01]|[0]?[.][0-9]+)\\)$/.test(Value) // dto.\n    );\n}\n/**** ValueIsEMailAddress ****/\nvar EMailAddressPattern = /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/;\n// see https://stackoverflow.com/questions/201323/how-to-validate-an-email-address-using-a-regular-expression\nfunction ValueIsEMailAddress(Value) {\n    return ValueIsStringMatching(Value, EMailAddressPattern);\n}\n/**** ValueIsURL ****/\nvar noCtrlCharsOrWhitespacePattern = /^[^\\s\\x00-\\x1F\\x7F-\\x9F\\u2028\\u2029\\uFFF9-\\uFFFB]*$/;\nfunction ValueIsURL(Value) {\n    if (!ValueIsStringMatching(Value, noCtrlCharsOrWhitespacePattern) ||\n        (Value === '')) {\n        return false;\n    }\n    try {\n        new URL(Value, 'file://');\n        return true;\n    }\n    catch (Signal) {\n        return false;\n    }\n}\n//------------------------------------------------------------------------------\n//--                      Argument Validation Functions                       --\n//------------------------------------------------------------------------------\nvar rejectNil = false;\nvar acceptNil = true;\n/**** validatedArgument ****/\nfunction validatedArgument(Description, Argument, ValueIsValid, NilIsAcceptable, Expectation) {\n    if (Argument == null) {\n        if (NilIsAcceptable) {\n            return Argument;\n        }\n        else {\n            throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n        }\n    }\n    else {\n        if (ValueIsValid(Argument)) {\n            switch (true) {\n                case Argument instanceof Boolean:\n                case Argument instanceof Number:\n                case Argument instanceof String:\n                    return Argument.valueOf(); // unboxes any primitives\n                default:\n                    return Argument;\n            }\n        }\n        else {\n            throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is no valid \" + escaped(Expectation));\n        }\n    }\n}\n/**** ValidatorForClassifier ****/\nfunction ValidatorForClassifier(Classifier, NilIsAcceptable, Expectation) {\n    var Validator = function (Description, Argument) {\n        return validatedArgument(Description, Argument, Classifier, NilIsAcceptable, Expectation);\n    };\n    var ClassifierName = Classifier.name;\n    if ((ClassifierName != null) && /^ValueIs/.test(ClassifierName)) {\n        var ValidatorName = ClassifierName.replace(// derive name from validator\n        /^ValueIs/, NilIsAcceptable ? 'allow' : 'expect');\n        return FunctionWithName(Validator, ValidatorName);\n    }\n    else {\n        return Validator; // without any specific name\n    }\n}\n/**** FunctionWithName (works with older JS engines as well) ****/\nfunction FunctionWithName(originalFunction, desiredName) {\n    if (originalFunction == null) {\n        throwError('MissingArgument: no function given');\n    }\n    if (typeof originalFunction !== 'function') {\n        throwError('InvalidArgument: the given 1st Argument is not a JavaScript function');\n    }\n    if (desiredName == null) {\n        throwError('MissingArgument: no desired name given');\n    }\n    if ((typeof desiredName !== 'string') && !(desiredName instanceof String)) {\n        throwError('InvalidArgument: the given desired name is not a string');\n    }\n    if (originalFunction.name === desiredName) {\n        return originalFunction;\n    }\n    try {\n        Object.defineProperty(originalFunction, 'name', { value: desiredName });\n        if (originalFunction.name === desiredName) {\n            return originalFunction;\n        }\n    }\n    catch (signal) { /* ok - let's take the hard way */ }\n    var renamed = new Function('originalFunction', 'return function ' + desiredName + ' () {' +\n        'return originalFunction.apply(this,Array.prototype.slice.apply(arguments))' +\n        '}');\n    return renamed(originalFunction);\n} // also works with older JavaScript engines\n/**** expect[ed]Value ****/\nfunction expectValue(Description, Argument) {\n    if (Argument == null) {\n        throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n    }\n    else {\n        return Argument.valueOf();\n    }\n}\nvar expectedValue = expectValue;\n/**** allow/expect[ed]Boolean ****/\nvar allowBoolean = /*#__PURE__*/ ValidatorForClassifier(ValueIsBoolean, acceptNil, 'boolean value'), allowedBoolean = allowBoolean;\nvar expectBoolean = /*#__PURE__*/ ValidatorForClassifier(ValueIsBoolean, rejectNil, 'boolean value'), expectedBoolean = expectBoolean;\n/**** allow/expect[ed]Number ****/\nvar allowNumber = /*#__PURE__*/ ValidatorForClassifier(ValueIsNumber, acceptNil, 'numeric value'), allowedNumber = allowNumber;\nvar expectNumber = /*#__PURE__*/ ValidatorForClassifier(ValueIsNumber, rejectNil, 'numeric value'), expectedNumber = expectNumber;\n/**** allow/expect[ed]FiniteNumber ****/\nvar allowFiniteNumber = /*#__PURE__*/ ValidatorForClassifier(ValueIsFiniteNumber, acceptNil, 'finite numeric value'), allowedFiniteNumber = allowFiniteNumber;\nvar expectFiniteNumber = /*#__PURE__*/ ValidatorForClassifier(ValueIsFiniteNumber, rejectNil, 'finite numeric value'), expectedFiniteNumber = expectFiniteNumber;\n/**** allow/expect[ed]NaN ****/\nvar allowNaN = /*#__PURE__*/ ValidatorForClassifier(ValueIsNaN, acceptNil, 'NaN value'), allowedNaN = allowNaN;\nvar expectNaN = /*#__PURE__*/ ValidatorForClassifier(ValueIsNaN, rejectNil, 'NaN value'), expectedNaN = expectNaN;\n/**** allow[ed]NumberInRange ****/\nfunction allowNumberInRange(Description, Argument, minValue, maxValue, withMin, withMax) {\n    return (Argument == null\n        ? Argument\n        : expectedNumberInRange(Description, Argument, minValue, maxValue, withMin, withMax));\n}\nvar allowedNumberInRange = allowNumberInRange;\n/**** expect[ed]NumberInRange ****/\nfunction expectNumberInRange(Description, Argument, minValue, maxValue, withMin, withMax) {\n    expectNumber(Description, Argument);\n    if (isNaN(Argument)) {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is not-a-number\");\n    }\n    if (withMin == null) {\n        withMin = true;\n    }\n    if (withMax == null) {\n        withMax = true;\n    }\n    if ((minValue != null) && isFinite(minValue)) {\n        if ((maxValue != null) && isFinite(maxValue)) {\n            if ((Argument < minValue) || (!withMin && (Argument === minValue)) ||\n                (Argument > maxValue) || (!withMax && (Argument === maxValue))) {\n                throw new RangeError(\"the given \" + escaped(Description) + \" (\" + Argument + \") is outside \" +\n                    (\"the allowed range (\" + minValue + \"...\" + maxValue + \")\"));\n            }\n        }\n        else {\n            if ((Argument < minValue) || (!withMin && (Argument === minValue))) {\n                throw new RangeError(\"the given \" + escaped(Description) + \" is below the allowed \" +\n                    (\"minimum (\" + Argument + \" \" + (withMin ? '<' : '<=') + \" \" + minValue + \")\"));\n            }\n        }\n    }\n    else {\n        if ((maxValue != null) && isFinite(maxValue)) {\n            if ((Argument > maxValue) || (!withMax && (Argument === maxValue))) {\n                throw new RangeError(\"the given \" + escaped(Description) + \" exceeds the allowed \" +\n                    (\"maximum (\" + Argument + \" \" + (withMax ? '>' : '>=') + \" \" + maxValue + \")\"));\n            }\n        }\n    }\n    return Argument.valueOf();\n}\nvar expectedNumberInRange = expectNumberInRange;\n/**** allow/expect[ed]Integer ****/\nvar allowInteger = /*#__PURE__*/ ValidatorForClassifier(ValueIsInteger, acceptNil, 'integral numeric value'), allowedInteger = allowInteger;\nvar expectInteger = /*#__PURE__*/ ValidatorForClassifier(ValueIsInteger, rejectNil, 'integral numeric value'), expectedInteger = expectInteger;\n/**** allow[ed]IntegerInRange ****/\nfunction allowIntegerInRange(Description, Argument, minValue, maxValue) {\n    return (Argument == null\n        ? Argument\n        : expectedIntegerInRange(Description, Argument, minValue, maxValue));\n}\nvar allowedIntegerInRange = allowIntegerInRange;\n/**** expect[ed]IntegerInRange ****/\nfunction expectIntegerInRange(Description, Argument, minValue, maxValue) {\n    expectInteger(Description, Argument);\n    if (isNaN(Argument)) {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is not-a-number\");\n    }\n    if ((minValue != null) && isFinite(minValue)) {\n        if ((maxValue != null) && isFinite(maxValue)) {\n            if ((Argument < minValue) || (Argument > maxValue)) {\n                throw new RangeError(\"the given \" + escaped(Description) + \" (\" + Argument + \") is outside \" +\n                    (\"the allowed range (\" + minValue + \"...\" + maxValue + \")\"));\n            }\n        }\n        else {\n            if (Argument < minValue) {\n                throw new RangeError(\"the given \" + escaped(Description) + \" is below the allowed \" +\n                    (\"minimum (\" + Argument + \" < \" + minValue + \")\"));\n            }\n        }\n    }\n    else {\n        if ((maxValue != null) && isFinite(maxValue)) {\n            if (Argument > maxValue) {\n                throw new RangeError(\"the given \" + escaped(Description) + \" exceeds the allowed \" +\n                    (\"maximum (\" + Argument + \" > \" + maxValue + \")\"));\n            }\n        }\n    }\n    return Argument.valueOf();\n}\nvar expectedIntegerInRange = expectIntegerInRange;\n/**** allow/expect[ed]Ordinal ****/\nvar allowOrdinal = /*#__PURE__*/ ValidatorForClassifier(ValueIsOrdinal, acceptNil, 'ordinal number'), allowedOrdinal = allowOrdinal;\nvar expectOrdinal = /*#__PURE__*/ ValidatorForClassifier(ValueIsOrdinal, rejectNil, 'ordinal number'), expectedOrdinal = expectOrdinal;\n/**** allow/expect[ed]Cardinal ****/\nvar allowCardinal = /*#__PURE__*/ ValidatorForClassifier(ValueIsCardinal, acceptNil, 'cardinal number'), allowedCardinal = allowCardinal;\nvar expectCardinal = /*#__PURE__*/ ValidatorForClassifier(ValueIsCardinal, rejectNil, 'cardinal number'), expectedCardinal = expectCardinal;\n/**** allow/expect[ed]String ****/\nvar allowString = /*#__PURE__*/ ValidatorForClassifier(ValueIsString, acceptNil, 'literal string'), allowedString = allowString;\nvar expectString = /*#__PURE__*/ ValidatorForClassifier(ValueIsString, rejectNil, 'literal string'), expectedString = expectString;\n/**** allow/expect[ed]NonEmptyString ****/\nvar allowNonEmptyString = /*#__PURE__*/ ValidatorForClassifier(ValueIsNonEmptyString, acceptNil, 'non-empty literal string'), allowedNonEmptyString = allowNonEmptyString;\nvar expectNonEmptyString = /*#__PURE__*/ ValidatorForClassifier(ValueIsNonEmptyString, rejectNil, 'non-empty literal string'), expectedNonEmptyString = expectNonEmptyString;\n/**** allow[ed]StringMatching ****/\nfunction allowStringMatching(Description, Argument, Pattern) {\n    return (Argument == null\n        ? Argument\n        : expectedStringMatching(Description, Argument, Pattern));\n}\nvar allowedStringMatching = allowStringMatching;\n/**** expect[ed]StringMatching ****/\nfunction expectStringMatching(Description, Argument, Pattern) {\n    expectString(Description, Argument);\n    if (Pattern.test(Argument)) {\n        return Argument.valueOf();\n    }\n    else {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" does not match the specified pattern\");\n    }\n}\nvar expectedStringMatching = expectStringMatching;\n/**** allow/expect[ed]Text ****/\nvar allowText = /*#__PURE__*/ ValidatorForClassifier(ValueIsText, acceptNil, 'literal text'), allowedText = allowText;\nvar expectText = /*#__PURE__*/ ValidatorForClassifier(ValueIsText, rejectNil, 'literal text'), expectedText = expectText;\n/**** allow/expect[ed]Textline ****/\nvar allowTextline = /*#__PURE__*/ ValidatorForClassifier(ValueIsTextline, acceptNil, 'single line of text'), allowedTextline = allowTextline;\nvar expectTextline = /*#__PURE__*/ ValidatorForClassifier(ValueIsTextline, rejectNil, 'single line of text'), expectedTextline = expectTextline;\n/**** allow/expect[ed]Function ****/\nvar allowFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsFunction, acceptNil, 'JavaScript function'), allowedFunction = allowFunction;\nvar expectFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsFunction, rejectNil, 'JavaScript function'), expectedFunction = expectFunction;\n/**** allow/expect[ed]AnonymousFunction ****/\nvar allowAnonymousFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsAnonymousFunction, acceptNil, 'anonymous JavaScript function'), allowedAnonymousFunction = allowAnonymousFunction;\nvar expectAnonymousFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsAnonymousFunction, rejectNil, 'anonymous JavaScript function'), expectedAnonymousFunction = expectAnonymousFunction;\n/**** allow/expect[ed]NamedFunction ****/\nvar allowNamedFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsNamedFunction, acceptNil, 'named JavaScript function'), allowedNamedFunction = allowNamedFunction;\nvar expectNamedFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsNamedFunction, rejectNil, 'named JavaScript function'), expectedNamedFunction = expectNamedFunction;\n/**** allow/expect[ed]NativeFunction ****/\nvar allowNativeFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsNativeFunction, acceptNil, 'native JavaScript function'), allowedNativeFunction = allowNativeFunction;\nvar expectNativeFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsNativeFunction, rejectNil, 'native JavaScript function'), expectedNativeFunction = expectNativeFunction;\n/**** allow/expect[ed]ScriptedFunction ****/\nvar allowScriptedFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsScriptedFunction, acceptNil, 'scripted JavaScript function'), allowedScriptedFunction = allowScriptedFunction;\nvar expectScriptedFunction = /*#__PURE__*/ ValidatorForClassifier(ValueIsScriptedFunction, rejectNil, 'scripted JavaScript function'), expectedScriptedFunction = expectScriptedFunction;\n/**** allow/expect[ed]Object ****/\nvar allowObject = /*#__PURE__*/ ValidatorForClassifier(ValueIsObject, acceptNil, 'JavaScript object'), allowedObject = allowObject;\nvar expectObject = /*#__PURE__*/ ValidatorForClassifier(ValueIsObject, rejectNil, 'JavaScript object'), expectedObject = expectObject;\n/**** allow/expect[ed]PlainObject ****/\nvar allowPlainObject = /*#__PURE__*/ ValidatorForClassifier(ValueIsPlainObject, acceptNil, '\"plain\" JavaScript object'), allowedPlainObject = allowPlainObject;\nvar expectPlainObject = /*#__PURE__*/ ValidatorForClassifier(ValueIsPlainObject, rejectNil, '\"plain\" JavaScript object'), expectedPlainObject = expectPlainObject;\n/**** allow/expect[ed]VanillaObject ****/\nvar allowVanillaObject = /*#__PURE__*/ ValidatorForClassifier(ValueIsVanillaObject, acceptNil, '\"vanilla\" JavaScript object'), allowedVanillaObject = allowVanillaObject;\nvar expectVanillaObject = /*#__PURE__*/ ValidatorForClassifier(ValueIsVanillaObject, rejectNil, '\"vanilla\" JavaScript object'), expectedVanillaObject = expectVanillaObject;\n/**** allow[ed]Array ****/\nfunction allowArray(Description, Argument) {\n    return (Argument == null\n        ? Argument\n        : expectedArray(Description, Argument));\n}\nvar allowedArray = allowArray;\n/**** expect[ed]Array ****/\nfunction expectArray(Description, Argument) {\n    if (Argument == null) {\n        throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n    }\n    if (ValueIsArray(Argument)) {\n        return Argument;\n    }\n    else {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is no JavaScript array\");\n    }\n}\nvar expectedArray = expectArray;\n/**** allow[ed]List ****/\nfunction allowList(Description, Argument, Expectation, minLength, maxLength) {\n    return (Argument == null\n        ? Argument\n        : expectedList(Description, Argument, Expectation, minLength, maxLength));\n}\nvar allowedList = allowList;\n/**** expect[ed]List ****/\nfunction expectList(Description, Argument, Expectation, minLength, maxLength) {\n    if (Argument == null) {\n        throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n    }\n    if (ValueIsList(Argument, minLength, maxLength)) {\n        return Argument;\n    }\n    else {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is \" + (Expectation == null\n            ? 'either not a list or contains an invalid number of elements'\n            : 'no ' + escaped(Expectation)));\n    }\n}\nvar expectedList = expectList;\n/**** allow[ed]ListSatisfying ****/\nfunction allowListSatisfying(Description, Argument, Validator, Expectation, minLength, maxLength) {\n    return (Argument == null\n        ? Argument\n        : expectedListSatisfying(Description, Argument, Validator, Expectation, minLength, maxLength));\n}\nvar allowedListSatisfying = allowListSatisfying;\n/**** expect[ed]ListSatisfying ****/\nfunction expectListSatisfying(Description, Argument, Validator, Expectation, minLength, maxLength) {\n    if (Argument == null) {\n        throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n    }\n    if (ValueIsListSatisfying(Argument, Validator, minLength, maxLength)) {\n        return Argument;\n    }\n    else {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is \" + (Expectation == null\n            ? 'either not a list or contains invalid elements'\n            : 'no ' + escaped(Expectation)));\n    }\n}\nvar expectedListSatisfying = expectListSatisfying;\n/**** allow[ed]InstanceOf ****/\nfunction allowInstanceOf(Description, Argument, constructor, Expectation) {\n    return (Argument == null\n        ? Argument\n        : expectedInstanceOf(Description, Argument, constructor, Expectation));\n}\nvar allowedInstanceOf = allowInstanceOf;\n/**** expect[ed]InstanceOf ****/\nfunction expectInstanceOf(Description, Argument, constructor, Expectation) {\n    if (Argument == null) {\n        throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n    }\n    if (!(Argument instanceof constructor)) {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is no \" + escaped(Expectation));\n    }\n    return Argument;\n}\nvar expectedInstanceOf = expectInstanceOf;\n/**** allow[ed]ValueInheritingFrom ****/\nfunction allowValueInheritingFrom(Description, Argument, prototype, Expectation) {\n    return (Argument == null\n        ? Argument\n        : expectedValueInheritingFrom(Description, Argument, prototype, Expectation));\n}\nvar allowedValueInheritingFrom = allowValueInheritingFrom;\n/**** expect[ed]ValueInheritingFrom ****/\nfunction expectValueInheritingFrom(Description, Argument, prototype, Expectation) {\n    if (Argument == null) {\n        throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n    }\n    if (prototype.isPrototypeOf(Argument)) {\n        return Argument;\n    }\n    else {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is no \" + escaped(Expectation));\n    }\n}\nvar expectedValueInheritingFrom = expectValueInheritingFrom;\n/**** allow/expect[ed]Date ****/\nvar allowDate = /*#__PURE__*/ ValidatorForClassifier(ValueIsDate, acceptNil, 'JavaScript Date object'), allowedDate = allowDate;\nvar expectDate = /*#__PURE__*/ ValidatorForClassifier(ValueIsDate, rejectNil, 'JavaScript Date object'), expectedDate = expectDate;\n/**** allow/expect[ed]Error ****/\nvar allowError = /*#__PURE__*/ ValidatorForClassifier(ValueIsError, acceptNil, 'JavaScript Error object'), allowedError = allowError;\nvar expectError = /*#__PURE__*/ ValidatorForClassifier(ValueIsError, rejectNil, 'JavaScript Error object'), expectedError = expectError;\n/**** allow/expect[ed]Promise ****/\nvar allowPromise = /*#__PURE__*/ ValidatorForClassifier(ValueIsPromise, acceptNil, 'JavaScript Promise (or \"Thenable\") object'), allowedPromise = allowPromise;\nvar expectPromise = /*#__PURE__*/ ValidatorForClassifier(ValueIsPromise, rejectNil, 'JavaScript Promise (or \"Thenable\") object'), expectedPromise = expectPromise;\n/**** allow/expect[ed]RegExp ****/\nvar allowRegExp = /*#__PURE__*/ ValidatorForClassifier(ValueIsRegExp, acceptNil, 'JavaScript RegExp object'), allowedRegExp = allowRegExp;\nvar expectRegExp = /*#__PURE__*/ ValidatorForClassifier(ValueIsRegExp, rejectNil, 'JavaScript RegExp object'), expectedRegExp = expectRegExp;\n/**** allow[ed]OneOf ****/\nfunction allowOneOf(Description, Argument, ValueList) {\n    return (Argument == null\n        ? Argument\n        : expectedOneOf(Description, Argument, ValueList));\n}\nvar allowedOneOf = allowOneOf;\n/**** expect[ed]OneOf ****/\nfunction expectOneOf(Description, Argument, ValueList) {\n    if (Argument == null) {\n        throwError(\"MissingArgument: no \" + escaped(Description) + \" given\");\n    }\n    if (ValueIsOneOf(Argument, ValueList)) {\n        return ( // unboxes any primitives\n        (Argument == null) || (typeof Argument.valueOf !== 'function')\n            ? Argument\n            : Argument.valueOf());\n    }\n    else {\n        throwError(\"InvalidArgument: the given \" + escaped(Description) + \" is not among the supported values\");\n    }\n}\nvar expectedOneOf = expectOneOf;\n/**** allow/expect[ed]Color ****/\nvar allowColor = /*#__PURE__*/ ValidatorForClassifier(ValueIsColor, acceptNil, 'valid CSS color specification'), allowedColor = allowColor;\nvar expectColor = /*#__PURE__*/ ValidatorForClassifier(ValueIsColor, rejectNil, 'valid CSS color specification'), expectedColor = expectColor;\n/**** allow/expect[ed]EMailAddress ****/\nvar allowEMailAddress = /*#__PURE__*/ ValidatorForClassifier(ValueIsEMailAddress, acceptNil, 'valid EMail address'), allowedEMailAddress = allowEMailAddress;\nvar expectEMailAddress = /*#__PURE__*/ ValidatorForClassifier(ValueIsEMailAddress, rejectNil, 'valid EMail address'), expectedEMailAddress = expectEMailAddress;\n/**** allow/expect[ed]URL ****/\nvar allowURL = /*#__PURE__*/ ValidatorForClassifier(ValueIsURL, acceptNil, 'valid URL'), allowedURL = allowURL;\nvar expectURL = /*#__PURE__*/ ValidatorForClassifier(ValueIsURL, rejectNil, 'valid URL'), expectedURL = expectURL;\n/**** escaped - escapes all control characters in a given string ****/\nfunction escaped(Text) {\n    var EscapeSequencePattern = /\\\\x[0-9a-zA-Z]{2}|\\\\u[0-9a-zA-Z]{4}|\\\\[0bfnrtv'\"\\\\\\/]?/g;\n    var CtrlCharCodePattern = /[\\x00-\\x1f\\x7f-\\x9f]/g;\n    return Text\n        .replace(EscapeSequencePattern, function (Match) {\n        return (Match === '\\\\' ? '\\\\\\\\' : Match);\n    })\n        .replace(CtrlCharCodePattern, function (Match) {\n        switch (Match) {\n            case '\\0': return '\\\\0';\n            case '\\b': return '\\\\b';\n            case '\\f': return '\\\\f';\n            case '\\n': return '\\\\n';\n            case '\\r': return '\\\\r';\n            case '\\t': return '\\\\t';\n            case '\\v': return '\\\\v';\n            default: {\n                var HexCode = Match.charCodeAt(0).toString(16);\n                return '\\\\x' + '00'.slice(HexCode.length) + HexCode;\n            }\n        }\n    });\n}\n/**** unescaped - evaluates all escape sequences in a given string ****/\nfunction unescaped(Text) {\n    var EscapeSequencePattern = /\\\\[0bfnrtv'\"\\\\\\/]|\\\\x[0-9a-zA-Z]{2}|\\\\u[0-9a-zA-Z]{4}/g;\n    return Text\n        .replace(EscapeSequencePattern, function (Match) {\n        switch (Match) {\n            case '\\\\0': return '\\0';\n            case '\\\\b': return '\\b';\n            case '\\\\f': return '\\f';\n            case '\\\\n': return '\\n';\n            case '\\\\r': return '\\r';\n            case '\\\\t': return '\\t';\n            case '\\\\v': return '\\v';\n            case '\\\\\\'': return \"'\";\n            case '\\\\\"': return '\"';\n            case '\\\\\\\\': return \"\\\\\";\n            default: {\n                var CharCode = parseInt(Match.slice(2), 16);\n                return String.fromCharCode(CharCode);\n            }\n        }\n    });\n}\n/**** quotable - makes a given string ready to be put in single/double quotes ****/\nfunction quotable(Text, Quote) {\n    if (Quote === void 0) { Quote = '\"'; }\n    var EscSeqOrSglQuotePattern = /\\\\x[0-9a-zA-Z]{2}|\\\\u[0-9a-zA-Z]{4}|\\\\[0bfnrtv'\"\\\\\\/]?|'/g;\n    var EscSeqOrDblQuotePattern = /\\\\x[0-9a-zA-Z]{2}|\\\\u[0-9a-zA-Z]{4}|\\\\[0bfnrtv'\"\\\\\\/]?|\"/g;\n    var CtrlCharCodePattern = /[\\x00-\\x1f\\x7f-\\x9f]/g;\n    return Text\n        .replace(Quote === \"'\" ? EscSeqOrSglQuotePattern : EscSeqOrDblQuotePattern, function (Match) {\n        switch (Match) {\n            case \"'\": return \"\\\\'\";\n            case '\"': return '\\\\\"';\n            case '\\\\': return '\\\\\\\\';\n            default: return Match;\n        }\n    })\n        .replace(CtrlCharCodePattern, function (Match) {\n        switch (Match) {\n            case '\\0': return '\\\\0';\n            case '\\b': return '\\\\b';\n            case '\\f': return '\\\\f';\n            case '\\n': return '\\\\n';\n            case '\\r': return '\\\\r';\n            case '\\t': return '\\\\t';\n            case '\\v': return '\\\\v';\n            default: {\n                var HexCode = Match.charCodeAt(0).toString(16);\n                return '\\\\x' + '00'.slice(HexCode.length) + HexCode;\n            }\n        }\n    });\n}\n/**** quoted ****/\nfunction quoted(Text, Quote) {\n    if (Quote === void 0) { Quote = '\"'; }\n    return Quote + quotable(Text, Quote) + Quote;\n}\n/**** HTMLsafe ****/\nfunction HTMLsafe(Argument, EOLReplacement) {\n    EOLReplacement = (EOLReplacement || '').trim() || '<br/>';\n    return Argument.replace(/[&<>\"'\\u0000-\\u001F\\u007F-\\u009F\\\\]/g, function (Match) {\n        switch (Match) {\n            case '&': return '&amp;';\n            case '<': return '&lt;';\n            case '>': return '&gt;';\n            case '\"': return '&quot;';\n            case \"'\": return '&apos;';\n            case '\\b': return '&#92;b';\n            case '\\f': return '&#92;f';\n            case '\\n': return EOLReplacement;\n            case '\\r': return '&#92;r';\n            case '\\t': return '&#92;t';\n            case '\\v': return '&#92;v';\n            case '\\\\': return '&#92;';\n            default:\n                var Result = Match.charCodeAt(0).toString(16);\n                return '&#x0000'.substring(3, 7 - Result.length) + Result + ';';\n        }\n    });\n}\n/**** MarkDownSafe ****/\nfunction MarkDownSafe(Argument, EOLReplacement) {\n    return HTMLsafe(Argument, EOLReplacement).replace(/:/g, '&#58;');\n}\n/**** ValuesDiffer ****/\nfunction ValuesDiffer(thisValue, otherValue) {\n    if (thisValue === otherValue) {\n        return false;\n    }\n    var thisType = typeof thisValue;\n    if (thisType !== typeof otherValue) {\n        return true;\n    }\n    /**** ArraysDiffer ****/\n    function ArraysDiffer(thisArray, otherArray) {\n        if (!Array.isArray(otherArray)) {\n            return true;\n        }\n        if (thisArray.length !== otherArray.length) {\n            return true;\n        }\n        for (var i = 0, l = thisArray.length; i < l; i++) {\n            if (ValuesDiffer(thisArray[i], otherArray[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**** ObjectsDiffer ****/\n    function ObjectsDiffer(thisObject, otherObject) {\n        if (Object.getPrototypeOf(thisObject) !== Object.getPrototypeOf(otherObject)) {\n            return true;\n        }\n        for (var key in thisObject) {\n            if (!(key in otherObject)) {\n                return true;\n            }\n        }\n        for (var key in otherObject) {\n            if (!(key in thisObject)) {\n                return true;\n            }\n            if (ValuesDiffer(thisObject[key], otherObject[key])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    switch (thisType) {\n        case 'undefined':\n        case 'boolean':\n        case 'string':\n        case 'function': return true; // most primitives are compared using \"===\"\n        case 'number': return ((isNaN(thisValue) !== isNaN(otherValue)) ||\n            (Math.abs(thisValue - otherValue) > Number.EPSILON));\n        case 'object':\n            if (thisValue == null) {\n                return true;\n            } // since \"other_value\" != null!\n            if (otherValue == null) {\n                return true;\n            } // since \"this_value\" != null!\n            if (Array.isArray(thisValue)) {\n                return ArraysDiffer(thisValue, otherValue);\n            }\n            return ObjectsDiffer(thisValue, otherValue);\n        default: return true; // unsupported property type\n    }\n    return true;\n}\n/**** ValuesAreEqual ****/\nfunction ValuesAreEqual(thisValue, otherValue) {\n    return !ValuesDiffer(thisValue, otherValue);\n}\n/**** ObjectIsEmpty ****/\nfunction ObjectIsEmpty(Candidate) {\n    expectObject('candidate', Candidate);\n    for (var Key in Candidate) {\n        if (Object_hasOwnProperty(Candidate, Key)) {\n            return false;\n        }\n    }\n    return true;\n}\n/**** ObjectIsNotEmpty ****/\nfunction ObjectIsNotEmpty(Candidate) {\n    return !ObjectIsEmpty(Candidate);\n}\n/**** StringIsEmpty ****/\nfunction StringIsEmpty(Candidate) {\n    return /^\\s*$/.test(Candidate);\n}\n/**** StringIsNotEmpty ****/\nfunction StringIsNotEmpty(Candidate) {\n    return !StringIsEmpty(Candidate);\n}\n/**** constrained ****/\nfunction constrained(Value, Minimum, Maximum) {\n    if (Minimum === void 0) { Minimum = -Infinity; }\n    if (Maximum === void 0) { Maximum = Infinity; }\n    return Math.max(Minimum, Math.min(Value, Maximum));\n}\n//------------------------------------------------------------------------------\n//--                             Color Utilities                              --\n//------------------------------------------------------------------------------\n// built-in color names (see http://www.w3.org/TR/SVG/types.html#ColorKeywords) ----\nvar ColorSet = {\n    transparent: 'rgba(0,0,0,0,0.0)',\n    aliceblue: 'rgba(240,248,255,1.0)', lightpink: 'rgba(255,182,193,1.0)',\n    antiquewhite: 'rgba(250,235,215,1.0)', lightsalmon: 'rgba(255,160,122,1.0)',\n    aqua: 'rgba(0,255,255,1.0)', lightseagreen: 'rgba(32,178,170,1.0)',\n    aquamarine: 'rgba(127,255,212,1.0)', lightskyblue: 'rgba(135,206,250,1.0)',\n    azure: 'rgba(240,255,255,1.0)', lightslategray: 'rgba(119,136,153,1.0)',\n    beige: 'rgba(245,245,220,1.0)', lightslategrey: 'rgba(119,136,153,1.0)',\n    bisque: 'rgba(255,228,196,1.0)', lightsteelblue: 'rgba(176,196,222,1.0)',\n    black: 'rgba(0,0,0,1.0)', lightyellow: 'rgba(255,255,224,1.0)',\n    blanchedalmond: 'rgba(255,235,205,1.0)', lime: 'rgba(0,255,0,1.0)',\n    blue: 'rgba(0,0,255,1.0)', limegreen: 'rgba(50,205,50,1.0)',\n    blueviolet: 'rgba(138,43,226,1.0)', linen: 'rgba(250,240,230,1.0)',\n    brown: 'rgba(165,42,42,1.0)', magenta: 'rgba(255,0,255,1.0)',\n    burlywood: 'rgba(222,184,135,1.0)', maroon: 'rgba(128,0,0,1.0)',\n    cadetblue: 'rgba(95,158,160,1.0)', mediumaquamarine: 'rgba(102,205,170,1.0)',\n    chartreuse: 'rgba(127,255,0,1.0)', mediumblue: 'rgba(0,0,205,1.0)',\n    chocolate: 'rgba(210,105,30,1.0)', mediumorchid: 'rgba(186,85,211,1.0)',\n    coral: 'rgba(255,127,80,1.0)', mediumpurple: 'rgba(147,112,219,1.0)',\n    cornflowerblue: 'rgba(100,149,237,1.0)', mediumseagreen: 'rgba(60,179,113,1.0)',\n    cornsilk: 'rgba(255,248,220,1.0)', mediumslateblue: 'rgba(123,104,238,1.0)',\n    crimson: 'rgba(220,20,60,1.0)', mediumspringgreen: 'rgba(0,250,154,1.0)',\n    cyan: 'rgba(0,255,255,1.0)', mediumturquoise: 'rgba(72,209,204,1.0)',\n    darkblue: 'rgba(0,0,139,1.0)', mediumvioletred: 'rgba(199,21,133,1.0)',\n    darkcyan: 'rgba(0,139,139,1.0)', midnightblue: 'rgba(25,25,112,1.0)',\n    darkgoldenrod: 'rgba(184,134,11,1.0)', mintcream: 'rgba(245,255,250,1.0)',\n    darkgray: 'rgba(169,169,169,1.0)', mistyrose: 'rgba(255,228,225,1.0)',\n    darkgreen: 'rgba(0,100,0,1.0)', moccasin: 'rgba(255,228,181,1.0)',\n    darkgrey: 'rgba(169,169,169,1.0)', navajowhite: 'rgba(255,222,173,1.0)',\n    darkkhaki: 'rgba(189,183,107,1.0)', navy: 'rgba(0,0,128,1.0)',\n    darkmagenta: 'rgba(139,0,139,1.0)', oldlace: 'rgba(253,245,230,1.0)',\n    darkolivegreen: 'rgba(85,107,47,1.0)', olive: 'rgba(128,128,0,1.0)',\n    darkorange: 'rgba(255,140,0,1.0)', olivedrab: 'rgba(107,142,35,1.0)',\n    darkorchid: 'rgba(153,50,204,1.0)', orange: 'rgba(255,165,0,1.0)',\n    darkred: 'rgba(139,0,0,1.0)', orangered: 'rgba(255,69,0,1.0)',\n    darksalmon: 'rgba(233,150,122,1.0)', orchid: 'rgba(218,112,214,1.0)',\n    darkseagreen: 'rgba(143,188,143,1.0)', palegoldenrod: 'rgba(238,232,170,1.0)',\n    darkslateblue: 'rgba(72,61,139,1.0)', palegreen: 'rgba(152,251,152,1.0)',\n    darkslategray: 'rgba(47,79,79,1.0)', paleturquoise: 'rgba(175,238,238,1.0)',\n    darkslategrey: 'rgba(47,79,79,1.0)', palevioletred: 'rgba(219,112,147,1.0)',\n    darkturquoise: 'rgba(0,206,209,1.0)', papayawhip: 'rgba(255,239,213,1.0)',\n    darkviolet: 'rgba(148,0,211,1.0)', peachpuff: 'rgba(255,218,185,1.0)',\n    deeppink: 'rgba(255,20,147,1.0)', peru: 'rgba(205,133,63,1.0)',\n    deepskyblue: 'rgba(0,191,255,1.0)', pink: 'rgba(255,192,203,1.0)',\n    dimgray: 'rgba(105,105,105,1.0)', plum: 'rgba(221,160,221,1.0)',\n    dimgrey: 'rgba(105,105,105,1.0)', powderblue: 'rgba(176,224,230,1.0)',\n    dodgerblue: 'rgba(30,144,255,1.0)', purple: 'rgba(128,0,128,1.0)',\n    firebrick: 'rgba(178,34,34,1.0)', red: 'rgba(255,0,0,1.0)',\n    floralwhite: 'rgba(255,250,240,1.0)', rosybrown: 'rgba(188,143,143,1.0)',\n    forestgreen: 'rgba(34,139,34,1.0)', royalblue: 'rgba(65,105,225,1.0)',\n    fuchsia: 'rgba(255,0,255,1.0)', saddlebrown: 'rgba(139,69,19,1.0)',\n    gainsboro: 'rgba(220,220,220,1.0)', salmon: 'rgba(250,128,114,1.0)',\n    ghostwhite: 'rgba(248,248,255,1.0)', sandybrown: 'rgba(244,164,96,1.0)',\n    gold: 'rgba(255,215,0,1.0)', seagreen: 'rgba(46,139,87,1.0)',\n    goldenrod: 'rgba(218,165,32,1.0)', seashell: 'rgba(255,245,238,1.0)',\n    gray: 'rgba(128,128,128,1.0)', sienna: 'rgba(160,82,45,1.0)',\n    green: 'rgba(0,128,0,1.0)', silver: 'rgba(192,192,192,1.0)',\n    greenyellow: 'rgba(173,255,47,1.0)', skyblue: 'rgba(135,206,235,1.0)',\n    grey: 'rgba(128,128,128,1.0)', slateblue: 'rgba(106,90,205,1.0)',\n    honeydew: 'rgba(240,255,240,1.0)', slategray: 'rgba(112,128,144,1.0)',\n    hotpink: 'rgba(255,105,180,1.0)', slategrey: 'rgba(112,128,144,1.0)',\n    indianred: 'rgba(205,92,92,1.0)', snow: 'rgba(255,250,250,1.0)',\n    indigo: 'rgba(75,0,130,1.0)', springgreen: 'rgba(0,255,127,1.0)',\n    ivory: 'rgba(255,255,240,1.0)', steelblue: 'rgba(70,130,180,1.0)',\n    khaki: 'rgba(240,230,140,1.0)', tan: 'rgba(210,180,140,1.0)',\n    lavender: 'rgba(230,230,250,1.0)', teal: 'rgba(0,128,128,1.0)',\n    lavenderblush: 'rgba(255,240,245,1.0)', thistle: 'rgba(216,191,216,1.0)',\n    lawngreen: 'rgba(124,252,0,1.0)', tomato: 'rgba(255,99,71,1.0)',\n    lemonchiffon: 'rgba(255,250,205,1.0)', turquoise: 'rgba(64,224,208,1.0)',\n    lightblue: 'rgba(173,216,230,1.0)', violet: 'rgba(238,130,238,1.0)',\n    lightcoral: 'rgba(240,128,128,1.0)', wheat: 'rgba(245,222,179,1.0)',\n    lightcyan: 'rgba(224,255,255,1.0)', white: 'rgba(255,255,255,1.0)',\n    lightgoldenrodyellow: 'rgba(250,250,210,1.0)', whitesmoke: 'rgba(245,245,245,1.0)',\n    lightgray: 'rgba(211,211,211,1.0)', yellow: 'rgba(255,255,0,1.0)',\n    lightgreen: 'rgba(144,238,144,1.0)', yellowgreen: 'rgba(154,205,50,1.0)',\n    lightgrey: 'rgba(211,211,211,1.0)',\n};\n/**** HexColor - converts a given color to #rrggbbaa ****/\nfunction HexColor(Color) {\n    var lowerColor = Color.toLowerCase();\n    if (ColorSet.hasOwnProperty(lowerColor)) {\n        // @ts-ignore TS dislikes indexing with literal keys\n        Color = ColorSet[lowerColor];\n    } // do not return here as color is now in RGBA format\n    if (/^#[a-fA-F0-9]{6}$/.test(Color)) {\n        return Color + 'FF';\n    }\n    if (/^#[a-fA-F0-9]{8}$/.test(Color)) {\n        return Color;\n    }\n    var HexDigit = '0123456789ABCDEF';\n    function dec2hex(Value) {\n        if (Value > 255) {\n            Value = 255;\n        }\n        return HexDigit[Math.trunc(Value / 16)] + HexDigit[Value % 16];\n    }\n    var RGBPattern = /^rgb\\(([0-9]+),\\s*([0-9]+),\\s*([0-9]+)\\)$/i; // not perfect\n    var Match = RGBPattern.exec(Color);\n    if (Match != null) {\n        return ('#' +\n            dec2hex(parseInt(Match[1], 10)) +\n            dec2hex(parseInt(Match[2], 10)) +\n            dec2hex(parseInt(Match[3], 10)) + 'FF');\n    }\n    var RGBAPattern = /^rgba\\(([(0-9]+),\\s*([0-9]+),\\s*([0-9]+),\\s*([01]?[.][0-9]+|[01])\\)$/i; // not perfect\n    Match = RGBAPattern.exec(Color);\n    if (Match != null) {\n        return ('#' +\n            dec2hex(parseInt(Match[1], 10)) +\n            dec2hex(parseInt(Match[2], 10)) +\n            dec2hex(parseInt(Match[3], 10)) +\n            dec2hex(parseFloat(Match[4])));\n    }\n    throwError('InvalidArgument: the given Value is not a valid CSS Color specification');\n}\n/**** RGBAColor - converts a given color to RGBA(r,g,b,a) ****/\nfunction RGBAColor(Color) {\n    var lowerColor = Color.toLowerCase();\n    if (ColorSet.hasOwnProperty(lowerColor)) {\n        // @ts-ignore TS dislikes indexing with literal keys\n        return ColorSet[lowerColor]; // color is already in RGBA format\n    }\n    if (/^#[a-fA-F0-9]{6}$/.test(Color)) {\n        return ('rgba(' +\n            parseInt(Color.slice(1, 3), 16) + ',' +\n            parseInt(Color.slice(3, 5), 16) + ',' +\n            parseInt(Color.slice(5, 7), 16) + ', 1' +\n            ')');\n    }\n    if (/^#[a-fA-F0-9]{8}$/.test(Color)) {\n        return ('rgba(' +\n            parseInt(Color.slice(1, 3), 16) + ',' +\n            parseInt(Color.slice(3, 5), 16) + ',' +\n            parseInt(Color.slice(5, 7), 16) + ',' +\n            (parseInt(Color.slice(7), 16) / 255) +\n            ')');\n    }\n    var RGBPattern = /^rgb\\(([0-9]+),\\s*([0-9]+),\\s*([0-9]+)\\)$/i; //not perfect\n    var Match = RGBPattern.exec(Color);\n    if (Match != null) {\n        return Color.slice(0, Color.length - 1) + ',1)';\n    }\n    var RGBAPattern = /^rgba\\(([(0-9]+),\\s*([0-9]+),\\s*([0-9]+),\\s*([0]?[.][0-9]+|[01])\\)$/i; // not perfect\n    Match = RGBAPattern.exec(Color);\n    if (Match != null) {\n        return Color;\n    }\n    throwError('InvalidArgument: the given Value is not a valid CSS Color specification');\n}\n/**** shortHexColor - converts a given color into #RRGGBB ****/\nfunction shortHexColor(Color) {\n    return HexColor(Color).slice(0, 7);\n}\n\nexport { ColorSet, FunctionWithName, HTMLsafe, HexColor, MarkDownSafe, ObjectIsEmpty, ObjectIsNotEmpty, ObjectMergedWith, Object_hasOwnProperty, Object_isPrototypeOf, Object_propertyIsEnumerable, Object_toLocaleString, Object_toString, Object_valueOf, RGBAColor, StringIsEmpty, StringIsNotEmpty, ValidatorForClassifier, ValueExists, ValueInheritsFrom, ValueIsAnonymousFunction, ValueIsArray, ValueIsBoolean, ValueIsCardinal, ValueIsColor, ValueIsDate, ValueIsEMailAddress, ValueIsEmptyString, ValueIsError, ValueIsFiniteNumber, ValueIsFunction, ValueIsInstanceOf, ValueIsInteger, ValueIsIntegerInRange, ValueIsList, ValueIsListSatisfying, ValueIsMissing, ValueIsNaN, ValueIsNamedFunction, ValueIsNativeFunction, ValueIsNonEmptyString, ValueIsNumber, ValueIsNumberInRange, ValueIsObject, ValueIsOneOf, ValueIsOrdinal, ValueIsPlainObject, ValueIsPromise, ValueIsRegExp, ValueIsScriptedFunction, ValueIsString, ValueIsStringMatching, ValueIsText, ValueIsTextline, ValueIsURL, ValueIsVanillaObject, ValuesAreEqual, ValuesDiffer, acceptNil, allowAnonymousFunction, allowArray, allowBoolean, allowCardinal, allowColor, allowDate, allowEMailAddress, allowError, allowFiniteNumber, allowFunction, allowInstanceOf, allowInteger, allowIntegerInRange, allowList, allowListSatisfying, allowNaN, allowNamedFunction, allowNativeFunction, allowNonEmptyString, allowNumber, allowNumberInRange, allowObject, allowOneOf, allowOrdinal, allowPlainObject, allowPromise, allowRegExp, allowScriptedFunction, allowString, allowStringMatching, allowText, allowTextline, allowURL, allowValueInheritingFrom, allowVanillaObject, allowedAnonymousFunction, allowedArray, allowedBoolean, allowedCardinal, allowedColor, allowedDate, allowedEMailAddress, allowedError, allowedFiniteNumber, allowedFunction, allowedInstanceOf, allowedInteger, allowedIntegerInRange, allowedList, allowedListSatisfying, allowedNaN, allowedNamedFunction, allowedNativeFunction, allowedNonEmptyString, allowedNumber, allowedNumberInRange, allowedObject, allowedOneOf, allowedOrdinal, allowedPlainObject, allowedPromise, allowedRegExp, allowedScriptedFunction, allowedString, allowedStringMatching, allowedText, allowedTextline, allowedURL, allowedValueInheritingFrom, allowedVanillaObject, constrained, escaped, expectAnonymousFunction, expectArray, expectBoolean, expectCardinal, expectColor, expectDate, expectEMailAddress, expectError, expectFiniteNumber, expectFunction, expectInstanceOf, expectInteger, expectIntegerInRange, expectList, expectListSatisfying, expectNaN, expectNamedFunction, expectNativeFunction, expectNonEmptyString, expectNumber, expectNumberInRange, expectObject, expectOneOf, expectOrdinal, expectPlainObject, expectPromise, expectRegExp, expectScriptedFunction, expectString, expectStringMatching, expectText, expectTextline, expectURL, expectValue, expectValueInheritingFrom, expectVanillaObject, expectedAnonymousFunction, expectedArray, expectedBoolean, expectedCardinal, expectedColor, expectedDate, expectedEMailAddress, expectedError, expectedFiniteNumber, expectedFunction, expectedInstanceOf, expectedInteger, expectedIntegerInRange, expectedList, expectedListSatisfying, expectedNaN, expectedNamedFunction, expectedNativeFunction, expectedNonEmptyString, expectedNumber, expectedNumberInRange, expectedObject, expectedOneOf, expectedOrdinal, expectedPlainObject, expectedPromise, expectedRegExp, expectedScriptedFunction, expectedString, expectedStringMatching, expectedText, expectedTextline, expectedURL, expectedValue, expectedValueInheritingFrom, expectedVanillaObject, global, quotable, quoted, rejectNil, shortHexColor, throwError, unescaped, validatedArgument };\n//# sourceMappingURL=javascript-interface-library.esm.js.map\n","/*******************************************************************************\n*                                                                              *\n*                        WebApp Tinkerer (WAT) Runtime                         *\n*                                                                              *\n*******************************************************************************/\n\nimport download    from 'downloadjs'\nimport localforage from 'localforage'\n\nimport {\n  global, throwError, quoted,\n  ObjectIsEmpty,\n  ValueIsBoolean,\n  ValueIsFiniteNumber, ValueIsNumberInRange, ValueIsOrdinal,\n  ValueIsString, ValueIsStringMatching,\n  ValueIsText, ValueIsTextline, ValueIsArray, ValueIsFunction,\n  ValueIsOneOf, ValueIsURL,\n  allowBoolean, expectBoolean, expectedBoolean,\n  expectedNumber, allowNumberInRange, expectNumberInRange, expectedNumberInRange,\n  allowIntegerInRange, expectedIntegerInRange, allowOrdinal, expectOrdinal,\n  allowString, expectedStringMatching, allowText, allowedText, expectText,\n  allowTextline, allowedTextline, expectedTextline,\n  allowFunction, allowedFunction, expectFunction, expectedFunction,\n  expectObject, allowPlainObject, expectPlainObject, allowArray, expectedArray,\n  allowOneOf, expectedOneOf, expectOneOf,\n  allowColor, expectColor, expectURL,\n  ValidatorForClassifier, acceptNil, rejectNil,\n  ValuesAreEqual, HexColor, shortHexColor\n} from 'javascript-interface-library'\nimport * as JIL from 'javascript-interface-library'\n\nnamespace WAT {\n  export const Version = '0.1.0'\n\n/**** common types and values ****/\n\n  type WAT_uniqueId = string\n\n  export const WAT_Categories = ['Applet','Card','Overlay','Control','Compound']\n  export type  WAT_Category   = typeof WAT_Categories[number]\n\n  export type WAT_SemVer = string            // mainly for illustrative purposes\n  type WAT_Version = {     // not to be exported, users should stick with SemVer\n    major:number, minor?:number, Patch?:number, Build?:number\n  }\n  type WAT_normalizedVersion = {                           // not to be exported\n    major:number, minor:number, Patch:number, Build:number\n  }\n\n/**** layout setting types ****/\n\n  export type WAT_Location  = number         // mainly for illustrative purposes\n  export type WAT_Dimension = number                                     // dto.\n  export type WAT_Position  = { x:WAT_Location,y:WAT_Location }\n  export type WAT_Size      = { Width:WAT_Dimension,Height:WAT_Dimension }\n  export type WAT_Geometry  = { x:WAT_Location,y:WAT_Location, Width:WAT_Dimension,Height:WAT_Dimension }\n\n  export const WAT_horizontalAnchorings = ['left-width','left-right','width-right']\n  export type  WAT_horizontalAnchoring  = typeof WAT_horizontalAnchorings[number]\n\n  export const WAT_verticalAnchorings = ['top-height','top-bottom','height-bottom']\n  export type  WAT_verticalAnchoring  = typeof WAT_verticalAnchorings[number]\n\n  export type WAT_horizontalOffsets = [ WAT_Location|WAT_Dimension, WAT_Location|WAT_Dimension ]\n  export type WAT_verticalOffsets   = [ WAT_Location|WAT_Dimension, WAT_Location|WAT_Dimension ]\n\n/**** visual setting types ****/\n\n  export const WAT_FontWeights = [\n    'thin', 'extra-light', 'light', 'normal', 'medium', 'semi-bold',\n    'bold', 'extra-bold', 'heavy', 'lighter', 'bolder'\n  ]\n  export type WAT_FontWeight = typeof WAT_FontWeights[number]\n\n  const WAT_FontWeightValues = Object.assign(Object.create(null),{\n    'thin':100, 'extra-light':200, 'light':300, 'normal':400, 'medium':500,\n    'semi-bold':600, 'bold':700, 'extra-bold':800, 'heavy':900\n  })\n\n  export const WAT_FontStyles = [ 'normal',  'italic' ]\n  export type  WAT_FontStyle  = typeof WAT_FontStyles[number]\n\n  export const WAT_TextDecorationLines = [ 'none','underline','overline','line-through' ]\n  export type  WAT_TextDecorationLine  = typeof WAT_TextDecorationLines[number]\n\n  export const WAT_TextDecorationStyles = [ 'solid','double','dotted','dashed','wavy' ]\n  export type  WAT_TextDecorationStyle  = typeof WAT_TextDecorationStyles[number]\n\n  export type WAT_TextDecoration = {\n    Line:       WAT_TextDecorationLine,\n    Color?:     WAT_Color,          // \"null\" or \"undefined\" mean \"currentColor\"\n    Style?:     WAT_TextDecorationStyle,\n    Thickness?: WAT_Dimension          // \"null\" or \"undefined\" mean \"from-font\"\n  }\n\n  export type WAT_TextShadow = {\n    xOffset:   WAT_Location,\n    yOffset:   WAT_Location,\n    BlurRadius:WAT_Dimension,\n    Color:     WAT_Color                   // Color = \"transparent\" means \"none\"\n  }\n\n  export const WAT_TextAlignments = [ 'left','center','right','justify' ]\n  export type  WAT_TextAlignment  = typeof WAT_TextAlignments[number]\n\n  export const WAT_BackgroundModes = [ 'normal','contain','cover','fill','tile' ]\n  export type  WAT_BackgroundMode  = typeof WAT_BackgroundModes[number]\n\n  export type WAT_BackgroundTexture = {\n    ImageURL:WAT_URL,\n    Mode:    WAT_BackgroundMode,\n    xOffset: WAT_Location,\n    yOffset: WAT_Location\n  }\n\n  export const WAT_BorderStyles = [\n    'none', 'dotted', 'dashed', 'solid', 'double',\n    'groove', 'ridge', 'inset', 'outset'\n  ]\n  export type WAT_BorderStyle = typeof WAT_BorderStyles[number]\n\n  export type WAT_BoxShadow = {\n    isInset:     boolean,\n    xOffset:     WAT_Location,\n    yOffset:     WAT_Location,\n    BlurRadius:  WAT_Dimension,\n    SpreadRadius:WAT_Dimension,\n    Color:       WAT_Color                 // Color = \"transparent\" means \"none\"\n  }\n\n  export const WAT_Cursors = [\n    'alias', 'all-scroll', 'auto', 'cell', 'context-menu', 'col-resize', 'copy',\n    'crosshair', 'default', 'e-resize', 'ew-resize', 'grab', 'grabbing', 'help',\n    'move', 'n-resize', 'ne-resize', 'nesw-resize', 'ns-resize', 'nw-resize',\n    'nwse-resize', 'no-drop', 'none', 'not-allowed', 'pointer', 'progress',\n    'row-resize', 's-resize', 'se-resize', 'sw-resize', 'text', 'vertical-text',\n    'w-resize', 'wait', 'zoom-in', 'zoom-out'\n  ]\n  export type WAT_Cursor = typeof WAT_Cursors[number]\n\n  export type WAT_customCursor = {\n    ImageURL:WAT_URL,\n    xOffset: WAT_Location,\n    yOffset: WAT_Location\n  }\n\n  export const WAT_Overflows = [ 'visible',  'hidden',  'scroll',  'auto' ]\n  export type  WAT_Overflow  = typeof WAT_Overflows[number]\n\n  export const WAT_TextOverflows = ['clip',  'ellipsis']\n  export type  WAT_TextOverflow  = typeof WAT_TextOverflows[number]\n\n/**** additional data types ****/\n\n  export type WAT_Text     = string          // mainly for illustrative purposes\n  export type WAT_Textline = string                                      // dto.\n  export type WAT_Color    = string                                      // dto.\n  export type WAT_URL      = string                                      // dto.\n\n/**** re-export contents of javascript-interface-library ****/\n\n  for (let Key in JIL) {\n// @ts-ignore don't worry about typing\n    if (Object.prototype.hasOwnProperty.call(JIL,Key)) { WAT[Key] = JIL[Key] }\n  }\n\n/**** ValueIsElement ****/\n\n  export function ValueIsElement (Value:any):boolean {\n    return (Value instanceof HTMLElement)\n  }\n\n/**** allow/expect[ed]Element ****/\n\n  export const allowElement = ValidatorForClassifier(\n    ValueIsElement, acceptNil, 'DOM element'\n  ), allowedElement = allowElement\n\n  export const expectElement = ValidatorForClassifier(\n    ValueIsElement, rejectNil, 'DOM element'\n  ), expectedElement = expectElement\n\n/**** ValueIsVisual ****/\n\n  export function ValueIsVisual (Value:any):boolean {\n    return (Value instanceof WAT_Visual)\n  }\n\n/**** allow/expect[ed]Visual ****/\n\n  export const allowVisual = ValidatorForClassifier(\n    ValueIsVisual, acceptNil, 'WAT visual'\n  ), allowedVisual = allowVisual\n\n  export const expectVisual = ValidatorForClassifier(\n    ValueIsVisual, rejectNil, 'WAT visual'\n  ), expectedVisual = expectVisual\n\n/**** ValueIsApplet ****/\n\n  export function ValueIsApplet (Value:any):boolean {\n    return (Value instanceof WAT_Applet)\n  }\n\n/**** allow/expect[ed]Applet ****/\n\n  export const allowApplet = ValidatorForClassifier(\n    ValueIsApplet, acceptNil, 'WAT applet'\n  ), allowedApplet = allowApplet\n\n  export const expectApplet = ValidatorForClassifier(\n    ValueIsApplet, rejectNil, 'WAT applet'\n  ), expectedApplet = expectApplet\n\n/**** ValueIsCard ****/\n\n  export function ValueIsCard (Value:any):boolean {\n    return (Value instanceof WAT_Card)\n  }\n\n/**** allow/expect[ed]Card ****/\n\n  export const allowCard = ValidatorForClassifier(\n    ValueIsCard, acceptNil, 'WAT card'\n  ), allowedCard = allowCard\n\n  export const expectCard = ValidatorForClassifier(\n    ValueIsCard, rejectNil, 'WAT card'\n  ), expectedCard = expectCard\n\n/**** ValueIsOverlay ****/\n\n  export function ValueIsOverlay (Value:any):boolean {\n    return (Value instanceof WAT_Overlay)\n  }\n\n/**** allow/expect[ed]Overlay ****/\n\n  export const allowOverlay = ValidatorForClassifier(\n    ValueIsOverlay, acceptNil, 'WAT overlay'\n  ), allowedOverlay = allowOverlay\n\n  export const expectOverlay = ValidatorForClassifier(\n    ValueIsOverlay, rejectNil, 'WAT overlay'\n  ), expectedOverlay = expectOverlay\n\n/**** ValueIsControl ****/\n\n  export function ValueIsControl (Value:any):boolean {\n    return (Value instanceof WAT_Control)\n  }\n\n/**** allow/expect[ed]Control ****/\n\n  export const allowControl = ValidatorForClassifier(\n    ValueIsControl, acceptNil, 'WAT control'\n  ), allowedControl = allowControl\n\n  export const expectControl = ValidatorForClassifier(\n    ValueIsControl, rejectNil, 'WAT control'\n  ), expectedControl = expectControl\n\n/**** ValueIsCompound ****/\n\n  export function ValueIsCompound (Value:any):boolean {\n    return (Value instanceof WAT_Compound)\n  }\n\n/**** allow/expect[ed]Compound ****/\n\n  export const allowCompound = ValidatorForClassifier(\n    ValueIsCompound, acceptNil, 'WAT compound'\n  ), allowedCompound = allowCompound\n\n  export const expectCompound = ValidatorForClassifier(\n    ValueIsCompound, rejectNil, 'WAT compound'\n  ), expectedCompound = expectCompound\n\n/**** ValueIsComponent ****/\n\n  export function ValueIsComponent (Value:any):boolean {\n    return (Value instanceof WAT_Control) || (Value instanceof WAT_Compound)\n  }\n\n/**** allow/expect[ed]Component ****/\n\n  export const allowComponent = ValidatorForClassifier(\n    ValueIsComponent, acceptNil, 'WAT component'\n  ), allowedComponent = allowComponent\n\n  export const expectComponent = ValidatorForClassifier(\n    ValueIsComponent, rejectNil, 'WAT component'\n  ), expectedComponent = expectComponent\n\n/**** ValueIsContainer ****/\n\n  export function ValueIsContainer (Value:any):boolean {\n    return (Value instanceof WAT_Container)\n  }\n\n/**** allow/expect[ed]Container ****/\n\n  export const allowContainer = ValidatorForClassifier(\n    ValueIsContainer, acceptNil, 'WAT container'\n  ), allowedContainer = allowContainer\n\n  export const expectContainer = ValidatorForClassifier(\n    ValueIsContainer, rejectNil, 'WAT container'\n  ), expectedContainer = expectContainer\n\n/**** ValueIsUniqueId ****/\n\n  const uniqueIdPattern = /^wat-[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$/i\n\n  export function ValueIsUniqueId (Value:any):boolean {\n    return (ValueIsString(Value) && uniqueIdPattern.test(Value))\n  }\n\n/**** allow/expect[ed]UniqueId ****/\n\n  export const allowUniqueId = ValidatorForClassifier(\n    ValueIsUniqueId, acceptNil, 'unique WAT id'\n  ), allowedUniqueId = allowUniqueId\n\n  export const expectUniqueId = ValidatorForClassifier(\n    ValueIsUniqueId, rejectNil, 'unique WAT id'\n  ), expectedUniqueId = expectUniqueId\n\n/**** ValueIsId (i.e., HTML id) ****/\n\n  export type WAT_Id = string                // mainly for illustrative purposes\n\n  const WAT_IdPattern = /^[a-z][-_a-z.0-9]*$/i\n// see https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/id\n\n  export function ValueIsId (Value:any):boolean {\n    return ValueIsStringMatching(Value, WAT_IdPattern)\n  }\n\n/**** allow/expect[ed]Id ****/\n\n  export const allowId = ValidatorForClassifier(\n    ValueIsId, acceptNil, 'WAT HTML id'\n  ), allowedId = allowId\n\n  export const expectId = ValidatorForClassifier(\n    ValueIsId, rejectNil, 'WAT HTML id'\n  ), expectedId = expectId\n\n/**** ValueIsName ****/\n\n  export type WAT_Name = string              // mainly for illustrative purposes\n\n  const WAT_NamePattern = /^[a-z$_][a-z$_0-9]*(-[a-z$_][a-z$_0-9]*)*$/i\n\n  export function ValueIsName (Value:any):boolean {\n    return ValueIsStringMatching(Value, WAT_NamePattern)\n  }\n\n/**** allow/expect[ed]Name ****/\n\n  export const allowName = ValidatorForClassifier(\n    ValueIsName, acceptNil, 'WAT name'\n  ), allowedName = allowName\n\n  export const expectName = ValidatorForClassifier(\n    ValueIsName, rejectNil, 'WAT name'\n  ), expectedName = expectName\n\n/**** ValueIsUniversalName ****/\n\n  const WAT_UniversalNamePattern = /^#?[a-z$_][a-z$_0-9]*(-[a-z$_][a-z$_0-9]*)*$/i\n\n  export function ValueIsUniversalName (Value:any):boolean {\n    return ValueIsStringMatching(Value, WAT_UniversalNamePattern)\n  }\n\n/**** allow/expect[ed]UniversalName ****/\n\n  export const allowUniversalName = ValidatorForClassifier(\n    ValueIsUniversalName, acceptNil, 'WAT name'\n  ), allowedUniversalName = allowUniversalName\n\n  export const expectUniversalName = ValidatorForClassifier(\n    ValueIsUniversalName, rejectNil, 'WAT name'\n  ), expectedUniversalName = expectUniversalName\n\n/**** ValueIsLabel ****/\n\n  export type WAT_Label = string             // mainly for illustrative purposes\n\n  export function ValueIsLabel (Value:any):boolean {\n    return ValueIsTextline(Value)\n  }\n\n/**** allow/expect[ed]Label ****/\n\n  export const allowLabel = ValidatorForClassifier(\n    ValueIsLabel, acceptNil, 'WAT visual label'\n  ), allowedLabel = allowLabel\n\n  export const expectLabel = ValidatorForClassifier(\n    ValueIsLabel, rejectNil, 'WAT visual label'\n  ), expectedLabel = expectLabel\n\n/**** ValueIsIdentifier ****/\n\n  export type WAT_Identifier = string        // mainly for illustrative purposes\n\n  const IdentifierPattern = /^[a-z$_][a-z$_0-9]*$/i\n\n  export function ValueIsIdentifier (Value:any):boolean {\n    return ValueIsStringMatching(Value, IdentifierPattern)\n  }\n\n/**** allow/expect[ed]Identifier ****/\n\n  export const allowIdentifier = ValidatorForClassifier(\n    ValueIsIdentifier, acceptNil, 'WAT identifier'\n  ), allowedIdentifier = allowIdentifier\n\n  export const expectIdentifier = ValidatorForClassifier(\n    ValueIsIdentifier, rejectNil, 'WAT identifier'\n  ), expectedIdentifier = expectIdentifier\n\n/**** ValueIsLocation ****/\n\n  export function ValueIsLocation (Value:any):boolean {\n    return ValueIsNumberInRange(Value, 0,Infinity, true,false)\n  }\n\n/**** allow/expect[ed]Location ****/\n\n  export const allowLocation = ValidatorForClassifier(\n    ValueIsLocation, acceptNil, 'coordinate'\n  ), allowedLocation = allowLocation\n\n  export const expectLocation = ValidatorForClassifier(\n    ValueIsLocation, rejectNil, 'coordinate'\n  ), expectedLocation = expectLocation\n\n/**** ValueIsDimension ****/\n\n  export function ValueIsDimension (Value:any):boolean {\n    return ValueIsFiniteNumber(Value) && (Value >= 0)\n  }\n\n/**** allow/expect[ed]Dimension ****/\n\n  export const allowDimension = ValidatorForClassifier(\n    ValueIsDimension, acceptNil, 'extent'\n  ), allowedDimension = allowDimension\n\n  export const expectDimension = ValidatorForClassifier(\n    ValueIsDimension, rejectNil, 'extent'\n  ), expectedDimension = expectDimension\n\n/**** ValueIsSemVer ****/\n\n  const SemVerPattern = /^(0|[1-9]\\d*)(?:[.](0|[1-9]\\d*)(?:[.](0|[1-9]\\d*)(-[-0-9A-Za-z.]+)?)?)?$/\n// pattern is not perfect, see https://semver.org/\n\n  export function ValueIsSemVer (Value:any):boolean {\n    return ValueIsStringMatching(Value, SemVerPattern)\n  }\n\n/**** allow/expect[ed]SemVer ****/\n\n  export const allowSemVer = ValidatorForClassifier(\n    ValueIsSemVer, acceptNil, 'version specification'\n  ), allowedSemVer = allowSemVer\n\n  export const expectSemVer = ValidatorForClassifier(\n    ValueIsSemVer, rejectNil, 'version specification'\n  ), expectedSemVer = expectSemVer\n\n/**** throwReadOnlyError ****/\n\n  export function throwReadOnlyError (Name:WAT_Name):never {\n    throwError(\n      'ReadOnlyProperty: property ' + quoted(Name) + ' must not be set'\n    )\n  }\n\n/**** throwWriteOnlyError ****/\n\n  export function throwWriteOnlyError (Name:WAT_Name):never {\n    throwError(\n      'WriteOnlyProperty: property ' + quoted(Name) + ' must not be read'\n    )\n  }\n\n/**** PropertyDescriptorFor ****/\n\n  export function PropertyDescriptorFor (Target:any, Property:any):any {\n    if (Target == null) throwError(\n      'InvalidArgument: the given target object is null or undefined'\n    )\n\n    while (Target != null) {\n      let Candidate = Object.getOwnPropertyDescriptor(Target,Property)\n      if (Candidate != null) { return Candidate }\n\n      Target = Object.getPrototypeOf(Target)\n    }\n\n    return undefined\n  }\n\n/**** KeySetOf ****/\n\n  type WAT_KeySet = { [Key:string]:any }\n\n  function KeySetOf (KeyList:string[]):WAT_KeySet {\n    let Result = Object.create(null)\n      KeyList.forEach(Key => Result[Key] = Key)\n    return Result\n  }\n\n/**** camelized ****/\n\n  function camelized (Original:string):string {\n    return Original.replace(/-([a-z])/gi,(Match) => Match[1].toUpperCase())\n  }\n\n/**** pruned ****/\n\n  function pruned (Original:string):string {\n    return Original.replace(/^\\s+/,'').replace(/\\s+$/,'').replace(/\\s+/g,' ')\n  }\n\n/**** forEach ****/\n\n  type IteratorCallback = (Value:any, Index:number, List:any[]) => void\n\n  function forEach (\n    ElementList:HTMLCollection|NodeListOf<Element>, Handler:IteratorCallback\n  ):void {\n    Array.prototype.forEach.call(ElementList,Handler)\n  }\n\n/**** filtered ****/\n\n  type FilterCallback = (Value:any, Index:number, List:any[]) => unknown\n\n  function filtered (\n    ElementList:HTMLCollection|NodeListOf<Element>, Filter:string | FilterCallback\n  ):HTMLElement[] {\n    return (\n      ValueIsString(Filter)\n      ? Array.prototype.filter.call(ElementList,(Candidate:Element) => Candidate.matches(Filter as string))\n      : Array.prototype.filter.call(ElementList,Filter as FilterCallback)\n    )\n  }\n\n/**** closestParent ****/\n\n  function closestParent (DOMElement:HTMLElement, Selector:string):HTMLElement | undefined {\n    let outerElement = DOMElement.parentElement\n    if (outerElement == null) { return undefined }\n\n    return outerElement.closest(Selector) as HTMLElement\n  }\n\n/**** closestFilteredParent ****/\n\n  function closestFilteredParent (\n    DOMElement:HTMLElement, Selector:string, Filter:Function\n  ):HTMLElement | undefined {\n    let outerElement = DOMElement.parentElement\n    if (outerElement == null) { return undefined }\n\n    outerElement = outerElement.closest(Selector) as HTMLElement\n    while (outerElement != null) {\n      if (Filter(outerElement) == true) { return outerElement }\n      outerElement = outerElement.closest(Selector) as HTMLElement\n    }\n\n    return undefined\n  }\n\n/**** attr ****/\n\n  function attr (DOMElement:Element, Name:string, Value?:string):any {\n    if (arguments.length === 2) {\n      return DOMElement.getAttribute(Name)\n    } else {\n      if (Value == null) {\n        DOMElement.removeAttribute(Name)\n      } else {\n        DOMElement.setAttribute(Name,Value as string)\n      }\n    }\n  }\n\n/**** css ****/\n\n  function css (DOMElement:HTMLElement, Name:string, Value?:string):any {\n    if (arguments.length === 2) {\n// @ts-ignore we want to index literally!\n      return window.getComputedStyle(DOMElement)[camelized(Name)] as string\n    } else {\n// @ts-ignore we want to index literally!\n      DOMElement.style[camelized(Name)] = Value as string\n    }\n  }\n\n/**** html ****/\n\n  function html (DOMElement:Element, Value?:string):any {\n    if (arguments.length === 1) {\n      return DOMElement.innerHTML\n    } else {\n      DOMElement.innerHTML = Value as string\n    }\n  }\n\n/**** text ****/\n\n  function text (DOMElement:HTMLElement, Value?:string):any {\n    if (arguments.length === 1) {\n      return DOMElement.innerText\n    } else {\n      DOMElement.innerText = Value as string\n    }\n  }\n\n/**** data ****/\n\n  function data (DOMElement:HTMLElement, Name:string, Value?:string):any {\n    if (arguments.length === 2) {\n      return DOMElement.dataset[camelized(Name)]\n    } else {\n      DOMElement.dataset[camelized(Name)] = Value as string\n    }\n  }\n\n  const EventHandlerRegistry = new WeakMap()\n\n  function registerEventHandlerIn (\n    Element:Document|HTMLElement, EventName:string, Selector:string | undefined,\n    Handler:Function, onceOnly:boolean\n  ):void {\n    let EventNames:string[] =  pruned(EventName).split(' ')\n\n  /**** construct actual event handler ****/\n\n    let actualHandler = function EventHandler (DOMEvent:Event):void {\n      try {\n        if (\n          (Selector != null) &&\n          ! (DOMEvent.target as HTMLElement).matches(Selector)\n        ) { return }\n\n        let Result:any = Handler(DOMEvent)\n\n        if (Result === false) {\n          DOMEvent.stopPropagation()\n          DOMEvent.preventDefault()\n        }\n      } catch (Signal) {\n        console.error('event handler failed with',Signal)\n      }\n\n      if (onceOnly) {\n        off(DOMEvent.currentTarget as HTMLElement, DOMEvent.type, Selector, Handler)\n      }\n    }\n\n  /**** register and attach event handlers ****/\n\n    let HandlerList:any[] = EventHandlerRegistry.get(Element)\n    if (HandlerList == null) {\n      EventHandlerRegistry.set(Element,HandlerList = [])\n    }\n\n    EventNames.forEach((EventName:string) => {\n      HandlerList.push({ EventName, Selector, actualHandler, Handler })\n      Element.addEventListener(EventName,actualHandler,false)\n    })\n  }\n\n/**** on ****/\n\n  function on (\n    Element:Document|HTMLElement, EventName:string, Selector:string | undefined,\n    Handler:Function\n  ):void {\n    registerEventHandlerIn(Element,EventName,Selector,Handler,false)\n  }\n\n/**** one ****/\n\n  function one (\n    Element:Document|HTMLElement, EventName:string, Selector:string | undefined,\n    Handler:Function\n  ):void {\n    registerEventHandlerIn(Element,EventName,Selector,Handler,true)\n  }\n\n/**** off ****/\n\n  function off (\n    Element:Document|HTMLElement, EventName?:string, Selector?:string | undefined,\n    Handler?:Function\n  ):void {\n    let EventNames:string[] | undefined = undefined\n    if (EventName != null) { EventNames = pruned(EventName).split(' ') }\n\n  /**** unregister and detach event handlers ****/\n\n    let HandlerList:any[] = EventHandlerRegistry.get(Element)\n    if (HandlerList == null) { return }\n\n    for (let i = HandlerList.length; i >= 0; i--) {\n      let HandlerEntry = HandlerList[i]\n      if (\n        ((EventNames == null) || (EventNames.indexOf(HandlerEntry.EventName) >= 0)) &&\n        ((Selector   == null) || (HandlerEntry.Selector === Selector)) &&\n        ((Handler    == null) || (HandlerEntry.Handler  === Handler))\n      ) {\n        Element.removeEventListener(HandlerEntry.EventName,HandlerEntry.actualHandler)\n        HandlerList.splice(i,1)\n      }\n    }\n  }\n\n/**** trigger ****/\n\n  function trigger (\n    DOMElement:Document|HTMLElement, EventOrName:Event|string, extraParameters?:any\n  ):void {\n    if (ValueIsString(EventOrName)) {\n      let EventName = EventOrName as string, simulatedEvent:Event\n      switch (EventName) {\n        case 'mousedown': case 'mousemove': case 'mouseup':\n        case 'mouseover': case 'mouseenter': case 'mouseleave': case 'mouseout':\n        case 'click': case 'dblclick': case 'contextmenu':\n          simulatedEvent = new MouseEvent(EventName)\n          break\n        case 'keydown': case 'keypress': case 'keyup':\n          simulatedEvent = new KeyboardEvent(EventName)\n          break\n        default:\n          simulatedEvent = new CustomEvent(EventName)\n      }\n\n      if (extraParameters != null) {\n// @ts-ignore always allow \"detail\"\n        simulatedEvent['detail'] = extraParameters\n      }\n\n      DOMElement.dispatchEvent(simulatedEvent)\n    } else {                                         // ValueIsInstanceOf(Event)\n      if (extraParameters != null) {\n// @ts-ignore always allow \"detail\"\n        (EventOrName as Event)['detail'] = extraParameters\n      }\n\n      DOMElement.dispatchEvent(EventOrName as Event)\n    }\n  }\n\n/**** remove ****/\n\n  function remove (ElementOrList:Element|Element[]|HTMLCollection):void {\n    switch (true) {\n      case ValueIsElement(ElementOrList):\n        let outerElement = (ElementOrList as Element).parentElement\n        if (outerElement != null) { outerElement.removeChild(ElementOrList as Element) }\n        break\n      case ValueIsArray(ElementOrList):\n        (ElementOrList as Element[]).forEach((Element) => remove(Element))\n        break\n      default:\n        forEach(ElementOrList as HTMLCollection,(Element) => remove(Element))\n    }\n  }\n\n/**** ElementFromHTML ****/\n\n  function ElementFromHTML (HTML:string):HTMLElement {\n    let auxElement = document.createElement('div')\n      auxElement.innerHTML = HTML\n    return auxElement.firstChild as HTMLElement\n  }\n\n//----------------------------------------------------------------------------//\n//                                HTML Parsing                                //\n//----------------------------------------------------------------------------//\n\n  type HTMLAttribute = {\n    Name:string,\n    Value:string,\n    escapedValue:string\n  }\n\n  type HTMLParserCallbackSet = {\n    processStartTag ?: (TagName:string, Attributes:HTMLAttribute[], isUnary:boolean, isTopLevel:boolean) => any,\n    processEndTag   ?: (TagName:string, isTopLevel:boolean) => any,\n    processText     ?:    (Text:string, isTopLevel:boolean) => any,\n    processComment  ?: (Comment:string) => any\n  }\n\n  type TagStack = string[] & { last:() => string|undefined }\n\n  function parseHTML (HTML:string, Callbacks:HTMLParserCallbackSet):void {\n    const StartTagPattern  = /^<([-a-z0-9_]+)((?:[\\s\\xA0]+[-a-z0-9_]+(?:[\\s\\xA0]*=[\\s\\xA0]*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s\\xA0]+))?)*)[\\s\\xA0]*(\\/?)>/i\n    const EndTagPattern    = /^<\\/([-a-z0-9_]+)[^>]*>/i\n    const AttributePattern = /([-a-z0-9]+)(?:[\\s\\xA0]*=[\\s\\xA0]*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s\\xA0]+)))?/gi\n\n  /**** MapOf makes a \"map\" with keys from a given comma-separated key list ****/\n\n    function MapOf (Elements:string):{ [Key:string]:boolean } {\n      let ElementList = Elements.split(',')\n      let Result = Object.create(null)\n        for (let i = 0, l = ElementList.length; i < l; i++) {\n          Result[ElementList[i]] = true\n        }\n      return Result\n    }\n\n  /**** maps with the names of tags and attributes with a specific characteristic ****/\n\n    const isEmptyElement = MapOf(\n      'area,base,basefont,br,col,embed,frame,hr,img,input,isIndex,keygen,link,' +\n      'meta,param,source,track,wbr'\n    )\n\n    const isBlockElement = MapOf(\n      'address,article,aside,audio,blockquote,canvas,center,dd,dir,div,dl,dt,' +\n      'fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,' +\n      'hgroup,hr,ins,isIndex,li,main,menu,nav,noframes,noscript,ol,output,p,pre,' +\n      'section,table,tbody,td,tfoot,th,thead,tr,ul,video' +\n      ',applet' // added for WAT\n    )\n\n    const isInlineElement = MapOf(\n      'a,abbr,acronym,Applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,' +\n      'font,i,iframe,img,input,ins,kbd,label,map,Object,q,s,samp,Script,select,' +\n      'small,span,strike,strong,sub,sup,textarea,tt,u,var'\n    )\n\n    const isSelfClosingElement = MapOf(\n      'area,base,basefont,bgsound,br,col,colgroup,dd,dt,embed,frame,hr,img,' +\n      'input,isIndex,keygen,li,link,menuitem,meta,options,p,param,source,td,' +\n      'tfoot,th,thead,tr,track,wbr'\n    )\n\n    const isSpecialElement = MapOf(\n      'script,style,svelte:options'\n    )\n\n    const isKeywordAttribute = MapOf(\n      'checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,' +\n      'noshade,nowrap,readonly,selected'\n    )\n\n  /**** actual HTML parser ****/\n\n    let doNothing = function ():void {}\n\n    let processStartTag = Callbacks.processStartTag || doNothing\n    let processEndTag   = Callbacks.processEndTag   || doNothing\n    let processText     = Callbacks.processText     || doNothing\n    let processComment  = Callbacks.processComment  || doNothing\n\n// @ts-ignore \"Stack.last\" will be defined just one line later\n    let Stack:TagStack = []    // Stack with tag names of unclosed HTML elements\n      Stack.last = function last ():string|undefined { return this[this.length-1] }\n\n    function parseStartTag (\n      _:any, TagName:string, rest:string, isUnary?:boolean\n    ):string {\n      TagName = TagName.toLowerCase()\n\n      if (isBlockElement[TagName]) {            // close pending inline elements\n        while ((Stack.last() != null) && isInlineElement[Stack.last() as string]) {\n          parseEndTag('', Stack.last())\n        }\n      }\n\n      if (isSelfClosingElement[TagName] && (Stack.last() === TagName)) {\n        parseEndTag('', TagName)\n      }\n\n      isUnary = isEmptyElement[TagName] || !!isUnary\n      if (! isUnary) { Stack.push(TagName) }\n\n      if (processStartTag !== doNothing) {\n        let Attributes:any[] = []\n          rest.replace(AttributePattern, function(Match:any, AttributeName:string):string {\n            let AttributeValue:string = (arguments[2] ? arguments[2] :\n              arguments[3] ? arguments[3] :\n                arguments[4] ? arguments[4] :\n                  isKeywordAttribute[AttributeName] ? AttributeName : '')\n            Attributes.push({\n              Name:AttributeName, Value:AttributeValue,\n              escapedValue:AttributeValue.replace(/(^|[^\\\\])\"/g, '$1\\\\\\\"')\n            })\n            return ''\n          })\n        processStartTag(\n          TagName, Attributes, isUnary, (Stack.length === (isUnary ? 0 : 1))\n        )\n      }\n\n      return ''\n    }\n\n    function parseEndTag (_?:any, TagName?:string):string {\n      let Position;                 // how many open elements have to be closed?\n      if (TagName == null) {\n        Position = 0\n      } else {\n        TagName = TagName.toLowerCase()\n\n        for (Position = Stack.length-1; Position >= 0; Position--) {\n          if (Stack[Position] === TagName) { break }\n        }\n      }\n\n      if (Position >= 0) {\n        for (let i = Stack.length-1; i >= Position; i--) {\n          processEndTag(Stack[i], (i === 0))\n        }\n        Stack.length = Position\n      }\n\n      return ''\n    }\n\n    let lastHTMLContent = HTML\n    while (HTML !== '') {\n      let inText = true\n\n      if ((Stack.last() == null) || ! isSpecialElement[Stack.last() as string]) {\n        if (HTML.startsWith('<!--')) {                           // HTML comment\n          let Index = HTML.indexOf('-->',4)\n          if (Index > 0) {\n            processComment(HTML.slice(4,Index))\n            HTML    = HTML.slice(Index + 3)\n            inText = false\n          }\n        } else if (HTML.startsWith('</')) {                      // HTML end tag\n          let Match = HTML.match(EndTagPattern)\n          if (Match != null) {\n            HTML = HTML.slice(Match[0].length)\n            Match[0].replace(EndTagPattern, parseEndTag);// for side effects\n            inText = false\n          }\n        } else if (HTML.startsWith('<')) {                     // HTML start tag\n          let Match = HTML.match(StartTagPattern)\n          if (Match != null) {\n            HTML = HTML.slice(Match[0].length)\n            Match[0].replace(StartTagPattern, parseStartTag);// for side effects\n            inText = false\n          }\n        }\n\n        if (inText) {\n          let Index = HTML.indexOf('<')\n\n          let Text = (Index < 0 ? HTML : HTML.slice(0,Index))\n          HTML     = (Index < 0 ? ''   : HTML.slice(Index))\n\n          processText(Text, Stack.length === 0)\n        }\n      } else {\n        HTML = HTML.replace(\n          new RegExp('^((?:.|\\n)*?)<\\/' + Stack.last() + '[^>]*>','i'),\n          function (_:any, Text:string):string {\n            Text = Text\n              .replace(/<!--(.*?)-->/g, '$1')\n              .replace(/<!\\[CDATA\\[(.*?)]]>/g, '$1')\n            processText(Text, Stack.length === 0)\n            return ''\n          }\n        )\n        parseEndTag('', Stack.last())\n      }\n\n      if (HTML === lastHTMLContent) {\n        switch (true) {\n          case HTML.startsWith('<'):\n            HTML = HTML.slice(1)\n            processText('&lt;', Stack.length === 0)\n            break\n          default:\n            throwError('HTMLParseError: could not parse \"' + HTML + '\"')\n        }\n      }\n      lastHTMLContent = HTML\n    }\n    parseEndTag()\n  }\n\n/**** AttributeFrom ****/\n\n  function AttributeFrom (AttributeName:string, Attributes:any[]):string|undefined {\n    for (let i = 0, l = Attributes.length; i < l; i++) {\n      let Attribute = Attributes[i]\n      if (Attribute.Name === AttributeName) { return Attribute.Value }\n    }\n    return undefined\n  }\n\n/**** deserializedTag ****/\n\n  function deserializedTag (\n    TagName:string, Attributes:HTMLAttribute[], isUnary:boolean\n  ):string {\n    let Result = '<' + TagName\n      for (let i = 0, l = Attributes.length; i < l; i++) {\n        let Attribute = Attributes[i]\n        Result += ' ' + Attribute.Name + '=\"' + Attribute.escapedValue + '\"'\n      }\n    return Result + (isUnary ? '/>' : '>')\n  }\n\n/**** escapedHTMLAttribute ****/\n\n  function escapedHTMLAttribute (OriginalValue:string):string {\n    return OriginalValue.replace(\n      /[&<>\"'\\u0000-\\u001F\\u007F-\\u009F\\\\]/g, function (Match) {\n        switch (Match) {\n          case '&':  return '&amp;'\n          case '<':  return '&lt;'\n          case '>':  return '&gt;'\n          case '\"':  return '&quot;'\n          case \"'\":  return '&apos;'\n          case '\\n': return '\\n'            // allows line feeds to be preserved\n          case '\\\\': return '&#92;'\n          default:   let Result = Match.charCodeAt(0).toString(16)\n                     return '&#x0000'.substring(3,7-Result.length) + Result + ';'\n        }\n      }\n    )\n  }\n\n/**** unescapedHTMLAttribute ****/\n\n  function unescapedHTMLAttribute (OriginalValue:string):string {\n    return OriginalValue.replace(\n      /&(amp|lt|gt|quot|apos|#92|#x[0-9a-fA-F]{4});/g, function (Match) {\n        switch (Match) {\n          case '&amp;':  return '&'\n          case '&lt;':   return '<'\n          case '&gt;':   return '>'\n          case '&quot;': return '\"'\n          case '&apos;': return \"'\"\n          case '&#92;':  return '\\\\'\n          default:\n            let Code = parseInt(Match.slice(3),16)\n            return String.fromCharCode(Code)\n        }\n      }\n    )\n  }\n\n//----------------------------------------------------------------------------//\n//                              Version Handling                              //\n//----------------------------------------------------------------------------//\n\n/**** parsedVersion - parses \"SemVer\" into \"Version\" ****/\n\n  const VersionPattern = /^(\\d+)(?:[.](\\d+)(?:[.](\\d+)(-[-0-9A-Za-z.]+)?)?)?$/\n// pattern is not perfect, see https://semver.org/\n\n  function parsedVersion (              // for syntactically valid SemVers only!\n    Version:WAT_SemVer\n  ):WAT_Version {\n    let MatchList = VersionPattern.exec(Version) as string[]\n      let major = parseInt(MatchList[1],10)\n      let minor = (MatchList[2] == null ? undefined : parseInt(MatchList[2],10))\n      let Patch = (MatchList[3] == null ? undefined : parseInt(MatchList[3],10))\n      let Build = (MatchList[4] == null ? undefined : parseInt(MatchList[4].slice(1),16))\n\n    return { major, minor, Patch, Build }\n  }\n\n/**** normalized ****/\n\n  function normalized (Version:WAT_Version):WAT_normalizedVersion {\n    let { major, minor, Patch, Build } = Version\n      minor = minor || 0\n      Patch = Patch || ((major === 0) && (minor === 0) ? 1 : 0)\n      Build = 1\n    return { major, minor, Patch, Build }\n  }\n\n/**** serializedVersion ****/\n\n  function serializedVersion (Version:WAT_Version):WAT_SemVer {\n    return (\n      Version.major + '.' + (Version.minor || '0') + '.' + (Version.Patch || '0') + (\n        Version.Build == null ? '' : '.' + Version.Build.toString(16)\n      )\n    )\n  }\n\n/**** VersionAeqB ****/\n\n  function VersionAeqB (\n    VersionA:WAT_Version, VersionB:WAT_Version\n  ):boolean {\n    return (\n       (VersionA.major       ===  VersionB.major) &&\n      ((VersionA.minor || 0) === (VersionB.minor || 0)) &&\n      ((VersionA.Patch || 0) === (VersionB.Patch || 0)) &&\n      ((VersionA.Build || 1) === (VersionB.Build || 1))\n    )\n  }\n\n/**** VersionAgtB ****/\n\n  function VersionAgtB (\n    VersionA:WAT_Version, VersionB:WAT_Version\n  ):boolean {\n    return (\n      (VersionA.major  >  VersionB.major) ||\n      (VersionA.major === VersionB.major) && (\n        ((VersionA.minor || 0)  >  (VersionB.minor || 0)) ||\n        ((VersionA.minor || 0) === (VersionB.minor || 0)) && (\n          ((VersionA.Patch || 0)  >  (VersionB.Patch || 0)) ||\n          ((VersionA.Patch || 0) === (VersionB.Patch || 0)) &&\n            ((VersionA.Build || 1)  >  (VersionB.Build || 1))\n        )\n      )\n    )\n  }\n\n/**** VersionAmatchesB - A was requested and B is already loaded ****/\n\n  function VersionAmatchesB (\n    VersionA:WAT_Version, VersionB:WAT_normalizedVersion\n  ):boolean {\n    if (VersionA.major == null)              { return true }\n    if (VersionA.major !== VersionB.major)   { return false }    // inkompatible\n\n    if (VersionA.minor == null)              { return true }\n    if (VersionB.major === 0) {\n      if (VersionA.minor !== VersionB.minor) { return false }    // inkompatible\n    } else {\n      if (VersionA.minor  >  VersionB.minor) { return false }   // missing feat.\n    }\n\n    return (VersionA.Patch == null) || (VersionA.Patch <= VersionB.Patch)\n  }\n\n/**** RelationshipAreplacingB ****/\n\n  const WAT_VersionRelationships = [\n    'compatibleDowngrade','incompatibleDowngrade',\n    'sameVersion',\n    'compatibleUpgrade','incompatibleUpgrade'\n  ]\n  type WAT_VersionRelationship = typeof WAT_VersionRelationships[number]\n\n  function RelationshipAreplacingB (\n    VersionA:WAT_normalizedVersion, VersionB:WAT_normalizedVersion\n  ):WAT_VersionRelationship {\n    switch (true) {\n      case VersionAeqB(VersionA,VersionB):    return 'sameVersion'\n      case (VersionA.major < VersionB.major): return 'incompatibleDowngrade'\n      case (VersionA.major > VersionB.major): return 'incompatibleUpgrade'\n      case (VersionA.major === 0) && (VersionA.minor < VersionB.minor): return 'incompatibleDowngrade'\n      case (VersionA.major === 0) && (VersionA.minor > VersionB.minor): return 'incompatibleUpgrade'\n      case (VersionA.major === 0) && (VersionA.Patch < VersionB.Patch): return 'incompatibleDowngrade'\n      case (VersionA.major === 0) && (VersionA.Patch > VersionB.Patch): return 'compatibleUpgrade'\n      case (VersionA.major === 0) && (VersionA.Build < VersionB.Build): return 'compatibleDowngrade'\n      case (VersionA.major === 0) && (VersionA.Build > VersionB.Build): return 'compatibleUpgrade'\n      case (VersionA.minor < VersionB.minor): return 'incompatibleDowngrade'\n      case (VersionA.minor > VersionB.minor): return 'compatibleUpgrade'\n      case (VersionA.Patch < VersionB.Patch): return 'compatibleDowngrade'\n      case (VersionA.Patch > VersionB.Patch): return 'compatibleUpgrade'\n      case (VersionA.Build < VersionB.Build): return 'compatibleDowngrade'\n      case (VersionA.Build > VersionB.Build): return 'compatibleUpgrade'\n      default: throwError('InternalError: unforeseen version relationship')\n    }\n  }\n\n/**** currentTimestamp ****/\n\n  const initialTimestamp = new Date('2020-02-02').getTime()\n\n  function currentTimestamp ():number {\n    return Date.now()-initialTimestamp\n  }\n\n//----------------------------------------------------------------------------//\n//                            Resource Management                             //\n//----------------------------------------------------------------------------//\n\n  type HTMLAttributeSet = { [normalizedName:string]:HTMLAttribute }\n\n  const WAT_ResourceForms = ['literalStyle','externalStyle','literalScript','externalScript']\n  type  WAT_ResourceForm  = typeof WAT_ResourceForms[number]\n\n  type WAT_ResourceInfo = {            // used when parsing a plain resource set\n    Form:WAT_ResourceForm,\n    Type:string, Media?:string, Title?:string, noModule?:boolean,\n    Value:string|WAT_URL|undefined, AttributeSet?:HTMLAttributeSet\n  }\n\n  const UsageCountOfResource = new WeakMap()\n\n/**** ResourcesInDocument ****/\n\n  function ResourcesInDocument ():string {\n    let ResourceInfoList:WAT_ResourceInfo[] = []\n\n    function includeResource (ResourceInfo:WAT_ResourceInfo):void {\n      for (let i = 0, l = ResourceInfoList.length; i < l; i++) {\n        if (ResourceInfosAreMatching(ResourceInfoList[i],ResourceInfo)) {\n          ResourceInfoList[i] = ResourceInfo\n          return\n        }\n      }\n      ResourceInfoList.push(ResourceInfo)\n    }\n\n    filtered(document.head.children,'link,style,script').forEach((DOMElement) => {\n      let Type, Media, Title, noModule, Value\n      switch (DOMElement.tagName) {\n        case 'LINK':\n          Type  = attr(DOMElement,'type')  || 'text/css'\n          Media = attr(DOMElement,'media') || 'all'\n          Title = attr(DOMElement,'title') || undefined\n          Value = attr(DOMElement,'href')\n          if ((Type === 'text/css') && (Value != null)) {\n            includeResource({ Form:'externalStyle', Type, Media, Title, Value })\n          }\n          break\n        case 'STYLE':\n          Type  = attr(DOMElement,'type')  || 'text/css'\n          Media = attr(DOMElement,'media') || 'all'\n          Title = attr(DOMElement,'title') || undefined\n          Value = html(DOMElement)\n          if ((Type === 'text/css') && (Value.trim() !== '')) {\n            includeResource({ Form:'literalStyle', Type, Media, Title, Value })\n          }\n          break\n        case 'SCRIPT':\n          Type     = attr(DOMElement,'type') || 'application/javascript'\n            if (Type === 'text/javascript') { Type = 'application/javascript' }\n          noModule = (attr(DOMElement,'nomodule') != null)\n          Value    = attr(DOMElement,'src') || html(DOMElement)\n\n          if ((Type === 'application/javascript') && (Value.trim() !== '')) {\n            if (attr(DOMElement,'src') == null) {\n              includeResource({ Form:'literalScript',  Type, noModule, Value })\n            } else {\n              includeResource({ Form:'externalScript', Type, noModule, Value })\n            }\n          }\n      }\n    })\n\n    return ResourceInfoList.join('\\n')\n  }\n\n/**** registerResources ****/\n\n  export function registerResources (Resources:string):void {\n    expectText('resource',Resources)\n    processResources(Resources || '','register')\n  }\n\n/**** unregisterResources ****/\n\n  export function unregisterResources (Resources:string | undefined):void {\n    allowText('resource',Resources)\n    if (Resources != null) {\n      processResources(Resources || '','unregister')\n    }\n  }\n\n/**** collectResources ****/\n\n  function collectResources (Resources:string):void {\n    processResources(Resources || '','collect')\n  }\n\n/**** processResources ****/\n\n  type WAT_ResourceProcessingMode = 'register' | 'unregister' | 'collect'\n\n  function processResources (\n    Resources:string, Mode:WAT_ResourceProcessingMode\n  ):void {\n    if (Resources.trim() === '') { return }\n\n    let ResourceInfoList = parsedResources(Resources)  // also avoids duplicates\n    ResourceInfoList.forEach(\n      (ResourceInfo) => { processResource(ResourceInfo,Mode) }\n    )\n  }\n\n/**** processResource - for registration, deregistration and collection ****/\n\n  function processResource (\n    ResourceInfo:WAT_ResourceInfo, Mode:WAT_ResourceProcessingMode\n  ):void {\n    let matchingResource = ElementMatchingResourceInfo(ResourceInfo)\n    if (matchingResource == null) {\n      switch (Mode) {\n        case 'register':   break              // installation will be done below\n        case 'unregister': return                        // already unregistered\n        case 'collect':    throwError('NoSuchResource: an expected resource has already been removed')\n      }\n    } else {\n      switch (Mode) {\n        case 'register':   reuseResource(matchingResource);   return\n        case 'unregister': unuseResource(matchingResource);   return\n        case 'collect':    collectResource(matchingResource); return\n      }\n    }\n\n  /**** now install the requested resource ****/\n\n    let Resource\n    switch (ResourceInfo.Form) {\n      case 'literalStyle':\n        Resource = ElementFromHTML('<style></style>')\n        html(Resource,ResourceInfo.Value || '')\n        break\n      case 'externalStyle':\n        Resource = ElementFromHTML('<link></link>')\n        break\n      case 'literalScript':\n        Resource = ElementFromHTML('<' + 'script><' + '/script>')\n        html(Resource,ResourceInfo.Value || '')\n        break\n      case 'externalScript':\n        Resource = ElementFromHTML('<' + 'script><' + '/script>')\n        break\n      default: throwError('InternalError: unforeseen resource form')\n    }\n      let AttributeSet = ResourceInfo.AttributeSet || {}\n      for (let AttributeName in AttributeSet) {\n        if (AttributeSet.hasOwnProperty(AttributeName)) {\n          attr(Resource,AttributeName,AttributeSet[AttributeName].Value)\n        }\n      }\n    switch (ResourceInfo.Form) {\n      case 'literalStyle':\n      case 'externalStyle':\n        document.head.appendChild(Resource)\n        break\n      case 'literalScript':\n        try {\n          document.head.appendChild(Resource)\n        } catch (Signal) {\n          console.warn('could not attach literal script', Signal)\n          throw Signal\n        }\n        break\n      case 'externalScript':\n        document.head.appendChild(Resource)\n        break\n      default: throwError('InternalError: unforeseen resource form')\n    }\n\n    UsageCountOfResource.set(Resource,1)\n  }\n\n/**** parsedResources - parses resources string into ResourceInfo list ****/\n\n  function parsedResources (Resources:string):WAT_ResourceInfo[] {\n    let ResourceInfoList:WAT_ResourceInfo[] = []\n      function AttributeSetFrom (AttributeList:HTMLAttribute[]):HTMLAttributeSet {\n        let Result:HTMLAttributeSet = {}\n          for (let i = 0, l = AttributeList.length; i < l; i++) {\n            Result[ (AttributeList[i].Name as string).toLowerCase() ] = AttributeList[i]\n          }\n        return Result\n      }\n\n      function processResource (newResourceInfo:WAT_ResourceInfo):void {\n        ResourceInfoList.forEach((ResourceInfo) => {\n          if (ResourceInfosAreMatching(ResourceInfo,newResourceInfo)) {\n            throwError(\n              'DuplicateResources: the given set of resources contains duplicates'\n            )\n          } else {\n            ResourceInfoList.push(newResourceInfo)\n          }\n        })\n      }\n\n      let ResourceAttributes:HTMLAttributeSet, ResourceContent:string|undefined\n      let HTMLParserCallbacks = {\n        processStartTag: function processStartTag (\n          TagName:string, Attributes:HTMLAttribute[], isUnary:boolean, isTopLevel:boolean\n        ) {\n          if (isTopLevel) {\n            switch (TagName) {\n              case 'link':\n                if (AttributeFrom('rel',Attributes) === 'stylesheet') {\n                  processResource({\n                    Form: 'externalStyle',\n                    Type: AttributeFrom ('type',Attributes) || 'text/css',\n                    Media:AttributeFrom('media',Attributes) || 'all',\n                    Title:AttributeFrom('title',Attributes) || undefined,\n                    Value:AttributeFrom('href',Attributes),\n                    AttributeSet:AttributeSetFrom(Attributes)\n                  })\n                }\n                return\n              case 'script':\n              case 'style':\n                ResourceAttributes = AttributeSetFrom(Attributes)\n                ResourceContent    = ''\n                return\n              default:\n                throwError(\n                  'InvalidResourceSet: a WAT resource set must only contain ' +\n                  'style, script or link elements (the latter only with ' +\n                  'relation \"stylesheet\")'\n                )\n            }\n          } else {\n            if (ResourceContent !== undefined) {\n              ResourceContent += deserializedTag(TagName,Attributes,isUnary)\n            }\n          }\n        },\n        processEndTag: function processEndTag (TagName:string, isTopLevel:boolean) {\n          if (isTopLevel) {\n            switch (TagName) {\n              case 'script':\n                processResource({\n                  Form:    (ResourceAttributes.src == null ? 'literalScript' : 'externalScript'),\n                  Type:    ResourceAttributes?.type.Value || 'application/javascript',\n                  noModule:('nomodule' in ResourceAttributes),\n                  Value:   (\n                    ResourceAttributes.src == null\n                    ? ResourceContent\n                    : ResourceAttributes.src.Value\n                  ),\n                  AttributeSet:ResourceAttributes\n                })\n                break\n              case 'style':\n                processResource({\n                  Form: 'literalStyle',\n                  Type: ResourceAttributes?.type.Value  || 'text/css',\n                  Media:ResourceAttributes?.media.Value || 'all',\n                  Title:ResourceAttributes?.title.Value || undefined,\n                  Value:ResourceContent,\n                  AttributeSet:ResourceAttributes\n                })\n            }\n            ResourceAttributes = {}; ResourceContent = undefined\n          } else {\n            if (ResourceContent !== undefined) {\n              ResourceContent += '</' + TagName + '>'\n            }\n          }\n        },\n        processText: function processText (Text:string, isTopLevel:boolean) {\n          if (ResourceContent !== undefined) {\n            ResourceContent += Text\n          }\n        },\n      }\n\n      parseHTML(Resources, HTMLParserCallbacks)\n    return ResourceInfoList\n  }\n\n/**** reuseResource ****/\n\n  function reuseResource (Resource:Element):void {\n    UsageCountOfResource.set(\n      Resource, (UsageCountOfResource.get(Resource) || 0) + 1\n    )\n  }\n\n/**** unuseResource ****/\n\n  function unuseResource (Resource:Element):void {\n    UsageCountOfResource.set(\n      Resource, Math.max(0, (UsageCountOfResource.get(Resource) || 0) - 1)\n    )\n  }\n\n  let ResourceCollection:Element[]\n\n/**** clearResourceCollection - to be called prior to a resource collection ****/\n\n  function clearResourceCollection ():void {\n    ResourceCollection = []\n  }\n\n/**** collectResource ****/\n\n  function collectResource (Resource:Element):void {\n    for (let i = 0, l = ResourceCollection.length; i < l; i++) {\n      if (ResourceCollection[i] === Resource) { return }\n    }\n    ResourceCollection.push(Resource)\n  }\n\n/**** collectedResources ****/\n\n  function collectedResources ():string {\n    let Result = ''\n      for (let i = 0, l = ResourceCollection.length; i < l; i++) {\n        Result += ResourceCollection[i].outerHTML + '\\n'\n      }\n    return Result\n  }\n\n/**** ResourceInfosAreMatching ****/\n\n  function ResourceInfosAreMatching (\n    Info_A:WAT_ResourceInfo, Info_B:WAT_ResourceInfo\n  ):boolean {\n    if (Info_A.Form !== Info_B.Form) { return false }\n\n    switch (Info_A.Form) {\n      case 'literalStyle':\n      case 'externalStyle': return (\n        (Info_A.Type  === Info_B.Type)  &&\n        (Info_A.Media === Info_B.Media) &&\n        (Info_A.Title === Info_B.Title) &&\n        ((Info_A.Value || '').trim() === (Info_B.Value || '').trim())\n      )\n      case 'literalScript':\n      case 'externalScript': return (\n        (Info_A.Type     === Info_B.Type)     &&\n        (Info_A.noModule === Info_B.noModule) &&\n        ((Info_A.Value || '').trim() === (Info_B.Value || '').trim())\n      )\n      default: throwError('InternalError: unforeseen resource form')\n    }\n  }\n\n/**** ResourceInfoMatchesElement ****/\n\n  function ResourceInfoMatchesElement (\n    ResourceInfo:WAT_ResourceInfo, DOMElement:Element\n  ):boolean {\n    switch (ResourceInfo.Form) {\n      case 'literalStyle': return (\n        (DOMElement.tagName === 'STYLE') &&\n        ((attr(DOMElement,'type')  || 'text/css') === 'text/css')  &&\n        ((attr(DOMElement,'media') || 'all')      === ResourceInfo.Media) &&\n        ((attr(DOMElement,'title') || undefined)  === ResourceInfo.Title) &&\n        ((DOMElement.textContent || '').trim() === ResourceInfo.Value)\n      )\n      case 'externalStyle': return (\n        (DOMElement.tagName === 'LINK') && (attr(DOMElement,'rel') === 'stylesheet') &&\n        ((attr(DOMElement,'type')  || 'text/css') === 'text/css')  &&\n        ((attr(DOMElement,'media') || 'all')      === ResourceInfo.Media) &&\n        ((attr(DOMElement,'title') || undefined)  === ResourceInfo.Title) &&\n        (attr(DOMElement,'href') === ResourceInfo.Value)  // TODO: normalize URL\n      )\n      case 'literalScript': return (\n        (DOMElement.tagName === 'SCRIPT') && (\n          (attr(DOMElement,'type') == null) ||\n          (attr(DOMElement,'type') === 'application/javascript') ||\n          (attr(DOMElement,'type') === 'text/javascript')\n        ) &&\n        ((attr(DOMElement,'nomodule') || false) === ResourceInfo.noModule) &&\n        ((DOMElement.textContent || '').trim() === ResourceInfo.Value)\n      )\n      case 'externalScript': return (\n        (DOMElement.tagName === 'SCRIPT') && (\n          (attr(DOMElement,'type') == null) ||\n          (attr(DOMElement,'type') === 'application/javascript') ||\n          (attr(DOMElement,'type') === 'text/javascript')\n        ) &&\n        ((attr(DOMElement,'nomodule') || false) === ResourceInfo.noModule) &&\n        (attr(DOMElement,'src') === ResourceInfo.Value)   // TODO: normalize URL\n      )\n      default: throwError('InternalError: unforeseen resource form')\n    }\n  }\n\n/**** ElementMatchingResourceInfo ****/\n\n  function ElementMatchingResourceInfo (\n    ResourceInfo:WAT_ResourceInfo\n  ):Element | undefined {\n    let matchingElement:Element|undefined = undefined\n      filtered(document.head.children,'link,style,script').forEach((DOMElement) => {\n        if (ResourceInfoMatchesElement(ResourceInfo,DOMElement)) {\n          matchingElement = DOMElement\n        }\n      })\n    return matchingElement\n  }\n\n//----------------------------------------------------------------------------//\n//                              Backup Handling                               //\n//----------------------------------------------------------------------------//\n\n  let BackupIsSupported = false\n  try {\n    localforage.config({\n      driver: [localforage.INDEXEDDB, localforage.WEBSQL]\n    })\n    BackupIsSupported = true\n  } catch (Signal) { /* nop */ }\n\n  let AppletStore:any                          // will be filled during start-up\n\n/**** AppletsMayBePreserved ****/\n\n  export function AppletsMayBePreserved ():boolean {\n    return (AppletStore != null)\n  }\n\n/**** AppletMayBePreserved ****/\n\n  export function AppletMayBePreserved (Applet:WAT_Applet):boolean {\n    expectApplet('applet',Applet)\n\n    return (\n      AppletsMayBePreserved() &&\n      ValueIsName(Applet.Name) &&\n      (InternalsOfVisual(Applet) != null) &&\n      (InternalsOfVisual(Applet).BackupStatus == null)\n    )\n  }\n\n/**** AppletHasBackup ****/\n\n  export async function AppletHasBackup (\n    AppletOrPeer:WAT_Applet|HTMLElement\n  ):Promise<boolean> {\n    let AppletName\n      switch (true) {\n        case ValueIsApplet(AppletOrPeer):\n          AppletName = (AppletOrPeer as WAT_Applet).Name\n          if (AppletName == null) { return false }\n          break\n        case ValueIsElement(AppletOrPeer):\n          let Candidate = data(AppletOrPeer as HTMLElement,'wat-name')\n          if (ValueIsName(Candidate)) { AppletName = Candidate } else { return false }\n          break\n        default: throwError(\n          'InvalidArgument: applet or applet name expected'\n        )\n      }\n    if (! AppletsMayBePreserved()) { return false }\n\n    try {\n      let normalizedAppletName = (\n        AppletName.startsWith('#') ? AppletName.slice(1) : AppletName\n      )\n\n      return ValueIsString(await AppletStore.getItem(normalizedAppletName))\n    } catch (Signal) {\n      console.error(\n        'backup of applet \"' + AppletName + ' could not be checked, reason: ', Signal\n      )\n      return false\n    }\n  }\n\n/**** AppletRestoredIntoPeer (during startup: applet does not yet exist) ****/\n\n  async function AppletRestoredIntoPeer (\n    Peer:HTMLElement\n  ):Promise<WAT_Applet> {\n    expectElement('applet peer',Peer)\n\n    let AppletName = data(Peer,'wat-name')\n    if (! ValueIsName(AppletName)) throwError(\n      'InvalidArgument: the given applet peer does not have a valid name'\n    )\n\n    let Serialization\n      try {\n        let normalizedAppletName = (\n          AppletName.startsWith('#') ? AppletName.slice(1) : AppletName\n        )\n        Serialization = await AppletStore.getItem(normalizedAppletName)\n      } catch (Signal) {\n        console.error(\n          'applet \"' + AppletName + ' could not be restored, reason: ', Signal\n        )\n        throwError('applet could not be restored (see browser console)')\n      }\n    deserializeAppletIntoPeer(Serialization, Peer, {\n      compatibleDowngrade:  'perform',\n      incompatibleDowngrade:'perform',\n      sameVersion:          'perform',\n      compatibleUpgrade:    'perform',\n      incompatibleUpgrade:  'perform'\n    })\n\n    return VisualOfElement(Peer) as WAT_Applet\n  }\n\n/**** preserveApplet ****/\n\n  export async function preserveApplet (Applet:WAT_Applet):Promise<void> {\n    expectApplet('applet',Applet)\n\n    validateBackupAccessForApplet(Applet)\n\n    let AppletInternals = InternalsOfVisual(Applet)\n    try {\n      let normalizedAppletName = (\n        Applet.Name.startsWith('#') ? Applet.Name.slice(1) : Applet.Name\n      )\n\n      AppletInternals.BackupStatus = 'isBeingPreserved'\n        let Serialization = serializedVisuals(\n          [Applet],undefined,'withPendingSettings','withAllMasters'\n        )\n        await AppletStore.setItem(normalizedAppletName,Serialization)\n      delete AppletInternals.BackupStatus\n    } catch (Signal) {\n      delete AppletInternals.BackupStatus\n      console.error(\n        'applet \"' + Applet.Name + ' could not be preserved, reason: ', Signal\n      )\n      throwError('applet could not be preserved (see browser console)')\n    }\n  }\n\n/**** restoreApplet (while applet is running) ****/\n\n  export async function restoreApplet (\n    Applet:WAT_Applet, CollisionHandling:WAT_CollisionHandling\n  ):Promise<void> {\n    expectApplet('applet',Applet)\n\n    let AppletName = Applet.Name\n    validateBackupAccessForApplet(Applet)\n\n    let Serialization\n      let AppletInternals = InternalsOfVisual(Applet)\n      try {\n        let normalizedAppletName = (\n          AppletName.startsWith('#') ? AppletName.slice(1) : AppletName\n        )\n\n        AppletInternals.BackupStatus = 'isBeingRestored'\n          Serialization = await AppletStore.getItem(normalizedAppletName)\n        delete AppletInternals.BackupStatus\n      } catch (Signal) {\n        delete AppletInternals.BackupStatus\n        console.error(\n          'applet \"' + AppletName + ' could not be restored, reason: ', Signal\n        )\n        throwError('applet could not be restored (see browser console)')\n      }\n    deserializeAppletIntoPeer(Serialization, Applet.Peer, CollisionHandling)\n  }\n\n/**** removeBackupOfApplet ****/\n\n  export async function removeBackupOfApplet (Applet:WAT_Applet):Promise<void> {\n    expectApplet('applet',Applet)\n\n    validateBackupAccessForApplet(Applet)\n\n    let AppletInternals = InternalsOfVisual(Applet)\n    try {\n      let normalizedAppletName = (\n        Applet.Name.startsWith('#') ? Applet.Name.slice(1) : Applet.Name\n      )\n\n      AppletInternals.BackupStatus = 'isBeingRemoved'\n        await AppletStore.removeItem(normalizedAppletName)\n      delete AppletInternals.BackupStatus\n    } catch (Signal) {\n      delete AppletInternals.BackupStatus\n      console.error(\n        'applet \"' + Applet.Name + ' could not be removed, reason: ', Signal\n      )\n      throwError('applet could not be removed (see browser console)')\n    }\n  }\n\n/**** validateBackupAccessForApplet ****/\n\n  function validateBackupAccessForApplet (Applet:WAT_Applet):void {\n    if (! AppletsMayBePreserved()) throwError(\n      'NotSupported: WAT applets can not be preserved in this environment'\n    )\n\n    let AppletName = Applet.Name\n    if (! ValueIsName(AppletName)) throwError(\n      'InvalidArgument: the given applet does not have a valid name'\n    )\n\n    switch (InternalsOfVisual(Applet).BackupStatus) {\n      case 'isBeingPreserved': throwError(\n        'ForbiddenOperation: this applet is currently being backed-up'\n      )\n      case 'isBeingRestored': throwError(\n        'ForbiddenOperation: this applet is currently being restored from its backup'\n      )\n      case 'isBeingRemoved': throwError(\n        'ForbiddenOperation: the backup of this applet is currently being removed'\n      )\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                       Serialization/Deserialization                        //\n//----------------------------------------------------------------------------//\n\n/**** serializedResources (w/o duplicates) ****/\n\n  function serializedResources (ResourcesList:string[]):string {\n    clearResourceCollection()\n      ResourcesList.forEach(\n        (Resources) => processResources(Resources,'collect')\n      )\n    return collectedResources()\n  }\n\n/**** serializedMasters - w/o check for duplicates ****/\n\n  function serializedMasters (\n    MasterList:WAT_Name[], withPendingSettings?:'withPendingSettings'\n  ):string {\n    let Serializations:string[] = []\n      MasterList.forEach((Master) => {\n        if (Master in MasterRegistry) {\n          Serializations.push(serializedMaster(Master,withPendingSettings))\n        }\n      })\n    return Serializations.join('\\n')\n  }\n\n/**** serializedMaster ****/\n\n  export function serializedMaster (\n    Master:WAT_Name, withPendingSettings?:'withPendingSettings'\n  ):string {\n    expectName('master name',Master)\n\n    let MasterInfo = MasterRegistry[Master]\n    if (MasterInfo == null) throwError(\n      'NoSuchMaster: no master named ' + quoted(Master) + ' found'\n    )\n\n    function copyDetails (DetailNames:string):void {\n      DetailNames.split(' ').forEach((DetailName) => {\n// @ts-ignore we definitely want to index \"MasterInfo\" using a string\n        let Detail = MasterInfo[DetailName] as any\n        if (\n          (Detail != null) && (\n            ValueIsString(Detail) && (Detail !== '') ||\n            ValueIsArray(Detail)  && (Detail.length > 0)\n          )\n        ) { MasterRecord[DetailName] = Detail }\n      })\n    }\n\n    let MasterRecord:any = {}\n      copyDetails(\n        'Name Version Category Resources Template Classes Styles Script Properties'\n      )\n\n      let undesignableProperties = []\n      for (let PropertyName in MasterInfo.undesignablePropertySet) {\n        undesignableProperties.push(PropertyName)\n      }\n      MasterRecord.undesignableProperties = undesignableProperties.join(' ')\n    if (withPendingSettings === 'withPendingSettings') {\n      copyDetails(\n        'pendingResources pendingTemplate pendingClasses pendingStyles pendingScript'\n      )\n    }\n\n    return (\n      '<'+'script type=\"application/wat-master\">\\n' +\n      JSON.stringify(MasterRecord) +\n      '\\n<'+'/script>'\n    )\n  }\n\n/**** serializedVisuals - w/o check for duplicates or inclusions ****/\n\n  function serializedVisuals (\n    VisualList:WAT_Visual[],\n    withUniqueId?:'withUniqueId',\n    withPendingSettings?:'withPendingSettings',\n    withMasters?:'withAllMasters'|'withUsedMasters',\n    withResources?:'withResources' // assumes non-empty \"withMasters\"\n  ):string {\n    let Serialization = ''\n      if (withMasters || withResources) {\n        if (withMasters == null) { withMasters = 'withUsedMasters' }\n\n        let MasterList:WAT_Name[]\n          if (withMasters === 'withUsedMasters') {\n            MasterList = MastersUsedByVisuals(VisualList,'withoutIntrinsics')\n          } else {\n            MasterList = allMastersInDocument()\n          }\n\n          if (withResources) {\n            let ResourcesList:string[] = []\n              MasterList.forEach((Master) => {\n                let MasterInfo = MasterRegistry[Master]\n                if ((MasterInfo != null) && (MasterInfo.Resources != null)) {\n                  ResourcesList.push(MasterInfo.Resources)\n                }\n              })\n            if (ResourcesList.length > 0) {\n              Serialization += serializedResources(ResourcesList) + '\\n'\n            }\n          }\n        Serialization += serializedMasters(MasterList,withPendingSettings) + '\\n'\n      }\n\n      VisualList.forEach(\n        (Visual) => Serialization += serializedVisual(\n          Visual, withUniqueId, withPendingSettings\n        )\n      )\n    return Serialization\n  }\n\n/**** serializedVisual ****/\n\n  function serializedVisual (\n    Visual:WAT_Visual,\n    withUniqueId?:'withUniqueId',\n    withPendingSettings?:'withPendingSettings'\n  ):string {\n    function triggerRecursively (EventName:string):void {\n      Visual.trigger(EventName)\n      switch (Visual.Category) {\n        case 'Applet':\n          (Visual as WAT_Applet).CardList.forEach(\n            (Card:WAT_Card) => Card.trigger(EventName)\n          )\n          (Visual as WAT_Applet).OverlayList.forEach(\n            (Overlay:WAT_Overlay) => Overlay.trigger(EventName)\n          )\n          break\n        case 'Card':\n        case 'Overlay':\n        case 'Compound':\n          (Visual as WAT_Container).ComponentList.forEach(\n            (Component:WAT_Component) => Component.trigger(EventName)\n          )\n      }\n    }\n\n  /**** preserveUniqueIdIn ****/\n\n    function preserveUniqueIdIn (Peer:HTMLElement):void {\n      let Visual = VisualForDOMElement.get(Peer)\n      attr(Peer,'data-wat-unique-id',InternalsForVisual.get(Visual).uniqueId)\n\n      filtered(Peer.children,'.WAT.Card,.WAT.Overlay,.WAT.Control,.WAT.Compound')\n      .forEach(function (Peer) {\n        preserveUniqueIdIn(Peer as HTMLElement)\n      })\n    }\n\n  /**** removeUniqueIdFrom ****/\n\n    function removeUniqueIdFrom (Peer:HTMLElement):void {\n      attr(Peer,'data-wat-unique-id',undefined)\n\n      filtered(Peer.children,'.WAT.Card,.WAT.Overlay,.WAT.Control,.WAT.Compound')\n      .forEach(function (Peer) {\n        removeUniqueIdFrom(Peer as HTMLElement)\n      })\n    }\n\n    triggerRecursively('before-serialization')\n      if (withUniqueId) { preserveUniqueIdIn(Visual.Peer) }\n        let Serialization = Visual.Peer.outerHTML\n      if (withUniqueId) { removeUniqueIdFrom(Visual.Peer) }\n    triggerRecursively('after-serialization')\n\n    return Serialization\n  }\n\n/**** parsedSerialization ****/\n\n  type WAT_parsedSerialization = {\n    serializedResources:string[], serializedMasters:string[],\n    serializedApplets:string[],   serializedCards:string[],\n    serializedOverlays:string[],  serializedComponents:string[]\n  }\n\n  export function parsedSerialization (Serialization:string):WAT_parsedSerialization {\n    expectText('serialization',Serialization)\n\n    let serializedResources:string[] = [], serializedMasters:string[]    = []\n    let serializedApplets:string[]   = [], serializedCards:string[]      = []\n    let serializedOverlays:string[]  = [], serializedComponents:string[] = []\n\n    let ElementType:undefined | (\n      'literalStyle' | 'externalStyle' | 'literalScript' | 'externalScript' |\n      'Master' | 'Applet' | 'Card' | 'Overlay' | 'Component'\n    ), ElementContent:any\n    let HTMLParserCallbacks = {\n      processStartTag: function processStartTag (\n        TagName:string, Attributes:HTMLAttribute[], isUnary:boolean, isTopLevel:boolean\n      ) {\n        if (isTopLevel) {\n          switch (TagName) {\n            case 'link':\n              if (\n                (AttributeFrom('rel',Attributes) === 'stylesheet') &&\n                (ValueIsURL(AttributeFrom('href',Attributes)))\n              ) {\n                serializedResources.push(\n                  deserializedTag(TagName,Attributes,isUnary)\n                )\n              } else {\n                throwError('InvalidSerialization: invalid \"link\" element encountered')\n              }\n              break\n            case 'style':\n              let Type = AttributeFrom('type',Attributes)\n              if ((Type == null) || (Type === 'text/css')) {\n                ElementType    = 'literalStyle'\n                ElementContent = deserializedTag(TagName,Attributes,false)\n              } else {\n                throwError('InvalidSerialization: invalid \"style\" element encountered')\n              }\n              break\n            case 'script':\n              switch (AttributeFrom('type',Attributes)) {\n                case 'application/wat-master':\n                  ElementType    = 'Master'\n                  ElementContent = deserializedTag(TagName,Attributes,false)\n                  break\n                case 'application/javascript':\n                case 'text/javascript':\n                  ElementType = (\n                    (AttributeFrom('src',Attributes) == null)\n                    ? 'literalScript'\n                    : 'externalScript'\n                  )\n                  ElementContent = deserializedTag(TagName,Attributes,false)\n                  break\n                default: throwError(\n                  'InvalidSerialization: invalid \"script\" element encountered'\n                )\n              }\n              break\n            case 'div':\n              let Classes = AttributeFrom('class',Attributes) || ''\n              if (/(^|\\s)WAT(\\s|$)/.test(Classes)) {\n                switch (true) {\n                  case /(^|\\s)Applet(\\s|$)/.test(Classes):             ElementType = 'Applet';    break\n                  case /(^|\\s)Card(\\s|$)/.test(Classes):               ElementType = 'Card';      break\n                  case /(^|\\s)Overlay(\\s|$)/.test(Classes):            ElementType = 'Overlay';   break\n                  case /(^|\\s)(Control|Compound)(\\s|$)/.test(Classes): ElementType = 'Component'; break\n                  default: throwError(\n                    'InvalidSerialization: invalid \"div\" element encountered'\n                  )\n                }\n                ElementContent = deserializedTag(TagName,Attributes,false)\n              } else {\n                throwError('InvalidSerialization: invalid \"div\" element encountered')\n              }\n            default:\n              throwError(\n                'InvalidSerialization: invalid \"' + TagName.toLowerCase() + '\" ' +\n                'element encountered'\n              )\n          }\n        } else {\n          if (ElementContent !== undefined) {\n            ElementContent += deserializedTag(TagName,Attributes,isUnary)\n          }\n        }\n      },\n      processEndTag: function processEndTag (TagName:string, isTopLevel:boolean) {\n        if (isTopLevel) {\n          ElementContent += '</' + TagName + '>'\n\n          switch (TagName) {\n            case 'style':\n              serializedResources.push(ElementContent)\n              break\n            case 'script':\n              switch (ElementType) {\n                case 'Master':         serializedMasters.push(ElementContent); break\n                case 'literalScript':\n                case 'externalScript': serializedResources.push(ElementContent)\n              }\n              break\n            case 'div':\n              ElementContent += '</' + TagName + '>'\n              switch (ElementType) {\n                case 'Applet':    serializedApplets.push(ElementContent);    break\n                case 'Card':      serializedCards.push(ElementContent);      break\n                case 'Overlay':   serializedOverlays.push(ElementContent);   break\n                case 'Component': serializedComponents.push(ElementContent); break\n              }\n          }\n          ElementType = ElementContent = undefined\n        } else {\n          if (ElementContent !== undefined) {\n            ElementContent += '</' + TagName + '>'\n          }\n        }\n      },\n      processText: function processText (Text:string, isTopLevel:boolean) {\n        if (ElementContent !== undefined) {\n          ElementContent += Text\n        }\n      },\n    }\n\n    parseHTML(Serialization, HTMLParserCallbacks)\n\n    return {\n      serializedResources, serializedMasters,  serializedApplets,\n      serializedCards,     serializedOverlays, serializedComponents\n    }\n  }\n\n/**** deserializedMaster ****/\n\n  export function deserializedMaster(Serialization:string):WAT_MasterInfo {\n    expectText('serialization',Serialization)\n\n    let MasterObject\n    try {\n      MasterObject = JSON.parse(Serialization)\n    } catch (Signal) {\n      throwError(\n        'InvalidSerialization: the given serialized master does not contain ' +\n        'a master specification'\n      )\n    }\n\n    return parsedMaster(MasterObject)\n  }\n\n/**** deserializeAppletIntoPeer - Peer remains the same! ****/\n\n  function deserializeAppletIntoPeer(\n    Serialization:string, Peer:HTMLElement, CollisionHandling:WAT_CollisionHandling\n  ):void {\n    let { serializedMasters, serializedApplets } = parsedSerialization(Serialization)\n    if (serializedApplets.length === 0) throwError(\n      'InvalidSerialization: the given serialization does not contain any applets'\n    )\n    if (serializedApplets.length  >  1) throwError(\n      'InvalidSerialization: the given serialization contains multiple applets'\n    )\n\n  /**** clear old applet ****/\n\n    let duringStartUp = (WAT_isReady && ! WAT_isRunning)\n    if (duringStartUp) {\n      html(Peer,'')\n    } else {\n      let oldApplet = VisualOfElement(Peer) as WAT_Applet\n        oldApplet.CardList.forEach((Card:WAT_Card) => Card.remove())\n        oldApplet.OverlayList.forEach((Overlay:WAT_Overlay) => Overlay.remove())\n      html(Peer,'')          // also removes mandatory card (w/o event handlers)\n\n      InternalsForVisual.delete(oldApplet)\n    }\n\n  /**** if need be: install given masters ****/\n\n    if (serializedMasters.length > 0) {\n      let MasterInfoList:WAT_MasterInfo[] = []\n        serializedMasters.forEach(\n          (serializedMaster) => MasterInfoList.push(\n            deserializedMaster(serializedMaster)\n          )\n        )\n      MasterInfoList.forEach(\n        (MasterInfo) => {\n          if (! MasterIsIntrinsic(MasterInfo.Name)) {\n            registerMaster(MasterInfo)\n          }\n        }\n      )\n    }\n\n    let auxiliaryPeer = ElementFromHTML(serializedApplets[0])\n      while (auxiliaryPeer.hasChildNodes()) {\n        Peer.appendChild(auxiliaryPeer.firstChild as ChildNode)\n      }\n\n      let AttributeList = auxiliaryPeer.attributes\n      for (let i = 0, l = AttributeList.length; i < l; i++) {\n        let AttributeName = AttributeList[i].name\n        switch (AttributeName) {\n          case 'id': case 'class': case 'style': break\n          default: attr(Peer,AttributeName,AttributeList[i].value)\n        }\n      }\n\n      let StyleSet = auxiliaryPeer.style\n      for (let Property in StyleSet) {\n        switch (Property) {\n          case 'display': case 'position':\n          case 'left': case 'width': case 'right': case 'top':\n          case 'height': case 'bottom': break\n          default: if (StyleSet.hasOwnProperty(Property)) {\n            css(Peer,Property,StyleSet[Property])\n          }\n        }\n      }\n    let newApplet = VisualBuiltFromPeer(Peer,'Applet') // actually builds applet\n  }\n\n/**** AppletDeserializedFrom ****/\n\n  export function AppletDeserializedFrom(\n    oldApplet:WAT_Applet, Serialization:string\n  ):WAT_Applet {\n    expectApplet     ('applet',oldApplet)\n    expectText('serialization',Serialization)\n\n    let Peer = oldApplet.Peer\n      deserializeAppletIntoPeer(Serialization, Peer, {\n        compatibleDowngrade:  'perform',\n        incompatibleDowngrade:'perform',\n        sameVersion:          'perform',\n        compatibleUpgrade:    'perform',\n        incompatibleUpgrade:  'perform'\n      })\n    return VisualOfElement(Peer) as WAT_Applet\n  }\n\n//----------------------------------------------------------------------------//\n//                               Import/Export                                //\n//----------------------------------------------------------------------------//\n\n//----------------------------------------------------------------------------//\n//                             Property Handling                              //\n//----------------------------------------------------------------------------//\n\n  const internalPropertyNames:WAT_Identifier[] = `\n    uniqueId Id Name Label Category Master ErrorInfo mayBeDesigned mayBeDeleted\n    Classes isVisible isEnabled Value Script pendingScript pendingScriptError\n    TabIndex PointerSensitivity Overflows TextOverflow Opacity\n    x y Width Height Position Size Geometry GeometryOnDisplay\n    horizontalAnchoring verticalAnchoring horizontalOffsets verticalOffsets\n    minWidth maxWidth minHeight maxHeight\n    FontFamily FoltSize FontWeight FontStyle TextDecoration TextShadow\n    TextAlignment ForegroundColor Color BackgroundColor BackgroundTexture\n    BorderWidths BorderColors BorderStyles BorderRadii BoxShadow\n    Cursor customCursor\n  `.trim().replace(/\\s+/g,' ').split(' ')\n\n  const internalPropertyNameSet = Object.create(null)\n  internalPropertyNames.forEach(\n    (PropertyName) => internalPropertyNameSet[PropertyName] = PropertyName\n  )\n\n/**** expectedProperty ****/\n\n  function expectedProperty (Description:string, Value:any):WAT_Property {\n    expectPlainObject(Description,Value)\n\n    let Identifier = Value.Identifier\n    if (! ValueIsIdentifier(Identifier)) throwError(\n      'InvalidArgument: invalid property name ' + quoted(Identifier)\n    )\n\n    validatePropertyName(Identifier)\n\n    let Label = Value.Label\n    switch (true) {\n      case (Label == null):        Label = Identifier;                 break\n      case ValueIsTextline(Label): Label = Label.trim() || Identifier; break\n      default: throwError(\n        'InvalidArgument: the label of property ' + quoted(Identifier) +\n        ' does not consist of a single line of text'\n      )\n    }\n\n    let EditorType = Value.EditorType\n    switch (true) {\n      case (EditorType == null): throwError(\n        'InvalidArgument: missing editor type for property ' + quoted(Identifier)\n      )\n      case ! ValueIsOneOf(EditorType,WAT_PropertyEditorTypes): throwError(\n        'InvalidArgument: invalid editor type given for property ' + quoted(Identifier)\n      )\n    }\n\n    let Property:WAT_Property = { Identifier, Label, EditorType }\n      let InputPattern\n      switch (EditorType) {\n        case 'checkbox':\n          break;\n        case 'choice':                       // drop-down for boolean properties\n          Property.FalseValue = expectedTextline('label for value \"false\"', Value.FalseValue)\n          Property.TrueValue  = expectedTextline('label for value \"true\"',  Value.TrueValue)\n          break\n        case 'textline-input':\n        case 'password-input':\n        case 'email-address-input':\n        case 'phone-number-input':\n        case 'url-input':\n        case 'search-input':\n          if (Value.minLength != null) {\n            Property.minLength = expectedIntegerInRange('minimal input length', Value.minLength, 0)\n          }\n          if (Value.maxLength != null) {\n            Property.maxLength = expectedIntegerInRange('maximal input length', Value.maxLength, 0)\n          }\n          if ((Value.multiple != null) && (EditorType === 'email-address-input')) {\n            Property.multiple = expectedBoolean('multi-value flag', Value.multiple)\n          }\n          if (Value.Pattern != null) {\n            Property.Pattern = expectedTextline('input pattern', Value.Pattern)\n          }\n          break\n        case 'number-input':\n          if (Value.minValue != null) {\n            Property.minValue = expectedNumber('minimal allowed value', Value.minValue)\n          }\n          if (Value.maxValue != null) {\n            Property.maxValue = expectedNumber('maximal allowed value', Value.maxValue)\n          }\n          if (Value.StepValue != null) {\n            if (Value.StepValue === 'any') {\n              Property.StepValue = 'any'\n            } else {\n              Property.StepValue = expectedNumberInRange('step value', Value.StepValue, 0,Infinity, false)\n            }\n          }\n          break\n        case 'time-input':\n          InputPattern = /^[0-9]{2}:[0-9]{2}$/\n        case 'date-time-input':\n          InputPattern = /^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}$/\n        case 'date-input':\n          InputPattern = InputPattern || /^[0-9]{4}-[0-9]{2}-[0-9]{2}$/\n        case 'month-input':\n          InputPattern = InputPattern || /^[0-9]{4}-[0-9]{2}$/\n        case 'week-input':\n          InputPattern = InputPattern || /^[0-9]{4}-W[0-9]{2}$/\n\n          if (Value.minValue != null) {\n            Property.minValue = expectedStringMatching('minimal allowed value', Value.minValue, InputPattern)\n          }\n          if (Value.maxValue != null) {\n            Property.maxValue = expectedStringMatching('maximal allowed value', Value.maxValue, InputPattern)\n          }\n          if (Value.StepValue != null) {\n            if (Value.StepValue === 'any') {\n              Property.StepValue = 'any'\n            } else {\n              Property.StepValue = expectedIntegerInRange('step value', Value.StepValue, 0)\n            }\n          }\n          break\n        case 'color-input':\n          break\n        case 'drop-down':\n          Property.ValueList = expectedArray('list of allowed values',Value.ValueList)\n            for (let i = 0, l = Property.ValueList.length; i < l; i++) {\n              if (! ValueIsTextline(Property.ValueList[i])) throwError(\n                'InvalidArgument: element #' + (i+1) + ' of the list of ' +\n                'foreseen drop-down values is not a valid line of text'\n              )\n            }\n          break\n        case 'slider':\n          if (Value.minValue != null) {\n            Property.minValue = expectedNumber('minimal allowed value', Value.minValue)\n          }\n          if (Value.maxValue != null) {\n            Property.maxValue = expectedNumber('maximal allowed value', Value.maxValue)\n          }\n          if (Value.StepValue != null) {\n            if (Value.StepValue === 'any') {\n              Property.StepValue = 'any'\n            } else {\n              Property.StepValue = expectedNumberInRange('step value', Value.StepValue, 0,Infinity, false)\n            }\n          }\n          break\n        case 'text-input':\n        case 'html-input':\n        case 'css-input':\n        case 'javascript-input':\n        case 'json-input':\n          if (Value.minLength != null) {\n            Property.minLength = expectedIntegerInRange('minimal input length', Value.minLength, 0)\n          }\n          if (Value.maxLength != null) {\n            Property.maxLength = expectedIntegerInRange('maximal input length', Value.maxLength, 0)\n          }\n      }\n\n    return Property\n  }\n\n/**** defineForbiddenPropertyNames ****/\n\n  function defineForbiddenPropertyNames ():void {\n    function processPrototype (Prototype:any) {\n      for (let PropertyName in Prototype) {\n        if (Prototype.hasOwnProperty(PropertyName)) {\n          forbiddenPropertyNames[PropertyName] = PropertyName\n        }\n      }\n    }\n\n    processPrototype(WAT_Visual.prototype)\n    processPrototype(WAT_Applet.prototype)\n    processPrototype(WAT_Container.prototype)\n    processPrototype(WAT_Layer.prototype)\n    processPrototype(WAT_Card.prototype)\n    processPrototype(WAT_Overlay.prototype)\n    processPrototype(WAT_Compound.prototype)\n    processPrototype(WAT_Control.prototype)\n\n    delete forbiddenPropertyNames['Value']\n  }                                     // n.b. \"Value\" is deliberately allowed!\n\n/**** validatePropertyName ****/\n\n  function validatePropertyName (Identifier:WAT_Identifier):void {\n    if (Identifier in forbiddenPropertyNames) throwError(\n      'InvalidArgument: forbidden property name ' + quoted(Identifier)\n    )\n  }\n\n/**** definePropertyGetterForVisual ****/\n\n  function definePropertyGetterForVisual (\n    Visual:WAT_Visual, Property:WAT_Identifier, Getter:Function\n  ):void {\n    expectIdentifier('property name',Property)\n    allowFunction ('property getter',Getter)\n\n    let Descriptor = PropertyDescriptorFor(Visual,Property)\n    if (Descriptor == null) {\n      Descriptor = {\n        get:Getter, set:function () { throwReadOnlyError(Property) },\n        configurable:true, enumerable:true\n      }\n    } else {\n      if (typeof Descriptor.value === 'function') throwError(\n        'InvalidProperty: method ' + quoted(Property) + ' must not be redefined as a property'\n      )\n\n      if (Descriptor.configurable == false) throwError(\n        'InvalidProperty: property ' + quoted(Property) + ' cannot be redefined'\n      )\n\n      delete Descriptor.value\n      delete Descriptor.writable\n\n      Descriptor.get = Getter\n      Descriptor.set = Descriptor.set || function () { throwReadOnlyError(Property) }\n    }\n\n    Object.defineProperty(Visual,Property,Descriptor)\n  }\n\n/**** definePropertySetterForVisual ****/\n\n  function definePropertySetterForVisual (\n    Visual:WAT_Visual, Property:WAT_Identifier, Setter:Function\n  ):void {\n    expectIdentifier('property name',Property)\n    allowFunction ('property setter',Setter)\n\n    let Descriptor = PropertyDescriptorFor(Visual,Property)\n    if (Descriptor == null) {\n      Descriptor = {\n        get:function () { throwWriteOnlyError(Property) }, set:Setter,\n        configurable:true, enumerable:true\n      }\n    } else {\n      if (typeof Descriptor.value === 'function') throwError(\n        'InvalidProperty: method ' + quoted(Property) + ' must not be redefined as a property'\n      )\n\n      if (Descriptor.configurable == false) throwError(\n        'InvalidProperty: property ' + quoted(Property) + ' cannot be redefined'\n      )\n\n      delete Descriptor.value\n      delete Descriptor.writable\n\n      Descriptor.get = Descriptor.get || function () { throwWriteOnlyError(Property) }\n      Descriptor.set = Setter\n    }\n\n    Object.defineProperty(Visual,Property,Descriptor)\n  }\n\n//----------------------------------------------------------------------------//\n//                             Geometry Handling                              //\n//----------------------------------------------------------------------------//\n\n/**** outerPeerOf ****/\n\n  function outerPeerOf (Peer:HTMLElement):HTMLElement {\n    let Candidate = Peer.parentElement\n    if (Candidate == null) throwError(\n      'ImpossibleOperation: a detached visual can not be right or bottom aligned'\n    )\n    return Candidate\n  }\n\n/**** GeometryOfVisual ****/\n\n  function GeometryOfVisual (Visual:WAT_Visual):WAT_Geometry {\n    let Peer = PeerOfVisual(Visual)\n    return {\n      x:Peer.offsetLeft, Width:Peer.offsetWidth,\n      y:Peer.offsetTop, Height:Peer.offsetHeight\n    }\n  }\n\n/**** GeometryOfVisualOnDisplay ****/\n\n  function GeometryOfVisualOnDisplay (Visual:WAT_Visual):WAT_Geometry {\n    let boundingRect = PeerOfVisual(Visual).getBoundingClientRect()\n    return {\n      x:boundingRect.left, Width:boundingRect.width,\n      y:boundingRect.top, Height:boundingRect.height\n    }\n  }\n\n/**** changeGeometryOfVisualTo ****/\n\n  function changeGeometryOfVisualTo (\n    Visual:WAT_Visual, x?:number, y?:number, Width?:number, Height?:number\n  ):void {\n    const Peer = PeerOfVisual(Visual)\n\n    let StyleChanges:any = {}\n    function changeStyles (additionalChanges:any):void {\n      Object.assign(StyleChanges,additionalChanges)\n    }\n\n  /**** compute horizontal geometry update ****/\n\n    let horizontalAnchoring, oldLeft,oldWidth,oldRight\n    if ((x != null) || (Width != null)) {\n      horizontalAnchoring = horizontalAnchoringOfVisual(Visual)\n      oldLeft  = Math.round(Peer.offsetLeft)\n      oldWidth = Math.round(Peer.offsetWidth)\n    }\n\n    if (x != null) {\n      oldRight = (horizontalAnchoring === 'left-width' ? NaN : outerPeerOf(Peer).offsetWidth-(oldLeft as number)-(oldWidth as number))\n\n      x = Math.round(x)\n      let dx = x-(oldLeft as number)\n\n      switch (horizontalAnchoring) {\n        case 'left-width':  changeStyles({ left:x+'px'                           }); break\n        case 'width-right': changeStyles({              right:(oldRight-dx)+'px' }); break\n        case 'left-right':  changeStyles({ left:x+'px', right:(oldRight-dx)+'px' }); break\n      }\n    }\n\n    if (Width != null) {\n      Width = Math.round(Width)\n      if (horizontalAnchoring === 'left-right') {\n        oldRight = (StyleChanges.right != null ? parseFloat(StyleChanges.right) : outerPeerOf(Peer).offsetWidth-(oldLeft as number)-(oldWidth as number))\n        changeStyles({ right:(oldRight - (Width-(oldWidth as number)))+'px' })\n      } else {\n        changeStyles({ width:Width+'px' })\n      }\n    }\n\n  /**** compute vertical geometry update ****/\n\n    let verticalAnchoring, oldTop,oldHeight,oldBottom\n    if ((y != null) || (Height != null)) {\n      verticalAnchoring = verticalAnchoringOfVisual(Visual)\n      oldTop    = Math.round(Peer.offsetTop)\n      oldHeight = Math.round(Peer.offsetHeight)\n    }\n\n    if (y != null) {\n      oldBottom = (verticalAnchoring === 'top-height' ? NaN : outerPeerOf(Peer).offsetHeight-(oldTop as number)-(oldHeight as number))\n\n      y = Math.round(y)\n      let dy = y-(oldTop as number)\n\n      switch (verticalAnchoring) {\n        case 'top-height':    changeStyles({ top:y+'px'                             }); break\n        case 'height-bottom': changeStyles({             bottom:(oldBottom-dy)+'px' }); break\n        case 'top-bottom':    changeStyles({ top:y+'px', bottom:(oldBottom-dy)+'px' }); break\n      }\n    }\n\n    if (Height != null) {\n      Height = Math.round(Height)\n      if (verticalAnchoring === 'top-bottom') {\n        oldBottom = (StyleChanges.bottom != null ? parseFloat(StyleChanges.bottom) : outerPeerOf(Peer).offsetHeight-(oldTop as number)-(oldHeight as number))\n        changeStyles({ bottom:(oldBottom - (Height-(oldHeight as number)))+'px' })\n      } else {\n        changeStyles({ height:Height+'px' })\n      }\n    }\n\n  /**** now actually update the visual ****/\n\n    if (! ObjectIsEmpty(StyleChanges)) {\n      applyStylesToVisual(Visual, StyleChanges)\n    }\n  }\n\n/**** horizontalAnchoringOfVisual ****/\n\n  function horizontalAnchoringOfVisual (Visual:WAT_Visual):WAT_horizontalAnchoring {\n    let Peer = PeerOfVisual(Visual)\n\n    let left  = Peer.style.left  || 'auto'\n    let right = Peer.style.right || 'auto'\n    let Width = Peer.style.width || 'auto'\n\n    if (right === 'auto') { return 'left-width' }\n    if (Width === 'auto') { return 'left-right' }\n    if (left  === 'auto') { return 'width-right' }            // check this last\n\n    console.error(\n      'could not determine horizontal anchors of given Visual\\n' +\n      'got left:' + left + ', right:' + right + ', width:' + Width\n    )\n\n    return 'left-width'\n  }\n\n/**** horizontalOffsetsOfVisual ****/\n\n  function horizontalOffsetsOfVisual (Visual:WAT_Visual):WAT_horizontalOffsets {\n    let Peer = PeerOfVisual(Visual)\n\n    let left  = Math.round(Peer.offsetLeft)\n    let width = Math.round(Peer.offsetWidth)\n//  let right = Math.round(outerPeerOf(Peer).offsetWidth-left-width)\n\n    switch (horizontalAnchoringOfVisual(Visual)) {\n      case 'left-width':  return [left,width]\n      case 'width-right': return [width,Math.round(outerPeerOf(Peer).offsetWidth-left-width)]\n      case 'left-right':  return [left, Math.round(outerPeerOf(Peer).offsetWidth-left-width)]\n      default:            return [left,width]\n    }\n  }\n\n/**** changeHorizontalAnchoringOfVisualTo ****/\n\n  function changeHorizontalAnchoringOfVisualTo (\n    Visual:WAT_Visual, newAnchoring:WAT_horizontalAnchoring\n  ):void {\n    let oldAnchoring = horizontalAnchoringOfVisual(Visual)\n    if (oldAnchoring === newAnchoring) { return }\n\n    let Peer = PeerOfVisual(Visual)\n\n    let left  = Math.round(Peer.offsetLeft)\n    let Width = Math.round(Peer.offsetWidth)\n    let right = Math.round(outerPeerOf(Peer).offsetWidth-left-Width)\n\n    let StyleSet\n      switch (newAnchoring) {\n        case 'left-width':  StyleSet = { left:left+'px', width:Width+'px', right:'auto' };     break\n        case 'width-right': StyleSet = { left:'auto',    width:Width+'px', right:right+'px' }; break\n        case 'left-right':  StyleSet = { left:left+'px', width:'auto',     right:right+'px' }; break\n        default: throwError('InternalError: unforeseen horizontal anchoring')\n      }\n    applyStylesToVisual(Visual,StyleSet)\n  }\n\n/**** changeHorizontalOffsetsOfVisualTo ****/\n\n  function changeHorizontalOffsetsOfVisualTo (\n    Visual:WAT_Visual, offsets:WAT_horizontalOffsets\n  ):void {\n    let Peer = PeerOfVisual(Visual)\n\n    switch (horizontalAnchoringOfVisual(Visual)) {\n      case 'left-width':\n        if (offsets[0] != null) { applyStyleToVisual(Visual, 'left', Math.round(offsets[0])+'px') }\n        if (offsets[1] != null) { applyStyleToVisual(Visual, 'width',Math.round(offsets[1])+'px') }\n        break\n      case 'width-right':\n        if (offsets[0] != null) { applyStyleToVisual(Visual, 'width',Math.round(offsets[0])+'px') }\n        if (offsets[1] != null) { applyStyleToVisual(Visual, 'right',Math.round(offsets[1])+'px') }\n        break\n      case 'left-right':\n        if (offsets[0] != null) { applyStyleToVisual(Visual, 'left', Math.round(offsets[0])+'px') }\n        if (offsets[1] != null) { applyStyleToVisual(Visual, 'right',Math.round(offsets[1])+'px') }\n    }\n  }\n\n/**** verticalAnchoringOfVisual ****/\n\n  function verticalAnchoringOfVisual (Visual:WAT_Visual):WAT_verticalAnchoring {\n    let Peer = PeerOfVisual(Visual)\n\n    let top    = Peer.style.top    || 'auto'\n    let bottom = Peer.style.bottom || 'auto'\n    let Height = Peer.style.height || 'auto'\n\n    if (bottom === 'auto') { return 'top-height' }\n    if (Height === 'auto') { return 'top-bottom' }\n    if (top    === 'auto') { return 'height-bottom' }         // check this last\n\n    console.error(\n      'could not determine vertical anchors of given Visual\\n' +\n      'got top:' + top + ', bottom:' + bottom + ', height:' + Height\n    )\n\n    return 'top-height'\n  }\n\n/**** verticalOffsetsOfVisual ****/\n\n  function verticalOffsetsOfVisual (Visual:WAT_Visual):WAT_verticalOffsets {\n    let Peer = PeerOfVisual(Visual)\n\n    let top    = Math.round(Peer.offsetTop)\n    let height = Math.round(Peer.offsetHeight)\n//  let bottom = Math.round(outerPeer().offsetHeight-top-height)\n\n    switch (verticalAnchoringOfVisual(Visual)) {\n      case 'top-height':    return [top,height]\n      case 'height-bottom': return [height,Math.round(outerPeerOf(Peer).offsetHeight-top-height)]\n      case 'top-bottom':    return [top,   Math.round(outerPeerOf(Peer).offsetHeight-top-height)]\n      default:              return [top,height]\n    }\n  }\n\n/**** changeVerticalAnchoringOfVisualTo ****/\n\n  function changeVerticalAnchoringOfVisualTo (\n    Visual:WAT_Visual, newAnchoring:WAT_verticalAnchoring\n  ):void {\n    let oldAnchoring = verticalAnchoringOfVisual(Visual)\n    if (oldAnchoring === newAnchoring) { return }\n\n    let Peer = PeerOfVisual(Visual)\n\n    let top    = Math.round(Peer.offsetTop)\n    let Height = Math.round(Peer.offsetHeight)\n    let bottom = Math.round(outerPeerOf(Peer).offsetHeight-top-Height)\n\n    let StyleSet\n      switch (newAnchoring) {\n        case 'top-height':    StyleSet = { top:top+'px', height:Height+'px', bottom:'auto' }; break\n        case 'height-bottom': StyleSet = { top:'auto',   height:Height+'px', bottom:bottom+'px' }; break\n        case 'top-bottom':    StyleSet = { top:top+'px', height:'auto',      bottom:bottom+'px' }; break\n        default: throwError('InternalError: unforeseen vertical anchoring')\n      }\n    applyStylesToVisual(Visual,StyleSet)\n  }\n\n/**** changeVerticalOffsetsOfVisualTo ****/\n\n  function changeVerticalOffsetsOfVisualTo (\n    Visual:WAT_Visual, offsets:WAT_verticalOffsets\n  ):void {\n    switch (verticalAnchoringOfVisual(Visual)) {\n      case 'top-height':\n        if (offsets[0] != null) { applyStyleToVisual(Visual, 'top',   Math.round(offsets[0])+'px') }\n        if (offsets[1] != null) { applyStyleToVisual(Visual, 'height',Math.round(offsets[1])+'px') }\n        break\n      case 'height-bottom':\n        if (offsets[0] != null) { applyStyleToVisual(Visual, 'height',Math.round(offsets[0])+'px') }\n        if (offsets[1] != null) { applyStyleToVisual(Visual, 'bottom',Math.round(offsets[1])+'px') }\n        break\n      case 'top-bottom':\n        if (offsets[0] != null) { applyStyleToVisual(Visual, 'top',   Math.round(offsets[0])+'px') }\n        if (offsets[1] != null) { applyStyleToVisual(Visual, 'bottom',Math.round(offsets[1])+'px') }\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                             Master Management                              //\n//----------------------------------------------------------------------------//\n\n  type WAT_StyleSet    = { [Key:string]:(string | undefined) }\n  type WAT_PropertySet = { [Key:string]:string }\n\n  type WAT_MasterInfo = {\n    Name:WAT_Name, Version?:WAT_normalizedVersion, Category:WAT_Category,\n    Resources?:WAT_Text,  pendingResources?:WAT_Text,\n    Template:WAT_Text,    pendingTemplate?:WAT_Text,\n    Classes?:WAT_Name[],  pendingClasses?:WAT_Name[],\n    Styles?:WAT_StyleSet, pendingStyles?:WAT_StyleSet,\n    Script?:WAT_Text,     pendingScript?:WAT_Text,\n    Properties?:WAT_Property[], undesignablePropertySet?:WAT_PropertySet,\n    ErrorInfo?:WAT_ErrorInfo, compiledScript?:Function, UsageCount:number\n  }\n\n  const WAT_VersionHandlings = [ 'perform','ignore','abort' ]\n  type  WAT_VersionHandling  = typeof WAT_VersionHandlings[number]\n\n  type WAT_CollisionHandling = {\n    compatibleDowngrade:WAT_VersionHandling,\n    incompatibleDowngrade:WAT_VersionHandling,\n    sameVersion:WAT_VersionHandling,\n    compatibleUpgrade:WAT_VersionHandling,\n    incompatibleUpgrade:WAT_VersionHandling\n  }\n\n  type WAT_MasterRegistry = { [Name:string]:WAT_MasterInfo }\n\n  const MasterRegistry:WAT_MasterRegistry = Object.create(null)\n\n/**** MasterInfoFromElement (script[type=\"application/wat-master\"]) ****/\n\n  function MasterInfoFromElement (Element:HTMLElement):WAT_MasterInfo {\n    let MasterObject = JSON.parse(html(Element))\n    return parsedMaster(MasterObject)\n  }\n\n/**** parsedMaster - fundamental errors prevent a master from being imported ****/\n\n  function parsedMaster (MasterObject:any):WAT_MasterInfo {\n    expectPlainObject('master specification',MasterObject)\n\n    let Name = expectedName('master name',MasterObject.Name)\n    if (Name.startsWith('#')) {\n      throwError('InvalidImport: the name of a master must not be global')\n    }\n\n    let Version  = normalized(parsedVersion(allowedSemVer('master version',MasterObject.Version) || '0.0.1'))\n    let Category = expectedOneOf('master category',MasterObject.Category, WAT_Categories)\n\n    let Resources = allowedText('master resources',MasterObject.Resources)\n      if ((Resources != null) && (Resources.trim() === '')) { Resources = null }\n    let pendingResources = allowedText('pending master resources',MasterObject.pendingResources)\n      if ((pendingResources != null) && (pendingResources.trim() === '')) { pendingResources = null }\n\n    let Template = allowedText('master template',MasterObject.Template)\n      if ((Template != null) && (Template.trim() === '')) {\n        Template = '<div class=\"WAT ' + Name + '\"></div>'\n      }\n    let pendingTemplate = allowedText('pending master template',MasterObject.pendingTemplate)\n      if ((pendingTemplate != null) && (pendingTemplate.trim() === '')) { pendingTemplate = null }\n\n    let Classes        = parsedClasses(MasterObject.Classes)\n    let pendingClasses = allowedTextline('pending master classes',MasterObject.pendingClasses)\n\n    let Styles        = parsedStyles(MasterObject.Styles)\n    let pendingStyles = allowedText('pending master CSS styles',MasterObject.pendingStyles)\n\n    let Script        = allowedText        ('master script',MasterObject.Script)\n    let pendingScript = allowedText('pending master script',MasterObject.pendingScript)\n\n    let Properties = parsedProperties(MasterObject.Properties)\n    let undesignablePropertySet = parsedUndesignableProperties(MasterObject.undesignableProperties)\n\n    let plainMaster = 'plain' + Category\n    if (Name !== plainMaster) {  // protect certain properties based on category\n      for (let PropertyName in MasterRegistry[plainMaster].undesignablePropertySet) {\n        undesignablePropertySet[PropertyName] = PropertyName\n      }\n    }\n\n    return {\n      Name, Version, Category,\n      Resources, pendingResources, Template, pendingTemplate,\n      Classes, pendingClasses, Styles, pendingStyles, Script, pendingScript,\n      Properties, undesignablePropertySet,\n      ErrorInfo:undefined, compiledScript:undefined, UsageCount:0\n    }\n  }\n\n  export const WAT_PropertyEditorTypes = [\n    'checkbox', 'choice',\n    'textline-input', 'password-input', 'number-input', 'search-input',\n    'phone-number-input', 'email-address-input', 'url-input',\n    'time-input', 'date-time-input', 'date-input', 'month-input', 'week-input',\n    'color-input', 'drop-down', 'slider',\n    'text-input', 'html-input', 'css-input', 'javascript-input', 'json-input'\n  ]\n  export type WAT_PropertyEditorType = typeof WAT_PropertyEditorTypes[number]\n\n  export type WAT_Property = {\n    Identifier:WAT_Identifier, Label:WAT_Textline,\n    EditorType:WAT_PropertyEditorType\n  } & {                              // plus additional editor-specific elements\n    FalseValue?:string, TrueValue?:string,\n    minLength?:number, maxLength?:number,\n    multiple?:boolean, Pattern?:string,\n    minValue?:any, maxValue?:any, StepValue?:'any'|number,\n    ValueList?:any[]\n  }\n\n  const forbiddenPropertyNames = Object.create(null)     // will be filled later\n\n/**** parsedProperties ****/\n\n  function parsedProperties (Value:any):WAT_Property[] {\n    allowArray('list of custom properties',Value)\n    if ((Value == null) || (Value.length === 0)) { return [] }\n\n    let PropertyList:WAT_Property[] = []\n      let parsedPropertySet = Object.create(null)\n\n      Value.forEach((Specification:any) => {\n        let Property = expectedProperty('property specification',Specification)\n        PropertyList.push(parsedPropertySet[Property.Identifier] = Property)\n      })\n    return PropertyList\n  }\n\n/**** parsedUndesignableProperties ****/\n\n  function parsedUndesignableProperties (\n    undesignableProperties:string\n  ):WAT_PropertySet {\n    allowText('list of undesignable properties',undesignableProperties)\n\n    let Result:WAT_PropertySet = Object.create(null)\n    if (undesignableProperties == null) { return Result }\n      undesignableProperties.trim().replace(/\\s+/g,' ').split(' ').forEach(\n        (PropertyName) => {\n          allowIdentifier('name of an undesignable property',PropertyName)\n          Result[PropertyName] = PropertyName                 // no further test\n        }\n      )\n    return Result\n  }\n\n/**** parsedClasses ****/\n\n  function parsedClasses (Value:any):WAT_Name[] {\n    allowText('master class presets',Value)\n    if (Value == null) { return [] }\n\n    let ClassNames = Value.trim().replace(/\\s+/g,' ').split(' ')\n      if (ClassNames.length === 0) { return [] }\n\n      ClassNames.forEach((Value:any) => {\n        if (! ValueIsName(Value)) throwError(\n          'InvalidSpecification: master specification contains invalid ' +\n          'class name ' + quoted(Value)\n        )\n      })\n    return ClassNames\n  }\n\n/**** parsedStyles ****/\n\n  function parsedStyles (Value:any):WAT_StyleSet | undefined {\n    allowText('master style presets',Value)\n    if (Value == null) { return undefined }\n\n    Value = Value.trim()\n    if (Value === '') { return undefined }\n\n// see https://stackoverflow.com/questions/3326494/parsing-css-in-javascript-jquery\n\n    let StyleElement = document.createElement('style')\n    StyleElement.textContent = '#' + Math.round(Math.random()*9999) + ' {' + Value + '}'\n\n    let auxDocument = document.implementation.createHTMLDocument('')\n    auxDocument.body.appendChild(StyleElement)\n\n    let StyleSet = (StyleElement.sheet?.cssRules[0] as CSSStyleRule).style\n    let StylePresets = Object.create(null)\n      for (let i = 0, l = StyleSet.length; i < l; i++) {\n        let PropertyName  = StyleSet[i]\n        let PropertyValue = StyleSet.getPropertyValue(PropertyName)\n        StylePresets[PropertyName] = PropertyValue\n      }\n    return StylePresets\n  }\n\n/**** MasterMayBeRegistered ****/\n\n  function MasterMayBeRegistered (\n    MasterInfo:WAT_MasterInfo, CollisionHandling:WAT_CollisionHandling\n  ):boolean {\n    let Master = MasterInfo.Name\n    if (MasterIsIntrinsic(Master)) throwError(\n      'ForbiddenRegistration: intrinsic master ' + quoted(Master) + ' must ' +\n      'not be replaced'\n    )\n\n    if (Master in MasterRegistry) {\n      let Relationship = RelationshipAreplacingB(\n        MasterInfo.Version as WAT_normalizedVersion,\n        MasterRegistry[Master].Version as WAT_normalizedVersion\n      )\n\n// @ts-ignore we definitely want to index \"CollisionHandling\" with a string\n      switch (CollisionHandling[Relationship]) {\n        case 'perform': return true\n        case 'ignore':  return false\n        case 'abort': switch (Relationship) {\n          case 'compatibleDowngrade': throwError(\n            'ForbiddenImport: this import would result in a downgrade of ' +\n            'master ' + quoted(Master)\n          )\n          case 'incompatibleDowngrade': throwError(\n            'ForbiddenImport: this import would result in an incompatible ' +\n            'downgrade of master ' + quoted(Master)\n          )\n          case 'sameVersion': throwError(\n            'ForbiddenImport: this import would overwrite master ' + quoted(Master)\n          )\n          case 'compatibleUpgrade': throwError(\n            'ForbiddenImport: this import would result in an upgrade of ' +\n            'master ' + quoted(Master)\n          )\n          case 'incompatibleUpgrade': throwError(\n            'ForbiddenImport: this import would result in an incompatible ' +\n            'upgrade of master ' + quoted(Master)\n          )\n        }\n      }\n      return false\n    } else {\n      return true\n    }\n  }\n\n/**** MasterIsIntrinsic ****/\n\n  const intrinsicMasterSet = Object.create(null)\n  'Applet Card Overlay Compound Control'.split(' ').forEach(\n    (Category) => intrinsicMasterSet['plain'+Category] = true\n  )\n\n  function MasterIsIntrinsic (Master:WAT_Name):boolean {\n    return (intrinsicMasterSet[Master] != null)\n  }\n\n/**** registerMastersInDocument ****/\n\n  function registerMastersInDocument ():void {\n    let ErrorOccurred = false\n      forEach(\n        document.head.querySelectorAll('script[type=\"application/wat-master\"]'),\n        (ScriptElement) => {\n        try {\n          let MasterInfo = MasterInfoFromElement(ScriptElement)\n          if (MasterMayBeRegistered(MasterInfo, {            // n.b.: may throw!\n            compatibleDowngrade:  'ignore',\n            incompatibleDowngrade:'abort',\n            sameVersion:          'ignore',\n            compatibleUpgrade:    'perform',\n            incompatibleUpgrade:  'perform'\n          })) {\n            registerMaster(MasterInfo)\n          }\n        } catch (Signal) {\n          ErrorOccurred = true\n          console.warn('Error in Master Registration:',Signal)\n        }\n      })\n    if (ErrorOccurred) window.alert(\n      'The WAT masters bundled with this document could not be\\n' +\n      'registered without errors - see browser console for details'\n    )\n  }\n\n/**** registerMasterFromSerialization ****/\n\n  export function registerMasterFromSerialization (Serialization:string):void {\n    expectText('serialization',Serialization)\n\n    let MasterObject = JSON.parse(Serialization)\n    let MasterInfo   = parsedMaster(MasterObject)\n    registerMaster(MasterInfo)\n  }\n\n/**** registerMaster ****/\n\n  function registerMaster (MasterInfo:WAT_MasterInfo):void {\n    if (MasterIsIntrinsic(MasterInfo.Name)) throwError(\n      'ForbiddenOperation: an intrinsic master must not be (re-)registered'\n    )\n\n    MasterInfo.ErrorInfo = undefined\n      if (MasterInfo.Resources != null) {\n        registerResources(MasterInfo.Resources)\n      }\n\n      if (MasterInfo.Script != null) {\n        compileScriptIntoMaster(MasterInfo.Script,MasterInfo)\n      }\n    MasterInfo.UsageCount = 0\n\n    let Name = MasterInfo.Name\n    MasterRegistry[Name] = MasterInfo\n    if (WAT_isRunning) { refreshInstancesOfMaster(Name) }\n  }\n\n/**** unregisterMaster ****/\n\n  export function unregisterMaster (Name:WAT_Name):void {\n    if (MasterIsIntrinsic(Name)) throwError(\n      'ForbiddenOperation: an intrinsic master must not be unregistered'\n    )\n\n    if (Name in MasterRegistry) {\n      let MasterInfo = MasterRegistry[Name]\n      if (MasterInfo.Resources != null) {\n        unregisterResources(MasterRegistry[Name].Resources)\n      }\n\n      releaseMaster(Name)\n\n      delete MasterRegistry[Name]\n      if (WAT_isRunning) { refreshInstancesOfMaster(Name) }\n    }\n  }\n\n/**** compileScriptIntoMaster ****/\n\n  function compileScriptIntoMaster (\n    Script:WAT_Text | undefined, MasterInfo:WAT_MasterInfo\n  ):void {\n    delete MasterInfo.compiledScript\n\n    if (Script != null) {\n      try {\n        MasterInfo.compiledScript = new Function(\n          'toGet','toSet','on','off','trigger','$', Script\n        )\n      } catch (Signal) {\n        MasterInfo.ErrorInfo = {\n          Title:       'Compilation Error',\n          longMessage: 'Script of Master ' + quoted(MasterInfo.Name) + ' could not be compiled',\n          shortMessage:Signal.message,\n          Reason:      Signal,\n          Applet:      firstAppletInDocument(),\n          Sufferer:    MasterInfo.Name,\n          Property:    'Script'\n        }\n      }\n    }\n  }\n\n/**** releaseMaster ****/\n\n  function releaseMaster (Master:WAT_Name):void {\n    let MasterInfo = MasterRegistry[Master]\n    if (MasterInfo == null) { return }\n\n    off(document.body, 'mousedown mousemove mouseup','.' + Master)\n    off(document.body, 'mouseenter mouseleave','.' + Master)\n    off(document.body, 'keydown keypress keyup','.' + Master)\n    off(document.body, 'input change click','.' + Master)\n\n    let Resources = MasterInfo.Resources\n    if (Resources != null) { unregisterResources(Resources) }\n  }\n\n/**** refreshInstancesOfMaster ****/\n\n  function refreshInstancesOfMaster (Name:WAT_Name):void {\n    if (WAT_isRunning) {\n      forEach(\n        document.body.querySelectorAll('.WAT[data-wat-master=\"' + Name + '\"]'),\n        (Peer) => refreshVisual(VisualOfElement(Peer as HTMLElement))\n      )\n    }\n  }\n\n/**** useMaster ****/\n\n  function useMaster (Name:WAT_Name, Category:WAT_Category):void {\n    let MasterInfo = MasterRegistry[Name]\n    switch (true) {\n      case (MasterInfo == null): throwError(\n        'NoSuchMaster: a master with the name ' + quoted(Name) + ' does not exist'\n      )\n      case (MasterInfo.Category !== Category): throwError(\n        'UnsuitableMaster: master ' + quoted(Name) + ' is not for ' + Category\n      )\n    }\n\n    MasterInfo.UsageCount += 1\n  }\n\n/**** unuseMaster ****/\n\n  function unuseMaster (Name:WAT_Name):void {\n    let MasterInfo = MasterRegistry[Name]\n    if (MasterInfo != null) {\n      MasterInfo.UsageCount -= 1\n    }\n  }\n\n/**** hasMaster ****/\n\n  export function hasMaster (Name:WAT_Name):boolean {\n    expectName('master name',Name)\n    return (MasterRegistry[Name] != null)\n  }\n\n/**** lacksMaster ****/\n\n  export function lacksMaster (Name:WAT_Name):boolean {\n    expectName('master name',Name)\n    return (MasterRegistry[Name] == null)\n  }\n\n/**** existingInfoForMaster ****/\n\n  function existingInfoForMaster (Name:WAT_Name):WAT_MasterInfo {\n    expectName('master name',Name)\n\n    let MasterInfo = MasterRegistry[Name]\n    if (MasterInfo == null) throwError(\n      'NoSuchMaster: a master with the name ' + quoted(Name) + ' does not exist'\n    )\n\n    return MasterInfo\n  }\n\n/**** createMaster ****/\n\n  export function createMaster (\n    Name:WAT_Name, Category:WAT_Category, Version?:WAT_SemVer,\n    Template?:WAT_Text\n  ):void {\n    expectName     ('master name',Name)\n    expectOneOf('master category',Category, WAT_Categories)\n    allowSemVer ('master version',Version)\n    allowText  ('master template',Template)\n\n    if (Name in MasterRegistry) throwError(\n      'MasterExists: a master with the name ' + quoted(Name) + ' exists already'\n    )\n\n    let MasterInfo:WAT_MasterInfo = {\n      Name, Category, Version:normalized(parsedVersion(Version || '0.0.1')),\n      Template:Template || '<div class=\"WAT ' + Name + '\"></div>',\n      UsageCount:0\n    }\n\n    registerMaster(MasterInfo)\n  }\n\n/**** DuplicateOfMaster ****/\n\n  export function DuplicateOfMaster (\n    oldName:WAT_Name, newName:WAT_Name, newVersion?:WAT_normalizedVersion\n  ):WAT_MasterInfo {\n//  expectName    ('old master name',oldName) // done by \"existingInfoForMaster\"\n    expectName    ('new master name',newName)\n    allowSemVer('new master version',newVersion)\n\n    if (newName in MasterRegistry) throwError(\n      'MasterExists: a master with the name ' + quoted(newName) + ' exists already'\n    )\n\n    let oldMasterInfo = existingInfoForMaster(oldName)\n    let newMasterInfo = Object.assign({},oldMasterInfo)\n      newMasterInfo.Name = newName\n      if (newVersion != null) { newMasterInfo.Version = newVersion }\n\n      if (oldMasterInfo.Properties != null) {            // detach from original\n        newMasterInfo.Properties = []\n        oldMasterInfo.Properties.forEach(\n          (Property) => (newMasterInfo.Properties as WAT_Property[]).push(Object.assign({},Property))\n        )\n      }\n    registerMaster(newMasterInfo)\n    return newMasterInfo\n  }\n\n/**** renameMaster ****/\n\n  export function renameMaster (\n    oldName:WAT_Name, newName:WAT_Name, updateInstances:boolean = true\n  ):void {\n//  expectName                 ('old master name',oldName)       // t.b.d. below\n    expectName                 ('new master name',newName)\n    allowBoolean('master instance update setting',updateInstances)\n\n    let oldMasterInfo = existingInfoForMaster(oldName)\n    if (oldName === newName) { return }\n\n    let newMasterInfo = MasterRegistry[newName]\n    if (newMasterInfo != null) throwError(\n      'MasterExists: a master with the name ' + quoted(newName) + ' exists already'\n    )\n\n    delete MasterRegistry[oldName]\n      oldMasterInfo.Name = newName\n      ;(oldMasterInfo.Version as WAT_Version).Build = currentTimestamp()\n    MasterRegistry[newName] = oldMasterInfo\n\n    if (updateInstances) {\n      forEach(\n        document.body.querySelectorAll('.WAT[data-wat-master=\"' + oldName + '\"]'),\n        (Peer) => { data(Peer as HTMLElement,'wat-master',newName) }\n      )\n\n      if (WAT_isRunning) {\n        refreshInstancesOfMaster(newName)\n      }\n    } else {\n      if (WAT_isRunning) {\n        refreshInstancesOfMaster(oldName)\n        refreshInstancesOfMaster(newName)\n      }\n    }\n  }\n\n/**** [set]NameOfMaster ****/\n\n  export function NameOfMaster (Name:WAT_Name):WAT_Name {\n    let MasterInfo = existingInfoForMaster(Name)\n    return Name\n  }\n\n  export function setNameOfMaster (oldName:WAT_Name, newName:WAT_Name):void {\n    renameMaster(oldName,newName, true)\n  }\n\n/**** CategoryOfMaster ****/\n\n  export function CategoryOfMaster (Name:WAT_Name):WAT_Category {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.Category\n  }\n\n/**** [set]VersionOfMaster ****/\n\n  export function VersionOfMaster (Name:WAT_Name):WAT_SemVer {\n    let MasterInfo = existingInfoForMaster(Name) as WAT_MasterInfo\n    return serializedVersion(MasterInfo.Version as WAT_Version)\n  }\n\n  export function setVersionOfMaster (Name:WAT_Name, newSemVer:WAT_SemVer):void {\n    let MasterInfo = existingInfoForMaster(Name) as WAT_MasterInfo\n    let newVersion = normalized(parsedVersion(newSemVer))\n      if (VersionAgtB((MasterInfo.Version as WAT_Version),newVersion)) throwError(\n        'InvalidArgument: the new version of a master must be greater than ' +\n        'the existing one'\n      )\n    MasterInfo.Version       = newVersion\n    MasterInfo.Version.Build = currentTimestamp()\n  }\n\n/**** ResourcesOfMaster ****/\n\n  export function ResourcesOfMaster (Name:WAT_Name):WAT_Text | undefined {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.Resources\n  }\n\n/**** [set]PendingResourcesOfMaster ****/\n\n  export function pendingResourcesOfMaster (Name:WAT_Name):WAT_Text | undefined {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.pendingResources\n  }\n\n  export function setPendingResourcesOfMaster (\n    Name:WAT_Name, newResources?:WAT_Text\n  ):void {\n//  expectName        ('master name',Name)  // t.b.d. by \"existingInfoForMaster\"\n    allowText('new master resources',newResources)\n\n    let MasterInfo = existingInfoForMaster(Name)\n    if ((newResources == null) || (newResources.trim() === '')) {\n      delete MasterInfo.pendingResources\n    } else {\n      MasterInfo.pendingResources = newResources\n    }\n  }\n\n/**** activatePendingResourcesOfMaster ****/\n\n  export function activatePendingResourcesOfMaster (Name:WAT_Name):void {\n    let MasterInfo = existingInfoForMaster(Name)\n\n    unregisterMaster(Name)       // because resources could contain side effects\n      MasterInfo.Resources     = MasterInfo.pendingResources\n      delete MasterInfo.pendingResources\n      ;(MasterInfo.Version as WAT_Version).Build = currentTimestamp()\n    registerMaster(MasterInfo)\n  }\n\n/**** TemplateOfMaster ****/\n\n  export function TemplateOfMaster (Name:WAT_Name):WAT_Text | undefined {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.Template\n  }\n\n/**** [set]PendingTemplateOfMaster ****/\n\n  export function pendingTemplateOfMaster (Name:WAT_Name):WAT_Text | undefined {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.pendingTemplate\n  }\n\n  export function setPendingTemplateOfMaster (\n    Name:WAT_Name, newTemplate?:WAT_Text\n  ):void {\n//  expectName       ('master name',Name)   // t.b.d. by \"existingInfoForMaster\"\n    allowText('new master template',newTemplate)\n\n    let MasterInfo = existingInfoForMaster(Name)\n    if ((newTemplate == null) || (newTemplate.trim() === '')) {\n      delete MasterInfo.pendingTemplate\n    } else {\n      MasterInfo.pendingTemplate = newTemplate\n    }\n  }\n\n/**** activatePendingTemplateOfMaster ****/\n\n  export function activatePendingTemplateOfMaster (Name:WAT_Name):void {\n    let MasterInfo = existingInfoForMaster(Name)\n      if (MasterInfo.pendingTemplate == null) {\n        MasterInfo.Template = '<div class=\"WAT ' + Name + '\"></div>'\n      } else {\n        MasterInfo.Template = MasterInfo.pendingTemplate\n        delete MasterInfo.pendingTemplate\n      }\n    ;(MasterInfo.Version as WAT_Version).Build = currentTimestamp()\n  }\n\n/**** ClassesOfMaster ****/\n\n  export function ClassesOfMaster (Name:WAT_Name):WAT_Text {\n    let MasterInfo = existingInfoForMaster(Name)\n    return serializedClasses(MasterInfo.Classes)\n  }\n\n/**** [set]PendingClassesOfMaster ****/\n\n  export function pendingClassesOfMaster (Name:WAT_Name):WAT_Text {\n    let MasterInfo = existingInfoForMaster(Name)\n    return serializedClasses(MasterInfo.pendingClasses)\n  }\n\n  export function setPendingClassesOfMaster (\n    Name:WAT_Name, newClasses?:WAT_Text\n  ):void {\n//  expectName      ('master name',Name)    // t.b.d. by \"existingInfoForMaster\"\n    allowText('new master classes',newClasses)\n\n    let MasterInfo = existingInfoForMaster(Name)\n    if ((newClasses == null) || (newClasses.trim() === '')) {\n      delete MasterInfo.pendingClasses\n    } else {\n      MasterInfo.pendingClasses = parsedClasses(newClasses)\n    }\n  }\n\n/**** activatePendingClassesOfMaster ****/\n\n  export function activatePendingClassesOfMaster (Name:WAT_Name):void {\n    let MasterInfo = existingInfoForMaster(Name)\n      MasterInfo.Classes = MasterInfo.pendingClasses\n      delete MasterInfo.pendingClasses\n      ;(MasterInfo.Version as WAT_Version).Build = currentTimestamp()\n    refreshInstancesOfMaster(Name)\n  }\n\n/**** serializedClasses ****/\n\n  function serializedClasses (ClassNames:WAT_Name[] | undefined):WAT_Text {\n    return (ClassNames == null ? '' : ClassNames.join(' '))\n  }\n\n/**** StylesOfMaster ****/\n\n  export function StylesOfMaster (Name:WAT_Name):WAT_Text {\n    let MasterInfo = existingInfoForMaster(Name)\n    return serializedStyles(MasterInfo.Styles)\n  }\n\n/**** [set]PendingStylesOfMaster ****/\n\n  export function pendingStylesOfMaster (Name:WAT_Name):WAT_Text {\n    let MasterInfo = existingInfoForMaster(Name)\n    return serializedStyles(MasterInfo.pendingStyles)\n  }\n\n  export function setPendingStylesOfMaster (\n    Name:WAT_Name, newStyles?:WAT_Text\n  ):void {\n//  expectName     ('master name',Name)     // t.b.d. by \"existingInfoForMaster\"\n    allowText('new master styles',newStyles)\n\n    let MasterInfo = existingInfoForMaster(Name)\n    if ((newStyles == null) || (newStyles.trim() === '')) {\n      delete MasterInfo.pendingStyles\n    } else {\n      MasterInfo.pendingStyles = parsedStyles(newStyles)\n    }\n  }\n\n/**** activatePendingStylesOfMaster ****/\n\n  export function activatePendingStylesOfMaster (Name:WAT_Name):void {\n    let MasterInfo = existingInfoForMaster(Name)\n      MasterInfo.Styles = MasterInfo.pendingStyles\n      delete MasterInfo.pendingStyles\n      ;(MasterInfo.Version as WAT_Version).Build = currentTimestamp()\n    refreshInstancesOfMaster(Name)\n  }\n\n/**** serializedStyles ****/\n\n  function serializedStyles (StyleSet:WAT_StyleSet | undefined):WAT_Text {\n    let Serialization = ''\n      if (StyleSet != null) {\n        for (let Key in StyleSet) {\n          if (StyleSet.hasOwnProperty(Key)) {\n            Serialization += Key + ':' + StyleSet[Key] + '; '\n          }\n        }\n      }\n    return Serialization\n  }\n\n/**** ScriptOfMaster ****/\n\n  export function ScriptOfMaster (Name:WAT_Name):WAT_Text | undefined {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.Script\n  }\n\n/**** [set]PendingScriptOfMaster ****/\n\n  export function pendingScriptOfMaster (Name:WAT_Name):WAT_Text | undefined {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.pendingScript\n  }\n\n  export function setPendingScriptOfMaster (\n    Name:WAT_Name, newScript?:WAT_Text\n  ):void {\n//  expectName     ('master name',Name)     // t.b.d. by \"existingInfoForMaster\"\n    allowText('new master script',newScript)\n\n    let MasterInfo = existingInfoForMaster(Name)\n    if ((newScript == null) || (newScript.trim() === '')) {\n      delete MasterInfo.pendingScript\n    } else {\n      MasterInfo.pendingScript = newScript\n    }\n  }\n\n/**** activatePendingScriptOfMaster ****/\n\n  export function activatePendingScriptOfMaster (Name:WAT_Name):void {\n    let MasterInfo = existingInfoForMaster(Name)\n\n    MasterInfo.ErrorInfo = undefined\n      compileScriptIntoMaster(MasterInfo.pendingScript,MasterInfo)   // may fail!\n    if (MasterInfo.ErrorInfo == null) {\n      MasterInfo.Script = MasterInfo.pendingScript\n      delete MasterInfo.pendingScript\n      ;(MasterInfo.Version as WAT_Version).Build = currentTimestamp()\n\n      refreshInstancesOfMaster(Name)\n    } else {\n      MasterInfo.ErrorInfo  = undefined\n      compileScriptIntoMaster(MasterInfo.Script,MasterInfo)\n\n      if (MasterInfo.ErrorInfo != null) {\n        refreshInstancesOfMaster(Name)\n      }\n    }\n  }\n\n/**** PropertiesOfMaster ****/\n\n  export function PropertiesOfMaster (Name:WAT_Name):WAT_Property[] {\n    let MasterInfo = existingInfoForMaster(Name)\n\n    let Result = []\n      let Properties = MasterInfo.Properties\n      if (Properties != null) {\n        for (let i = 0, l = Properties.length; i < l; i++) {\n          Result.push(Object.assign({},Properties[i]))\n        }\n      }\n    return Result\n  }\n\n/**** PropertyNamesOfMaster ****/\n\n  export function PropertyNamesOfMaster (Name:WAT_Name):WAT_Identifier[] {\n    let MasterInfo = existingInfoForMaster(Name)\n\n    let Result = []\n      let Properties = MasterInfo.Properties\n      if (Properties != null) {\n        for (let i = 0, l = Properties.length; i < l; i++) {\n          Result.push(Properties[i].Identifier)\n        }\n      }\n    return Result\n  }\n\n/**** PropertyOfMaster ****/\n\n  export function PropertyOfMaster (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):WAT_Property | undefined {\n//  expectName       ('master name',Name)   // t.b.d. by \"existingInfoForMaster\"\n    allowIdentifier('property name',Identifier)\n\n    validatePropertyName(Identifier)\n\n    let MasterInfo = existingInfoForMaster(Name)\n    let Properties = MasterInfo.Properties\n      if (Properties != null) {\n        for (let i = 0, l = Properties.length; i < l; i++) {\n          let Property = Properties[i]\n          if (Property.Identifier === Identifier) {\n            return Object.assign({},Property)\n          }\n        }\n      }\n    return undefined\n  }\n\n/**** MasterHasProperty ****/\n\n  export function MasterHasProperty (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):boolean {\n//  expectName       ('master name',Name)   // t.b.d. by \"existingInfoForMaster\"\n    allowIdentifier('property name',Identifier)\n\n    if (Identifier in forbiddenPropertyNames) { return false }\n\n    let MasterInfo = existingInfoForMaster(Name)\n    let Properties = MasterInfo.Properties\n      if (Properties != null) {\n        for (let i = 0, l = Properties.length; i < l; i++) {\n          let Property = Properties[i]\n          if (Property.Identifier === Identifier) {\n            return true\n          }\n        }\n      }\n    return false\n  }\n\n/**** MasterLacksProperty ****/\n\n  export function MasterLacksProperty (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):boolean {\n    return ! MasterHasProperty(Name,Identifier)\n  }\n\n/**** insertPropertyOfMasterAt ****/\n\n  export function insertPropertyOfMasterAt (\n    Name:WAT_Name, Specification:WAT_Property, Index?:number\n  ):void {\n//  expectName      ('master name',Name)  // t.b.d. by \"IndexOfPropertyOfMaster\"\n    allowOrdinal('insertion index',Index)\n\n    let Property = expectedProperty('property specification',Specification)\n\n    let Identifier = Property.Identifier\n    if (IndexOfPropertyOfMaster(Name,Identifier) >= 0) throwError(\n      'PropertyExists: a property with the name ' + quoted(Identifier) + ' exists already'\n    )\n\n    let MasterInfo = MasterRegistry[Name]\n    let Properties = MasterInfo.Properties\n    if (Properties == null) {\n      MasterInfo.Properties = [Property]\n    } else {\n      if (Index == null) {\n        Index = Properties.length\n      } else {\n        Index = Math.min(Index,Properties.length)\n      }\n\n      Properties.splice(Index,0, Property)\n    }\n  }\n\n/**** renamePropertyOfMaster ****/\n\n  export function renamePropertyOfMaster (\n    Name:WAT_Name, oldIdentifier:WAT_Identifier, newIdentifier:WAT_Identifier\n  ):void {\n//  expectName      ('master name',Name)  // t.b.d. by \"IndexOfPropertyOfMaster\"\n    expectIdentifier('old property identifier',oldIdentifier)\n    expectIdentifier('new property identifier',newIdentifier)\n\n    validatePropertyName(oldIdentifier)\n    validatePropertyName(newIdentifier)\n\n    if (oldIdentifier === newIdentifier) { return }\n\n    let PropertyIndex = IndexOfPropertyOfMaster(Name,oldIdentifier)\n    if (PropertyIndex < 0) throwError(\n      'NoSuchProperty: a property with the name ' + quoted(oldIdentifier) + ' ' +\n      'does not exist'\n    )\n\n    if (IndexOfPropertyOfMaster(Name,newIdentifier) >= 0) throwError(\n      'PropertyExists: a property with the name ' + quoted(newIdentifier) + ' ' +\n      'exists already'\n    )\n\n    let Property = (MasterRegistry[Name].Properties as WAT_Property[])[PropertyIndex]\n    Property.Identifier = newIdentifier\n  }\n\n/**** changePropertyOfMaster ****/\n\n  export function changePropertyOfMaster (\n    Name:WAT_Name, Identifier:WAT_Identifier, Specification:WAT_Property\n  ):void {\n//  expectName      ('master name',Name)                         // t.b.d. below\n    expectIdentifier('property identifier',Identifier)\n\n    validatePropertyName(Identifier)\n\n    let Property = expectedProperty('property specification',Specification)\n    if (Identifier !== Property.Identifier) {\n      renamePropertyOfMaster(Name, Identifier, Property.Identifier)\n    }\n\n    let PropertyIndex = IndexOfPropertyOfMaster(Name,Identifier)\n\n    let Properties = MasterRegistry[Name].Properties as WAT_Property[]\n    Properties[PropertyIndex] = Property\n  }\n\n/**** IndexOfPropertyOfMaster ****/\n\n  export function IndexOfPropertyOfMaster (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):number {\n//  expectName        ('master name',Name)  // t.b.d. by \"existingInfoForMaster\"\n    expectIdentifier('property name',Identifier)\n\n    validatePropertyName(Identifier)\n\n    let MasterInfo = existingInfoForMaster(Name)\n    let Properties = MasterInfo.Properties\n      if (Properties != null) {\n        for (let i = 0, l = Properties.length; i < l; i++) {\n          if (Properties[i].Identifier === Identifier) {\n            return i\n          }\n        }\n      }\n    return -1\n  }\n\n/**** PropertyCountOfMaster ****/\n\n  export function PropertyCountOfMaster (Name:WAT_Name):number {\n//  expectName('master name',Name)          // t.b.d. by \"existingInfoForMaster\"\n\n    let MasterInfo = existingInfoForMaster(Name)\n    let Properties = MasterInfo.Properties\n    return (Properties == null ? 0 : Properties.length)\n  }\n\n/**** PropertyOfMasterMayBeMovedUp ****/\n\n  export function PropertyOfMasterMayBeMovedUp (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):boolean {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n\n    let Index = IndexOfPropertyOfMaster(Name,Identifier)\n    return (Index > 0)\n  }\n\n/**** PropertyOfMasterMayBeMovedDown ****/\n\n  export function PropertyOfMasterMayBeMovedDown (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):boolean {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n\n    let Index = IndexOfPropertyOfMaster(Name,Identifier)\n    return (\n      (Index >= 0) &&\n      (Index < (MasterRegistry[Name].Properties as WAT_Property[]).length-1)\n    )\n  }\n\n/**** movePropertyOfMasterToTop ****/\n\n  export function movePropertyOfMasterToTop (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):void {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n\n    let Index = IndexOfPropertyOfMaster(Name,Identifier)\n    if (Index > 0) {\n      let Properties = MasterRegistry[Name].Properties as WAT_Property[]\n      let Property   = Properties.splice(Index,1)[0]\n      Properties.unshift(Property)\n    }\n  }\n\n/**** movePropertyOfMasterUp ****/\n\n  export function movePropertyOfMasterUp (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):void {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n\n    let Index = IndexOfPropertyOfMaster(Name,Identifier)\n    if (Index > 0) {\n      let Properties = MasterRegistry[Name].Properties as WAT_Property[]\n      let Property   = Properties.splice(Index,1)[0]\n      Properties.splice(Index-1,0, Property)\n    }\n  }\n\n/**** movePropertyOfMasterDown ****/\n\n  export function movePropertyOfMasterDown (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):void {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n\n    let Properties = MasterRegistry[Name].Properties as WAT_Property[]\n\n    let Index = IndexOfPropertyOfMaster(Name,Identifier)\n    if (Index < Properties.length-1) {\n      let Property = Properties.splice(Index,1)[0]\n      Properties.splice(Index+1,0, Property)\n    }\n  }\n\n/**** movePropertyOfMasterToBottom ****/\n\n  export function movePropertyOfMasterToBottom (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):void {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n\n    let Properties = MasterRegistry[Name].Properties as WAT_Property[]\n\n    let Index = IndexOfPropertyOfMaster(Name,Identifier)\n    if (Index < Properties.length-1) {\n      let Property = Properties.splice(Index,1)[0]\n      Properties.push(Property)\n    }\n  }\n\n/**** movePropertyOfMasterTo ****/\n\n  export function movePropertyOfMasterTo (\n    Name:WAT_Name, Identifier:WAT_Identifier, newIndex:number\n  ):void {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n    expectOrdinal  ('property index',newIndex)\n\n    let oldIndex = IndexOfPropertyOfMaster(Name,Identifier)\n    if (oldIndex < 0) throwError(\n      'NoSuchProperty: a property with the name ' + quoted(Identifier) + ' ' +\n      'does not exist'\n    )\n\n    if (oldIndex === newIndex) { return }\n\n    let Properties = MasterRegistry[Name].Properties as WAT_Property[]\n\n    let Property = Properties.splice(oldIndex,1)[0]\n    Properties.splice(newIndex,0,Property)\n  }\n\n/**** removePropertyOfMaster ****/\n\n  export function removePropertyOfMaster (\n    Name:WAT_Name, Identifier:WAT_Identifier\n  ):void {\n//  expectName        ('master name',Name)// t.b.d. by \"IndexOfPropertyOfMaster\"\n//  expectIdentifier('property name',Identifier)                         // dto.\n\n    let Index = IndexOfPropertyOfMaster(Name,Identifier)\n    if (Index >= 0) {\n      let Properties = MasterRegistry[Name].Properties as WAT_Property[]\n\n      Properties.splice(Index,1)\n      if (Properties.length === 0) {\n        delete MasterRegistry[Name].Properties\n      }\n    }\n  }\n\n/**** ErrorInfoOfMaster ****/\n\n  export function ErrorInfoOfMaster (Name:WAT_Name):WAT_ErrorInfo | undefined {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.ErrorInfo\n  }\n\n/**** UsageCountOfMaster ****/\n\n  export function UsageCountOfMaster (Name:WAT_Name):number {\n    let MasterInfo = existingInfoForMaster(Name)\n    return MasterInfo.UsageCount\n  }\n\n/**** allMastersInDocument ****/\n\n  function allMastersInDocument ():WAT_Name[] {\n    let MasterSet = Object.create(null)\n      forEach(\n        document.head.querySelectorAll('script[type=\"application/wat-master\"]'),\n        (ScriptElement) => {\n        try {\n          let MasterInfo = MasterInfoFromElement(ScriptElement)\n          let MasterName = MasterInfo.Name\n          if (ValueIsName(MasterName) && (MasterName in MasterRegistry)) {\n            MasterSet[MasterName] = MasterName\n          }\n        } catch (Signal) { /* nop - has already be reported */ }\n      })\n    let MasterList:WAT_Name[] = []\n      for (let Master in MasterSet) {\n        MasterList.push(Master)\n      }\n    return MasterList\n  }\n\n/**** Masters ****/\n\n  export function Masters ():WAT_Name[] {\n    let Result = []\n      for (let Master in MasterRegistry) {\n        Result.push(Master)\n      }\n    return Result\n  }\n\n/**** instantiableMasters - i.e., all without Applet masters ****/\n\n  export function instantiableMasters ():WAT_Name[] {\n    let Result = []\n      for (let Master in MasterRegistry) {\n        let MasterInfo = MasterRegistry[Master]\n        if (MasterInfo.Category !== 'Applet') { Result.push(Master) }\n      }\n    return Result\n  }\n\n/**** instantiableLayerMasters ****/\n\n  export function instantiableLayerMasters ():WAT_Name[] {\n    let Result = []\n      for (let Master in MasterRegistry) {\n        let MasterInfo = MasterRegistry[Master]\n        if (\n          (MasterInfo.Category === 'Card') ||\n          (MasterInfo.Category === 'Overlay')\n        ) { Result.push(Master) }\n      }\n    return Result\n  }\n\n/**** instantiableComponentMasters ****/\n\n  export function instantiableComponentMasters ():WAT_Name[] {\n    let Result = []\n      for (let Master in MasterRegistry) {\n        let MasterInfo = MasterRegistry[Master]\n        if (\n          (MasterInfo.Category === 'Control') ||\n          (MasterInfo.Category === 'Compound')\n        ) { Result.push(Master) }\n      }\n    return Result\n  }\n\n/**** missingMasters ****/\n\n  export function missingMasters ():WAT_Name[] {\n    let missingMasterSet = Object.create(null)\n      forEach(\n        document.body.querySelectorAll('.WAT[data-wat-master]'),\n        (Peer) => {\n          let Master = data(Peer as HTMLElement,'wat-master')\n          if (ValueIsName(Master) && ! (Master in MasterRegistry)) {\n            missingMasterSet[Master] = Master\n          }\n        }\n      )\n    let missingMasterList = []\n      for (let Master in missingMasterSet) {\n        missingMasterList.push(Master)\n      }\n    return missingMasterList\n  }\n\n/**** unusedMasters ****/\n\n  export function unusedMasters ():WAT_Name[] {\n    let unusedMasterList = []\n      for (let Master in MasterRegistry) {\n        let MasterInfo = MasterRegistry[Master]\n        if (MasterInfo.UsageCount <= 0) {\n          unusedMasterList.push(Master)\n        }\n      }\n    return unusedMasterList\n  }\n\n/**** MastersUsedByVisuals ****/\n\n  export function MastersUsedByVisuals (\n    VisualList:WAT_Visual[], withoutIntrinsics?:'withoutIntrinsics'\n  ):WAT_Name[] {\n    let MasterSet = Object.create(null)\n      function collectMastersUsedByVisual (Visual:WAT_Visual):void {\n        MasterSet[Visual.Master] = true\n\n        switch (Visual.Category) {\n          case 'Applet':\n            (Visual as WAT_Applet).CardList.forEach(\n              (Card:WAT_Card) => collectMastersUsedByVisual(Card)\n            )\n            (Visual as WAT_Applet).OverlayList.forEach(\n              (Overlay:WAT_Overlay) => collectMastersUsedByVisual(Overlay)\n            )\n            break\n          case 'Card':\n          case 'Overlay':\n          case 'Compound':\n            (Visual as WAT_Container).ComponentList.forEach(\n // @ts-ignore Components are always Visuals\n              (Component:WAT_Component) => collectMastersUsedByVisual(Component)\n            )\n        }\n      }\n\n      VisualList.forEach((Visual:WAT_Visual) => collectMastersUsedByVisual(Visual))\n    if (withoutIntrinsics) {\n      delete MasterSet.plainApplet\n      delete MasterSet.plainCard\n      delete MasterSet.plainOverlay\n      delete MasterSet.plainControl\n      delete MasterSet.plainCompound\n    }\n    let MasterList:WAT_Name[] = []\n      for (let Master in MasterSet) {\n        MasterList.push(Master)\n      }\n    return MasterList\n  }\n\n//----------------------------------------------------------------------------//\n//                               global Visuals                               //\n//----------------------------------------------------------------------------//\n\n/**** globalVisualOfApplet ****/\n\n  function globalVisualOfApplet (\n    Applet:WAT_Applet, globalName:WAT_Name\n  ):WAT_Visual {\n    return (InternalsOfVisual(Applet).globalVisualSet as WAT_KeySet)[globalName]\n  }\n\n/**** AppletHasGlobalVisual ****/\n\n  function AppletHasGlobalVisual (\n    Applet:WAT_Applet, globalName:WAT_Name\n  ):boolean {\n    return (globalVisualOfApplet(Applet,globalName) != null)\n  }\n\n/**** registerGlobalVisualOfApplet ****/\n\n  function registerGlobalVisualOfApplet (\n    Applet:WAT_Applet, Visual:WAT_Visual\n  ):void {\n    let globalVisualSet = InternalsOfVisual(Applet).globalVisualSet as WAT_KeySet\n      let globalName = Visual.Name\n      if (globalName in globalVisualSet) {\n        throwError(\n          'VisualExists: a visual with the global name \"' + globalName + '\" ' +\n          'exists already'\n        )\n      }\n    globalVisualSet[globalName] = Visual\n  }\n\n/**** unregisterGlobalVisualOfApplet ****/\n\n  function unregisterGlobalVisualOfApplet (\n    Applet:WAT_Applet, Visual:WAT_Visual\n  ):void {\n    let globalName = Visual.Name\n    delete (InternalsOfVisual(Applet).globalVisualSet as WAT_KeySet)[globalName]\n  }\n\n//----------------------------------------------------------------------------//\n//                            Reactivity Handling                             //\n//----------------------------------------------------------------------------//\n\n  type WAT_ReactivityContext = {\n    $: (firstArg:any, secondArg?:any, thirdArg?:any) => any,\n    setReactiveVariable: (VariableName:string, newValue:any, definitely?:boolean, wasControlValueChange?:'wasControlValueChange') => void,\n    clearReactiveVariable: (VariableName:WAT_Identifier) => void,\n    unregisterReactiveFunctionsOfVisual: (Visual:WAT_Visual) => void\n  }\n\n/**** ReactivityContext ****/\n\n  type VariableSet = { [Key:string]:any }\n  type FunctionSet = { [Key:string]:Function }\n\n  function ReactivityContext (Applet:WAT_Applet):WAT_ReactivityContext {\n    let FunctionKeySet:WeakMap<Function,string> // every function is associated with a unique key\n    let reactiveVariableSet:VariableSet       // set of reactive variables & their current values\n\n    let FunctionStack:Function[] // (reversed) stack of currently running reactive funct.s\n\n    let FunctionVarSet:WeakMap<Function,VariableSet>  // set of reactive var.s already known for a given fct.\n    let FunctionVarCount:WeakMap<Function,number>       // # of reactive var.s already known for a given fct.\n    let FunctionVarList:WeakMap<Function,string[]>      // list of reactive var.s to be passed upon fct. call\n    let VarFunctionSet:{[Key:string]:FunctionSet}     // set of functions interested in a given reactive var.\n\n    let recalculating:boolean                    // are we in the middle of a recalculation?\n    let RecalculationError:any              // last error that occurred during recalculation\n    let activeVarSet:VariableSet       // set of variables handled during this recalculation\n    let pendingFunctionSet:FunctionSet // set of reactive functions yet to be (re)calculated\n    let pendingFunctionList:string[]     // sorted list of reactive funct.s to be calculated\n\n  /**** reset ****/\n\n    function reset ():void {\n      FunctionKeySet      = new WeakMap()\n      reactiveVariableSet = Object.create(null)\n\n      FunctionStack = []\n\n      FunctionVarSet   = new WeakMap()\n      FunctionVarCount = new WeakMap()\n      FunctionVarList  = new WeakMap()\n      VarFunctionSet   = Object.create(null)\n\n      resetCalculation()\n    }\n\n  /**** resetCalculation - done AFTER any recalculation ****/\n\n    function resetCalculation ():void {\n      recalculating       = false\n  //  RecalculationError  = undefined                            // not in here!\n\n      activeVarSet        = Object.create(null)\n      pendingFunctionSet  = Object.create(null)\n      pendingFunctionList = []\n    }\n\n  /**** changedVariables ****/\n\n    function changedVariables ():any {\n      return Object.assign(Object.create(null),reactiveVariableSet)\n    }\n\n  /**** getReactiveVariable ****/\n\n    function getReactiveVariable (VariableName:string):any {\n      if (FunctionStack.length > 0) {\n        registerFunctionsForVariable(FunctionStack,VariableName)\n      }\n\n      if (VariableName[0] === '#') {\n        let globalVisual = globalVisualOfApplet(Applet,VariableName)\n        if (globalVisual != null) {\n          reactiveVariableSet[VariableName] = globalVisual.Value\n        }\n      }\n      return reactiveVariableSet[VariableName]\n    }\n\n  /**** setReactiveVariable ****/\n\n    function setReactiveVariable (\n      VariableName:string, newValue:any, definitely:boolean = false,\n      wasControlValueChange?:'wasControlValueChange'\n    ):void {\n      let oldValue = reactiveVariableSet[VariableName]\n\n      let equalValues = ValuesAreEqual(oldValue,newValue)\n      if (equalValues && ! definitely) { return }\n\n      if (VariableName in activeVarSet) {\n        if (equalValues) {\n          return\n        } else {\n          throw new Error(\n            'CircularDependency: trigger variable \"' + VariableName + '\" ' +\n            'has been changed during an ongoing recalculation'\n          )\n        }\n      }\n\n      reactiveVariableSet[VariableName] = newValue  // before Ctrl.Value is set!\n      activeVarSet[VariableName]        = newValue\n\n      if ((VariableName[0] === '#') && ! wasControlValueChange) {\n        let globalVisual = globalVisualOfApplet(Applet,VariableName)\n        if (globalVisual != null) { globalVisual.Value = newValue }\n      }\n\n      extendCalculationBy(VariableName)\n      if (! recalculating) {\n        recalculate()\n        if (RecalculationError != null) {\n          throw RecalculationError\n        }\n      }\n    }\n\n  /**** clearReactiveVariable ****/\n\n    function clearReactiveVariable (VariableName:string):any {\n      delete reactiveVariableSet[VariableName]\n    }\n\n  /**** registerReactiveFunctionOfVisual ****/\n\n    function registerReactiveFunctionOfVisual (\n      Visual:WAT_Visual, Handler:Function, VarNames:string = '',\n      toBeInvokedOnRegistration:boolean = false\n    ):void {\n      let FunctionKey = FunctionKeySet.get(Handler)\n      if (FunctionKey == null) {\n        FunctionKey = newFunctionKey()\n        FunctionKeySet.set(Handler,FunctionKey)\n\n        let reactiveFunctionList = InternalsOfVisual(Visual).reactiveFunctionList\n        if (reactiveFunctionList == null) {\n          InternalsOfVisual(Visual).reactiveFunctionList = [Handler]\n        } else {\n          reactiveFunctionList.push(Handler)\n        }\n\n        FunctionVarSet.set(Handler,Object.create(null))\n        FunctionVarCount.set(Handler,0)\n\n        VarNames = VarNames.trim().replace(/\\s+/g,' ')\n        if (VarNames !== '') {\n          let VarNameList = VarNames.split(' ')\n          for (let i = 0, l = VarNameList.length; i < l; i++) {\n            registerFunctionForVariable(Handler,VarNameList[i])\n          }\n\n          if (! toBeInvokedOnRegistration) {\n            let VarSet = FunctionVarSet.get(Handler)\n              let VarList = []\n              for (let VarName in VarSet) {\n                VarList.push(VarName)\n              }\n            FunctionVarList.set(Handler,VarList)\n\n            return\n          }\n        }\n      }\n\n      calculateReactiveFunction(Handler)\n    }\n\n  /**** unregisterReactiveFunctionOfVisual ****/\n\n    function unregisterReactiveFunctionOfVisual (\n      Visual:WAT_Visual, Handler:Function\n    ):void {\n      const FunctionKey = FunctionKeySet.get(Handler)\n      if (FunctionKey == null) { return }\n\n      let reactiveFunctionList = InternalsOfVisual(Visual).reactiveFunctionList\n      if (reactiveFunctionList != null) {\n        let Index = reactiveFunctionList.indexOf(Handler)\n        if (Index >= 0) { reactiveFunctionList.splice(Index,1) }\n      }\n\n      let VarSet = FunctionVarSet.get(Handler)\n      for (let VarName in VarSet) {\n        let FunctionSet = VarFunctionSet[VarName]\n        delete FunctionSet[FunctionKey]\n\n        if (ObjectIsEmpty(FunctionSet)) {\n          delete VarFunctionSet[VarName]\n        }\n      }\n    }\n\n  /**** unregisterReactiveFunctionsOfVisual ****/\n\n    function unregisterReactiveFunctionsOfVisual (Visual:WAT_Visual):void {\n      let reactiveFunctionList = InternalsOfVisual(Visual).reactiveFunctionList\n      if (reactiveFunctionList != null) {\n        for (let i = 0, l = reactiveFunctionList.length; i < l; i++) {\n          unregisterReactiveFunctionOfVisual(\n            Visual, reactiveFunctionList[0]               // this is not a typo!\n          )\n        }\n      }\n    }\n\n  /**** registerFunctionForVariable ****/\n\n    function registerFunctionForVariable (Handler:Function, VarName:string):void {\n      let VarSet = FunctionVarSet.get(Handler)            // reference, not copy\n      if (VarSet == null) throwError('InternalError: unregistered function')\n\n      if (! (VarName in VarSet)) {\n        VarSet[VarName] = true\n        FunctionVarCount.set(Handler,(FunctionVarCount.get(Handler) || 0)+1)\n\n        let FunctionSet = VarFunctionSet[VarName]\n        if (FunctionSet == null) {\n          FunctionSet = VarFunctionSet[VarName] = Object.create(null)\n        }\n\n        let FunctionKey = FunctionKeySet.get(Handler)\n        if (FunctionKey == null) throwError('InternalError: unregistered function')\n        FunctionSet[FunctionKey] = Handler\n      }\n    }\n\n  /**** registerFunctionsForVariable ****/\n\n    function registerFunctionsForVariable (\n      HandlerList:Function[], VarName:string\n    ):void {\n      for (let i = 0, l = HandlerList.length; i < l; i++) {\n        registerFunctionForVariable(HandlerList[i],VarName)\n      }\n    }\n\n  /**** extendCalculationBy ****/\n\n    function extendCalculationBy (VarName:string):void {\n      let FunctionSet = VarFunctionSet[VarName]\n      if (FunctionSet == null) { return }\n\n      let FunctionSetHasChanged = false\n        for (let FunctionKey in FunctionSet) {\n          if (! (FunctionKey in pendingFunctionSet)) {\n            FunctionSetHasChanged = true\n            pendingFunctionSet[FunctionKey] = FunctionSet[FunctionKey]\n          }\n        }\n      if (! FunctionSetHasChanged) { return }\n\n      pendingFunctionList = []\n      for (let FunctionKey in pendingFunctionSet) {\n        pendingFunctionList.push(FunctionKey)\n      }\n\n      pendingFunctionList.sort((FunctionKey_A,FunctionKey_B) => {\n        let VarCount_A = FunctionVarCount.get(pendingFunctionSet[FunctionKey_A]) || 0\n        let VarCount_B = FunctionVarCount.get(pendingFunctionSet[FunctionKey_B]) || 0\n\n        switch (true) {\n          case VarCount_A  <  VarCount_B: return -1\n          case VarCount_A === VarCount_B: return  0\n          default:                        return  1\n        }\n      })\n    }\n\n  /**** recalculate ****/\n\n    function recalculate ():void {\n      recalculating = true\n        RecalculationError = undefined\n\n        while (pendingFunctionList.length > 0) {\n          let FunctionKey = pendingFunctionList.shift() as string\n          let Handler     = pendingFunctionSet[FunctionKey]\n            delete pendingFunctionSet[FunctionKey]\n\n          try {\n            calculateReactiveFunction(Handler)\n          } catch (Signal) {\n            console.error(\n              'error during automatic recalculation of reactive functions',\n              Signal\n            )\n            RecalculationError = Signal\n          }\n        }\n      resetCalculation()                      // also sets recalculating = false\n    }\n\n  /**** calculateReactiveFunction ****/\n\n    function calculateReactiveFunction (Handler:Function):void {\n      let reactiveVarSet:VariableSet | undefined = undefined\n        let VarList = FunctionVarList.get(Handler)\n        if (VarList != null) {\n          reactiveVarSet = Object.create(null)\n          for (let i = 0, l = VarList.length; i < l; i++) {\n            let VarName = VarList[i]\n// @ts-ignore how can \"reactiveVarSet\" be null here?\n            reactiveVarSet[VarName] = reactiveVariableSet[VarName]\n          }\n        }\n      FunctionStack.unshift(Handler)\n      try {\n        Handler(reactiveVarSet)\n        FunctionStack.shift()\n      } catch (Signal) {\n        FunctionStack.shift()\n        throw Signal\n      }\n    }\n\n    function $ (\n      Visual:WAT_Visual, firstArg:any, secondArg?:any, thirdArg?:any\n    ):any {\n      switch (arguments.length-1) {\n        case 0:\n          throwError('MissingArgument: reactive variable name or function expected')\n        case 1:\n          if (ValueIsString(firstArg))   { return getReactiveVariable(firstArg) }\n          if (ValueIsFunction(firstArg)) { return registerReactiveFunctionOfVisual(Visual, firstArg) }\n          break\n        case 2:\n          if (ValueIsString(firstArg)) {\n            return setReactiveVariable(firstArg, secondArg, false)\n          }\n\n          if (ValueIsFunction(firstArg)) {\n            if (ValueIsBoolean(secondArg)) {\n              return (\n                secondArg == true\n                ? registerReactiveFunctionOfVisual(Visual, firstArg)\n                : unregisterReactiveFunctionOfVisual(Visual, firstArg)\n              )\n            }\n\n            if (ValueIsString(secondArg)) {\n              return registerReactiveFunctionOfVisual(Visual, firstArg, secondArg, false)\n            }\n          }\n          break\n        case 3:\n          if (ValueIsString(firstArg) && ValueIsBoolean(thirdArg)) {\n            return setReactiveVariable(firstArg, secondArg, thirdArg)\n          }\n\n          if (ValueIsFunction(firstArg) && ValueIsString(secondArg) && ValueIsBoolean(thirdArg)) {\n            return registerReactiveFunctionOfVisual(Visual, firstArg, secondArg, thirdArg)\n          }\n      }\n\n      throwError(\n        'InvalidArguments: variable name (with opt. value) or function ' +\n        '(with opt. variable names) expected'\n      )\n    }\n\n    reset()\n\n    return {\n      $, setReactiveVariable, clearReactiveVariable, unregisterReactiveFunctionsOfVisual\n    }\n  }\n\n/**** newFunctionKey ****/\n\n  let KeyCounter = 0\n\n  function newFunctionKey ():string {\n    KeyCounter += 1\n    return 'BRE-' + KeyCounter\n  }\n\n/**** make global visuals \"reactive\" ****/\n\n  on(document.body, 'value-changed', undefined, function (DOMEvent:Event) {\n    let Origin = VisualOfElement(DOMEvent.target as HTMLElement)\n    if (Origin == null) { return }\n\n    let Name = Origin.Name\n    if ((Name || '')[0] === '#') {\n      InternalsOfVisual(Origin.Applet).ReactivityContext?.setReactiveVariable(\n// @ts-ignore always use \"detail\"\n        Name, DOMEvent.detail, false, 'wasControlValueChange'\n      )\n    }\n  })\n\n//----------------------------------------------------------------------------//\n//                               Event Handling                               //\n//----------------------------------------------------------------------------//\n\n/**** ignore some events while an applet is under design ****/\n\n  function swallowEventWhileLayouting (Event:any):void {\n    if (Designer == null) { return }\n\n    let AppletPeer = Event.target.closest('.WAT.Applet')\n    if (AppletPeer == null) { return }\n\n    let Applet = VisualOfElement(AppletPeer) as WAT_Applet\n    if (Applet == null) { return }\n\n    if (Designer.layoutsApplet(Applet)) {\n      Event.stopPropagation()\n      Event.preventDefault()\n    }\n  }\n\n  document.body.addEventListener('mousedown',swallowEventWhileLayouting)\n  document.body.addEventListener('mousemove',swallowEventWhileLayouting)\n  document.body.addEventListener('mouseup',  swallowEventWhileLayouting)\n\n  document.body.addEventListener('mouseenter',swallowEventWhileLayouting)\n  document.body.addEventListener('mouseleave',swallowEventWhileLayouting)\n\n  document.body.addEventListener('keydown', swallowEventWhileLayouting)\n  document.body.addEventListener('keypress',swallowEventWhileLayouting)\n  document.body.addEventListener('keyup',   swallowEventWhileLayouting)\n\n  document.body.addEventListener('input', swallowEventWhileLayouting)\n  document.body.addEventListener('change',swallowEventWhileLayouting)\n  document.body.addEventListener('click', swallowEventWhileLayouting)\n\n/**** registerEventHandlerForVisual - on([TapPoint,]Event[,Selector],Handler) ****/\n\n  function registerEventHandlerForVisual (\n    Visual:WAT_Visual, ...ArgumentList:any[]\n  ):void {\n    let TapPoint:WAT_Visual | undefined, EventName:string\n    let EventSelector:string | undefined, EventHandler:Function\n    if (ValueIsString(ArgumentList[0]) && ArgumentList[0].startsWith('@')) {\n      let TapPointSelector = (ArgumentList.shift() as string).slice(1), TapElement\n      if (TapPointSelector[0] === '.') {\n        expectName('tap point master name',TapPointSelector.slice(1))\n        TapElement = closestParent(Visual.Peer,'.WAT' + TapPointSelector)\n      } else {\n        expectUniversalName('tap point name',TapPointSelector)\n        TapElement = closestFilteredParent(\n          Visual.Peer,'.WAT',\n          (Peer:HTMLElement) => (VisualOfElement(Peer).Name === TapPointSelector)\n        )\n      }\n      if (TapElement != null) {\n        TapPoint = VisualOfElement(TapElement)\n      }\n    } else {\n      TapPoint = Visual\n    }\n\n    EventName     = expectedName('event name',ArgumentList.shift())\n    EventSelector = (\n      ValueIsString(ArgumentList[0]) ? ArgumentList.shift() as string : undefined\n    )\n    EventHandler  = expectedFunction('event handler',ArgumentList.shift())\n\n  /**** ignore registration if no matching tap point exists ****/\n\n    if (TapPoint == null) { return }\n\n  /**** provide the \"actual\" event handler for the configured situation ****/\n\n    let actualHandler = function actualEventHandler (...ArgumentList:any) {\n      let Event = ArgumentList[0]\n\n      if ((Designer != null) && Designer.layoutsApplet(Visual.Applet)) {\n        Event.stopPropagation()\n        Event.preventDefault()\n        return\n      }                          // no event handling for \"applets under design\"\n\n      if ((TapPoint === Visual) && (EventSelector == null)) {\n        if (Event.target !== Visual.Peer) { return }\n      }                         // ignore \"inner events\" if no selector is given\n\n      EventHandler.apply(Visual,ArgumentList)\n    }\n\n  /**** register event handler at tap point ****/\n\n    let Internals     = InternalsForVisual.get(Visual)\n    let EventHandlers = Internals.EventHandlers\n    if (EventHandlers == null) {\n      Internals.EventHandlers = EventHandlers = []\n    }\n\n    for (let i = 0, l = EventHandlers.length; i < l; i++) {\n      let Candidate = EventHandlers[i]\n      if (\n        (Candidate.TapPoint  === TapPoint)  && (Candidate.EventSelector === EventSelector) &&\n        (Candidate.EventName === EventName) && (Candidate.EventHandler  === EventHandler)\n      ) { return }                        // handler has already been registered\n    }\n\n    EventHandlers.push({\n      TapPoint, EventName, EventSelector, EventHandler, actualHandler\n    })                       // n.b.: a missing selector is specified as \"null\"!\n\n    if (EventSelector == null) {\n      TapPoint.Peer.on(EventName, actualHandler)\n    } else {\n      TapPoint.Peer.on(EventName, EventSelector, actualHandler)\n    }\n  }\n\n/**** unregisterEventHandlerForVisual - off([TapPoint,]Event[,Selector],Handler) ****/\n\n  function unregisterEventHandlerForVisual (\n    Visual:WAT_Visual, ...ArgumentList:any[]\n  ) {\n    let TapPoint, EventName, EventSelector, EventHandler\n    if (ValueIsString(ArgumentList[0]) && ArgumentList[0].startsWith('@')) {\n      let TapPointSelector = (ArgumentList.shift() as string).slice(1), TapElement\n      if (TapPointSelector[0] === '.') {\n        expectName('tap point master name',TapPointSelector.slice(1))\n        TapElement = closestParent(Visual.Peer,'.WAT' + TapPointSelector)\n      } else {\n        expectUniversalName('tap point name',TapPointSelector)\n        TapElement = closestFilteredParent(\n          Visual.Peer, '.WAT',\n          (Peer:HTMLElement) => (VisualOfElement(Peer).Name === TapPointSelector)\n        )\n      }\n      if (TapElement != null) {\n        TapPoint = VisualOfElement(TapElement)\n      }\n    } else {\n      TapPoint = Visual\n    }\n\n    EventName     = allowedName('event name',ArgumentList.shift())\n    EventSelector = (\n      ValueIsString(ArgumentList[0]) ? ArgumentList.shift() as string : null\n    )\n    EventHandler  = allowedFunction('event handler',ArgumentList.shift())\n\n    if (EventHandler == null) {\n      if (EventSelector == null) { EventSelector === undefined }\n    }                 // important for selection of event handlers to be removed\n\n  /**** perform deregistration ****/\n\n    if (TapPoint == null) { return }\n\n    let Internals     = InternalsForVisual.get(Visual)\n    let EventHandlers = Internals.EventHandlers\n    if (EventHandlers == null) { return }\n\n    for (let i = EventHandlers.length-1; i >= 0; i--) {\n      let Candidate = EventHandlers[i]\n      if (\n        (Candidate.TapPoint      === TapPoint) &&\n        ((EventName    == null) || (Candidate.EventName    === EventName)) &&\n        (Candidate.EventSelector === EventSelector) &&  // even for missing ones\n        ((EventHandler == null) || (Candidate.EventHandler === EventHandler))\n      ) {\n        let actualHandler = Candidate.actualHandler\n\n        if (Candidate.EventSelector == null) {\n          TapPoint.Peer.off(Candidate.EventName, actualHandler)\n        } else {\n          TapPoint.Peer.off(Candidate.EventName, Candidate.EventSelector, actualHandler)\n        }\n\n        EventHandlers.splice(i,1)\n      }\n    }\n    if (EventHandlers.length === 0) { delete Internals.EventHandlers }\n  }\n\n/**** unregisterAllEventHandlersForVisual ****/\n\n  function unregisterAllEventHandlersForVisual (Visual:WAT_Visual) {\n    let Internals     = InternalsForVisual.get(Visual)\n    let EventHandlers = Internals.EventHandlers\n    if (EventHandlers == null) { return }\n\n    for (let i = 0, l = EventHandlers.length; i < l; i++) {\n      let [TapPoint, EventName, EventSelector, actualHandler] = EventHandlers[i]\n      if (EventSelector == null) {\n        TapPoint.Peer.off(EventName, actualHandler)\n      } else {\n        TapPoint.Peer.off(EventName, EventSelector, actualHandler)\n      }\n    }\n    delete Internals.EventHandlers\n  }\n\n/**** triggerEventFromVisual - trigger([InjectPoint,]Event[,...]) ****/\n\n  function triggerEventFromVisual (\n    Visual:WAT_Visual, ...ArgumentList:any[]\n  ) {\n    let InjectionPoint\n    if (ValueIsString(ArgumentList[0]) && ArgumentList[0].startsWith('@')) {\n      let InjectionPointSelector = (ArgumentList.shift() as string).slice(1), InjectionElement\n      if (InjectionPointSelector[0] === '.') {\n        expectName('injection point master name',InjectionPointSelector.slice(1))\n        InjectionElement = closestParent(Visual.Peer,'.WAT' + InjectionPointSelector)\n      } else {\n        expectUniversalName('injection point name',InjectionPointSelector)\n\n        InjectionElement = closestFilteredParent(\n          Visual.Peer, '.WAT',\n          (Peer:HTMLElement) => (VisualOfElement(Peer).Name === InjectionPointSelector)\n        )\n      }\n      if (InjectionElement != null) {\n        InjectionPoint = VisualOfElement(InjectionElement)\n      }\n    } else {\n      InjectionPoint = Visual\n    }\n\n    if (InjectionPoint != null) {\n      let EventName = ArgumentList.shift()\n      InjectionPoint.Peer.trigger(EventName,ArgumentList)\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                               Error Handling                               //\n//----------------------------------------------------------------------------//\n\n  export type WAT_ErrorInfo = {\n    Title:       string,                    // used as heading for error display\n    longMessage: string,                               // used for error display\n    shortMessage:string,                   // used by Designer in MessageDisplay\n    Reason?:     string,                    // internal (technical) error report\n\n    Applet:   WAT_Applet,                  // applet containing faulty component\n    Sufferer: WAT_Name|WAT_Visual, // name of affected master or affected visual\n    Property?:WAT_Identifier      // optional: affected property (e.g. \"Script\")\n  }\n\n/**** [set]ErrorInfoOfVisual ****/\n\n  function ErrorInfoOfVisual (Visual:WAT_Visual):WAT_ErrorInfo | undefined {\n    return InternalsOfVisual(Visual).ErrorInfo\n  }\n\n  function setErrorInfoOfVisual (\n    Visual:WAT_Visual, newErrorInfo?:WAT_ErrorInfo\n  ) {\n    let Internals = InternalsOfVisual(Visual)\n    if (newErrorInfo == null) {\n      delete Internals.ErrorInfo\n      remove(filtered(Internals.Peer.children,'.WAT-ErrorIndicator'))\n    } else {\n      if (Internals.ErrorInfo == null) {    // don't overwrite an existing error\n        Internals.ErrorInfo = newErrorInfo\n        remove(filtered(Internals.Peer.children,'.WAT-ErrorIndicator'))\n        Internals.Peer.appendChild(\n          ElementFromHTML('<button class=\"WAT-ErrorIndicator\"></button>')\n        )\n      }\n    }\n  }\n\n/**** install event handler for Error Indicators ****/\n\n  function installEventHandlerForErrorIndicators () {\n    off(document, 'click','.WAT-ErrorIndicator')\n    on (document, 'click','.WAT-ErrorIndicator', function (DOMEvent:Event) {\n      let ErrorIndicator = DOMEvent.target as HTMLElement\n      let affectedVisual = VisualOfElement(ErrorIndicator?.closest('.WAT'))\n      if (affectedVisual == null) {\n        alert('WAT Error\\n\\nCould not find Visual for this Error Indicator')\n        return\n      }\n\n      let ErrorInfo = ErrorInfoOfVisual(affectedVisual)\n      if (ErrorInfo != null) {\n        if ((Designer != null) && affectedVisual.Applet.mayBeDesigned) {\n          if (window.confirm(\n            ErrorInfo.Title + '\\n\\n' + ErrorInfo.longMessage +\n            (ErrorInfo.Reason != null ? '\\n\\nReason:\\n' + ErrorInfo.Reason : '') +\n            '\\n\\nDo you want to proceed to the Designer?'\n          )) {\n            Designer.startDesigning(\n              ErrorInfo.Sufferer,  ErrorInfo.Property\n            )\n          }\n        } else {\n          window.alert(\n            ErrorInfo.Title + '\\n\\n' + ErrorInfo.longMessage +\n            (ErrorInfo.Reason != null ? '\\n\\nReason:\\n' + ErrorInfo.Reason : '')\n          )\n        }\n      }\n    })\n  }\n\n/**** firstAppletInDocument (used for errors in masters) ****/\n\n  function firstAppletInDocument ():WAT_Applet {\n    let firstAppletPeer = AppletPeersInDocument()[0]\n    return VisualOfElement(firstAppletPeer) as WAT_Applet\n  }\n\n/**** VisualWithUniqueId ****/\n\n  const VisualRegistry = Object.create(null)\n\n  function VisualWithUniqueId (uniqueId:number):WAT_Visual {\n    expectOrdinal('unique visual id',uniqueId)\n    return VisualRegistry[uniqueId]\n  }\n\n/**** VisualOfElement (internal function w/o validation) ****/\n\n  const VisualForDOMElement = new WeakMap()             // DOM element -> visual\n\n  function VisualOfElement (Element:HTMLElement | null):WAT_Visual {\n    return (Element == null ? undefined : VisualForDOMElement.get(Element))\n  }\n\n/**** VisualForElement (public version w/ validation) ****/\n\n  export function VisualForElement (Element:HTMLElement):WAT_Visual {\n    expectElement('element',Element)\n\n    let Candidate = VisualForDOMElement.get(Element)\n    if (Candidate != null) { return Candidate }\n\n    Candidate = Element.closest('.WAT')\n    return (Candidate == null ? undefined : VisualForDOMElement.get(Candidate))\n  }\n\n/**** InternalsOfVisual ****/\n\n  type WAT_Internals = {\n    uniqueId:number,                              // internally unique visual id\n    Peer:HTMLElement,                                      // mandatory property\n    State?:any,                  // opt. custom state, must be JSON-serializable\n    EventHandlers?:any,    // list of event handlers registered from this visual\n    reactiveFunctionList?:Function[],              // list of reactive functions\n    globalVisualSet?:{ [Name:string]:WAT_Visual },           // for applets only\n    ReactivityContext?:WAT_ReactivityContext,                            // dto.\n    BackupStatus?:'isBeingPreserved'|'isBeingRestored'|'isBeingRemoved', // dto.\n    ErrorInfo?:WAT_ErrorInfo, pendingScriptError?:WAT_ErrorInfo\n  }\n\n  const InternalsForVisual = new WeakMap()                // visual -> internals\n\n  function InternalsOfVisual (Visual:WAT_Visual):WAT_Internals {\n    return InternalsForVisual.get(Visual)\n  }\n\n/**** PeerOfVisual ****/\n\n  function PeerOfVisual (Visual:WAT_Visual):HTMLElement {\n    return InternalsForVisual.get(Visual).Peer\n  }\n\n/**** AppletOfPeer ****/\n\n  function AppletOfPeer (Peer:HTMLElement):WAT_Applet | undefined {\n    let Candidate = Peer.closest('.WAT.Applet')\n    return (Candidate == null ? undefined : VisualOfElement(Candidate as HTMLElement) as WAT_Applet)\n  }\n\n/**** CategoryOfPeer ****/\n\n  function CategoryOfPeer (\n    Peer:HTMLElement, DefaultCategory?:WAT_Category|'Layer'|'Component'\n  ):WAT_Category {\n    switch (true) {\n      case Peer.classList.contains('Applet'):   return 'Applet'\n      case Peer.classList.contains('Card'):     return 'Card'\n      case Peer.classList.contains('Overlay'):  return 'Overlay'\n      case Peer.classList.contains('Control'):  return 'Control'\n      case Peer.classList.contains('Compound'): return 'Compound'\n      default: switch (DefaultCategory) {\n        case 'Applet':    return 'Applet'\n        case 'Layer':     return 'Card'\n        case 'Card':      return 'Card'\n        case 'Overlay':   return 'Overlay'\n        case 'Component': return (\n          filtered(Peer.children,'.WAT.Control,.WAT.Compound').length > 0\n          ? 'Compound'\n          : 'Control'\n        )\n        case 'Control':  return 'Control'\n        case 'Compound': return 'Compound'\n        default: throwError(\n          'BrokenVisual: cannot determine category of given visual'\n        )\n      }\n    }\n  }\n\n/**** VersionOfPeer ****/\n\n  function VersionOfPeer (Peer:HTMLElement):WAT_Version|undefined {\n    let Candidate = data(Peer,'wat-master-version')\n    return (ValueIsSemVer(Candidate) ? parsedVersion(Candidate) : undefined)\n  }\n\n/**** MasterOfPeer ****/\n\n  function MasterOfPeer (Peer:HTMLElement, Category?:WAT_Category):WAT_Name {\n    let Candidate = data(Peer,'wat-master')\n    if (ValueIsName(Candidate)) {\n      return Candidate\n    } else {\n      return (Category == null ? 'plainVisual' : 'plain'+Category)\n    }\n  }\n\n/**** NameOfPeer ****/\n\n  function NameOfPeer (Peer:HTMLElement):WAT_Name {\n    let Candidate = data(Peer,'wat-name')\n    return (ValueIsUniversalName(Candidate) ? Candidate : undefined)\n  }\n\n/**** ScriptOfPeer ****/\n\n  function ScriptOfPeer (Peer:HTMLElement):string {\n    let Candidate = data(Peer,'wat-script')\n    return (ValueIsText(Candidate) ? Candidate : undefined)\n  }\n\n/**** StateOfPeer ****/\n\n  function StateOfPeer (Peer:HTMLElement):any {\n    let Candidate = data(Peer,'wat-state')\n    if (Candidate == null) { return null }\n\n    try {\n      return JSON.parse(Candidate)\n    } catch (Signal) {\n      return null\n    }\n  }\n\n/**** VisualBuiltFromPeer - extremely forgiving (not to break an applet) ****/\n\n  function VisualBuiltFromPeer (\n    Peer:HTMLElement, allowedCategory:WAT_Category|'Layer'|'Component'\n  ):WAT_Visual {\n    let Category = CategoryOfPeer(Peer,allowedCategory)\n    if (CategoryContradictsExpectation(Category,allowedCategory)) {\n      let originalCategory = Category\n        switch (allowedCategory) {\n          case 'Layer':     Category = 'Card'; break\n          case 'Component': Category = (\n            filtered(Peer.children,'.WAT.Control,.WAT.Compound').length > 0\n            ? 'Compound'\n            : 'Control'\n          )\n          default: Category = allowedCategory\n        }\n\n        let Visual = VisualOfCategory(Category,Peer)\n        let Applet = AppletOfPeer(Peer)\n        if (Applet != null) {\n          setErrorInfoOfVisual(Visual,{\n            Title:       'Inappropriate Category',\n            longMessage: 'This visual belongs to category ' +\n                         quoted(originalCategory) + ', which is not allowed here',\n            shortMessage:'inappropriate category ' + quoted(originalCategory),\n            Applet:      Applet,\n            Sufferer:    Visual,\n            Property:    'Category'\n          })\n\n          buildInnerVisuals()\n        }\n      return Visual\n    }\n\n    function buildInnerVisuals ():void {\n      switch (Category) {\n        case 'Applet':\n          filtered(Peer.children,'.WAT.Card,.WAT.Overlay').forEach((Peer) => {\n            buildVisualFromPeer(Peer as HTMLElement,'Layer')\n          })\n          break\n        case 'Card':\n        case 'Overlay':\n        case 'Compound':\n          filtered(Peer.children,'.WAT.Control,.WAT.Compound').forEach((Peer) => {\n            buildVisualFromPeer(Peer as HTMLElement,'Component')\n          })\n      }\n    }\n\n    let Visual = VisualOfCategory(Category,Peer)\n    let Applet = AppletOfPeer(Peer)\n    if (Applet != null) {\n      let Master     = MasterOfPeer(Peer,Category)\n      let MasterInfo = MasterRegistry[Master]\n      if (MasterInfo == null) {\n        setErrorInfoOfVisual(Visual,{\n          Title:       'No such Master',\n          longMessage: 'A visual master called ' + quoted(Master) + ' is not ' +\n                       'available',\n          shortMessage:'unknown master ' + quoted(Master),\n          Applet:      Applet,\n          Sufferer:    Visual,\n          Property:    'Master'\n        })\n          buildInnerVisuals()\n        return Visual\n      }\n\n      let Classes = MasterInfo.Classes\n      if (Classes != null) {\n        Classes.forEach((Class) => { Peer.classList.add(Class) })\n      }\n\n      if (MasterInfo.Category !== Category) {\n        setErrorInfoOfVisual(Visual,{\n          Title:       'Inappropriate Master',\n          longMessage: 'Master ' + quoted(Master) + ' is not foreseen for ' +\n                       'category ' + quoted(Category),\n          shortMessage:'inappropriate master ' + quoted(Master),\n          Applet:      Applet,\n          Sufferer:    Visual,\n          Property:    'Master'\n        })\n          buildInnerVisuals()\n        return Visual\n      }\n\n      let Version = VersionOfPeer(Peer)\n      if ((Version != null) && ! VersionAmatchesB(Version,MasterInfo.Version as WAT_normalizedVersion)) {\n        setErrorInfoOfVisual(Visual,{\n          Title:       'Inappropriate Version',\n          longMessage: 'This visual requires a different version of master ' +\n                       quoted(Master) + ' than available',\n          shortMessage:'inappropriate master ' + quoted(Master),\n          Applet:      Applet,\n          Sufferer:    Visual,\n          Property:    'Version'\n        })\n          buildInnerVisuals()\n        return Visual\n      }\n\n      if (MasterInfo.ErrorInfo != null) {\n        setErrorInfoOfVisual(Visual,MasterInfo.ErrorInfo)\n          buildInnerVisuals()\n        return Visual\n      }\n\n      if (Category === 'Applet') {// every applet must always contain >= 1 cards\n        if (filtered(Peer.children,'.WAT.Card').length === 0) {\n          Peer.insertBefore(ElementFromHTML(\n            '<div class=\"WAT Card\" data-wat-master=\"plainCard\" style=\"visibility:visible\"></div>'\n          ), Peer.firstChild)\n        }\n      }\n\n      let Name = NameOfPeer(Peer)\n      if ((Name != null) && (Name[0] === '#')) {\n        try {\n          registerGlobalVisualOfApplet(Applet,Visual)\n        } catch (Signal) {\n          setErrorInfoOfVisual(Visual,{\n            Title:       'Global name Collision',\n            longMessage: 'The global name of this visual ' + quoted(Name) + ' ' +\n                         'has already been used',\n            shortMessage:'global name collision ' + quoted(Name),\n            Applet:      Applet,\n            Sufferer:    Visual,\n            Property:    'Name'\n          })\n            buildInnerVisuals()\n          return Visual\n        }\n      }\n\n      let State = StateOfPeer(Peer)\n      if (State != null) {\n        InternalsOfVisual(Visual).State = State\n      }\n\n      let VisualScript = ScriptOfPeer(Peer)\n      if ((MasterInfo.compiledScript != null) || (VisualScript != null)) {\n        const toGet   = definePropertyGetterForVisual.bind(null,Visual)\n        const toSet   = definePropertySetterForVisual.bind(null,Visual)\n        const on      = registerEventHandlerForVisual.bind(null,Visual)\n        const off     = unregisterEventHandlerForVisual.bind(null,Visual)\n        const trigger = triggerEventFromVisual.bind(null,Visual)\n\n        const Reactivity = (...ArgumentList:any[]):any => {\n          ArgumentList.unshift(Visual)\n          return InternalsOfVisual(Applet as WAT_Applet).ReactivityContext?.$.apply(\n// @ts-ignore don't worry about number of arguments\n            null,ArgumentList          // since number of arguments is important\n          )\n        }\n\n        if (MasterInfo.compiledScript != null) {\n          try {\n            MasterInfo.compiledScript.call(Visual, toGet,toSet,on,off,trigger,Reactivity)\n          } catch (Signal) {\n            setErrorInfoOfVisual(Visual,{\n              Title:       'Execution Error in Master Script',\n              longMessage: 'The script of master ' + quoted(Master) + ' could ' +\n                           'not be applied to this visual',\n              shortMessage:Signal.message,\n              Reason:      Signal,\n              Applet:      Applet,\n              Sufferer:    Visual,\n              Property:    'Master'\n            })\n              buildInnerVisuals()\n            return Visual\n          }\n        }\n\n        let compiledScript\n        if (VisualScript != null) {\n          try {\n            compiledScript = new Function(\n              'toGet','toSet','on','off','trigger','$', VisualScript\n            )\n          } catch (Signal) {\n            setErrorInfoOfVisual(Visual,{\n              Title:       'Compilation Error',\n              longMessage: 'The script of this visual could not be compiled',\n              shortMessage:Signal.message,\n              Reason:      Signal,\n              Applet:      Applet,\n              Sufferer:    Visual,\n              Property:    'Script'\n            })\n              buildInnerVisuals()\n            return Visual\n          }\n\n          try {\n            compiledScript.call(Visual, toGet,toSet,on,off,trigger,Reactivity)\n          } catch (Signal) {\n            setErrorInfoOfVisual(Visual,{\n              Title:       'Execution Error in Visual Script',\n              longMessage: 'The script of this visual failed',\n              shortMessage:Signal.message,\n              Reason:      Signal,\n              Applet:      Applet,\n              Sufferer:    Visual,\n              Property:    'Script'\n            })\n              buildInnerVisuals()\n            return Visual\n          }\n        }\n      }\n\n      buildInnerVisuals()\n    }\n\n    return Visual\n  }\n\n/**** buildVisualFromPeer ****/\n\n  function buildVisualFromPeer (\n    Peer:HTMLElement, allowedCategory:WAT_Category|'Layer'|'Component'\n  ):void {\n    VisualBuiltFromPeer(Peer,allowedCategory)\n  }\n\n/**** VisualOfCategory - for creating new or refreshing existing visuals ****/\n\n  let uniqueIdCounter = 0\n\n  function VisualOfCategory (\n    Category:WAT_Category, Peer:HTMLElement\n  ):WAT_Visual {\n    let uniqueId\n      let oldVisual = VisualForDOMElement.get(Peer)\n      if (oldVisual == null) {                                // deserialization\n        let serializedId = attr(Peer,'data-wat-unique-id')\n        if (serializedId != null) {\n          let newId = parseInt(serializedId,10)\n          if (\n            ValueIsOrdinal(newId) &&\n            (newId < uniqueIdCounter) &&\n            (VisualRegistry[newId] == null)\n          ) { uniqueId = newId }\n\n          attr(Peer,'data-wat-unique-id',undefined)\n        }\n      } else {                                                        // refresh\n        uniqueId = InternalsForVisual.get(oldVisual).uniqueId\n      }\n    if (uniqueId == null) { uniqueId = newUniqueId() }\n\n    let newVisual:WAT_Visual\n      switch (Category) {\n        case 'Applet':   newVisual = new WAT_Applet();   break\n        case 'Card':     newVisual = new WAT_Card();     break\n        case 'Overlay':  newVisual = new WAT_Overlay();  break\n        case 'Control':  newVisual = new WAT_Control();  break\n        case 'Compound': newVisual = new WAT_Compound(); break\n        default: throwError('InternalError: unforeseen visual category')\n      }\n      VisualForDOMElement.set(Peer,newVisual)\n      VisualRegistry[uniqueId] = newVisual\n\n      Peer.classList.add('WAT',Category)\n\n      InternalsForVisual.set(newVisual,{ uniqueId, Peer })\n      if (Category === 'Applet') {\n        let Internals = InternalsForVisual.get(newVisual)\n        Internals.globalVisualSet   = Object.create(null)\n        Internals.ReactivityContext = ReactivityContext(newVisual as WAT_Applet)\n      }\n    return newVisual\n  }\n\n/**** newUniqueId ****/\n\n  export function newUniqueId ():number {\n    return ++uniqueIdCounter\n  }\n\n/**** CategoryContradictsExpectation ****/\n\n  function CategoryContradictsExpectation (\n    Category:WAT_Category, allowedCategory:WAT_Category|'Layer'|'Component'\n  ):boolean {\n    switch (allowedCategory) {\n      case 'Applet':    return (Category !== 'Applet')\n      case 'Layer':     return (Category !== 'Card')    && (Category !== 'Overlay')\n      case 'Card':      return (Category !== 'Card')\n      case 'Overlay':   return (Category !== 'Overlay')\n      case 'Component': return (Category !== 'Control') && (Category !== 'Compound')\n      case 'Control':   return (Category !== 'Control')\n      case 'Compound':  return (Category !== 'Compound')\n      default: throwError('InternalError: unforeseen visual category')\n    }\n  }\n\n/**** applyStyleToVisual ****/\n\n  function applyStyleToVisual (\n    Visual:WAT_Visual, StyleName:string, StyleValue:any\n  ):void {\n    let MasterInfo = MasterRegistry[Visual.Master]\n    if ((MasterInfo?.Styles != null) && (StyleName in MasterInfo.Styles)) {\n      let MasterStyle = MasterInfo.Styles[StyleName]\n      if (MasterStyle === 'initial') {\n        return\n      } else {\n        StyleValue = MasterStyle\n      }\n    }\n    css(PeerOfVisual(Visual),StyleName,StyleValue)\n  }\n\n/**** applyStylesToVisual ****/\n\n  function applyStylesToVisual (\n    Visual:WAT_Visual, StyleSet:WAT_StyleSet\n  ):void {\n    let newStyleSet:{ [Key:string]:string } | undefined = undefined\n      let MasterInfo = MasterRegistry[Visual.Master]\n      if (MasterInfo?.Styles == null) {\n        for (let StyleName in StyleSet) {\n          if (\n            StyleSet.hasOwnProperty(StyleName) &&\n            (StyleSet[StyleName] !== null)\n          ) {\n            if (newStyleSet == null) { newStyleSet = {} }\n            newStyleSet[StyleName] = StyleSet[StyleName] as string\n          }\n        }\n      } else {\n        const MasterStyles = MasterInfo.Styles\n        for (let StyleName in StyleSet) {\n          if (StyleSet.hasOwnProperty(StyleName) && ! (StyleName in MasterStyles)) {\n            if (newStyleSet == null) { newStyleSet = {} }\n            newStyleSet[StyleName] = StyleSet[StyleName] as string\n          }\n        }\n      }\n    if (newStyleSet != null) {\n      for (let StyleName in newStyleSet) {\n        if (newStyleSet.hasOwnProperty(StyleName)) {\n          css(PeerOfVisual(Visual),StyleName,newStyleSet[StyleName])\n        }\n      }\n    }\n  }\n\n/**** refreshVisual ****/\n\n  function refreshVisual (Visual:WAT_Visual, oldMaster?:WAT_Name):void {\n    let Peer = Visual.Peer          // Peer remains the same, but Visual changes\n      let newMaster:WAT_Name\n      if (oldMaster != null) {\n        newMaster = MasterOfPeer(Peer)        // new Visual will use this master\n        Peer.data('wat-master',oldMaster) // but the current one still uses this\n      }\n\n      Visual.trigger('prepare-refresh')        // still using the current master\n      releaseVisual(Visual)                                  // NOT recursively!\n    buildVisualFromPeer(Peer,Visual.Category)                      // may throw!\n  }\n\n/**** releaseVisual ****/\n\n  function releaseVisual (Visual:WAT_Visual, recursively?:'recursively'):void {\n    unregisterAllEventHandlersForVisual(Visual)\n\n    let uniqueId = Visual.uniqueId\n    if (ValueIsOrdinal(uniqueId)) {\n      delete VisualRegistry[uniqueId]     // n.b.: \"Internals.uniqueId\" remains!\n    }                           // (i.e.: after \"refresh\", uniqueId is restored)\n\n    let Name = Visual.Name\n    if ((Name != null) && (Name[0] === '#')) {\n      unregisterGlobalVisualOfApplet(Visual.Applet,Visual)\n    }\n\n    InternalsOfVisual(Visual.Applet).ReactivityContext\n      ?.unregisterReactiveFunctionsOfVisual(Visual)\n\n    if (recursively) {\n      filtered(Visual.Peer.children,'.WAT.Card,.WAT.Overlay,.WAT.Compound,.WAT.Control').forEach(\n        (Peer) => { releaseVisual(VisualOfElement(Peer as HTMLElement),recursively) }\n      )\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                                 WAT_Visual                                 //\n//----------------------------------------------------------------------------//\n\n  export abstract class WAT_Visual {\n  /**** uniqueId ****/\n\n    get uniqueId () { return InternalsOfVisual(this).uniqueId }\n\n    set uniqueId (newId:number) {\n      expectOrdinal('new unique id',newId)\n\n      let uniqueId = InternalsOfVisual(this).uniqueId\n      switch (true) {\n        case (newId === uniqueId):\n          return\n        case (newId > uniqueIdCounter): throwError(\n          'InvalidArgument: forbidden id value given'\n        )\n        case (VisualRegistry[newId] != null): throwError(\n          'InvalidArgument: the given id is not unique'\n        )\n      }\n\n      delete VisualRegistry[uniqueId]\n      VisualRegistry[newId] = this\n\n      InternalsOfVisual(this).uniqueId = newId\n    }\n\n  /**** Peer ****/\n\n    get Peer () { return InternalsOfVisual(this).Peer }\n    set Peer (newPeer:any) { throwReadOnlyError('Peer') }\n\n  /**** isAttached ****/\n\n    get isAttached () {\n      return document.body.contains( InternalsOfVisual(this).Peer )\n    }\n\n    set isAttached (newAttachment:any) { throwReadOnlyError('isAttached') }\n\n  /**** Id ****/\n\n    get Id () {\n      let Candidate = attr(PeerOfVisual(this),'id')\n      return (ValueIsId(Candidate) ? Candidate : undefined)\n    }\n\n    set Id (newId:string | undefined) {\n      allowId('id',newId)\n\n      let Peer = PeerOfVisual(this)\n\n      let oldId = attr(Peer,'id')\n      if (newId == oldId) { return }\n\n      if (newId == null) {\n        attr(Peer,'id',undefined)\n      } else {\n        if (document.getElementById(newId) == null) {\n          attr(Peer,'id',newId)\n        } else {\n          throwError('InvalidArgument: the given HTML id is not unique')\n        }\n      }\n    }\n\n  /**** Name ****/\n\n    get Name () {\n      let Candidate = data(PeerOfVisual(this),'wat-name')\n      return (ValueIsUniversalName(Candidate) ? Candidate : undefined)\n    }\n\n    set Name (newName:string) {\n      allowUniversalName('name',newName)\n\n      let Peer = PeerOfVisual(this)\n\n      let oldName = data(Peer,'wat-name')\n      if (newName == oldName) { return }\n\n      let Applet = this.Applet\n\n      if (oldName.startsWith('#')) {\n        unregisterGlobalVisualOfApplet(Applet,oldName)\n        InternalsOfVisual(this.Applet)?.ReactivityContext\n          ?.clearReactiveVariable(oldName)\n      }\n\n      data(Peer,'wat-name',newName || undefined)\n      if (newName.startsWith('#')) {\n        registerGlobalVisualOfApplet(Applet,this)\n        InternalsOfVisual(this.Applet)?.ReactivityContext\n          ?.setReactiveVariable(newName,this.Value)\n      }\n    }\n\n  /**** Label ****/\n\n    get Label () {\n      let Candidate = data(PeerOfVisual(this),'wat-label')\n      return (ValueIsLabel(Candidate) ? Candidate : undefined)\n    }\n\n    set Label (newLabel:WAT_Label) {\n      allowLabel('label',newLabel)\n      data(PeerOfVisual(this),'wat-label',newLabel || undefined)\n    }\n\n  /**** Category ****/\n\n    get Category () {\n      let Peer = PeerOfVisual(this)\n      switch (true) {\n        case Peer.classList.contains('Applet'):   return 'Applet'\n        case Peer.classList.contains('Card'):     return 'Card'\n        case Peer.classList.contains('Overlay'):  return 'Overlay'\n        case Peer.classList.contains('Control'):  return 'Control'\n        case Peer.classList.contains('Compound'): return 'Compound'\n        default: throwError(\n          'BrokenVisual: cannot determine category of given visual'\n        )\n      }\n    }\n    set Category (newCategory:any) { throwReadOnlyError('Category') }\n\n  /**** Master ****/\n\n    get Master () {\n      let Peer = PeerOfVisual(this)\n\n      let Master = data(Peer,'wat-master')\n      if (ValueIsName(Master)) {\n        return Master             // independent of whether master exists or not\n      } else {\n        throwError('InvalidVisual: the given visual does not have a master')\n      }\n    }\n    set Master (newMaster:any) {\n      allowName('master',newMaster)\n\n      if (newMaster == null) {\n        newMaster = 'plain' + this.Category\n      } else {\n        let MasterInfo = MasterRegistry[newMaster]\n        if ((MasterInfo != null) && (MasterInfo.Category !== this.Category)) throwError(\n          'InvalidArgument: the given master is not made for visuals of type ' +\n          quoted(this.Category)\n        )\n      }\n\n      let Peer = PeerOfVisual(this)\n\n      let oldMaster = data(Peer,'wat-master')\n      if (newMaster == oldMaster) { return }\n\n      data(Peer,'wat-master',newMaster)\n      refreshVisual(this)\n    }\n\n  /**** ErrorInfo ****/\n\n    get ErrorInfo () { return ErrorInfoOfVisual(this) }\n    set ErrorInfo (newErrorInfo:any) { throwReadOnlyError('ErrorInfo') }\n\n  /**** Container ****/\n\n    get Container () {\n      let ContainerPeer = closestParent(\n        PeerOfVisual(this), '.WAT.Card,.WAT.Overlay,.WAT.Compound'\n      )\n      return (\n        ContainerPeer == null\n        ? undefined\n        : VisualOfElement(ContainerPeer)\n      )\n    }\n    set Container (newContainer:any) { throwReadOnlyError('Container') }\n\n  /**** Layer ****/\n\n    get Layer () {\n      let LayerPeer = PeerOfVisual(this).closest('.WAT.Card,.WAT.Overlay') // no typo!\n      return (\n        LayerPeer == null\n        ? undefined\n        : VisualOfElement(LayerPeer as HTMLElement)\n      )\n    }\n    set Layer (newLayer:any) { throwReadOnlyError('Layer') }\n\n  /**** Applet ****/\n\n    get Applet () {\n      let AppletPeer = PeerOfVisual(this).closest('.WAT.Applet')     // no typo!\n      return (\n        AppletPeer == null\n        ? undefined\n        : VisualOfElement(AppletPeer as HTMLElement)\n      )\n    }\n    set Applet (newApplet:any) { throwReadOnlyError('Applet') }\n\n  /**** mayBeDesigned ****/\n\n    get mayBeDesigned () {\n      return (this.Peer.data('wat-designability') !== 'false')\n    }\n\n    set mayBeDesigned (newDesignability:boolean) {\n      expectBoolean('designability',newDesignability)\n      this.Peer.data(\n        'wat-designability', newDesignability === false ? 'false' : null\n      )\n    }\n\n  /**** mayBeDeleted ****/\n\n    get mayBeDeleted () {\n      return (this.Peer.data('wat-deletability') !== 'false')\n    }\n\n    set mayBeDeleted (newDeletability:boolean) {\n      expectBoolean('deletability',newDeletability)\n      this.Peer.data(\n        'wat-deletability', newDeletability === false ? 'false' : null\n      )\n    }\n\n  /**** isVisible ****/\n\n    get isVisible () {\n      return (css(this.Peer,'visibility') !== 'hidden')\n    }\n\n    set isVisible (newVisibility:boolean) {\n      expectBoolean('visibility',newVisibility)\n      applyStyleToVisual(\n        this, 'visibility', newVisibility === true ? 'visible' : 'hidden'\n      )\n    }\n\n  /**** isShown ****/\n\n    get isShown () {\n      let Peer = this.Peer\n      if (! document.body.contains(Peer)) { return false }\n\n      while (Peer !== document.body) {\n        if (\n          (css(Peer,'display')    === 'none') ||\n          (css(Peer,'visibility') === 'hidden')\n        ) { return false }\n\n        Peer = Peer.parentElement\n      }\n      return true\n    }\n\n    set isShown (newEmergence:any) { throwReadOnlyError('isShown') }\n\n  /**** show/hide ****/\n\n    public show () { this.isVisible = true }\n    public hide () { this.isVisible = false }\n\n  /**** isEnabled ****/\n\n    get isEnabled () {\n      return ! this.Peer.disabled\n    }\n\n    set isEnabled (newEnabling:boolean) {\n      expectBoolean('enabling',newEnabling)\n      this.Peer.disabled = ! newEnabling\n    }\n\n  /**** isDisabled ****/\n\n    get isDisabled () {\n      return this.Peer.disabled\n    }\n\n    set isDisabled (newDisabling:boolean) {\n      expectBoolean('disabling',newDisabling)\n      this.Peer.disabled = newDisabling\n    }\n\n  /**** enable/disable ****/\n\n    public enable ()  { this.isEnabled = false }\n    public disable () { this.isEnabled = true }\n\n  /**** PropertySet ****/\n\n    get PropertySet () {\n      let PropertySet = Object.create(null)\n        let MasterInfo = MasterRegistry[this.Master]\n        if (MasterInfo == null) { return PropertySet }\n\n        let Properties = MasterInfo.Properties\n        if (Properties == null) { return PropertySet }\n\n        for (let i = 0, l = Properties.length; i < l; i++) {\n          let Property = Properties[i]\n          PropertySet[Property.Identifier] = Object.assign(Object.create(null),Property)\n          if (Property.ValueList != null) {\n            PropertySet[Property.Identifier].ValueList = Property.ValueList.slice()\n          }\n        }\n      return PropertySet\n    }\n\n    set PropertySet (newPropertySet:any) { throwReadOnlyError('PropertySet') }\n\n  /**** PropertyMayBeDesigned - a method especially for the Designer ****/\n\n    public PropertyMayBeDesigned (PropertyName:WAT_Identifier):boolean {\n      expectIdentifier('property name',PropertyName)\n\n      let MasterInfo = MasterRegistry[this.Master]\n      return (\n        (MasterInfo?.undesignablePropertySet == null) ||\n        ! (PropertyName in MasterInfo.undesignablePropertySet)\n      )\n    }\n\n  /**** State ****/\n\n    get State () { return InternalsOfVisual(this).State }\n    set State (newState:any) {\n      if (newState == null) {\n        delete InternalsOfVisual(this).State\n      } else {\n        InternalsOfVisual(this).State = newState\n      }\n    }\n\n  /**** Value (default implementation, may be overwritten) ****/\n\n    get Value () {\n      let State = InternalsOfVisual(this).State\n      return (State == null ? undefined : State.Value)\n    }\n\n    set Value (newValue:any) {\n      let State = InternalsOfVisual(this).State\n      if (newValue == null) {\n        if (State != null) {\n          delete State.Value\n        }\n      } else {\n        if (State == null) {\n          State = InternalsOfVisual(this).State = {}\n        }\n        State.Value = newValue\n      }\n\n      this.trigger('value-changed', newValue)// finally also triggers reactivity\n    }\n\n  /**** Script ****/\n\n    get Script () { return this.Peer.data('wat-script') }\n    set Script (newScript:any) { throwReadOnlyError('Script') }\n\n  /**** pendingScript ****/\n\n    get pendingScript () { return this.Peer.data('wat-pending-script') }\n    set pendingScript (newPendingScript:WAT_Text) {\n      allowText('script',newPendingScript)\n\n      this.Peer.data(\n        'wat-pending-script', (newPendingScript || '').trim() === '' ? null : newPendingScript\n      )\n    }\n\n  /**** activatePendingScript ****/\n\n    public activatePendingScript () {\n      this.clearPendingScriptError()\n\n      let Internals = InternalsOfVisual(this)\n\n      let pendingScript = this.pendingScript\n      if (pendingScript == null) {\n        if ((this.Script || '').trim() !== '') {\n          this.Peer.data('wat-script',null)\n          refreshVisual(this)         // serialization still done by old script!\n        }\n      } else {\n        let pendingScriptError\n        try {                       // just compile in order to check for errors\n          let compiledScript = new Function(\n            'toGet','toSet','on','off','trigger','$', pendingScript\n          )\n        } catch (Signal) {\n          pendingScriptError = {\n            Title:       'Compilation Error',\n            longMessage: 'pending visual script could not be compiled',\n            shortMessage:Signal.message,\n            Reason:      Signal,\n            Applet:      this.Applet,\n            Sufferer:    this,\n            Property:    'pendingScript'\n          }\n\n          Internals.pendingScriptError = pendingScriptError\n        }\n\n        if (pendingScriptError == null) {\n          this.Peer.data('wat-script',pendingScript)\n          this.Peer.data('wat-pending-script',null)\n\n          refreshVisual(this)         // serialization still done by old script!\n        }\n      }\n    }\n\n  /**** activeScript ****/\n\n    get pendingScriptError () { return InternalsOfVisual(this).pendingScriptError }\n    set pendingScriptError (newError:any) { throwReadOnlyError('pendingScriptError') }\n\n  /**** clearPendingScriptError ****/\n\n    public clearPendingScriptError () {\n      delete InternalsOfVisual(this).pendingScriptError\n    }\n\n  /**** Classes ****/\n\n    get Classes () {\n      let ClassNameList = this.Peer.classList.slice()\n      return ClassNameList.sort().join(' ')\n    }\n\n    set Classes (newClasses:string) {\n      allowString('class list',newClasses)  // a better test follows in a moment\n\n      let newClassNameList = newClasses.trim().replace(/\\s+/g,' ').split(' ')\n        for (let i = 0, l = newClassNameList.length; i < l; i++) {\n          let ClassName = newClassNameList[i]\n          if (! ValueIsName(ClassName)) {\n            throwError('InvalidArgument: invalid class name ' + quoted(ClassName) + ' given')\n          }\n        }\n      let ClassNameSet = KeySetOf(newClassNameList)\n        ClassNameSet['WAT'] = true\n        ClassNameSet[this.Category] = true\n\n        let MasterInfo = MasterRegistry[this.Master]\n        if (MasterInfo?.Classes != null) {\n          MasterInfo.Classes.forEach((ClassName) => ClassNameSet[ClassName] = true)\n        }\n      let ClassNameList = []\n        for (let ClassName in ClassNameSet) {\n          ClassNameList.push(ClassName)\n        }\n      this.Peer.className = ClassNameList.join(' ')\n    }\n\n  /**** TabIndex ****/\n\n    get TabIndex () {\n      let rawValue = attr(this.Peer,'tabindex')\n      return (rawValue == null ? undefined : parseInt(rawValue,10))\n    }\n\n    set TabIndex (newTabIndex:number | undefined) {\n      allowIntegerInRange('tab index',newTabIndex, -1,32767)\n      attr(this.Peer, 'tabindex', newTabIndex + '')\n    }\n\n  /**** PointerSensitivity ****/\n\n    get PointerSensitivity () {\n      return (css(this.Peer,'pointer-events') !== 'none')\n    }\n\n    set PointerSensitivity (newPointerSensitivity:boolean) {\n      expectBoolean('pointer sensitivity',newPointerSensitivity)\n\n      applyStyleToVisual(this, 'pointer-events', (\n        newPointerSensitivity === true ? 'auto' : 'none'\n      ))\n    }\n\n  /**** Overflows ****/\n\n    get Overflows () {\n      function normalizedOverflow (Overflow:string):WAT_Overflow {\n        switch (Overflow) {\n          case 'visible':  case 'hidden':\n          case 'scroll':   case 'auto':\n            return Overflow\n          case 'clip':\n            return 'hidden'\n          case 'overlay':\n          default:\n            return 'auto'\n        }\n      }\n\n      let Overflows = css(this.Peer,'overflow').split(' ')\n        let horizontalOverflow = normalizedOverflow(Overflows[0])\n        let verticalOverflow   = normalizedOverflow(Overflows[1] || horizontalOverflow)\n      return [horizontalOverflow,verticalOverflow]\n    }\n\n    set Overflows (newOverflows:WAT_Overflow[]) {\n      allowArray('list of overflow settings',newOverflows)\n      if (newOverflows != null) {\n        expectOneOf('horizontal overflow',newOverflows[0], WAT_Overflows)\n        expectOneOf  ('vertical overflow',newOverflows[1], WAT_Overflows)\n      }\n\n      if (newOverflows == null) {\n        applyStyleToVisual(this, 'overflow',null)\n      } else {\n        applyStyleToVisual(this, 'overflow',newOverflows.join(' '))\n      }\n    }\n\n  /**** TextOverflow ****/\n\n    get TextOverflow () {\n      return (css(this.Peer,'text-overflow') === 'clip' ? 'clip' : 'ellipsis')\n    }\n\n    set TextOverflow (newTextOverflow:WAT_TextOverflow) {\n      allowOneOf('text overflow',newTextOverflow, WAT_TextOverflows)\n      applyStyleToVisual(this, 'text-overflow',newTextOverflow)\n    }\n\n  /**** Opacity ****/\n\n    get Opacity () {\n      return Math.round(100 * parseFloat(css(this.Peer,'opacity')))\n    }\n\n    set Opacity (newOpacity:number) {\n      allowNumberInRange('opacity',newOpacity, 0,1)\n      applyStyleToVisual(this, 'opacity', Math.round(newOpacity) + '%')\n    }\n\n  /**** x ****/\n\n    get x () { return GeometryOfVisual(this).x }\n    set x (newX:WAT_Location) {\n      expectLocation('x coordinate',newX)\n      changeGeometryOfVisualTo(this, newX,undefined, undefined,undefined)\n    }\n\n  /**** y ****/\n\n    get y () { return GeometryOfVisual(this).y }\n    set y (newY:WAT_Location) {\n      expectLocation('y coordinate',newY)\n      changeGeometryOfVisualTo(this, undefined,newY, undefined,undefined)\n    }\n\n  /**** Width ****/\n\n    get Width () { return GeometryOfVisual(this).Width }\n    set Width (newWidth:WAT_Dimension) {\n      expectDimension('width',newWidth)\n      changeGeometryOfVisualTo(this, undefined,undefined, newWidth,undefined)\n    }\n\n  /**** Height ****/\n\n    get Height () { return GeometryOfVisual(this).Height }\n    set Height (newHeight:WAT_Dimension) {\n      expectDimension('height',newHeight)\n      changeGeometryOfVisualTo(this, undefined,undefined, undefined,newHeight)\n    }\n\n  /**** Position ****/\n\n    get Position () {\n      let Geometry = GeometryOfVisual(this)\n      return { x:Geometry.x, y:Geometry.y }\n    }\n    set Position (newPosition:WAT_Position) {\n      expectPlainObject('position',newPosition)\n        expectLocation('x coordinate',newPosition.x)\n        expectLocation('y coordinate',newPosition.y)\n      changeGeometryOfVisualTo(this, newPosition.x,newPosition.y, undefined,undefined)\n    }\n\n  /**** Size ****/\n\n    get Size () {\n      let Geometry = GeometryOfVisual(this)\n      return { Width:Geometry.Width, Height:Geometry.Height }\n    }\n    set Size (newSize:WAT_Size) {\n      expectPlainObject('size',newSize)\n        expectDimension ('width',newSize.Width)\n        expectDimension('height',newSize.Height)\n      changeGeometryOfVisualTo(this, undefined,undefined, newSize.Width,newSize.Height)\n    }\n\n  /**** Geometry ****/\n\n    get Geometry () { return GeometryOfVisual(this) }\n    set Geometry (newGeometry:WAT_Geometry) {\n      expectObject('visual geometry',newGeometry)\n        expectLocation('x coordinate',newGeometry.x)\n        expectLocation('y coordinate',newGeometry.y)\n        expectDimension      ('width',newGeometry.Width)\n        expectDimension     ('height',newGeometry.Height)\n      changeGeometryOfVisualTo(\n        this, newGeometry.x,newGeometry.y, newGeometry.Width,newGeometry.Height\n      )\n    }\n\n  /**** GeometryOnDisplay ****/\n\n    get GeometryOnDisplay () { return GeometryOfVisualOnDisplay(this) }\n    set GeometryOnDisplay (newGeometry:any) { throwReadOnlyError('GeometryOnDisplay') }\n\n  /**** horizontalAnchoring ****/\n\n    get horizontalAnchoring () { return horizontalAnchoringOfVisual(this) }\n    set horizontalAnchoring (newAnchoring:WAT_horizontalAnchoring) {\n      expectOneOf('horizontal anchoring',newAnchoring, WAT_horizontalAnchorings)\n      changeHorizontalAnchoringOfVisualTo(this, newAnchoring)\n    }\n\n  /**** verticalAnchoring ****/\n\n    get verticalAnchoring () { return verticalAnchoringOfVisual(this) }\n    set verticalAnchoring (newAnchoring:WAT_verticalAnchoring) {\n      expectOneOf('vertical anchoring',newAnchoring, WAT_verticalAnchorings)\n      changeVerticalAnchoringOfVisualTo(this, newAnchoring)\n    }\n\n  /**** horizontalOffsets ****/\n\n    get horizontalOffsets () { return horizontalOffsetsOfVisual(this) }\n    set horizontalOffsets (newOffsets:WAT_horizontalOffsets) {\n      switch (horizontalAnchoringOfVisual(this)) {\n        case 'left-width':\n          allowLocation  ('\"left\" offset',newOffsets[0])\n          allowDimension('\"width\" offset',newOffsets[1])\n          break\n        case 'width-right':\n          allowDimension('\"width\" offset',newOffsets[0])\n          allowLocation ('\"right\" offset',newOffsets[1])\n          break\n        case 'left-right':\n          allowLocation ('\"left\" offset',newOffsets[0])\n          allowLocation('\"right\" offset',newOffsets[1])\n      }\n\n      changeHorizontalOffsetsOfVisualTo(this, newOffsets)\n    }\n\n  /**** verticalOffsets ****/\n\n    get verticalOffsets () { return verticalOffsetsOfVisual(this) }\n    set verticalOffsets (newOffsets:WAT_verticalOffsets) {\n      switch (verticalAnchoringOfVisual(this)) {\n        case 'top-height':\n          allowLocation    ('\"top\" offset',newOffsets[0])\n          allowDimension('\"height\" offset',newOffsets[1])\n          break\n        case 'height-bottom':\n          allowDimension('\"height\" offset',newOffsets[0])\n          allowLocation ('\"bottom\" offset',newOffsets[1])\n          break\n        case 'top-bottom':\n          allowLocation   ('\"top\" offset',newOffsets[0])\n          allowLocation('\"bottom\" offset',newOffsets[1])\n      }\n\n      changeVerticalOffsetsOfVisualTo(this, newOffsets)\n    }\n\n  /**** min/maxWidth ****/\n\n    get minWidth () {\n      return parseFloat(css(this.Peer,'min-width'))\n    }\n\n    set minWidth (newMinimum:WAT_Dimension) {\n      allowDimension('minimal width',newMinimum)\n      applyStyleToVisual(this, 'min-width', Math.round(newMinimum) + 'px')\n    }\n\n    get maxWidth () {\n      let maxWidth = css(this.Peer,'max-width')\n      return (maxWidth === 'none' ? Infinity : parseFloat(maxWidth))\n    }\n\n    set maxWidth (newMaximum:WAT_Dimension) {\n      allowDimension('maximal width',newMaximum)\n      if (newMaximum === Infinity) {\n        applyStyleToVisual(this, 'max-width','none')\n      } else {\n        applyStyleToVisual(this, 'max-width',Math.round(newMaximum) + 'px')\n      }\n    }\n\n  /**** min/maxHeight ****/\n\n    get minHeight () {\n      return parseFloat(css(this.Peer,'min-height'))\n    }\n\n    set minHeight (newMinimum:WAT_Dimension) {\n      allowDimension('minimal height',newMinimum)\n      applyStyleToVisual(this, 'min-height', Math.round(newMinimum) + 'px')\n    }\n\n    get maxHeight () {\n      let maxHeight = css(this.Peer,'max-height')\n      return (maxHeight === 'none' ? Infinity : parseFloat(maxHeight))\n    }\n\n    set maxHeight (newMaximum:WAT_Dimension) {\n      allowDimension('maximal height',newMaximum)\n      if (newMaximum === Infinity) {\n        applyStyleToVisual(this, 'max-height','none')\n      } else {\n        applyStyleToVisual(this, 'max-height',Math.round(newMaximum) + 'px')\n      }\n    }\n\n  /**** coversPointOnDisplay ****/\n\n    public coversPointOnDisplay (\n      xOnDisplay:WAT_Location, yOnDisplay:WAT_Location\n    ):boolean {\n      expectLocation('x coordinate',xOnDisplay)\n      expectLocation('y coordinate',yOnDisplay)\n\n      let GeometryOnDisplay = this.GeometryOnDisplay\n      return (\n        (xOnDisplay >= GeometryOnDisplay.x) &&\n        (xOnDisplay <  GeometryOnDisplay.x + GeometryOnDisplay.Width) &&\n        (yOnDisplay >= GeometryOnDisplay.y) &&\n        (yOnDisplay <  GeometryOnDisplay.y + GeometryOnDisplay.Height)\n      )\n    }\n\n  /**** FontFamily ****/\n\n    get FontFamily () {\n      return css(this.Peer,'font-family')\n    }\n\n    set FontFamily (newFontFamily:WAT_Textline) {\n      allowTextline('font family',newFontFamily)\n      applyStyleToVisual(this, 'font-family',newFontFamily)\n    }\n\n  /**** FontSize ****/\n\n    get FontSize () {\n      return parseFloat(css(this.Peer,'font-size'))\n    }\n\n    set FontSize (newFontSize:WAT_Dimension) {\n      allowDimension('font size',newFontSize)\n\n      applyStyleToVisual(\n        this, 'font-size', newFontSize == null ? null : Math.round(newFontSize) + 'px'\n      )\n    }\n\n  /**** FontWeight ****/\n\n    get FontWeight () {\n      let FontWeight = css(this.Peer,'font-weight')\n      switch (FontWeight) {\n        case 'lighter':  case 'normal':\n        case 'bolder':   case 'bold':\n          return FontWeight\n        default:\n          let BoldnessIndex = Math.max(1, Math.min(9,\n            Math.round(parseFloat(FontWeight)/100)\n          ))-1\n          return WAT_FontWeights[BoldnessIndex]\n      }\n    }\n\n    set FontWeight (newFontWeight:WAT_FontWeight) {\n      allowOneOf('font weight',newFontWeight, WAT_FontWeights)\n\n      switch (newFontWeight) {\n        case null: case undefined:\n          applyStyleToVisual(this, 'font-weight',null)\n          break\n        case 'lighter':  case 'normal':\n        case 'bolder':   case 'bold':\n          applyStyleToVisual(this, 'font-weight',newFontWeight)\n          break\n        default:\n          applyStyleToVisual(\n            this, 'font-weight',WAT_FontWeightValues[newFontWeight]\n          )\n      }\n    }\n\n  /**** FontStyle ****/\n\n    get FontStyle () {\n      let FontStyle = css(this.Peer,'font-style')\n      switch (FontStyle) {\n        case 'normal':\n        case 'italic':\n          return FontStyle\n        default:\n          return (FontStyle.startsWith('oblique') ? 'italic' : 'normal')\n      }\n    }\n\n    set FontStyle (newFontStyle:WAT_FontStyle) {\n      allowOneOf('font weight',newFontStyle, WAT_FontStyles)\n      applyStyleToVisual(this, 'font-style', newFontStyle)\n    }\n\n  /**** LineHeight ****/\n\n    get LineHeight () {\n      let LineHeight = css(this.Peer,'line-height')\n      switch (true) {\n        case (LineHeight === 'normal'):\n          return Math.round(this.FontSize * 1.5)\n        case (LineHeight.indexOf('%') > 0):\n          return Math.round(this.FontSize * 100*parseFloat(LineHeight))\n        default:\n          return parseFloat(LineHeight)\n      }\n    }\n\n    set LineHeight (newLineHeight:WAT_Dimension) {\n      allowDimension('line height',newLineHeight)\n\n      applyStyleToVisual(\n        this, 'line-height', newLineHeight == null ? null : Math.round(newLineHeight) + 'px'\n      )\n    }\n\n  /**** TextDecoration ****/\n\n    get TextDecoration () {\n      let {\n        textDecorationColor, textDecorationLine, textDecorationStyle,\n// @ts-ignore\n        textDecorationThickness\n      } = window.getComputedStyle(this.Peer)\n\n      if (\n        (textDecorationLine === 'none') ||\n        ! ValueIsOneOf(textDecorationLine, WAT_TextDecorationLines)\n      ) {\n        return { Line:'none' }\n      } else {\n        let Thickness = parseFloat(textDecorationThickness)\n\n        return {\n          Line:  textDecorationLine,\n          Color: HexColor(textDecorationColor || '#000000'),\n          Style: ValueIsOneOf(textDecorationStyle, WAT_TextDecorationStyles) ? textDecorationStyle : 'solid',\n          Thickness: isNaN(Thickness) ? 1 : Math.round(Thickness)\n        }\n      }\n    }\n\n    set TextDecoration (newTextDecoration:WAT_TextDecoration) {\n      allowPlainObject('text decoration',newTextDecoration)\n      if (newTextDecoration != null) {\n        expectOneOf       ('text decoration shape',newTextDecoration.Line, WAT_TextDecorationLines)\n        allowColor        ('text decoration color',newTextDecoration.Color)\n        expectOneOf       ('text decoration style',newTextDecoration.Style, WAT_TextDecorationStyles)\n        allowDimension('text decoration thickness',newTextDecoration.Thickness)\n      }\n\n      if (newTextDecoration == null) {\n        applyStylesToVisual(this, {\n          'text-decoration-color':    undefined,\n          'text-decoration-line':     undefined,\n          'text-decoration-style':    undefined,\n          'text-decoration-thickness':undefined\n        })\n      } else {\n        if (newTextDecoration.Line === 'none') {\n          applyStyleToVisual(this, 'text-decoration-line','none')\n        } else {\n          applyStylesToVisual(this, {\n            'text-decoration-color': (\n              newTextDecoration.Color == null\n              ? 'currentColor'\n              : shortHexColor(HexColor(newTextDecoration.Color))\n            ),\n            'text-decoration-line':  newTextDecoration.Line,\n            'text-decoration-style': newTextDecoration.Style,\n            'text-decoration-thickness': (\n              newTextDecoration.Thickness == null\n              ? 'from-font'\n              : Math.round(newTextDecoration.Thickness) + 'px'\n            )\n          })\n        }\n      }\n    }\n\n  /**** TextShadow ****/\n\n    get TextShadow () {\n      let TextShadow = css(this.Peer,'text-shadow')\n      if (TextShadow === 'none') {\n        return { xOffset:0, yOffset:0, BlurRadius:0, Color:'#00000000' }\n      } else {\n        TextShadow = TextShadow.replace(/,.*$/,'').split(' ')\n        return {\n          xOffset:   parseFloat(TextShadow[0]),\n          yOffset:   parseFloat(TextShadow[1]),\n          BlurRadius:parseFloat(TextShadow[2]),\n          Color:     HexColor(TextShadow[3])\n        }\n      }\n    }\n\n    set TextShadow (newTextShadow:WAT_TextShadow) {\n      allowPlainObject('text shadow',newTextShadow)\n      if (newTextShadow != null) {\n        expectLocation    ('text shadow x offset',newTextShadow.xOffset)\n        expectLocation    ('text shadow y offset',newTextShadow.yOffset)\n        expectDimension('text shadow blur radius',newTextShadow.BlurRadius)\n        expectColor          ('text shadow color',newTextShadow.Color)\n      }\n\n      if (newTextShadow == null) {\n        applyStyleToVisual(this, 'text-shadow',null)\n      } else {\n        let Color = HexColor(newTextShadow.Color)\n        if (Color === '#00000000') {\n          applyStyleToVisual(this, 'text-shadow','none')\n        } else {\n          applyStyleToVisual(this, 'text-shadow',\n            Math.round(newTextShadow.xOffset) + 'px ' +\n            Math.round(newTextShadow.yOffset) + 'px ' +\n            Math.round(newTextShadow.BlurRadius) + 'px ' +\n            shortHexColor(Color)\n          )\n        }\n      }\n    }\n\n  /**** TextAlignment ****/\n\n    get TextAlignment () {\n      return css(this.Peer,'text-align')\n    }\n\n    set TextAlignment (newTextAlignment:WAT_TextAlignment) {\n      allowOneOf('text alignment',newTextAlignment, WAT_TextAlignments)\n      applyStyleToVisual(this, 'text-align', newTextAlignment)\n    }\n\n  /**** ForegroundColor ****/\n\n    get ForegroundColor () {\n      return HexColor(css(this.Peer,'color'))\n    }\n\n    set ForegroundColor (newColor:WAT_Color) {\n      allowColor('foreground color',newColor)\n\n      applyStyleToVisual(\n        this, 'color', newColor == null ? null : HexColor(newColor)\n      )\n    }\n\n  /**** Color (just a synonym for \"ForegroundColor\") ****/\n\n    get Color () { return this.ForegroundColor }\n    set Color (newColor:WAT_Color) { this.ForegroundColor = newColor }\n\n  /**** BackgroundColor ****/\n\n    get BackgroundColor () {\n      return HexColor(css(this.Peer,'background-color'))\n    }\n\n    set BackgroundColor (newColor:WAT_Color) {\n      allowColor('background color',newColor)\n\n      applyStyleToVisual(\n        this, 'background-color', newColor == null ? null : HexColor(newColor)\n      )\n    }\n\n  /**** BackgroundTexture ****/\n\n    get BackgroundTexture () {\n      let {\n        backgroundImage, backgroundPosition, backgroundSize, backgroundRepeat\n      } = window.getComputedStyle(this.Peer)\n\n      let Result = { ImageURL:'', Mode:'normal', xOffset:0, yOffset:0 }\n        if (backgroundImage !== 'none') {\n          Result.ImageURL = backgroundImage.slice(5,backgroundImage.length-2)\n        }\n\n        let Positions = backgroundPosition.split(' ')\n        if (Positions[0].endsWith('px')) { Result.xOffset = Math.round(parseFloat(Positions[0])) }\n        if (Positions[1].endsWith('px')) { Result.yOffset = Math.round(parseFloat(Positions[1])) }\n\n        if (backgroundRepeat === 'no-repeat') {\n          switch (backgroundSize) {\n            case 'contain':\n            case 'cover':     Result.Mode = backgroundSize; break\n            case '100% 100%': Result.Mode = 'fill';         break\n          }\n        } else {\n          Result.Mode = 'tile'\n        }\n      return Result\n    }\n\n    set BackgroundTexture (newTexture:WAT_BackgroundTexture) {\n      allowPlainObject('background texture',newTexture)\n      if (newTexture != null) {\n        expectURL          ('background image url',newTexture.ImageURL)\n        expectOneOf       ('background image mode',newTexture.Mode, WAT_BackgroundModes)\n        expectLocation('background image x offset',newTexture.xOffset)\n        expectLocation('background image y offset',newTexture.yOffset)\n      }\n\n      if (newTexture == null) {\n        applyStylesToVisual(this, {\n          'background-image':undefined, 'background-position':undefined,\n          'background-size':undefined,  'background-repeat':undefined\n        })\n      } else {\n        let BackgroundSize\n          switch (newTexture.Mode) {\n            case 'contain':\n            case 'cover':   BackgroundSize = newTexture.Mode; break\n            case 'fill':    BackgroundSize = '100% 100%';     break\n            case 'tile':    BackgroundSize = 'auto auto';     break\n          }\n        applyStylesToVisual(this, {\n          'background-image':    'url(\"' + newTexture.ImageURL + '\")',\n          'background-position': Math.round(newTexture.xOffset) + 'px ' + Math.round(newTexture.yOffset) + 'px',\n          'background-size':     BackgroundSize,\n          'background-repeat':   newTexture.Mode === 'tile' ? 'repeat' : 'no-repeat'\n        })\n      }\n    }\n\n  /**** BorderWidths ****/\n\n    get BorderWidths () {\n      let Peer = this.Peer\n      return [\n        parseFloat(css(Peer,'border-top-width')),\n        parseFloat(css(Peer,'border-right-width')),\n        parseFloat(css(Peer,'border-bottom-width')),\n        parseFloat(css(Peer,'border-left-width'))\n      ]\n    }\n\n    set BorderWidths (newBorderWidths:WAT_Dimension[]) {\n      allowArray('list of border widths',newBorderWidths)\n      if (newBorderWidths != null) {\n        expectDimension   ('top border width',newBorderWidths[0])\n        expectDimension ('right border width',newBorderWidths[1])\n        expectDimension('bottom border width',newBorderWidths[2])\n        expectDimension  ('left border width',newBorderWidths[3])\n      }\n\n      if (newBorderWidths == null) {\n        applyStylesToVisual(this, {\n          'border-top-width':    undefined,\n          'border-right-width':  undefined,\n          'border-bottom-width': undefined,\n          'border-left-width':   undefined\n        })\n      } else {\n        applyStylesToVisual(this, {\n          'border-top-width':    Math.round(newBorderWidths[0]) + 'px',\n          'border-right-width':  Math.round(newBorderWidths[1]) + 'px',\n          'border-bottom-width': Math.round(newBorderWidths[2]) + 'px',\n          'border-left-width':   Math.round(newBorderWidths[3]) + 'px'\n        })\n      }\n    }\n\n  /**** BorderColors ****/\n\n    get BorderColors () {\n      let Peer = this.Peer\n      return [\n        HexColor(css(Peer,'border-top-color')),\n        HexColor(css(Peer,'border-right-color')),\n        HexColor(css(Peer,'border-bottom-color')),\n        HexColor(css(Peer,'border-left-color'))\n      ]\n    }\n\n    set BorderColors (newBorderColors:WAT_Color[]) {\n      allowArray('list of border colors',newBorderColors)\n      if (newBorderColors != null) {\n        expectColor   ('top border color',newBorderColors[0])\n        expectColor ('right border color',newBorderColors[1])\n        expectColor('bottom border color',newBorderColors[2])\n        expectColor  ('left border color',newBorderColors[3])\n      }\n\n      if (newBorderColors == null) {\n        applyStylesToVisual(this, {\n          'border-top-color':    undefined,\n          'border-right-color':  undefined,\n          'border-bottom-color': undefined,\n          'border-left-color':   undefined\n        })\n      } else {\n        applyStylesToVisual(this, {\n          'border-top-color':    newBorderColors[0],\n          'border-right-color':  newBorderColors[1],\n          'border-bottom-color': newBorderColors[2],\n          'border-left-color':   newBorderColors[3]\n        })\n      }\n    }\n\n  /**** BorderStyles ****/\n\n    get BorderStyles () {\n      function normalizedBorderStyle (Value:any):WAT_BorderStyle {\n        return (ValueIsOneOf(Value,WAT_BorderStyles) ? Value : 'none')\n      }\n\n      let Peer = this.Peer\n      return [\n        normalizedBorderStyle(css(Peer,'border-top-style')),\n        normalizedBorderStyle(css(Peer,'border-right-style')),\n        normalizedBorderStyle(css(Peer,'border-bottom-style')),\n        normalizedBorderStyle(css(Peer,'border-left-style'))\n      ]\n    }\n\n    set BorderStyles (newBorderStyles:WAT_BorderStyle[]) {\n      allowArray('list of border styles',newBorderStyles)\n      if (newBorderStyles != null) {\n        expectOneOf   ('top border style',newBorderStyles[0], WAT_BorderStyles)\n        expectOneOf ('right border style',newBorderStyles[1], WAT_BorderStyles)\n        expectOneOf('bottom border style',newBorderStyles[2], WAT_BorderStyles)\n        expectOneOf  ('left border style',newBorderStyles[3], WAT_BorderStyles)\n      }\n\n      if (newBorderStyles == null) {\n        applyStylesToVisual(this, {\n          'border-top-style':   undefined,\n          'border-right-style': undefined,\n          'border-bottom-style':undefined,\n          'border-left-style':  undefined\n        })\n      } else {\n        applyStylesToVisual(this, {\n          'border-top-style':   newBorderStyles[0],\n          'border-right-style': newBorderStyles[1],\n          'border-bottom-style':newBorderStyles[2],\n          'border-left-style':  newBorderStyles[3]\n        })\n      }\n    }\n\n  /**** BorderRadii ****/\n\n    get BorderRadii () {\n      let Peer = this.Peer\n      return [\n        parseFloat(css(Peer,'border-top-left-radius')),\n        parseFloat(css(Peer,'border-top-right-radius')),\n        parseFloat(css(Peer,'border-bottom-right-radius')),\n        parseFloat(css(Peer,'border-bottom-left-radius'))\n      ]\n    }\n\n    set BorderRadii (newBorderRadii:WAT_Dimension[]) {\n      allowArray('list of border radii',newBorderRadii)\n      if (newBorderRadii != null) {\n        expectDimension    ('top-left border radius',newBorderRadii[0])\n        expectDimension   ('top-right border radius',newBorderRadii[1])\n        expectDimension('bottom-right border radius',newBorderRadii[2])\n        expectDimension ('bottom-left border radius',newBorderRadii[3])\n      }\n\n      if (newBorderRadii == null) {\n        applyStyleToVisual(this, 'border-radius',null)\n      } else {\n        applyStylesToVisual(this, {\n          'border-top-left-radius':     Math.round(newBorderRadii[0]) + 'px',\n          'border-top-right-radius':    Math.round(newBorderRadii[1]) + 'px',\n          'border-bottom-right-radius': Math.round(newBorderRadii[2]) + 'px',\n          'border-bottom-left-radius':  Math.round(newBorderRadii[3]) + 'px'\n        })\n      }\n    }\n\n  /**** BoxShadow ****/\n\n    get BoxShadow () {\n      let BoxShadow = css(this.Peer,'box-shadow')\n      if (BoxShadow === 'none') {\n        return { isInset:false, xOffset:0, yOffset:0, BlurRadius:0, SpreadRadius:0, Color:'#00000000' }\n      } else {\n        BoxShadow = BoxShadow.replace(/,.*$/,'').split(' ')\n\n        let isInset = (BoxShadow[0] === 'inset')\n        if (isInset) { BoxShadow.shift() }\n\n        return {\n          isInset,\n          xOffset:     parseFloat(BoxShadow[0]),\n          yOffset:     parseFloat(BoxShadow[1]),\n          BlurRadius:  parseFloat(BoxShadow[2]),\n          SpreadRadius:parseFloat(BoxShadow[3]),\n          Color:       HexColor(BoxShadow[4])\n        }\n      }\n    }\n\n    set BoxShadow (newBoxShadow:WAT_BoxShadow) {\n      allowPlainObject('box shadow',newBoxShadow)\n      if (newBoxShadow != null) {\n        expectBoolean      ('box shadow direction',newBoxShadow.isInset)\n        expectLocation      ('box shadow x offset',newBoxShadow.xOffset)\n        expectLocation      ('box shadow y offset',newBoxShadow.yOffset)\n        expectDimension  ('box shadow blur radius',newBoxShadow.BlurRadius)\n        expectDimension('box shadow spread radius',newBoxShadow.SpreadRadius)\n        expectColor            ('box shadow color',newBoxShadow.Color)\n      }\n\n      if (newBoxShadow == null) {\n        applyStyleToVisual(this, 'box-shadow',null)\n      } else {\n        if (HexColor(newBoxShadow.Color) === '#00000000') {\n          applyStyleToVisual(this, 'box-shadow','none')\n        } else {\n          applyStyleToVisual(this, 'box-shadow',\n            (newBoxShadow.isInset ? 'inset ' : '') +\n            Math.round(newBoxShadow.xOffset) + 'px ' +\n            Math.round(newBoxShadow.yOffset) + 'px ' +\n            Math.round(newBoxShadow.BlurRadius)   + 'px ' +\n            Math.round(newBoxShadow.SpreadRadius) + 'px ' +\n            shortHexColor(HexColor(newBoxShadow.Color))\n          )\n        }\n      }\n    }\n\n  /**** Cursor ****/\n\n    get Cursor () {\n      let CursorSpec = css(this.Peer,'cursor')\n      return (\n        CursorSpec.indexOf(',') > 0\n        ? CursorSpec.replace(/^.*,\\s*/,'')\n        : CursorSpec\n      )\n    }\n\n    set Cursor (newCursor:WAT_Cursor) {\n      allowOneOf('cursor',newCursor, WAT_Cursors)\n\n      if (newCursor == null) {\n        applyStyleToVisual(this, 'cursor',null)// also clears any \"customCursor\"\n      } else {\n        let CursorSpec = css(this.Peer,'cursor')\n        let Prefix = (\n          CursorSpec.indexOf(',') > 0\n          ? CursorSpec.replace(/,[^,]+$/,', ')\n          : ''\n        )\n\n        applyStyleToVisual(this, 'cursor',Prefix + newCursor)\n      }\n    }\n\n  /**** customCursor ****/\n\n    get customCursor () {\n      let Match = /^url\\(([^\\)])\\)(\\s+\\d+)?(\\s+\\d+)?,/.exec(css(this.Peer,'cursor'))\n      if (Match == null) {\n        return undefined\n      } else {\n        let ImageURL = Match[1]\n        let xOffset  = parseFloat(Match[2])\n        let yOffset  = parseFloat(Match[3])\n\n        if ('\\'\"'.indexOf(ImageURL[0]) >= 0) { ImageURL = ImageURL.slice(1,ImageURL.length-1) }\n        if (! ValueIsNumberInRange(xOffset, 0,31)) { xOffset = 0 }\n        if (! ValueIsNumberInRange(yOffset, 0,31)) { yOffset = 0 }\n\n        return { ImageURL, xOffset, yOffset }\n      }\n    }\n\n    set customCursor (newCustomCursor:WAT_customCursor | undefined) {\n      allowPlainObject('custom cursor',newCustomCursor)\n      if (newCustomCursor != null) {\n        expectURL('custom cursor image url',newCustomCursor.ImageURL)\n        expectNumberInRange('custom cursor x offset',newCustomCursor.xOffset, 0,31)\n        expectNumberInRange('custom cursor y offset',newCustomCursor.yOffset, 0,31)\n      }\n\n      let CursorSpec     = css(this.Peer,'cursor')\n      let standardCursor = (\n        CursorSpec.indexOf(',') > 0\n        ? CursorSpec.replace(/^.*,\\s*/,'')\n        : CursorSpec\n      )\n\n      if (newCustomCursor == null) {\n        applyStyleToVisual(this, 'cursor',standardCursor)\n      } else {\n        applyStyleToVisual(this, 'cursor',(\n          'url(\"' + newCustomCursor.ImageURL + '\") ' +\n          Math.round(newCustomCursor.xOffset) + 'px ' + Math.round(newCustomCursor.yOffset) + 'px, ' +\n          standardCursor\n        ))\n      }\n    }\n\n  /**** trigger ****/\n\n    public trigger (...ArgumentList:any):void {\n      triggerEventFromVisual(this,...ArgumentList)\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                                 WAT_Applet                                 //\n//----------------------------------------------------------------------------//\n\n  export class WAT_Applet extends WAT_Visual {\n  /**** Name ****/\n\n    get Name () {\n      let Candidate = data(PeerOfVisual(this),'wat-name')\n      return (ValueIsUniversalName(Candidate) ? Candidate : undefined)\n    }\n\n    set Name (newName:string) { throwReadOnlyError('Name') }\n\n  /**** globalVisual ****/\n\n    public globalVisual (globalName:WAT_Name):WAT_Visual {\n      expectUniversalName('global visual name',globalName)\n      if (globalName[0] === '#') {\n        return globalVisualOfApplet(this,globalName)\n      } else {\n        throwError('InvalidArgument: the given visual name is not a global one')\n      }\n    }\n\n  /**** isBeingPreserved ****/\n\n    get isBeingPreserved () {\n      return (InternalsOfVisual(this).BackupStatus === 'isBeingPreserved')\n    }\n    set isBeingPreserved (newState:any) { throwReadOnlyError('isBeingPreserved') }\n\n  /**** isBeingRestored ****/\n\n    get isBeingRestored () {\n      return (InternalsOfVisual(this).BackupStatus === 'isBeingRestored')\n    }\n    set isBeingRestored (newState:any) { throwReadOnlyError('isBeingRestored') }\n\n  /**** isBeingRemoved ****/\n\n    get isBeingRemoved () {\n      return (InternalsOfVisual(this).BackupStatus === 'isBeingRemoved')\n    }\n    set isBeingRemoved (newState:any) { throwReadOnlyError('isBeingRemoved') }\n\n  /**** CardList ****/\n\n    get CardList () {\n      let Result:WAT_Card[] = []\n        let Peer = PeerOfVisual(this)\n        filtered(Peer.children,'.WAT.Card').forEach(function (Peer) {\n          Result.push(VisualOfElement(Peer as HTMLElement) as WAT_Card)\n        })\n      return Result\n    }\n    set CardList (newCardList:any) { throwReadOnlyError('CardList') }\n\n  /**** CardLabelList ****/\n\n    get CardLabelList () {\n      let Result:WAT_Label[] = []\n        let Peer = PeerOfVisual(this)\n        filtered(Peer.children,'.WAT.Card').forEach(function (Peer) {\n          Result.push(VisualOfElement(Peer as HTMLElement).Label)\n        })\n      return Result\n    }\n    set CardLabelList (newLabelList:any) { throwReadOnlyError('CardLabelList') }\n\n  /**** CardCount ****/\n\n    get CardCount () {\n      let Peer = PeerOfVisual(this)\n      return filtered(Peer.children,'.WAT.Card').length\n    }\n    set CardCount (newCardCount:any) { throwReadOnlyError('CardCount') }\n\n  /**** Card ****/\n\n    public Card (CardOrNameOrIndex:WAT_Card|WAT_Name|number):WAT_Card | undefined {\n      switch (true) {\n        case ValueIsCard(CardOrNameOrIndex): return (\n          (CardOrNameOrIndex as WAT_Card).Applet === this\n          ? CardOrNameOrIndex as WAT_Card\n          : undefined\n        )\n        case ValueIsOrdinal(CardOrNameOrIndex):\n          return this.CardAtIndex(CardOrNameOrIndex as number)\n        case ValueIsName(CardOrNameOrIndex):\n          return this.CardNamed(CardOrNameOrIndex as WAT_Name)\n        default: throwError(\n          'InvalidArgument: card, card name or card index expected'\n        )\n      }\n    }\n\n  /**** CardAtIndex ****/\n\n    public CardAtIndex (Index:number):WAT_Card | undefined {\n      expectOrdinal('card index',Index)\n      return this.CardList[Index]\n    }\n\n  /**** CardNamed ****/\n\n    public CardNamed (Name:WAT_Name):WAT_Card | undefined {\n      expectName('card name',Name)\n\n      let Result:WAT_Card | undefined = undefined\n        let Peer = this.Peer\n        filtered(Peer.children,'.WAT.Card').forEach((Peer) => {\n          let Candidate = VisualForElement(Peer as HTMLElement) as WAT_Card\n          if (Candidate.Name === Name) { Result = Candidate }\n        })\n      return Result\n    }\n\n  /**** CardLabelled ****/\n\n    public CardLabelled (Label:WAT_Label):WAT_Card | undefined {\n      expectLabel('card label',Label)\n\n      let Result:WAT_Card | undefined = undefined\n        let Peer = this.Peer\n        filtered(Peer.children,'.WAT.Card').forEach((Peer) => {\n          let Candidate = VisualForElement(Peer as HTMLElement) as WAT_Card\n          if (Candidate.Label === Label) { Result = Candidate }\n        })\n      return Result\n    }\n\n  /**** IndexOfCard ****/\n\n    public IndexOfCard (CardOrNameOrIndex:WAT_Card|WAT_Name|number):number {\n      let Card = this.Card(CardOrNameOrIndex)\n      return (Card == null ? -1 : this.CardList.indexOf(Card))\n    }\n\n  /**** acceptsCardAt ****/\n\n    public acceptsCardAt (\n      CardOrNameOrIndex:WAT_Card|WAT_Name|number,\n      InsertionPoint?:WAT_Card|WAT_Name|number\n    ):boolean {\n      let Index = this.IndexOfCard(CardOrNameOrIndex)\n      if (Index >= 0) {\n        return this.CardMayBeShiftedTo(Index,InsertionPoint as number)\n      }                            // let \"CardMayBeShiftedTo\" do the validation\n\n      Index = (\n        InsertionPoint == null\n        ? this.CardCount\n        : this.IndexOfCard(InsertionPoint)\n      )\n      if (Index < 0) { return false }\n\n      return true\n    }\n\n  /**** acceptsNewCardAt - but only for an existing master ****/\n\n    public acceptsNewCardAt (\n      Master:WAT_Name,\n      InsertionPoint?:WAT_Card|WAT_Name|number\n    ):boolean {\n//    expectName('master name',Master)                  // will be checked below\n\n      let MasterInfo = existingInfoForMaster(Master)\n      if (MasterInfo.Category !== 'Card') { return false }\n\n      let Index = (\n        InsertionPoint == null\n        ? this.CardCount\n        : this.IndexOfCard(InsertionPoint)\n      )\n      if (Index < 0) { return false }\n\n      return true\n    }\n\n  /**** newCardInsertedAt - but only for an existing master ****/\n\n    public newCardInsertedAt (\n      Master:WAT_Name, InsertionPoint?:WAT_Card|WAT_Name|number\n    ):WAT_Card {\n//    expectName('master name',Master)                  // will be checked below\n\n      let MasterInfo = existingInfoForMaster(Master)\n      if (MasterInfo.Category !== 'Card') throwError(\n        'InvalidMaster: the given master cannot be used for a (new) card'\n      )\n\n      let Index = (\n        InsertionPoint == null\n        ? this.CardCount\n        : this.IndexOfCard(InsertionPoint)\n      )\n      if (Index < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      return this.CardDeserializedFrom(MasterInfo.Template,Index)\n    }\n\n  /**** DuplicateOfCard ****/\n\n    public DuplicateOfCard (CardOrNameOrIndex:WAT_Card|WAT_Name|number):WAT_Card {\n      let Index = this.IndexOfCard(CardOrNameOrIndex)\n      if (Index < 0) throwError(\n        'InvalidArgument: the given card does not exist or is not part of ' +\n        'this applet'\n      )\n\n      let CardSerialization = serializedVisual(this.CardList[Index])\n      return this.CardDeserializedFrom(CardSerialization,Index+1)\n    }\n\n  /**** CardDeserializedFrom ****/\n\n    public CardDeserializedFrom (\n      Serialization:string, InsertionPoint?:WAT_Card|WAT_Name|number\n    ):WAT_Card {\n      expectText('card serialization',Serialization)\n\n      let Index = (\n        InsertionPoint == null\n        ? this.CardCount\n        : this.IndexOfCard(InsertionPoint)\n      )\n      if (Index < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      let CardPeer = ElementFromHTML(Serialization)\n\n      let NeighbourCard = this.CardAtIndex(Index)\n      if (NeighbourCard == null) {\n        this.Peer.append(CardPeer)\n      } else {\n       this.Peer.insertBefore(CardPeer,NeighbourCard.Peer)\n      }\n\n      let newCard\n        try {\n          newCard = VisualBuiltFromPeer(CardPeer,'Card') as WAT_Card\n        } catch (Signal) {\n          remove(CardPeer)\n          throw Signal\n        }\n\n        if (! this.acceptsCardAt(newCard,Index)) {\n          remove(CardPeer)\n          throwError(\n            'InvalidOperation: the given serialized card must not be ' +\n            'inserted into this applet'\n          )\n        }\n      return newCard\n    }\n\n  /**** CardMayBeShiftedUp/Down ****/\n\n    public CardMayBeShiftedUp (CardOrNameOrIndex:WAT_Card|WAT_Name|number):boolean {\n      return (this.IndexOfCard(CardOrNameOrIndex) > 0)\n    }\n\n    public CardMayBeShiftedDown (CardOrNameOrIndex:WAT_Card|WAT_Name|number):boolean {\n      let oldIndex = this.IndexOfCard(CardOrNameOrIndex)\n      return (oldIndex >= 0) && (oldIndex < this.CardCount-1)\n    }\n\n  /**** CardMayBeShiftedTo ****/\n\n    public CardMayBeShiftedTo (\n      CardOrNameOrIndex:WAT_Card|WAT_Name|number,\n      InsertionPoint:WAT_Card|WAT_Name|number\n    ):boolean {\n      let oldIndex = this.IndexOfCard(CardOrNameOrIndex)\n      let newIndex = this.IndexOfCard(InsertionPoint)\n\n      return (oldIndex >= 0) && (newIndex >= 0) && (oldIndex !== newIndex)\n    }\n\n  /**** shiftCardUp/Down ****/\n\n    public shiftCardUp (CardOrNameOrIndex:WAT_Card|WAT_Name|number):void {\n      let oldIndex = this.IndexOfCard(CardOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given card does not exist or is not part of ' +\n        'this applet'\n      )\n\n      if (oldIndex > 0) {\n        let prevCard = this.CardAtIndex(oldIndex-1) as WAT_Card\n        this.CardAtIndex(oldIndex)?.Peer.insertBefore(prevCard.Peer)\n      }\n    }\n\n    public shiftCardDown (CardOrNameOrIndex:WAT_Card|WAT_Name|number):void {\n      let oldIndex = this.IndexOfCard(CardOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given card does not exist or is not part of ' +\n        'this applet'\n      )\n\n      if (oldIndex < this.CardCount-1) {\n        let nextCard = this.CardAtIndex(oldIndex+1) as WAT_Card\n        this.CardAtIndex(oldIndex)?.Peer.insertAfter(nextCard.Peer)\n      }\n    }\n\n  /**** shiftCardTo ****/\n\n    public shiftCardTo (\n      CardOrNameOrIndex:WAT_Card|WAT_Name|number,\n      InsertionPoint:WAT_Card|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfCard(CardOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given card does not exist or is not part of ' +\n        'this applet'\n      )\n\n      let newIndex = this.IndexOfCard(InsertionPoint)\n      if (newIndex < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      if (oldIndex === newIndex) { return }\n\n      let Card = this.CardAtIndex(oldIndex) as WAT_Card\n      if (oldIndex === 0) {\n        this.Peer.prepend(Card.Peer)\n      } else {\n        if (oldIndex < newIndex) { newIndex += 1 }\n\n        let prevCard = this.CardAtIndex(newIndex)\n        if (prevCard == null) {\n          this.Peer.append(Card.Peer)\n        } else {\n          Card.Peer.insertAfter(prevCard.Peer)\n        }\n      }\n    }\n\n  /**** removeCard ****/\n\n    public removeCard (CardOrNameOrIndex:WAT_Card|WAT_Name|number):void {\n      let Card = this.Card(CardOrNameOrIndex)\n      if (Card == null) { return }                  // this method is idempotent\n\n      releaseVisual(Card,'recursively')\n      remove(Card.Peer)\n\n      if (this.CardCount === 0) {  // an applet should always contain >= 1 cards\n        css(this.newCardInsertedAt('plainCard',0).Peer,'visibility','visible')\n      }\n    }\n\n  /**** shownCard ****/\n\n    get shownCard () {\n      let CardList = this.CardList\n      for (let i = 0, l = CardList.length; i < l; i++) {\n        if (CardList[i].isVisible) { return CardList[i] }\n      }\n\n      if (CardList.length === 0) {\n        CardList = [this.newCardInsertedAt('plainCard',0)]\n      }\n\n      this.showCard(CardList[0])\n      return CardList[0]\n    }\n\n    set shownCard (newCard:WAT_Card) { throwReadOnlyError('shownCard') }\n\n  /**** shownCardIndex ****/\n\n    get shownCardIndex () {\n      let CardList = this.CardList\n      for (let i = 0, l = CardList.length; i < l; i++) {\n        if (CardList[i].isVisible) { return i }\n      }\n\n      if (CardList.length === 0) {\n        CardList = [this.newCardInsertedAt('plainCard',0)]\n      }\n\n      this.showCard(CardList[0])\n      return 0\n    }\n\n    set shownCardIndex (newIndex:number) { throwReadOnlyError('shownCardIndex') }\n\n  /**** CardIsShown ****/\n\n    public CardIsShown (CardOrNameOrIndex:WAT_Card|WAT_Name|number):boolean {\n      let CardIndex = this.IndexOfCard(CardOrNameOrIndex)\n      return (CardIndex >= 0) && (this.CardAtIndex(CardIndex) as WAT_Card).isVisible\n    }\n\n  /**** showCard ****/\n\n    public showCard (CardOrNameOrIndex:WAT_Card|WAT_Name|number):void {\n      let CardIndex = this.IndexOfCard(CardOrNameOrIndex)\n      if (CardIndex < 0) {\n        throwError(\n          'InvalidArgument: the given card does not exist or is not part of ' +\n          'this applet'\n        )\n      } else {\n        let CardElement = PeerOfVisual(this.CardAtIndex(CardIndex) as WAT_Card)\n\n        filtered(this.Peer.children,'.WAT.Card').forEach((Peer) => {\n          if (Peer === CardElement) {\n            css(Peer as HTMLElement, 'visibility','visible')\n          } else {\n            css(Peer as HTMLElement, 'visibility','hidden')\n          }\n        })\n      }\n    }\n\n  /**** showFirst/Prev/Next/LastCard ****/\n\n    public showFirstCard ():void {\n      this.showCard(0)\n    }\n\n    public showPrevCard ():void {\n      this.showCard(Math.max(0,this.shownCardIndex-1))\n    }\n\n    public showPreviousCard ():void {\n      this.showCard(Math.max(0,this.shownCardIndex-1))\n    }\n\n    public showNextCard ():void {\n      this.showCard(Math.min(this.shownCardIndex+1,this.CardCount-1))\n    }\n\n    public showLastCard ():void {\n      this.showCard(this.CardCount-1)\n    }\n\n  /**** OverlayList ****/\n\n    get OverlayList () {\n      let Result:WAT_Overlay[] = []\n        let Peer = PeerOfVisual(this)\n        filtered(Peer.children,'.WAT.Overlay').forEach(function (Peer) {\n          Result.push(VisualOfElement(Peer as HTMLElement) as WAT_Overlay)\n        })\n      return Result\n    }\n    set OverlayList (newOverlayList:any) { throwReadOnlyError('OverlayList') }\n\n  /**** OverlayLabelList ****/\n\n    get OverlayLabelList () {\n      let Result:WAT_Label[] = []\n        let Peer = PeerOfVisual(this)\n        filtered(Peer.children,'.WAT.Overlay').forEach(function (Peer) {\n          Result.push(VisualOfElement(Peer as HTMLElement).Label)\n        })\n      return Result\n    }\n    set OverlayLabelList (newLabelList:any) { throwReadOnlyError('OverlayLabelList') }\n\n  /**** OverlayCount ****/\n\n    get OverlayCount () {\n      let Peer = PeerOfVisual(this)\n      return filtered(Peer.children,'.WAT.Overlay').length\n    }\n    set OverlayCount (newOverlayCount:any) { throwReadOnlyError('OverlayCount') }\n\n  /**** Overlay ****/\n\n    public Overlay (OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number):WAT_Overlay | undefined {\n      switch (true) {\n        case ValueIsOverlay(OverlayOrNameOrIndex): return (\n          (OverlayOrNameOrIndex as WAT_Overlay).Applet === this\n          ? OverlayOrNameOrIndex as WAT_Overlay\n          : undefined\n        )\n        case ValueIsOrdinal(OverlayOrNameOrIndex):\n          return this.OverlayAtIndex(OverlayOrNameOrIndex as number)\n        case ValueIsName(OverlayOrNameOrIndex):\n          return this.OverlayNamed(OverlayOrNameOrIndex as WAT_Name)\n        default: throwError(\n          'InvalidArgument: overlay, overlay name or overlay index expected'\n        )\n      }\n    }\n\n  /**** OverlayAtIndex ****/\n\n    public OverlayAtIndex (Index:number):WAT_Overlay | undefined {\n      expectOrdinal('card index',Index)\n      return this.OverlayList[Index]\n    }\n\n  /**** OverlayNamed ****/\n\n    public OverlayNamed (Name:WAT_Name):WAT_Overlay | undefined {\n      expectName('overlay name',Name)\n\n      let Result:WAT_Overlay | undefined = undefined\n        let Peer = this.Peer\n        filtered(Peer.children,'.WAT.Overlay').forEach((Peer) => {\n          let Candidate = VisualForElement(Peer as HTMLElement) as WAT_Overlay\n          if (Candidate.Name === Name) { Result = Candidate }\n        })\n      return Result\n    }\n\n  /**** OverlayLabelled ****/\n\n    public OverlayLabelled (Label:WAT_Label):WAT_Overlay | undefined {\n      expectLabel('overlay label',Label)\n\n      let Result:WAT_Overlay | undefined = undefined\n        let Peer = this.Peer\n        filtered(Peer.children,'.WAT.Overlay').forEach((Peer) => {\n          let Candidate = VisualForElement(Peer as HTMLElement) as WAT_Overlay\n          if (Candidate.Label === Label) { Result = Candidate }\n        })\n      return Result\n    }\n\n  /**** IndexOfOverlay ****/\n\n    public IndexOfOverlay (OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number):number {\n      let Overlay = this.Overlay(OverlayOrNameOrIndex)\n      return (Overlay == null ? -1 : this.OverlayList.indexOf(Overlay))\n    }\n\n  /**** acceptsOverlayAt ****/\n\n    public acceptsOverlayAt (\n      OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number,\n      InsertionPoint?:WAT_Overlay|WAT_Name|number\n    ):boolean {\n      let Index = this.IndexOfOverlay(OverlayOrNameOrIndex)\n      if (Index >= 0) {\n        return this.OverlayMayBeShiftedTo(Index,InsertionPoint as number)\n      }                         // let \"OverlayMayBeShiftedTo\" do the validation\n\n      Index = (\n        InsertionPoint == null\n        ? this.OverlayCount\n        : this.IndexOfOverlay(InsertionPoint)\n      )\n      if (Index < 0) { return false }\n\n      return true\n    }\n\n  /**** acceptsNewOverlayAt - but only for an existing master ****/\n\n    public acceptsNewOverlayAt (\n      Master:WAT_Name,\n      InsertionPoint?:WAT_Overlay|WAT_Name|number\n    ):boolean {\n//    expectName('master name',Master)                  // will be checked below\n\n      let MasterInfo = existingInfoForMaster(Master)\n      if (MasterInfo.Category !== 'Overlay') { return false }\n\n      let Index = (\n        InsertionPoint == null\n        ? this.OverlayCount\n        : this.IndexOfOverlay(InsertionPoint)\n      )\n      if (Index < 0) { return false }\n\n      return true\n    }\n\n  /**** newOverlayInsertedAt - but only for an existing master ****/\n\n    public newOverlayInsertedAt (\n      Master:WAT_Name, InsertionPoint?:WAT_Overlay|WAT_Name|number\n    ):WAT_Overlay {\n//    expectName('master name',Master)                  // will be checked below\n\n      let MasterInfo = existingInfoForMaster(Master)\n      if (MasterInfo.Category !== 'Overlay') throwError(\n        'InvalidMaster: the given master cannot be used for a (new) overlay'\n      )\n\n      let Index = (\n        InsertionPoint == null\n        ? this.OverlayCount\n        : this.IndexOfOverlay(InsertionPoint)\n      )\n      if (Index < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      return this.OverlayDeserializedFrom(MasterInfo.Template,Index)\n    }\n\n  /**** DuplicateOfOverlay ****/\n\n    public DuplicateOfOverlay (OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number):WAT_Overlay {\n      let Index = this.IndexOfOverlay(OverlayOrNameOrIndex)\n      if (Index < 0) throwError(\n        'InvalidArgument: the given overlay does not exist or is not part of ' +\n        'this applet'\n      )\n\n      let OverlaySerialization = serializedVisual(this.OverlayList[Index])\n      return this.OverlayDeserializedFrom(OverlaySerialization,Index+1)\n    }\n\n  /**** OverlayDeserializedFrom ****/\n\n    public OverlayDeserializedFrom (\n      Serialization:string, InsertionPoint?:WAT_Overlay|WAT_Name|number\n    ):WAT_Overlay {\n      expectText('overlay serialization',Serialization)\n\n      let Index = (\n        InsertionPoint == null\n        ? this.OverlayCount\n        : this.IndexOfOverlay(InsertionPoint)\n      )\n      if (Index < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      let OverlayPeer = ElementFromHTML(Serialization)\n\n      let NeighbourOverlay = this.OverlayAtIndex(Index)\n      if (NeighbourOverlay == null) {\n        this.Peer.append(OverlayPeer)\n      } else {\n        this.Peer.insertBefore(OverlayPeer,NeighbourOverlay.Peer)\n      }\n\n      let newOverlay\n        try {\n          newOverlay = VisualBuiltFromPeer(OverlayPeer,'Overlay') as WAT_Overlay\n        } catch (Signal) {\n          remove(OverlayPeer)\n          throw Signal\n        }\n\n        if (! this.acceptsOverlayAt(newOverlay,Index)) {\n          remove(OverlayPeer)\n          throwError(\n            'InvalidOperation: the given serialized overlay must not be ' +\n            'inserted into this applet'\n          )\n        }\n      return newOverlay\n    }\n\n  /**** OverlayMayBeShiftedUp/Down ****/\n\n    public OverlayMayBeShiftedUp (OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number):boolean {\n      return (this.IndexOfOverlay(OverlayOrNameOrIndex) > 0)\n    }\n\n    public OverlayMayBeShiftedDown (OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number):boolean {\n      let oldIndex = this.IndexOfOverlay(OverlayOrNameOrIndex)\n      return (oldIndex >= 0) && (oldIndex < this.OverlayCount-1)\n    }\n\n  /**** OverlayMayBeShiftedTo ****/\n\n    public OverlayMayBeShiftedTo (\n      OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number,\n      InsertionPoint:WAT_Overlay|WAT_Name|number\n    ):boolean {\n      let oldIndex = this.IndexOfOverlay(OverlayOrNameOrIndex)\n      let newIndex = this.IndexOfOverlay(InsertionPoint)\n\n      return (oldIndex >= 0) && (newIndex >= 0) && (oldIndex !== newIndex)\n    }\n\n  /**** shiftOverlayUp/Down ****/\n\n    public shiftOverlayUp (\n      OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfOverlay(OverlayOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given overlay does not exist or is not part of ' +\n        'this applet'\n      )\n\n      if (oldIndex > 0) {\n        let prevOverlay = this.OverlayAtIndex(oldIndex-1) as WAT_Overlay\n        this.OverlayAtIndex(oldIndex)?.Peer.insertBefore(prevOverlay.Peer)\n      }\n    }\n\n    public shiftOverlayDown (\n      OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfOverlay(OverlayOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given overlay does not exist or is not part of ' +\n        'this applet'\n      )\n\n      if (oldIndex < this.OverlayCount-1) {\n        let nextOverlay = this.OverlayAtIndex(oldIndex+1) as WAT_Overlay\n        this.OverlayAtIndex(oldIndex)?.Peer.insertAfter(nextOverlay.Peer)\n      }\n    }\n\n  /**** shiftOverlayTo ****/\n\n    public shiftOverlayTo (\n      OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number,\n      InsertionPoint:WAT_Overlay|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfOverlay(OverlayOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given overlay does not exist or is not part of ' +\n        'this applet'\n      )\n\n      let newIndex = this.IndexOfOverlay(InsertionPoint)\n      if (newIndex < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      if (oldIndex === newIndex) { return }\n\n      let Overlay = this.OverlayAtIndex(oldIndex) as WAT_Overlay\n      if (oldIndex === 0) {\n        this.Peer.prepend(Overlay.Peer)\n      } else {\n        if (oldIndex < newIndex) { newIndex += 1 }\n\n        let prevOverlay = this.OverlayAtIndex(newIndex)\n        if (prevOverlay == null) {\n          this.Peer.append(Overlay.Peer)\n        } else {\n          Overlay.Peer.insertAfter(prevOverlay.Peer)\n        }\n      }\n    }\n\n  /**** removeOverlay ****/\n\n    public removeOverlay (OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number):void {\n      let Overlay = this.Overlay(OverlayOrNameOrIndex)\n      if (Overlay == null) { return }               // this method is idempotent\n\n      releaseVisual(Overlay,'recursively')\n      remove(Overlay.Peer)\n    }\n\n  /**** frontmostOverlayOfClass ****/\n\n    public frontmostOverlayOfClass (ClassName:WAT_Name):WAT_Overlay | undefined {\n      expectName('HTML class name',ClassName)\n\n      let PeerList = filtered(this.Peer.children,'.WAT.Overlay.' + ClassName)\n      let Candidate = PeerList[PeerList.length-1]\n      return (\n        Candidate == null\n        ? undefined\n        : VisualOfElement(Candidate) as WAT_Overlay\n      )\n    }\n\n  /**** bringOverlayToFrontOfClass ****/\n\n    public bringOverlayToFrontOfClass (\n      OverlayOrNameOrIndex:WAT_Overlay|WAT_Name|number, ClassName:WAT_Name\n    ):void {\n      expectName('HTML class name',ClassName)\n\n      let Overlay = this.Overlay(OverlayOrNameOrIndex)\n      if (Overlay == null) throwError(\n        'InvalidArgument: the given overlay does not exist or is not part of ' +\n        'this applet'\n      )\n\n      let OverlayPeer = Overlay.Peer\n      if (! OverlayPeer.classList.contains(ClassName)) throwError(\n        'InvalidArgument: the given overlay does not have class ' +\n        quoted(ClassName) + ' itself'\n      )\n\n      let OverlayFound = false\n      filtered(this.Peer.children,'.WAT.Overlay.' + ClassName).forEach((Peer) => {\n        switch (true) {\n          case (OverlayPeer === Peer): OverlayFound = true; break\n          case OverlayFound:           this.Peer.insertBefore(Peer,OverlayPeer)\n        }             // does not touch Overlay itself (keeps menus etc. intact)\n      })\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                               WAT_Container                                //\n//----------------------------------------------------------------------------//\n\n  export abstract class WAT_Container extends WAT_Visual {\n  /**** ComponentList ****/\n\n    get ComponentList () {\n      let Result:(WAT_Control|WAT_Compound)[] = []\n        let Peer = PeerOfVisual(this)\n        filtered(Peer.children,'.WAT.Control,.WAT.Compound').forEach(function (Peer) {\n          Result.push(VisualOfElement(Peer as HTMLElement) as WAT_Control|WAT_Compound)\n        })\n      return Result\n    }\n    set ComponentList (newComponentList:any) { throwReadOnlyError('ComponentList') }\n\n  /**** ComponentLabelList ****/\n\n    get ComponentLabelList () {\n      let Result:WAT_Label[] = []\n        let Peer = PeerOfVisual(this)\n        filtered(Peer.children,'.WAT.Control,.WAT.Compound').forEach(function (Peer) {\n          Result.push(VisualOfElement(Peer as HTMLElement).Label)\n        })\n      return Result\n    }\n    set ComponentLabelList (newLabelList:any) { throwReadOnlyError('ComponentLabelList') }\n\n  /**** ComponentCount ****/\n\n    get ComponentCount () {\n      let Peer = PeerOfVisual(this)\n      return filtered(Peer.children,'.WAT.Control,.WAT.Compound').length\n    }\n    set ComponentCount (newComponentCount:any) { throwReadOnlyError('ComponentCount') }\n\n  /**** Component ****/\n\n    public Component (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):WAT_Control|WAT_Compound|undefined {\n      switch (true) {\n        case ValueIsControl(ComponentOrNameOrIndex): return (\n          (ComponentOrNameOrIndex as WAT_Control).Container === this\n          ? ComponentOrNameOrIndex as WAT_Control\n          : undefined\n        )\n        case ValueIsCompound(ComponentOrNameOrIndex): return (\n          (ComponentOrNameOrIndex as WAT_Compound).Container === this\n          ? ComponentOrNameOrIndex as WAT_Compound\n          : undefined\n        )\n        case ValueIsOrdinal(ComponentOrNameOrIndex):\n          return this.ComponentAtIndex(ComponentOrNameOrIndex as number)\n        case ValueIsName(ComponentOrNameOrIndex):\n          return this.ComponentNamed(ComponentOrNameOrIndex as WAT_Name)\n        default: throwError(\n          'InvalidArgument: component, component name or component index expected'\n        )\n      }\n    }\n\n  /**** ComponentAtIndex ****/\n\n    public ComponentAtIndex (Index:number):WAT_Control|WAT_Compound|undefined {\n      expectOrdinal('component index',Index)\n      return this.ComponentList[Index]\n    }\n\n  /**** ComponentNamed ****/\n\n    public ComponentNamed (Name:WAT_Name):WAT_Control|WAT_Compound|undefined {\n      expectName('component name',Name)\n\n      let Result:WAT_Control|WAT_Compound|undefined = undefined\n        let Peer = this.Peer\n        filtered(Peer.children,'.WAT.Control,.WAT.Compound').forEach((Peer) => {\n          let Candidate = VisualForElement(Peer as HTMLElement) as WAT_Control|WAT_Compound\n          if (Candidate.Name === Name) { Result = Candidate }\n        })\n      return Result\n    }\n\n  /**** ComponentLabelled ****/\n\n    public ComponentLabelled (Label:WAT_Label):WAT_Control|WAT_Compound|undefined {\n      expectLabel('component label',Label)\n\n      let Result:WAT_Control|WAT_Compound|undefined = undefined\n        let Peer = this.Peer\n        filtered(Peer.children,'.WAT.Control,.WAT.Compound').forEach((Peer) => {\n          let Candidate = VisualForElement(Peer as HTMLElement) as WAT_Control|WAT_Compound\n          if (Candidate.Label === Label) { Result = Candidate }\n        })\n      return Result\n    }\n\n  /**** IndexOfComponent ****/\n\n    public IndexOfComponent (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):number {\n      let Component = this.Component(ComponentOrNameOrIndex)\n      return (Component == null ? -1 : this.ComponentList.indexOf(Component))\n    }\n\n  /**** acceptsComponentAt ****/\n\n    public acceptsComponentAt (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number,\n      InsertionPoint?:WAT_Control|WAT_Compound|WAT_Name|number\n    ):boolean {\n      let Index = this.IndexOfComponent(ComponentOrNameOrIndex)\n      if (Index >= 0) {\n        return this.ComponentMayBeShiftedTo(Index,InsertionPoint as number)\n      }                       // let \"ComponentMayBeShiftedTo\" do the validation\n\n      Index = (\n        InsertionPoint == null\n        ? this.ComponentCount\n        : this.IndexOfComponent(InsertionPoint)\n      )\n      if (Index < 0) { return false }\n\n      return true\n    }\n\n  /**** acceptsNewComponentAt - but only for an existing master ****/\n\n    public acceptsNewComponentAt (\n      Master:WAT_Name,\n      InsertionPoint?:WAT_Control|WAT_Compound|WAT_Name|number\n    ):boolean {\n//    expectName('master name',Master)                  // will be checked below\n\n      let MasterInfo = existingInfoForMaster(Master)\n      if (\n        (MasterInfo.Category !== 'Control') &&\n        (MasterInfo.Category !== 'Compound')\n      ) { return false }\n\n      let Index = (\n        InsertionPoint == null\n        ? this.ComponentCount\n        : this.IndexOfComponent(InsertionPoint)\n      )\n      if (Index < 0) { return false }\n\n      return true\n    }\n\n  /**** newComponentInsertedAt - but only for an existing master ****/\n\n    public newComponentInsertedAt (\n      Master:WAT_Name,\n      InsertionPoint?:WAT_Control|WAT_Compound|WAT_Name|number\n    ):WAT_Control|WAT_Compound {\n//    expectName('master name',Master)                  // will be checked below\n\n      let MasterInfo = existingInfoForMaster(Master)\n      if (\n        (MasterInfo.Category !== 'Control') &&\n        (MasterInfo.Category !== 'Compound')\n      ) throwError(\n        'InvalidMaster: the given master cannot be used for a (new) component'\n      )\n\n      let Index = (\n        InsertionPoint == null\n        ? this.ComponentCount\n        : this.IndexOfComponent(InsertionPoint)\n      )\n      if (Index < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      return this.ComponentDeserializedFrom(MasterInfo.Template,Index)\n    }\n\n  /**** DuplicateOfComponent ****/\n\n    public DuplicateOfComponent (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):WAT_Control|WAT_Compound {\n      let Index = this.IndexOfComponent(ComponentOrNameOrIndex)\n      if (Index < 0) throwError(\n        'InvalidArgument: the given component does not exist or is not part ' +\n        'of this applet'\n      )\n\n      let ComponentSerialization = serializedVisual(this.ComponentList[Index])\n      return this.ComponentDeserializedFrom(ComponentSerialization,Index+1)\n    }\n\n  /**** ComponentDeserializedFrom ****/\n\n    public ComponentDeserializedFrom (\n      Serialization:string,\n      InsertionPoint?:WAT_Control|WAT_Compound|WAT_Name|number\n    ):WAT_Control|WAT_Compound {\n      expectText('component serialization',Serialization)\n\n      let Index = (\n        InsertionPoint == null\n        ? this.ComponentCount\n        : this.IndexOfComponent(InsertionPoint)\n      )\n      if (Index < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this container'\n      )\n\n      let ComponentPeer = ElementFromHTML(Serialization)\n\n      let NeighbourComponent = this.ComponentAtIndex(Index)\n      if (NeighbourComponent == null) {\n        this.Peer.append(ComponentPeer)\n      } else {\n        this.Peer.insertBefore(ComponentPeer,NeighbourComponent.Peer)\n      }\n\n      let newComponent\n        try {\n          newComponent = VisualBuiltFromPeer(ComponentPeer,'Component') as WAT_Control|WAT_Compound\n        } catch (Signal) {\n          remove(ComponentPeer)\n          throw Signal\n        }\n\n        if (! this.acceptsComponentAt(newComponent,Index)) {\n          remove(ComponentPeer)\n          throwError(\n            'InvalidOperation: the given serialized component must not be ' +\n            'inserted into this container'\n          )\n        }\n      return newComponent\n    }\n\n  /**** ComponentMayBeShiftedUp/Down ****/\n\n    public ComponentMayBeShiftedUp (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):boolean {\n      return (this.IndexOfComponent(ComponentOrNameOrIndex) > 0)\n    }\n\n    public ComponentMayBeShiftedDown (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):boolean {\n      let oldIndex = this.IndexOfComponent(ComponentOrNameOrIndex)\n      return (oldIndex >= 0) && (oldIndex < this.ComponentCount-1)\n    }\n\n  /**** ComponentMayBeShiftedTo ****/\n\n    public ComponentMayBeShiftedTo (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number,\n      InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number\n    ):boolean {\n      let oldIndex = this.IndexOfComponent(ComponentOrNameOrIndex)\n      let newIndex = this.IndexOfComponent(InsertionPoint)\n\n      return (oldIndex >= 0) && (newIndex >= 0) && (oldIndex !== newIndex)\n    }\n\n  /**** shiftComponentToTop ****/\n\n    public shiftComponentToTop (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfComponent(ComponentOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given component does not exist or is not part ' +\n        'of this applet'\n      )\n\n      if (oldIndex > 0) {\n        let Component = this.ComponentAtIndex(oldIndex) as WAT_Component\n        this.Peer.prepend(Component.Peer)\n      }\n    }\n\n  /**** shiftComponentUp ****/\n\n    public shiftComponentUp (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfComponent(ComponentOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given component does not exist or is not part ' +\n        'of this applet'\n      )\n\n      if (oldIndex > 0) {\n        let prevComponent = this.ComponentAtIndex(oldIndex-1) as WAT_Component\n        this.ComponentAtIndex(oldIndex)?.Peer.insertBefore(prevComponent.Peer)\n      }\n    }\n\n  /**** shiftComponentDown ****/\n\n    public shiftComponentDown (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfComponent(ComponentOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given component does not exist or is not part ' +\n        'of this applet'\n      )\n\n      if (oldIndex < this.ComponentCount-1) {\n        let nextComponent = this.ComponentAtIndex(oldIndex+1) as WAT_Component\n        this.ComponentAtIndex(oldIndex)?.Peer.insertAfter(nextComponent.Peer)\n      }\n    }\n\n  /**** shiftComponentToBottom ****/\n\n    public shiftComponentToBottom (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfComponent(ComponentOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given component does not exist or is not part ' +\n        'of this applet'\n      )\n\n      if (oldIndex < this.ComponentCount-1) {\n        let Component = this.ComponentAtIndex(oldIndex) as WAT_Component\n        this.Peer.append(Component.Peer)\n      }\n    }\n\n  /**** shiftComponentTo ****/\n\n    public shiftComponentTo (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number,\n      InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number\n    ):void {\n      let oldIndex = this.IndexOfComponent(ComponentOrNameOrIndex)\n      if (oldIndex < 0) throwError(\n        'InvalidArgument: the given component does not exist or is not part ' +\n        'of this applet'\n      )\n\n      let newIndex = this.IndexOfComponent(InsertionPoint)\n      if (newIndex < 0) throwError(\n        'InvalidArgument: the given insertion point does not exist or is not ' +\n        'part of this applet'\n      )\n\n      if (oldIndex === newIndex) { return }\n\n      let Component = this.ComponentAtIndex(oldIndex) as WAT_Component\n      if (oldIndex === 0) {\n        this.Peer.prepend(Component.Peer)\n      } else {\n        if (oldIndex < newIndex) { newIndex += 1 }\n\n        let prevComponent = this.ComponentAtIndex(newIndex)\n        if (prevComponent == null) {\n          this.Peer.append(Component.Peer)\n        } else {\n          this.Peer.insertAfter(Component.Peer,prevComponent.Peer)\n        }\n      }\n    }\n\n  /**** ComponentMayBeRemoved ****/\n\n    public ComponentMayBeRemoved (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):boolean {\n      return (this.IndexOfComponent(ComponentOrNameOrIndex) >= 0)\n    }\n\n  /**** removeComponent ****/\n\n    public removeComponent (\n      ComponentOrNameOrIndex:WAT_Control|WAT_Compound|WAT_Name|number\n    ):void {\n      let Component = this.Component(ComponentOrNameOrIndex)\n      if (Component == null) { return }             // this method is idempotent\n\n      releaseVisual(Component,'recursively')\n      remove(Component.Peer)\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                                 WAT_Layer                                  //\n//----------------------------------------------------------------------------//\n\n  export abstract class WAT_Layer extends WAT_Container {\n\n  }\n\n//----------------------------------------------------------------------------//\n//                                  WAT_Card                                  //\n//----------------------------------------------------------------------------//\n\n  export class WAT_Card extends WAT_Layer {\n  /**** isVisible ****/\n\n    get isVisible () {\n      return (css(this.Peer,'visibility') !== 'hidden')\n    }\n\n    set isVisible (newVisibility:boolean) {\n      expectBoolean('visibility',newVisibility)\n\n      if (newVisibility === true) {\n        this.Applet.showCard(this)\n      } else {\n        throwError(\n          'InvalidArgument: a card cannot be explicitly hidden, please ' +\n          'select another card to be shown instead'\n        )\n      }\n    }\n\n  /**** show ****/\n\n    public show () { this.isVisible = true }\n\n  /**** mayBeDisplaced ****/\n\n    get mayBeDisplaced ()                   { return false }\n    set mayBeDisplaced (newSetting:boolean) { throwReadOnlyError('mayBeDisplaced') }\n\n  /**** mayBeDeformed ****/\n\n    get mayBeDeformed ()                   { return false }\n    set mayBeDeformed (newSetting:boolean) { throwReadOnlyError('mayBeDeformed') }\n\n  /**** Index ****/\n\n    get Index () { return this.Applet.IndexOfCard(this) }\n    set Index (newIndex:any) { throwReadOnlyError('Index') }\n\n  /**** mayBeShiftedUp/Down ****/\n\n    get mayBeShiftedUp () { return this.Applet.CardMayBeShiftedUp(this) }\n    set mayBeShiftedUp (newValue:any) { throwReadOnlyError('mayBeShiftedUp') }\n\n    get mayBeShiftedDown () { return this.Applet.CardMayBeShiftedDown(this) }\n    set mayBeShiftedDown (newValue:any) { throwReadOnlyError('mayBeShiftedDown') }\n\n  /**** mayBeShiftedTo ****/\n\n    public mayBeShiftedTo (InsertionPoint:WAT_Card|WAT_Name|number):boolean {\n      return this.Applet.CardMayBeShiftedTo(this,InsertionPoint)\n    }\n\n  /**** shiftUp/Down ****/\n\n    public shiftUp   ():void { this.Applet.shiftCardUp(this) }\n    public shiftDown ():void { this.Applet.shiftCardDown(this) }\n\n  /**** shiftTo ****/\n\n    public shiftTo (InsertionPoint:WAT_Card|WAT_Name|number):void {\n      this.Applet.shiftCardTo(this,InsertionPoint)\n    }\n\n  /**** mayBeRemoved ****/\n\n    get mayBeRemoved () { return this.Applet.CardMayBeRemoved(this) }\n    set mayBeRemoved (newValue:any) { throwReadOnlyError('mayBeRemoved') }\n\n  /**** remove ****/\n\n    public remove ():void {\n      this.Applet.removeCard(this)\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                                WAT_Overlay                                 //\n//----------------------------------------------------------------------------//\n\n  export class WAT_Overlay extends WAT_Layer {\n  /**** mayBeDisplaced ****/\n\n    get mayBeDisplaced ()                   { return true }\n    set mayBeDisplaced (newSetting:boolean) { throwReadOnlyError('mayBeDisplaced') }\n\n  /**** mayBeDeformed ****/\n\n    get mayBeDeformed ()                   { return true }\n    set mayBeDeformed (newSetting:boolean) { throwReadOnlyError('mayBeDeformed') }\n\n  /**** Index ****/\n\n    get Index () { return this.Applet.IndexOfOverlay(this) }\n    set Index (newIndex:any) { throwReadOnlyError('Index') }\n\n  /**** mayBeShiftedUp/Down ****/\n\n    get mayBeShiftedUp () { return this.Applet.OverlayMayBeShiftedUp(this) }\n    set mayBeShiftedUp (newValue:any) { throwReadOnlyError('mayBeShiftedUp') }\n\n    get mayBeShiftedDown () { return this.Applet.OverlayMayBeShiftedDown(this) }\n    set mayBeShiftedDown (newValue:any) { throwReadOnlyError('mayBeShiftedDown') }\n\n  /**** mayBeShiftedTo ****/\n\n    public mayBeShiftedTo (InsertionPoint:WAT_Overlay|WAT_Name|number):boolean {\n      return this.Applet.OverlayMayBeShiftedTo(this,InsertionPoint)\n    }\n\n  /**** shiftUp/Down ****/\n\n    public shiftUp   ():void { this.Applet.shiftOverlayUp(this) }\n    public shiftDown ():void { this.Applet.shiftOverlayDown(this) }\n\n  /**** shiftTo ****/\n\n    public shiftTo (InsertionPoint:WAT_Overlay|WAT_Name|number):void {\n      this.Applet.shiftOverlayTo(this,InsertionPoint)\n    }\n\n  /**** mayBeRemoved ****/\n\n    get mayBeRemoved () { return this.Applet.OverlayMayBeRemoved(this) }\n    set mayBeRemoved (newValue:any) { throwReadOnlyError('mayBeRemoved') }\n\n  /**** remove ****/\n\n    public remove ():void {\n      this.Applet.removeOverlay(this)\n    }\n\n  /**** showAround ****/\n\n    public showAround (\n      x:number,y:number, Constraint:'withinApplet'|'withinViewport' = 'withinViewport'\n    ):void {\n      expectLocation('x coordinate',x)\n      expectLocation('y coordinate',y)\n      expectOneOf('positioning constraint',Constraint,['withinApplet','withinViewport'])\n\n      let Applet = this.Applet\n\n      if (Constraint === 'withinApplet') { // x/y are coord.s relative to applet\n        x = Math.max(0, Math.min(x, Applet.Width-this.Peer.offsetWidth))\n        y = Math.max(0, Math.min(y,Applet.Height-this.Peer.offsetHeight))\n\n        changeGeometryOfVisualTo(this, x,y, undefined,undefined)\n      } else {\n        let ViewportWidth  = document.body.clientWidth\n        let ViewportHeight = Math.max(window.innerHeight,document.body.clientHeight)\n\n        x = Math.max(0, Math.min(x, ViewportWidth-this.Peer.offsetWidth))\n        y = Math.max(0, Math.min(y,ViewportHeight-this.Peer.offsetHeight))\n\n        let AppletGeometryOnDisplay = Applet.GeometryOnDisplay\n        let AppletX = AppletGeometryOnDisplay.x\n        let AppletY = AppletGeometryOnDisplay.y\n\n        changeGeometryOfVisualTo(this, x-AppletX,y-AppletY, undefined,undefined)\n      } // x/y are viewport coord.s, but Overlay is placed within its applet\n    }\n\n  /**** isFrontmostOfClass ****/\n\n    public isFrontmostOfClass (ClassName:WAT_Name):boolean {\n      return (this.Applet.frontmostOverlayOfClass(ClassName) === this)\n    }\n\n  /**** bringToFrontOfClass ****/\n\n    public bringToFrontOfClass (ClassName:WAT_Name):void {\n      this.Applet.bringOverlayToFrontOfClass(ClassName)\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                               WAT_Component                                //\n//----------------------------------------------------------------------------//\n\n  export interface WAT_Component {\n    Peer:HTMLElement,\n    trigger:(...ArgumentList:any) => void,\n\n    Index:number\n    mayBeDisplaced:boolean\n    mayBeDeformed:boolean\n    mayBeShiftedUp:boolean\n    mayBeShiftedDown:boolean\n    mayBeShiftedTo (InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number):boolean\n    shiftUp ():void\n    shiftDown ():void\n    shiftTo (InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number):void\n    remove ():void\n  }\n\n//----------------------------------------------------------------------------//\n//                                WAT_Compound                                //\n//----------------------------------------------------------------------------//\n\n  export class WAT_Compound extends WAT_Container implements WAT_Component {\n  /**** mayBeDisplaced ****/\n\n    get mayBeDisplaced () {\n      let Container = this.Container\n      if (Container == null) { return false }\n\n      let MasterInfo = MasterRegistry[Container.Master]\n      if (MasterInfo == null) { return false }\n\n      let MasterStyles = MasterInfo.Styles || {}\n      return ! (\n        ('left' in MasterStyles) ||\n        ('width' in MasterStyles) && ('right' in MasterStyles)\n      ) || ! (\n        ('top' in MasterStyles) ||\n        ('height' in MasterStyles) && ('bottom' in MasterStyles)\n      )\n    }\n\n    set mayBeDisplaced (newSetting:boolean) { throwReadOnlyError('mayBeDisplaced') }\n\n  /**** mayBeDeformed ****/\n\n    get mayBeDeformed () {\n      let Container = this.Container\n      if (Container == null) { return false }\n\n      let MasterInfo = MasterRegistry[Container.Master]\n      if (MasterInfo == null) { return false }\n\n      let MasterStyles = MasterInfo.Styles || {}\n      return ! (\n        ('width' in MasterStyles) ||\n        ('left' in MasterStyles) && ('right' in MasterStyles)\n      ) || !(\n        ('height' in MasterStyles) ||\n        ('top' in MasterStyles) && ('bottom' in MasterStyles)\n      )\n    }\n\n    set mayBeDeformed (newSetting:boolean) { throwReadOnlyError('mayBeDeformed') }\n\n  /**** Index ****/\n\n    get Index () { return this.Container.IndexOfComponent(this) }\n    set Index (newIndex:any) { throwReadOnlyError('Index') }\n\n  /**** mayBeShiftedUp/Down ****/\n\n    get mayBeShiftedUp () { return this.Container.CompoundMayBeShiftedUp(this) }\n    set mayBeShiftedUp (newValue:any) { throwReadOnlyError('mayBeShiftedUp') }\n\n    get mayBeShiftedDown () { return this.Container.CompoundMayBeShiftedDown(this) }\n    set mayBeShiftedDown (newValue:any) { throwReadOnlyError('mayBeShiftedDown') }\n\n  /**** mayBeShiftedTo ****/\n\n    public mayBeShiftedTo (InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number):boolean {\n      return this.Container.CompoundMayBeShiftedTo(this,InsertionPoint)\n    }\n\n  /**** shiftUp/Down ****/\n\n    public shiftUp   ():void { this.Container.shiftCompoundUp(this) }\n    public shiftDown ():void { this.Container.shiftCompoundDown(this) }\n\n  /**** shiftTo ****/\n\n    public shiftTo (InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number):void {\n      this.Container.shiftCompoundTo(this,InsertionPoint)\n    }\n\n  /**** mayBeRemoved ****/\n\n    get mayBeRemoved () { return this.Container.ComponentMayBeRemoved(this) }\n    set mayBeRemoved (newValue:any) { throwReadOnlyError('mayBeRemoved') }\n\n  /**** remove ****/\n\n    public remove ():void {\n      this.Container.removeCompound(this)\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                                WAT_Control                                 //\n//----------------------------------------------------------------------------//\n\n  export class WAT_Control extends WAT_Visual implements WAT_Component {\n  /**** mayBeDisplaced ****/\n\n    get mayBeDisplaced () {\n      let Container = this.Container\n      if (Container == null) { return false }\n\n      let MasterInfo = MasterRegistry[Container.Master]\n      if (MasterInfo == null) { return false }\n\n      let MasterStyles = MasterInfo.Styles || {}\n      return ! (\n        ('left' in MasterStyles) ||\n        ('width' in MasterStyles) && ('right' in MasterStyles)\n      ) || ! (\n        ('top' in MasterStyles) ||\n        ('height' in MasterStyles) && ('bottom' in MasterStyles)\n      )\n    }\n\n    set mayBeDisplaced (newSetting:boolean) { throwReadOnlyError('mayBeDisplaced') }\n\n  /**** mayBeDeformed ****/\n\n    get mayBeDeformed () {\n      let Container = this.Container\n      if (Container == null) { return false }\n\n      let MasterInfo = MasterRegistry[Container.Master]\n      if (MasterInfo == null) { return false }\n\n      let MasterStyles = MasterInfo.Styles || {}\n      return ! (\n        ('width' in MasterStyles) ||\n        ('left' in MasterStyles) && ('right' in MasterStyles)\n      ) || !(\n        ('height' in MasterStyles) ||\n        ('top' in MasterStyles) && ('bottom' in MasterStyles)\n      )\n    }\n\n    set mayBeDeformed (newSetting:boolean) { throwReadOnlyError('mayBeDeformed') }\n\n  /**** Index ****/\n\n    get Index () { return this.Container.IndexOfComponent(this) }\n    set Index (newIndex:any) { throwReadOnlyError('Index') }\n\n  /**** mayBeShiftedUp/Down ****/\n\n    get mayBeShiftedUp () { return this.Container.CompoundMayBeShiftedUp(this) }\n    set mayBeShiftedUp (newValue:any) { throwReadOnlyError('mayBeShiftedUp') }\n\n    get mayBeShiftedDown () { return this.Container.CompoundMayBeShiftedDown(this) }\n    set mayBeShiftedDown (newValue:any) { throwReadOnlyError('mayBeShiftedDown') }\n\n  /**** mayBeShiftedTo ****/\n\n    public mayBeShiftedTo (InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number):boolean {\n      return this.Container.CompoundMayBeShiftedTo(this,InsertionPoint)\n    }\n\n  /**** shiftUp/Down ****/\n\n    public shiftUp   ():void { this.Container.shiftCompoundUp(this) }\n    public shiftDown ():void { this.Container.shiftCompoundDown(this) }\n\n  /**** shiftTo ****/\n\n    public shiftTo (InsertionPoint:WAT_Control|WAT_Compound|WAT_Name|number):void {\n      this.Container.shiftCompoundTo(this,InsertionPoint)\n    }\n\n  /**** mayBeRemoved ****/\n\n    get mayBeRemoved () { return this.Container.ComponentMayBeRemoved(this) }\n    set mayBeRemoved (newValue:any) { throwReadOnlyError('mayBeRemoved') }\n\n  /**** remove ****/\n\n    public remove ():void {\n      this.Container.removeCompound(this)\n    }\n  }\n\n//----------------------------------------------------------------------------//\n//                             intrinsic Masters                              //\n//----------------------------------------------------------------------------//\n\n  MasterRegistry.plainApplet = {\n    Name:'plainApplet', Version:normalized(parsedVersion('1.0.0')), Category:'Applet',\n    Template:'<div class=\"WAT Applet\"></div>',\n    undesignablePropertySet:Object.assign(Object.create(null),{\n      Name:true, mayBeDeleted:true, Overflows:true,\n      x:true,y:true, Width:true,Height:true,\n      Position:true, Size:true, Geometry:true,\n      horizontalAnchoring:true,verticalAnchoring:true,\n      horizontalOffsets:true,verticalOffsets:true,\n      minWidth:true,maxWidth:true, minHeight:true,maxHeight:true\n    }),\n    UsageCount:0\n  }\n\n  MasterRegistry.plainCard = {\n    Name:'plainCard', Version:normalized(parsedVersion('1.0.0')), Category:'Card',\n    Template:'<div class=\"WAT Card\"></div>',\n    undesignablePropertySet:Object.assign(Object.create(null),{\n      x:true,y:true, Width:true,Height:true,\n      Position:true, Size:true, Geometry:true,\n      horizontalAnchoring:true,verticalAnchoring:true,\n      horizontalOffsets:true,verticalOffsets:true,\n      minWidth:true,maxWidth:true, minHeight:true,maxHeight:true\n    }),\n    UsageCount:0\n  }\n\n  MasterRegistry.plainOverlay = {\n    Name:'plainOverlay', Version:normalized(parsedVersion('1.0.0')), Category:'Overlay',\n    Template:'<div class=\"WAT Overlay\"></div>', UsageCount:0\n  }\n\n  MasterRegistry.plainControl = {\n    Name:'plainControl', Version:normalized(parsedVersion('1.0.0')), Category:'Control',\n    Template:'<div class=\"WAT Control\"></div>', UsageCount:0\n  }\n\n  MasterRegistry.plainCompound = {\n    Name:'plainCompound', Version:normalized(parsedVersion('1.0.0')), Category:'Compound',\n    Template:'<div class=\"WAT Compound\"></div>', UsageCount:0\n  }\n\n/**** AppletPeersInDocument ****/\n\n  export function AppletPeersInDocument ():HTMLElement[] {\n    return filtered(\n      document.body.querySelectorAll('.WAT.Applet'),\n      (Peer) => {                                  // applets must not be nested\n        return (closestParent(Peer as HTMLElement,'.WAT.Applet') == null)\n      }\n    )\n  }\n\n//----------------------------------------------------------------------------//\n//                             Designer Interface                             //\n//----------------------------------------------------------------------------//\n\n  export type WAT_Designer = {\n    startDesigning: (\n      Target:WAT_Visual|WAT_Name, Property?:WAT_Identifier,\n      x?:number, y?:number\n    ) => void,\n    layoutsApplet: (Applet:WAT_Applet) => boolean          // for event handlers\n  }\n\n  let Designer:WAT_Designer\n\n/**** registerDesigner ****/\n\n  export function registerDesigner (newDesigner:WAT_Designer):void {\n    expectPlainObject('WAT designer',newDesigner)\n\n    if (\n      ! ValueIsFunction(newDesigner.startDesigning) ||\n      ! ValueIsFunction(newDesigner.layoutsApplet)\n    ) throwError(\n      'InvalidArgument: the given object is no valid WAT Designer'\n    )\n\n    if (Designer == null) {\n      Designer = newDesigner\n    } else {\n      if (Designer !== newDesigner) throwError(\n        'DesignerExists: another WAT Designer has already been registered'\n      )\n    }\n  }\n\n/**** ready - similar to jQuery.ready ****/\n\n  let   WAT_isReady                     = false\n  const ReadyFunctionsToCall:Function[] = []\n\n  export function ready (FunctionToCall:Function):void {\n    expectFunction('function to call',FunctionToCall)\n\n    if (WAT_isReady && ! ReadyFunctionsAreRunning) {\n      return FunctionToCall()                                      // may throw!\n    } else {\n      ReadyFunctionsToCall.push(FunctionToCall)\n    }\n  }\n\n/**** invokeAllReadyFunctionsToCall - WAT is ready but applets not started ****/\n// ReadyFunctionsToCall may be extended while invokeAllReadyFunctionsToCall is running!\n\n  let ReadyFunctionsAreRunning = false\n\n  function invokeAllReadyFunctionsToCall ():void {\n    console.log('WAT is ready')\n\n    ReadyFunctionsAreRunning = true\n      for (let i = 0; i < ReadyFunctionsToCall.length; i++) {\n        try {\n          ReadyFunctionsToCall[i]()\n        } catch (signal) {\n          console.error('registered WAT \"ready\" handler failed with ',signal)\n        }\n      }\n    ReadyFunctionsAreRunning = false\n  }\n\n/**** running - similar to jQuery.ready ****/\n\n  let   WAT_isRunning                     = false\n  const RunningFunctionsToCall:Function[] = []\n\n  export function running (FunctionToCall:Function):void {\n    expectFunction('function to call',FunctionToCall)\n\n    if (WAT_isRunning && ! RunningFunctionsAreRunning) {\n      return FunctionToCall()                                      // may throw!\n    } else {\n      RunningFunctionsToCall.push(FunctionToCall)\n    }\n  }\n\n/**** invokeAllRunningFunctionsToCall - all WAT applets are running ****/\n// RunningFunctionsToCall may be extended while invokeAllRunningFunctionsToCall is running!\n\n  let RunningFunctionsAreRunning = false\n\n  function invokeAllRunningFunctionsToCall ():void {\n    console.log('WAT is running')\n\n    RunningFunctionsAreRunning = true\n      for (let i = 0; i < RunningFunctionsToCall.length; i++) {\n        try {\n          RunningFunctionsToCall[i]()\n        } catch (signal) {\n          console.error('registered WAT \"running\" handler failed with ',signal)\n        }\n      }\n    RunningFunctionsAreRunning = false\n  }\n\n//----------------------------------------------------------------------------//\n//                                WAT Start-Up                                //\n//----------------------------------------------------------------------------//\n\n  global['WAT'] = Object.assign(WAT.ready,WAT)\n\n/**** startWAT ****/\n\n  async function startWAT ():Promise<void> {\n    WAT_isReady = true\n    invokeAllReadyFunctionsToCall()\n\n    await startAllApplets()\n\n    WAT_isRunning = true\n    invokeAllRunningFunctionsToCall()\n  }\n\n/**** startAllApplets ****/\n\n  async function startAllApplets ():Promise<void> {\n    let AppletPeerList = AppletPeersInDocument()\n    await AppletPeerList.forEach(async function (AppletPeer:HTMLElement) {\n      await startAppletFromPeer(AppletPeer)\n    })\n  }\n\n/**** startAppletFromPeer ****/\n\n  async function startAppletFromPeer (AppletPeer:HTMLElement):Promise<void> {\n    let Applet\n    if (BackupIsSupported && await AppletHasBackup(AppletPeer)) {\n      Applet = await AppletRestoredIntoPeer(AppletPeer)\n    } else {\n      Applet = VisualBuiltFromPeer(AppletPeer,'Applet') // act. makes the applet\n    }\n\n    Applet.trigger('applet-started',Applet)\n  }\n\n/**** start WAT and applets ****/\n\n  function startup () {\n    defineForbiddenPropertyNames()\n    registerMastersInDocument()            // nota bene: WAT is not yet \"ready\"!\n\n    installEventHandlerForErrorIndicators()\n\n    if (BackupIsSupported) {\n      localforage.ready(function () {\n        AppletStore = localforage.createInstance({\n          name:'WAT Applets'\n        })\n\n        startWAT()\n      })\n    } else {\n      startWAT()\n    }\n  }\n\n/**** wait for the proper trigger to start WAT ****/\n\n  if (\n    (document.readyState === 'complete') ||\n    (document.readyState === 'interactive')\n  ) {\n    setTimeout(startup, 1)\n  } else {\n    window.addEventListener('DOMContentLoaded', startup)\n  }\n\n  global.WAT = WAT\n}\n"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","this","constructor","create","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","n","v","op","pop","length","push","__spreadArray","to","from","i","il","j","r","s","o","u","require","Error","code","l","exports","1","_dereq_","module","global","scheduleDrain","draining","Mutation","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","len","immediate","task","self","window","2","INTERNAL","handlers","REJECTED","FULFILLED","PENDING","resolver","state","outcome","safelyResolveThenable","QueueItem","promise","onFulfilled","onRejected","callFulfilled","otherCallFulfilled","callRejected","otherCallRejected","unwrap","func","returnValue","getThen","obj","arguments","thenable","onError","onSuccess","tryToUnwrap","tryCatch","status","out","reason","all","iterable","toString","values","resolved","allResolver","resolveFromAll","outValue","error","race","response","3","4","_typeof","_classCallCheck","instance","Constructor","getIDB","indexedDB","webkitIndexedDB","mozIndexedDB","OIndexedDB","msIndexedDB","idb","isIndexedDBValid","open","isSafari","openDatabase","test","navigator","userAgent","platform","hasFetch","fetch","indexOf","IDBKeyRange","createBlob","parts","properties","Blob","name","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","append","getBlob","type","Promise$1","executeCallback","callback","executeTwoCallbacks","errorCallback","normalizeKey","key","console","warn","getCallback","DETECT_BLOB_SUPPORT_STORE","supportsBlobs","dbContexts","READ_ONLY","READ_WRITE","_binStringToArrayBuffer","bin","buf","ArrayBuffer","arr","Uint8Array","charCodeAt","_checkBlobSupportWithoutCaching","txn","transaction","blob","objectStore","put","onabort","preventDefault","stopPropagation","oncomplete","matchedChrome","match","matchedEdge","parseInt","_checkBlobSupport","_deferReadiness","dbInfo","dbContext","deferredOperation","deferredOperations","dbReady","_advanceReadiness","_rejectReadiness","err","_getConnection","upgradeNeeded","createDbContext","db","close","dbArgs","version","openreq","onupgradeneeded","createObjectStore","storeName","oldVersion","ex","newVersion","onerror","onsuccess","_getOriginalConnection","_getUpgradedConnection","_isUpgradeNeeded","defaultVersion","isNewStore","objectStoreNames","contains","isDowngrade","isUpgrade","incVersion","_encodeBlob","reader","FileReader","onloadend","base64","btoa","target","__local_forage_encoded_blob","readAsBinaryString","_decodeBlob","encodedBlob","atob","_isEncodedBlob","_fullyReady","_initReady","_dbInfo","_tryReconnect","forages","forage","createTransaction","mode","retries","undefined","tx","_initStorage","options","ready","initPromises","ignoreErrors","slice","_defaultConfig","k","getItem","req","get","iterate","openCursor","iterationNumber","cursor","setItem","blobSupport","store","removeItem","clear","count","advanced","openKeyCursor","advance","keys","dropInstance","currentConfig","config","dbPromise","deleteObjectStore","_forage2","deleteDatabase","onblocked","asyncStorage","_driver","_support","isWebSQLValid","BASE_CHARS","BLOB_TYPE_PREFIX","BLOB_TYPE_PREFIX_REGEX","SERIALIZED_MARKER","SERIALIZED_MARKER_LENGTH","TYPE_ARRAYBUFFER","TYPE_BLOB","TYPE_INT8ARRAY","TYPE_UINT8ARRAY","TYPE_UINT8CLAMPEDARRAY","TYPE_INT16ARRAY","TYPE_INT32ARRAY","TYPE_UINT16ARRAY","TYPE_UINT32ARRAY","TYPE_FLOAT32ARRAY","TYPE_FLOAT64ARRAY","TYPE_SERIALIZED_MARKER_LENGTH","toString$1","stringToBuffer","serializedString","encoded1","encoded2","encoded3","encoded4","bufferLength","buffer","bytes","bufferToString","base64String","substring","serialize","valueType","marker","fileReader","onload","str","readAsArrayBuffer","JSON","stringify","deserialize","parse","blobType","matcher","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","localforageSerializer","createDbTable","executeSql","_initStorage$1","dbInfoPromise","description","size","serializer","tryExecuteSql","sqlStatement","args","SYNTAX_ERR","results","rows","getItem$1","item","iterate$1","_setItem","retriesLeft","originalValue","sqlError","QUOTA_ERR","setItem$1","removeItem$1","clear$1","length$1","c","key$1","keys$1","getAllStoreNames","storeNames","dropInstance$1","operationInfo","dropTable","operations","webSQLStorage","isLocalStorageValid","localStorage","_getKeyPrefix","defaultConfig","keyPrefix","checkIfLocalStorageThrows","localStorageTestKey","_isLocalStorageUsable","_initStorage$2","clear$2","getItem$2","iterate$2","keyPrefixLength","key$2","keys$2","itemKey","length$2","removeItem$2","setItem$2","dropInstance$2","localStorageWrapper","sameValue","x","isNaN","includes","array","searchElement","isArray","arg","DefinedDrivers","DriverSupport","DefaultDrivers","INDEXEDDB","WEBSQL","LOCALSTORAGE","DefaultDriverOrder","OptionalDriverMethods","LibraryMethods","concat","DefaultConfig","driver","callWhenReady","localForageInstance","libraryMethod","_args","extend","_key","localforage_js","LocalForage","driverTypeKey","driverName","defineDriver","_config","_driverSet","_initDriver","_ready","_wrapLibraryMethodsWithReady","setDriver","replace","driverObject","complianceError","driverMethods","driverMethodName","methodNotImplementedFactory","methodName","_i","_len","optionalDriverMethod","configureMissingMethods","setDriverSupport","support","info","getDriver","getDriverPromise","getSerializer","serializerPromise","drivers","supportedDrivers","_getSupportedDrivers","setDriverToConfig","extendSelfWithDriver","_extend","initDriver","currentDriverIndex","driverPromiseLoop","oldDriverSetDone","supports","libraryMethodsAndProperties","createInstance","Function","Object_hasOwnProperty","Value","PropertyName","Object_isPrototypeOf","Candidate","isPrototypeOf","throwError","Message","Match","exec","namedError","ValueIsBoolean","Boolean","ValueIsNumber","Number","ValueIsFiniteNumber","isFinite","valueOf","ValueIsNaN","ValueIsNumberInRange","minValue","maxValue","withMin","withMax","ValueIsInteger","Math","round","ValueIsOrdinal","ValueIsCardinal","ValueIsString","emptyStringPattern","ValueIsNonEmptyString","ValueIsStringMatching","Pattern","noCtrlCharsButCRLFPattern","ValueIsText","noCtrlCharsPattern","ValueIsTextline","ValueIsFunction","ValueIsAnonymousFunction","ValueIsNamedFunction","ValueIsNativeFunction","ValueIsScriptedFunction","ValueIsObject","ValueIsPlainObject","getPrototypeOf","ValueIsVanillaObject","ValueIsArray","ValueIsList","minLength","maxLength","ValueIsListSatisfying","Validator","Signal","ValueIsDate","Date","ValueIsError","ValueIsPromise","ValueIsRegExp","RegExp","ValueIsOneOf","ValueList","ValueIsColor","ColorSet","EMailAddressPattern","ValueIsEMailAddress","noCtrlCharsOrWhitespacePattern","ValueIsURL","URL","rejectNil","acceptNil","validatedArgument","Description","Argument","ValueIsValid","NilIsAcceptable","Expectation","escaped","ValidatorForClassifier","Classifier","ClassifierName","FunctionWithName","originalFunction","desiredName","defineProperty","signal","renamed","expectValue","expectedValue","allowBoolean","allowedBoolean","expectBoolean","expectedBoolean","allowNumber","allowedNumber","expectNumber","expectedNumber","allowFiniteNumber","allowedFiniteNumber","expectFiniteNumber","expectedFiniteNumber","allowNaN","allowedNaN","expectNaN","expectedNaN","allowNumberInRange","expectedNumberInRange","allowedNumberInRange","expectNumberInRange","RangeError","allowInteger","allowedInteger","expectInteger","expectedInteger","allowIntegerInRange","expectedIntegerInRange","allowedIntegerInRange","expectIntegerInRange","allowOrdinal","allowedOrdinal","expectOrdinal","expectedOrdinal","allowCardinal","allowedCardinal","expectCardinal","expectedCardinal","allowString","allowedString","expectString","expectedString","allowNonEmptyString","allowedNonEmptyString","expectNonEmptyString","expectedNonEmptyString","allowStringMatching","expectedStringMatching","allowedStringMatching","expectStringMatching","allowText","allowedText","expectText","expectedText","allowTextline","allowedTextline","expectTextline","expectedTextline","allowFunction","allowedFunction","expectFunction","expectedFunction","allowAnonymousFunction","allowedAnonymousFunction","expectAnonymousFunction","expectedAnonymousFunction","allowNamedFunction","allowedNamedFunction","expectNamedFunction","expectedNamedFunction","allowNativeFunction","allowedNativeFunction","expectNativeFunction","expectedNativeFunction","allowScriptedFunction","allowedScriptedFunction","expectScriptedFunction","expectedScriptedFunction","allowObject","allowedObject","expectObject","expectedObject","allowPlainObject","allowedPlainObject","expectPlainObject","expectedPlainObject","allowVanillaObject","allowedVanillaObject","expectVanillaObject","expectedVanillaObject","allowArray","expectedArray","allowedArray","expectArray","allowList","expectedList","allowedList","expectList","allowListSatisfying","expectedListSatisfying","allowedListSatisfying","expectListSatisfying","allowInstanceOf","expectedInstanceOf","allowedInstanceOf","expectInstanceOf","allowValueInheritingFrom","expectedValueInheritingFrom","allowedValueInheritingFrom","expectValueInheritingFrom","allowDate","allowedDate","expectDate","expectedDate","allowError","allowedError","expectError","expectedError","allowPromise","allowedPromise","expectPromise","expectedPromise","allowRegExp","allowedRegExp","expectRegExp","expectedRegExp","allowOneOf","expectedOneOf","allowedOneOf","expectOneOf","allowColor","allowedColor","expectColor","expectedColor","allowEMailAddress","allowedEMailAddress","expectEMailAddress","expectedEMailAddress","allowURL","allowedURL","expectURL","expectedURL","Text","HexCode","quotable","Quote","quoted","HTMLsafe","EOLReplacement","trim","Result","ValuesDiffer","thisValue","otherValue","thisType","abs","EPSILON","thisArray","otherArray","ArraysDiffer","thisObject","otherObject","ObjectsDiffer","ValuesAreEqual","ObjectIsEmpty","Key","StringIsEmpty","transparent","aliceblue","lightpink","antiquewhite","lightsalmon","aqua","lightseagreen","aquamarine","lightskyblue","azure","lightslategray","beige","lightslategrey","bisque","lightsteelblue","black","lightyellow","blanchedalmond","lime","blue","limegreen","blueviolet","linen","brown","magenta","burlywood","maroon","cadetblue","mediumaquamarine","chartreuse","mediumblue","chocolate","mediumorchid","coral","mediumpurple","cornflowerblue","mediumseagreen","cornsilk","mediumslateblue","crimson","mediumspringgreen","cyan","mediumturquoise","darkblue","mediumvioletred","darkcyan","midnightblue","darkgoldenrod","mintcream","darkgray","mistyrose","darkgreen","moccasin","darkgrey","navajowhite","darkkhaki","navy","darkmagenta","oldlace","darkolivegreen","olive","darkorange","olivedrab","darkorchid","orange","darkred","orangered","darksalmon","orchid","darkseagreen","palegoldenrod","darkslateblue","palegreen","darkslategray","paleturquoise","darkslategrey","palevioletred","darkturquoise","papayawhip","darkviolet","peachpuff","deeppink","peru","deepskyblue","pink","dimgray","plum","dimgrey","powderblue","dodgerblue","purple","firebrick","red","floralwhite","rosybrown","forestgreen","royalblue","fuchsia","saddlebrown","gainsboro","salmon","ghostwhite","sandybrown","gold","seagreen","goldenrod","seashell","gray","sienna","green","silver","greenyellow","skyblue","grey","slateblue","honeydew","slategray","hotpink","slategrey","indianred","snow","indigo","springgreen","ivory","steelblue","khaki","tan","lavender","teal","lavenderblush","thistle","lawngreen","tomato","lemonchiffon","turquoise","lightblue","violet","lightcoral","wheat","lightcyan","white","lightgoldenrodyellow","whitesmoke","lightgray","yellow","lightgreen","yellowgreen","lightgrey","HexColor","Color","lowerColor","toLowerCase","HexDigit","dec2hex","trunc","parseFloat","shortHexColor","WAT","TargetObject","otherObjectList","Descriptor","getOwnPropertyDescriptor","propertyIsEnumerable","toLocaleString","Prototype","Minimum","Maximum","Infinity","max","min","CharCode","fromCharCode","WAT_FontWeightValues","assign","thin","extra-light","light","normal","medium","semi-bold","bold","extra-bold","heavy","JIL","ValueIsElement","HTMLElement","ValueIsVisual","WAT_Visual","ValueIsApplet","WAT_Applet","ValueIsCard","WAT_Card","ValueIsOverlay","WAT_Overlay","ValueIsControl","WAT_Control","ValueIsCompound","WAT_Compound","ValueIsComponent","ValueIsContainer","WAT_Container","allowElement","expectElement","allowVisual","expectVisual","allowApplet","expectApplet","allowCard","expectCard","allowOverlay","expectOverlay","allowControl","expectControl","allowCompound","expectCompound","allowComponent","expectComponent","allowContainer","expectContainer","uniqueIdPattern","ValueIsUniqueId","allowUniqueId","expectUniqueId","WAT_IdPattern","ValueIsId","allowId","expectId","WAT_NamePattern","ValueIsName","allowName","expectName","WAT_UniversalNamePattern","ValueIsUniversalName","ValueIsLabel","allowUniversalName","expectUniversalName","allowLabel","expectLabel","IdentifierPattern","ValueIsIdentifier","ValueIsLocation","ValueIsDimension","allowIdentifier","expectIdentifier","allowLocation","expectLocation","allowDimension","expectDimension","SemVerPattern","ValueIsSemVer","throwReadOnlyError","Name","throwWriteOnlyError","PropertyDescriptorFor","Target","Property","camelized","Original","toUpperCase","pruned","forEach","ElementList","Handler","filtered","Filter","filter","matches","closestParent","DOMElement","Selector","outerElement","parentElement","closest","closestFilteredParent","attr","getAttribute","removeAttribute","setAttribute","css","getComputedStyle","style","html","innerHTML","dataset","allowSemVer","expectSemVer","EventHandlerRegistry","WeakMap","on","Element","EventName","onceOnly","EventNames","split","actualHandler","DOMEvent","off","currentTarget","HandlerList","set","addEventListener","registerEventHandlerIn","HandlerEntry","removeEventListener","splice","remove","ElementOrList","ElementFromHTML","HTML","auxElement","firstChild","parseHTML","Callbacks","StartTagPattern","EndTagPattern","AttributePattern","MapOf","Elements","isEmptyElement","isBlockElement","isInlineElement","isSelfClosingElement","isSpecialElement","isKeywordAttribute","doNothing","processStartTag","processEndTag","processText","processComment","Stack","parseStartTag","TagName","rest","isUnary","last","parseEndTag","Attributes_1","AttributeName","AttributeValue","escapedValue","Position","lastHTMLContent","inText","startsWith","Index","Text_1","AttributeFrom","Attributes","Attribute","deserializedTag","VersionPattern","parsedVersion","Version","MatchList","major","minor","Patch","Build","normalized","initialTimestamp","getTime","currentTimestamp","now","ResourceCollection","UsageCountOfResource","registerResources","Resources","processResources","unregisterResources","Mode","ResourceAttributes","ResourceContent","ResourceInfoList","AttributeSetFrom","AttributeList","processResource","newResourceInfo","ResourceInfo","Info_A","Info_B","Form","Type","Media","Title","noModule","ResourceInfosAreMatching","isTopLevel","AttributeSet","src","media","title","parsedResources","Resource","matchingResource","matchingElement","head","children","tagName","textContent","ResourceInfoMatchesElement","ElementMatchingResourceInfo","reuseResource","unuseResource","collectResource","AppletStore","BackupIsSupported","localforage","AppletsMayBePreserved","AppletHasBackup","AppletOrPeer","AppletName","normalizedAppletName","_a","_b","Signal_1","AppletRestoredIntoPeer","Peer","Serialization","Signal_2","deserializeAppletIntoPeer","VisualOfElement","validateBackupAccessForApplet","Applet","InternalsOfVisual","BackupStatus","serializedMaster","Master","withPendingSettings","MasterInfo","MasterRegistry","copyDetails","DetailNames","DetailName","Detail","MasterRecord","undesignableProperties","undesignablePropertySet","join","serializedVisual","Visual","withUniqueId","triggerRecursively","trigger","Category","CardList","Card","OverlayList","Overlay","ComponentList","Component","preserveUniqueIdIn","VisualForDOMElement","InternalsForVisual","uniqueId","outerHTML","removeUniqueIdFrom","parsedSerialization","ElementType","ElementContent","serializedResources","serializedMasters","serializedApplets","serializedCards","serializedOverlays","serializedComponents","Classes","deserializedMaster","MasterObject","parsedMaster","CollisionHandling","WAT_isReady","WAT_isRunning","oldApplet","delete","MasterInfoList_1","MasterIsIntrinsic","registerMaster","auxiliaryPeer","hasChildNodes","attributes","StyleSet","VisualBuiltFromPeer","AppletInternals","VisualList","withMasters","withResources","MasterList","MastersUsedByVisuals","MasterSet","querySelectorAll","ScriptElement","MasterName","MasterInfoFromElement","allMastersInDocument","ResourcesList_1","collectedResources","Serializations","serializedVisuals","Signal_3","Signal_4","Signal_5","internalPropertyNames","internalPropertyNameSet","expectedProperty","Identifier","validatePropertyName","Label","EditorType","WAT_PropertyEditorTypes","InputPattern","FalseValue","TrueValue","multiple","StepValue","forbiddenPropertyNames","definePropertyGetterForVisual","Getter","configurable","enumerable","writable","definePropertySetterForVisual","Setter","outerPeerOf","GeometryOfVisual","PeerOfVisual","offsetLeft","Width","offsetWidth","offsetTop","Height","offsetHeight","changeGeometryOfVisualTo","horizontalAnchoring","oldLeft","oldWidth","oldRight","verticalAnchoring","oldTop","oldHeight","oldBottom","StyleChanges","changeStyles","additionalChanges","horizontalAnchoringOfVisual","NaN","dx","left","right","width","verticalAnchoringOfVisual","dy","top","bottom","height","applyStylesToVisual","expectedName","allowedSemVer","WAT_Categories","pendingResources","Template","pendingTemplate","parsedClasses","pendingClasses","Styles","parsedStyles","pendingStyles","Script","pendingScript","Properties","PropertyList","parsedPropertySet","Specification","parsedProperties","parsedUndesignableProperties","plainMaster","ErrorInfo","compiledScript","UsageCount","ClassNames","StyleElement","random","implementation","createHTMLDocument","sheet","cssRules","StylePresets","PropertyValue","getPropertyValue","MasterMayBeRegistered","Relationship","VersionA","VersionB","VersionAeqB","RelationshipAreplacingB","intrinsicMasterSet","compileScriptIntoMaster","refreshInstancesOfMaster","unregisterMaster","releaseMaster","longMessage","shortMessage","message","Reason","firstAppletPeer","AppletPeersInDocument","Sufferer","refreshVisual","existingInfoForMaster","renameMaster","oldName","newName","updateInstances","oldMasterInfo","serializedClasses","serializedStyles","MasterHasProperty","renamePropertyOfMaster","oldIdentifier","newIdentifier","PropertyIndex","IndexOfPropertyOfMaster","withoutIntrinsics","collectMastersUsedByVisual","plainApplet","plainCard","plainOverlay","plainControl","plainCompound","globalVisualOfApplet","globalName","globalVisualSet","registerGlobalVisualOfApplet","unregisterGlobalVisualOfApplet","ReactivityContext","FunctionKeySet","reactiveVariableSet","FunctionStack","FunctionVarSet","FunctionVarCount","FunctionVarList","VarFunctionSet","recalculating","RecalculationError","activeVarSet","pendingFunctionSet","pendingFunctionList","resetCalculation","getReactiveVariable","VariableName","VarName","registerFunctionForVariable","registerFunctionsForVariable","globalVisual","setReactiveVariable","newValue","definitely","wasControlValueChange","equalValues","FunctionSet","FunctionSetHasChanged","FunctionKey","sort","FunctionKey_A","FunctionKey_B","VarCount_A","VarCount_B","extendCalculationBy","shift","calculateReactiveFunction","recalculate","registerReactiveFunctionOfVisual","VarNames","toBeInvokedOnRegistration","KeyCounter","reactiveFunctionList","VarNameList","VarSet","VarList","unregisterReactiveFunctionOfVisual","reactiveVarSet","unshift","$","firstArg","secondArg","thirdArg","clearReactiveVariable","unregisterReactiveFunctionsOfVisual","newMasterInfo","newSemVer","newResources","newTemplate","newClasses","newStyles","newScript","newIndex","oldIndex","missingMasterSet","missingMasterList","unusedMasterList","swallowEventWhileLayouting","Event","Designer","AppletPeer","layoutsApplet","registerEventHandlerForVisual","TapPoint","EventSelector","EventHandler","ArgumentList","TapPointSelector_1","TapElement","Internals","EventHandlers","unregisterEventHandlerForVisual","TapPointSelector_2","allowedName","triggerEventFromVisual","InjectionPoint","InjectionPointSelector_1","InjectionElement","ErrorInfoOfVisual","setErrorInfoOfVisual","newErrorInfo","Origin","detail","VisualRegistry","VisualForElement","AppletOfPeer","MasterOfPeer","allowedCategory","DefaultCategory","classList","CategoryOfPeer","CategoryContradictsExpectation","originalCategory","Visual_1","VisualOfCategory","Applet_1","buildInnerVisuals","buildVisualFromPeer","Class","add","Version_1","VersionOfPeer","VersionAmatchesB","insertBefore","NameOfPeer","State","StateOfPeer","VisualScript","ScriptOfPeer","toGet","bind","toSet","on_1","off_1","trigger_1","Reactivity","uniqueIdCounter","newVisual","oldVisual","serializedId","newId","newUniqueId","applyStyleToVisual","StyleName","StyleValue","MasterStyle","newStyleSet","MasterStyles","oldMaster","releaseVisual","recursively","unregisterAllEventHandlersForVisual","newPeer","newAttachment","getElementById","newLabel","newCategory","newMaster","ContainerPeer","newContainer","LayerPeer","newLayer","newApplet","newDesignability","newDeletability","newVisibility","newEmergence","isVisible","disabled","newEnabling","newDisabling","isEnabled","PropertySet","newPropertySet","newState","newPendingScript","clearPendingScriptError","pendingScriptError","newError","newClassNameList","ClassName","KeyList","ClassNameSet","ClassNameList","className","rawValue","newTabIndex","newPointerSensitivity","normalizedOverflow","Overflow","Overflows","horizontalOverflow","newOverflows","WAT_Overflows","newTextOverflow","WAT_TextOverflows","newOpacity","newX","newY","newWidth","newHeight","Geometry","newPosition","newSize","newGeometry","boundingRect","getBoundingClientRect","newAnchoring","WAT_horizontalAnchorings","changeHorizontalAnchoringOfVisualTo","WAT_verticalAnchorings","changeVerticalAnchoringOfVisualTo","horizontalOffsetsOfVisual","newOffsets","offsets","changeHorizontalOffsetsOfVisualTo","verticalOffsetsOfVisual","changeVerticalOffsetsOfVisualTo","newMinimum","maxWidth","newMaximum","maxHeight","xOnDisplay","yOnDisplay","GeometryOnDisplay","newFontFamily","newFontSize","FontWeight","BoldnessIndex","WAT_FontWeights","newFontWeight","FontStyle","newFontStyle","WAT_FontStyles","LineHeight","FontSize","newLineHeight","textDecorationColor","textDecorationLine","textDecorationStyle","textDecorationThickness","WAT_TextDecorationLines","Thickness","Line","Style","WAT_TextDecorationStyles","newTextDecoration","text-decoration-color","text-decoration-line","text-decoration-style","text-decoration-thickness","TextShadow","xOffset","yOffset","BlurRadius","newTextShadow","newTextAlignment","WAT_TextAlignments","newColor","ForegroundColor","backgroundImage","backgroundPosition","backgroundSize","backgroundRepeat","ImageURL","Positions","endsWith","newTexture","WAT_BackgroundModes","background-image","background-position","background-size","background-repeat","BackgroundSize","newBorderWidths","border-top-width","border-right-width","border-bottom-width","border-left-width","newBorderColors","border-top-color","border-right-color","border-bottom-color","border-left-color","normalizedBorderStyle","WAT_BorderStyles","newBorderStyles","border-top-style","border-right-style","border-bottom-style","border-left-style","newBorderRadii","border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","BoxShadow","isInset","SpreadRadius","newBoxShadow","CursorSpec","newCursor","WAT_Cursors","newCustomCursor","standardCursor","newCardList","newLabelList","newCardCount","CardOrNameOrIndex","CardAtIndex","CardNamed","InsertionPoint","IndexOfCard","CardMayBeShiftedTo","CardCount","CardDeserializedFrom","CardSerialization","newCard","CardPeer","NeighbourCard","acceptsCardAt","prevCard","nextCard","insertAfter","prepend","newCardInsertedAt","showCard","CardIndex","CardElement_1","shownCardIndex","newOverlayList","newOverlayCount","OverlayOrNameOrIndex","OverlayAtIndex","OverlayNamed","IndexOfOverlay","OverlayMayBeShiftedTo","OverlayCount","OverlayDeserializedFrom","OverlaySerialization","newOverlay","OverlayPeer","NeighbourOverlay","acceptsOverlayAt","prevOverlay","nextOverlay","PeerList","OverlayFound","_this","newComponentList","newComponentCount","ComponentOrNameOrIndex","Container","ComponentAtIndex","ComponentNamed","IndexOfComponent","ComponentMayBeShiftedTo","ComponentCount","ComponentDeserializedFrom","ComponentSerialization","newComponent","ComponentPeer","NeighbourComponent","acceptsComponentAt","prevComponent","nextComponent","newSetting","CardMayBeShiftedUp","CardMayBeShiftedDown","shiftCardUp","shiftCardDown","shiftCardTo","CardMayBeRemoved","removeCard","WAT_Layer","OverlayMayBeShiftedUp","OverlayMayBeShiftedDown","shiftOverlayUp","shiftOverlayDown","shiftOverlayTo","OverlayMayBeRemoved","removeOverlay","Constraint","ViewportWidth","clientWidth","ViewportHeight","innerHeight","clientHeight","AppletGeometryOnDisplay","frontmostOverlayOfClass","bringOverlayToFrontOfClass","CompoundMayBeShiftedUp","CompoundMayBeShiftedDown","CompoundMayBeShiftedTo","shiftCompoundUp","shiftCompoundDown","shiftCompoundTo","ComponentMayBeRemoved","removeCompound","mayBeDeleted","Size","horizontalOffsets","verticalOffsets","minWidth","minHeight","newDesigner","startDesigning","ReadyFunctionsToCall","FunctionToCall","ReadyFunctionsAreRunning","RunningFunctionsToCall","RunningFunctionsAreRunning","startWAT","log","invokeAllReadyFunctionsToCall","startAllApplets","invokeAllRunningFunctionsToCall","startAppletFromPeer","startup","ErrorOccurred","processPrototype","defineForbiddenPropertyNames","compatibleDowngrade","incompatibleDowngrade","sameVersion","compatibleUpgrade","incompatibleUpgrade","alert","ErrorIndicator","affectedVisual","mayBeDesigned","confirm","readyState"],"mappings":"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"}